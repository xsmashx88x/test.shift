<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" type="image/png" href="https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHiFT Codes - Tracker + More</title>
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="Borderlands4 SHiFT Codes - Tracker + Info Hub + More">
    <meta property="og:description" content="Track and manage Borderlands SHiFT codes + Info Hub + More">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card tags -->
    <meta name="twitter:title" content="Borderlands4 SHiFT Codes - Tracker + Info Hub +  More">
    <meta name="twitter:description" content="Track and manage Borderlands4 SHiFT codes + Info Hub +  More">
        <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
  <body>



    <div class="noise"></div>
    <div class="scanlines"></div>
    
    <div class="container">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&display=swap');
        

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Chakra Petch', sans-serif;
            text-align: center;
            padding: 20px;
            background: #000000;
            color: #fff;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 30%, #000000 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, #000000 0%, transparent 50%);
        }
        
        .container {
            max-width: 650px;
            margin: 0 auto;
            background: rgb(31 31 31);
            padding: 25px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(255, 198, 0, 0.4);
            border: 2px solid #ffc600;
            position: relative;
        }
        
        .container:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ffc600, #ff7c00, #ffc600);
            box-shadow: 0 0 10px #ffc600;
        }
/* button for feedback |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
/* START: Thin Line Tally Button */
/* START: Corrected Thin Line Tally Button Styles */

/* START: Solid Thin Line Tally Button */


/* === START: NEW STYLE FOR LAST COPIED ITEM === */
.code-box.last-copied,
.permanent-code-box.last-copied,
.expired-code-box.last-copied,
.black-market-code-box.last-copied {
    border: 2px solid #00ffff !important; /* A bright cyan border */
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.6) !important; /* A matching cyan glow */
}
/* === END: NEW STYLE === */


/* ===== FAINT BACKGROUND IMAGE FOR ACTIVE CODES ===== */

/* 1. Prepare the main code box to contain a background layer */
.code-box {
    position: relative; /* This is crucial for positioning the background image */
    overflow: hidden;   /* This prevents the background image from spilling outside the box */
}

/* 2. Create a pseudo-element that will act as the background image layer */
.code-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;

    /* --- CUSTOMIZE YOUR IMAGE HERE --- */
    background-image: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/activekeysv2.png'); /* URL to the Vault Symbol image */

    background-repeat: no-repeat;
    background-position: center;
    background-size: cover; /* 'contain' fits the whole image; 'cover' fills the whole box */
    
    /* --- MAKE IT FAINT --- */
    opacity: 0.1; /* Adjust between 0.0 (invisible) and 1.0 (fully visible) */
    
    z-index: 0; /* Places this layer behind the text and other content */
}

/* 3. Ensure the actual content (text, buttons, etc.) sits on top of the new background */
.code-box > * {
    position: relative;
    z-index: 1;
}

/* =================================================== */
/*    FAINT BACKGROUND IMAGES FOR OTHER CODE BOXES     */
/* =================================================== */

/* ===== 1. EXPIRED CODES ===== */
.expired-code-box {
    position: relative;
    overflow: hidden;
}
.expired-code-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    /* --- CUSTOMIZE YOUR IMAGE HERE --- */
    background-image: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/expiredcodes.png'); /* Suggested: Red/Cracked Vault Symbol */
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    opacity: 0.1; /* Very faint for expired boxes */
    z-index: 0;
}

/* ===== 2. BLACK MARKET CODES ===== */
.black-market-code-box {
    position: relative;
    overflow: hidden;
}
.black-market-code-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    /* --- CUSTOMIZE YOUR IMAGE HERE --- */
    background-image: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/blackmarketbgv1.png'); /* Suggested: Maurice Icon */
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    opacity: 0.1; /* Adjust faintness */
    z-index: 0;
}

/* ===== 3. PERMANENT/DROP CODES ===== */
.permanent-code-box {
    position: relative;
    overflow: hidden;
}
.permanent-code-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    /* --- CUSTOMIZE YOUR IMAGE HERE --- */
    background-image: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/dropskinsanmore.png'); /* Suggested: Diamond Key Icon */
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    opacity: 0.1; /* Adjust faintness */
    z-index: 0;
}

/* ===== 4. ENSURE CONTENT STAYS ON TOP (Apply to all boxes) ===== */
.expired-code-box > *,
.black-market-code-box > *,
.permanent-code-box > * {
    position: relative;
    z-index: 1;
}


/* =================================================== */
/*        FINAL: INTERACTIVE FLOATING INFO PANEL       */
/* =================================================== */

/* --- 1. The Main Container --- */
/* This is the element that floats and contains everything */
.floating-info-panel {
    /* REMOVED: position, top, left, transform, z-index */
    position: relative; /* This makes it a normal block element */
    width: 100%;      /* Make it span the full width of the container */
    margin-bottom: 0px; /* Add space between it and the "Connect/Contact" button below */
    
    background: rgba(20, 15, 25, 0.9);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid #ff7c00;
    border-radius: 4px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
    
    text-align: center;
    transition: all 0.3s ease-in-out;
}

/* --- 2. The Always-Visible Text Block --- */
.visible-reminder-text {
    color: #ffc600;
    font-family: 'Chakra Petch', sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-shadow: 1px 1px 1px #000;
    text-transform: uppercase;
    padding: 8px 12px;
    user-select: none;
    line-height: 1.0;
}

/* --- 3. The Smaller Clickable Link --- */
.thank-you-link {
    display: block; /* Makes it take its own line */
    margin-top: 5px; /* Space from the text above */
    color: #00ffff; /* A different color to show it's a special link */
    font-size: 12px;
    font-weight: 700;
    text-decoration: none;
    cursor: pointer;
    transition: color 0.2s ease;
    position: relative; /* Needed for the arrow */
}

.thank-you-link:hover {
    color: #fff;
}

/* --- 4. The Hidden Content (Default State) --- */
.thank-you-content {
    color: #f7f4f0;
    font-size: 14px;
    line-height: 1.6;
    text-align: left;
    
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out, border 0.3s ease;
    padding: 0 15px;
    border-top: 1px solid transparent;
}

.thank-you-content h4 { color: #fff; margin-bottom: 8px; }
.thank-you-content ul { list-style-type: none; padding-left: 0; }
.thank-you-content li { margin-bottom: 5px; }

/* --- 5. The "Open" State --- */
.floating-info-panel.is-open .thank-you-content {
    max-height: 70vh; /* Set a max height based on 70% of the screen's height */
    overflow-y: auto; /* Add a vertical scrollbar ONLY when the content is too long */
    padding: 15px;
    border-top: 1px solid rgba(255, 124, 0, 0.5);
}

/* --- 6. The Animated Arrow on the Link --- */
.thank-you-link::after {
    content: '‚ñº';
    font-size: 10px;
    margin-left: 8px;
    display: inline-block;
    transition: transform 0.3s ease-in-out;
}

.floating-info-panel.is-open .thank-you-link::after {
    transform: rotate(180deg); /* Flips arrow up */
}


/*|||||||||||||||||||||||||||||||||||||||||||||||||||||*/

 /* Title section text ish        ||||||||||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||*/
      /* activekeys title color |||||||||||||||||||||||||*/    
        h1 {
            color: #ffc600;
            margin-bottom: 15px;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 0 #000, 0 0 2px rgba(255, 198, 0, 0.7);
            font-weight: 700;
        }
    /* perm drops title color |||||||||||||||||||||||||*/
        h2 {
            color: #FF00F7;
            margin: 25px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #ff7c00;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 0 #000;
        }
            /* expired |||||||||||||||||||||||||*/
        h3 {
            color: #F91515;
            margin: 25px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #ff7c00;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 0 #000;
        }
        
        /* Social links styling ||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||||||||||||*/
/* =================================================== */
/*           HIGH-TECH CONTACT ME SECTION              */
/* =================================================== */

/* =================================================== */
/*    INTERACTIVE HIGH-TECH CONTACT ME SECTION (v2)    */
/* =================================================== */

/* --- The Main Wrapper --- */
.contact-me-section {
    border: 2px solid #00ffff;
    padding: 20px 15px;
    margin: 10px 0;
    background: rgba(17, 26, 34, 0.6);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
    text-align: center;
    clip-path: polygon(0 0, 100% 0, 100% 95%, 95% 100%, 0 100%);
    border-radius: 0;
    
    /* NEW: Add a transition to the container itself for smooth size changes */
    transition: padding-bottom 0.4s ease-in-out;
}

/* --- The "Contact Me" Title --- */
.contact-me-title {
    color: #00ffff;
    font-family: 'Chakra Petch', sans-serif;
    text-transform: uppercase;
    font-weight: 700;
    font-size: 18px;
    letter-spacing: 2px;
    text-shadow: 0 0 2px rgba(0, 255, 255, 0.8);
    margin: 0;
    
    /* NEW: Make the title look clickable */
    cursor: pointer;
}

/* =================================================== */
/*           THE SLIDE-DOWN EFFECT LOGIC (CORRECTED)   */
/* =================================================== */

/* 1. This new wrapper now handles the slide-down animation */
.slide-down-content {
    /* --- HIDING & ANIMATION LOGIC --- */
    max-height: 0;
    overflow: hidden;
    margin: 0;
    transition: max-height 0.4s ease-in-out, margin-top 0.4s ease-in-out;
}

/* 2. The hover effect now targets the new wrapper to reveal everything */
.contact-me-section:hover .slide-down-content {
    max-height: 200px; /* Adjust if content gets taller */
    margin-top: 20px;
}

/* --- REPLACE THE OLD .info-text RULE WITH THIS --- */
.info-text {
    /* Copied from your .social-links a style */
    color: #00ffff;
    text-decoration: none;
    font-size: 16px;
    font-weight: 700;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    clip-path: polygon(0 0, 100% 0, 100% 75%, 90% 100%, 0 100%);
    border-radius: 0;
    background: #111a22;
    border: 2px solid #00ffff;
    text-shadow: 0 0 2px rgba(0, 255, 255, 0.7);
    box-shadow: inset 0 0 5px rgba(0, 255, 255, 0.3);

    /* Properties to make it center and wrap nicely */
    display: block;           /* Make it a block element */
    width: fit-content;       /* Size the "button" to the text inside it */
    margin: 0 auto 15px auto; /* Center it horizontally and add space below */
}

/* 4. Your original .social-links rule, now ONLY for button layout */
.social-links {
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
}

/* 5. YOUR ORIGINAL BUTTON STYLES - UNCHANGED AND PERFECT */
.social-links a {
    color: #00ffff;
    text-decoration: none;
    font-size: 16px;
    font-weight: 700;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    clip-path: polygon(0 0, 100% 0, 100% 75%, 90% 100%, 0 100%);
    border-radius: 0;
    background: #111a22;
    border: 2px solid #00ffff;
    text-shadow: 0 0 2px rgba(0, 255, 255, 0.7);
    box-shadow: inset 0 0 5px rgba(0, 255, 255, 0.3);
    transition: all 0.2s ease;
}

.social-links a:hover,
.social-links a:focus-visible {
    color: #111a22;
    background: #00ffff;
    transform: translateY(-2px);
    box-shadow: 0 2px 15px rgba(0, 255, 255, 0.5);
    outline: none;
}

/*||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/

 /* active and perm code boxs |||||||||||||||||||||||||*/       
        .code-box {
            background: linear-gradient(135deg, #3A2A1A, #5C3C10); /* Gold-themed */
            color: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            text-align: left;
            transition: transform 0.2s;
            border: 2px solid #D4A017; 
            box-shadow: 0 0 8px rgba(212, 160, 23, 0.3); 
            position: relative;
        }

        .code-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 12px rgba(255, 179, 71, 0.5); 
        }
  /* old perm box? keep as it does the style |||||||||||||||||||||||||*/       
        .permanent-code-box {
            background: linear-gradient(135deg, #1b3b6a 0%, #0f2552 100%);
            color: white;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: left;
            transition: transform 0.2s;
            border: 1px solid #4a90e2;
            box-shadow: 0 0 4px rgba(74, 144, 226, 0.4);
            position: relative;
        }
        
        .permanent-code-box:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 6px rgba(74, 144, 226, 0.6);
        }
/* New style for Black Market Vendor */
.black-market-code-box {
    background: linear-gradient(135deg, #4d0000, #2d0000); /* Dark red/black */
    border: 2px solid #ff4444; /* Red border */
    box-shadow: 0 0 8px rgba(255, 68, 68, 0.3);
    color: #ffcccc; /* Default text color */
    padding: 15px; /* This padding was already correct */
    margin: 12px 0; /* Changed from 15px to 12px to match .code-box */
    border-radius: 4px;
    text-align: left;
    transition: transform 0.2s;
    position: relative;
}
        .black-market-code-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 12px rgba(255, 68, 68, 0.5);
        }
        .black-market-code-box .code-text { color: #ffaa99; }
        .black-market-code-box .title-container { color: #ff9999; }
        .black-market-code-box .expire-date { color: #ffcccc; }
        .black-market-code-box .countdown {
            color: #ffaaaa;
            border: 1px solid #ffaaaa;
        }
        /* Redeemed style for black market vendor */
        .black-market-code-box.redeemed {
            opacity: 0.7;
            position: relative;
                        border: 2px solid #44ff44;
        }
        .black-market-code-box.redeemed::after {
            content: "REDEEMED";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 24px;
            font-weight: bold;
            color: #7cff7c; /* Green checkmark color */
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(124, 255, 124, 0.7);
            z-index: 10;
            pointer-events: none;
        }
        .black-market-code-box.redeemed .code-text {
            color: #7cff7c !important;
        }

/* style change for the  code box section |||||||||||||||||||||||||*/        
        .code-box {
            background: linear-gradient(135deg, #3A2A1A 0%, #5C3C10 100%);
            color: #D4A017;
            padding: 15px;
            margin: 12px 0;
            border-radius: 4px;
            text-align: left;
            border: 2px solid #D4A017;
            box-shadow: 0 0 5px rgba(255, 68, 68, 0.3);
            position: relative;
        }
        
        .code-box .code-text {
            color: #FFBC01;
            text-shadow: 1px 1px 0 #400000;
        }
        
        .code-box .title-container {
            color: #FFBC01;
        }
        
        .code-box .expire-date {
            color: #FFBC01;
        }
        
        .code-box.redeemed {
        /*    background: linear-gradient(135deg, #2c5a2c 100%, #1c3a1c 100%); */
            border: 2px solid #44ff44;
            box-shadow: 0 0 5px rgba(68, 255, 68, 0.3);
        }
        
        .code-boxredeemed .code-text {
            color: #7cff7c !important;
            text-shadow: 1px 1px 0 #004000;
        }
        
       /*    .expired-code-box.redeemed .title-container {
            color: #9eff9e;
        }  */
        
         /*  .expired-code-box.redeemed .expire-date {
            color: #aaffaa; 
        } */

/* style change for the expired code box section |||||||||||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||||||*/        
        .expired-code-box {
            background: linear-gradient(135deg, #5a2c2c 0%, #3a1c1c 100%);
            color: #ff9999;
            padding: 15px;
            margin: 12px 0;
            border-radius: 4px;
            text-align: left;
            border: 2px solid #ff4444;
            box-shadow: 0 0 5px rgba(255, 68, 68, 0.3);
            position: relative;
        }
        
        .expired-code-box .code-text {
            color: #ff6666;
            text-shadow: 1px 1px 0 #400000;
        }
        
        .expired-code-box .title-container {
            color: #ff9999;
        }
        
        .expired-code-box .expire-date {
            color: #ffaaaa;
        }
        
        .expired-code-box.redeemed {
        /*    background: linear-gradient(135deg, #2c5a2c 100%, #1c3a1c 100%); */
            border: 2px solid #44ff44;
            box-shadow: 0 0 5px rgba(68, 255, 68, 0.3);
        }
        
        .expired-code-box.redeemed .code-text {
            color: #7cff7c !important;
            text-shadow: 1px 1px 0 #004000;
        }
        
       /*    .expired-code-box.redeemed .title-container {
            color: #9eff9e;
        }  */
        
         /*  .expired-code-box.redeemed .expire-date {
            color: #aaffaa; 
        } */
/* active code text color gold  |||||||||||||||||||||||||*/            
        .code-text {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            margin: 12px 0;
            word-break: break-all;
            letter-spacing: 1px;
            color: #ffc600;
            text-shadow: 1px 1px 0 #000;
        }
 /* active code text color gold ffc600 : not sure if works  |||||||||||||||||||||||||*/          
        .permanent-code-text {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            margin: 0 0 4px 0;
            word-break: break-all;
            letter-spacing: 0.5px;
            color: #ffc600;
            text-shadow: 1px 1px 0 #000, 0 0 5px rgba(255, 198, 0, 0.7);
            line-height: 1.2;
        }
        
        .code-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 198, 0, 0.3);
        }
        
.permanent-code-footer {
    display: flex !important; /* Force flex */
    flex-direction: row !important; /* Force row layout */
    justify-content: space-between; 
    align-items: center; 
    gap: 5px !important; /* Tighter gap for the whole footer */
    margin-top: 10px;
    padding-top: 8px;
    border-top: 1px solid rgba(107, 168, 255, 0.3);
}


 /* active copy button |||||||||||||||||||||*/       
        .small-copy-btn {
            background: linear-gradient(to bottom, #ff7c00, #e56a00);
            border: 1px solid #ffc600;
            color: #fff;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            order: 2;
        }
        
        .small-copy-btn:hover {
            background: linear-gradient(to bottom, #ff8c00, #ff6a00);
            transform: scale(1.05);
            box-shadow: 0 0 6px #ffc600;
        }
   /* permanent copy button |||||||||||||||||||||*/         
        .permanent-copy-btn {
            background: linear-gradient(to bottom, #B634D7, #AA2EC9);
            border: 1px solid #DE57FF;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            order: 2;
        }
        
        .permanent-copy-btn:hover {
            background: linear-gradient(to bottom, #AA2EC9, #B634D7);
            transform: scale(1.05);
            box-shadow: 0 0 4px #DE57FF;
        }
       /* expired copy button |||||||||||||||||||||*/         
        .expired-copy-btn {
            background: linear-gradient(to bottom, #EE2222, #DF2525);
            border: 1px solid #FF5757;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            order: 2;
        }
        
        .expired-copy-btn:hover {
            background: linear-gradient(to bottom, #DF2525, #EE2222);
            transform: scale(1.05);
            box-shadow: 0 0 4px #FF5757;
        }    
        .countdown {
            font-size: 14px;
            font-weight: bold;
            color: #ff7c00;
            margin: 8px 0;
            padding: 4px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            text-shadow: 1px 1px 0 #000;
            border: 1px solid #ff7c00;
        }
        
        .expire-date {
            font-size: 13px;
            color: #ff9e40;
            margin: 4px 0;
            font-style: italic;
            text-shadow: 1px 1px 0 #000;
        }
 /* active code text color gold 6ba8ff : not sure if works  |||||||||||||||||||||||||*/         
        .permanent-text {
            font-size: 10px;
            color: #E600FF;
            margin: 0;
            font-weight: bold;
            text-shadow: 1px 1px 0 #000, 0 0 3px rgba(107, 168, 255, 0.5);
            display: inline-block;
        }
        
        .copied-message {
            color: #7cff7c;
            font-weight: bold;
            display: none;
            margin-left: 5px;
            font-size: 11px;
            text-shadow: 1px 1px 0 #000;
            order: 3;
        }
        
        .permanent-copied-message {
            color: #7cff7c;
            font-weight: bold;
            display: none;
            margin-left: 5px;
            font-size: 11px;
            text-shadow: 1px 1px 0 #000;
            order: 3;
        }
        /* redeem button orange go to shift site ///////////////////*/        
/* This is the NEW button style */
.rewards-link {
    display: block;
    width: fit-content;            
    
    /* --- CHANGES ARE HERE --- */
    background: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/logo-cab3d495b9331db152448ceb0d5a52ebc2001b33aeca60e74419b730ee5a630f.png') no-repeat 15px center, linear-gradient(to bottom, #ff7c00, #e56a00);
    background-size: 320px 50px, auto; /* First value for image, second for gradient */
    padding: 2px 24px 2px 50px;       /* Increased left padding to make room for the image */
    /* --- END OF CHANGES --- */

    color: white;
    text-decoration: none;
    border-radius: 4px;
    margin: 10px auto 15px auto;
    font-weight: bold;
    transition: all 0.3s;
    font-size: 14px;
    text-transform: uppercase;
    border: 2px solid #ffc600;
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
    font-family: 'Chakra Petch', sans-serif;
}
        
.rewards-link:hover {
    /* Add the image layer to the hover effect as well */
    background: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/logo-cab3d495b9331db152448ceb0d5a52ebc2001b33aeca60e74419b730ee5a630f.png') no-repeat 15px center, linear-gradient(to bottom, #ff8c00, #ff6a00);
    background-size: 320px 50px, auto; /* Don't forget to include size here too */
    
    transform: scale(1.05);
    box-shadow: 0 0 10px #ffc600;
}
              
            .info-button {
            display: block; /* Default to block for stacking */
            width: fit-content; /* Make width fit content */
            margin: 10px auto; /* Default for stacking: center horizontally, provide vertical space */
            flex-shrink: 0; /* Prevent shrinking when inside flex container */
            }
                    /* Specific adjustments for buttons inside .top-header-buttons */
        .top-header-buttons .info-button {
            margin: 0; /* Remove auto margins when inside flex, let gap handle spacing */
            margin-bottom: 10px; /* Add vertical margin for wrapping on mobile */
        }
        }
        
        /*|||||||||||||||||||||||||*/

        .collapse-btn {
            background: linear-gradient(to bottom, #555, #333);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 8px 0;
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #666;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
        }
        
        .collapse-btn:hover {
            background: linear-gradient(to bottom, #666, #444);
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }
        /* expired button color and style |||||||||||||||||||||||||*/
        .collapse-btn-exp {
            background: linear-gradient(to bottom, #46171D, #E82740);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 8px 0;
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #FF0022;
            text-shadow: 1px 1px 0 #FF0022;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
        }
        
        .collapse-btn-exp:hover {
            background: linear-gradient(to bottom, #E82740, #46171D);
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }
 /* drops an limited time codes an more button ish  |||||||||||||| ||||||||||||||||||||||||||||||||*/          
        .collapse-btn-Perm {
                        display: block;
            width: fit-content;
            background: linear-gradient(to bottom, #541375, #8519bb);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
margin: 10px auto;
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #b200ff;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
        }
        
        .collapse-btn-Perm:hover {
            background: linear-gradient(to bottom, #8519bb, #541375);
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }       
 
 /* New Black Market button style  ||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||||||||*/       
.collapse-btn-BlackMarket { 
                display: block;
                            width: fit-content;
            background: linear-gradient(to bottom, #CC0000, #800000); /* Red */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px auto;
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #FF4444; /* Brighter red border */
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
        }
        
        .collapse-btn-BlackMarket:hover {
            background: linear-gradient(to bottom, #FF0000, #600000); /* Brighter red on hover */
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 68, 68, 0.4); /* Red glow */
        }

 /* Style for the container inside the Black Market dropdown */
#black-market-codes-container {
    /* All the red box styling has been removed from here */
    margin-top: 8px;
    text-align: left;
}
        /* Ensure the H2 inside the black market section has appropriate styling */
        #black-market-section h2 {
            color: #ff9999; /* Lighter red for heading */
            border-bottom-color: #ff6666;
        }    
        
/* Only when permanent section is visible (has 'show' class) change title text color an more */
#permanent-section.show .permanent-code-box {
    background: linear-gradient(180deg, #451565, #6D1489);
    border: 1px solid #920F74;
    box-shadow: 0 0 6px rgba(54, 54, 0, 0.6);
}

#permanent-section.show .permanent-code-box:hover {
    background: linear-gradient(180deg, #6D1489, #451565);
    border: 1px solid #920F74;
    box-shadow: 0 0 8px rgba(245, 76, 217, 0.8);
}
/* Text color for where tittle is like discord or twitch drop */
#permanent-section.show .permanent-code-text {
    color: #d50eeb;
    text-shadow: 1px 1px 0 #000, 0 0 10px rgba(54, 54, 54, 1);
    font-weight: bold;
}
/* info or body text color for perm box */
#permanent-section.show .permanent-title-container {
    color: #FF99FF;
    text-shadow: 1px 1px 0 #000, 0 0 2px #000;
    font-weight: bold;
}
        
        .expired-section, .permanent-section, .info-section {
            display: none;
            margin-top: 8px;
        }
        
        .expired-section.show, .permanent-section.show, .info-section.show {
            display: block;
        }
        .permanent-code-box .expire-date { color: #E830B7; }
        .permanent-code-box .countdown { color: #E144FF !important; border: 1px solid #F5BFFF;         }
/* ========================================================== */
/*     STYLES FOR EXPIRATION & COUNTDOWN (PURPLE SECTIONS)    */
/* ========================================================== */

/* --- Styling for the "Expires:" text --- */
#permanent-codes-section .expire-date,
#twitch-drops-section .expire-date {
    color: #DD8BFF; /* Golden/Orange text color */
    font-size: 11px;
    text-shadow: 1px 1px 0 #000;
    margin-bottom: 6px; /* Adds a little space below it */
    text-align: left;
}


/* --- Styling for the "Time left:" countdown box --- */
#permanent-codes-section .countdown,
#twitch-drops-section .countdown {
    border: 1px solid #ff9e40; /* Orange border */
    border-radius: 4px; /* Slightly rounded corners */
    color: #FF76DB; /* Orange text color */
    font-weight: bold;
    text-shadow: 1px 1px 0 #000;
    padding: 6px 10px; /* Space inside the box */
    margin-top: 5px; /* Space above the box */
    margin-bottom: 10px; /* Space below the box */
    text-align: left;
}


    /* =================================================== */
/*           STYLES FOR THE GOLD SECTION               */
/*         ( üëç ACTIVE BL4 SHIFT CODES )                */
/* =================================================== */

.title-container {
    font-size: 14px;
    color: #ff9e40;
    margin-bottom: 8px;
    min-height: 18px;
    text-shadow: 1px 1px 0 #000;
}

/* This targets links like "Via Twit" */
.title-container a {
    color: #F6E261; /* Teal color */
    text-decoration: underline;
    text-shadow: 1px 1px 0 #000;
    font-weight: bold;
}

.title-container a:hover {
    color: #DBBE00; /* Lighter teal for hover */
}


/* =================================================== */
/*          STYLES FOR THE PURPLE SECTION              */
/* (Twitch Drops & Permanent Codes like the cosmetics) */
/* =================================================== */

/* --- STYLES FOR THE PURPLE SECTION (TWITCH DROPS, ETC.) --- */

.permanent-title-container {
    /* This styles the container itself, you can leave it empty if you want */
    font-size: 11px;
    color: #F2D7EE; /* This is the gold/orange text color */
    /* ... other container styles ... */
}

/* This targets ALL links inside the purple container */
.permanent-title-container a {
    color: #FF5BDA; /* Light Sky Blue color for links */
    text-decoration: underline;
    font-weight: bold;
    text-shadow: 1px 1px 0 #000;
}

.permanent-title-container a:hover {
    color: #FFB7FE; /* Lighter blue for hover */
}

/* --- Style for links ONLY inside an EXPIRED code box --- */
.expired-code-box .title-container a {
    color: #CD2F2F; /* Pale Yellow - looks good on the red background */
    text-decoration: underline;
    font-weight: bold;
    text-shadow: 1px 1px 0 #000;
}

/* --- Hover effect for the expired code links --- */
.expired-code-box .title-container a:hover {
    filter: brightness(1.2); /* A subtle pop on hover */
}

/*||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||||||*/        
        .code-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    padding-right: 40px; /* This pushes text away from the report button */
}
        
        .permanent-code-header {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 2px;
    padding-right: 40px; /* This pushes text away from the report button */
}
        
        .key-icon {
            font-size: 18px;
            color: #ffc600;
            text-shadow: 1px 1px 0 #000;
        }
        
        .permanent-key-icon {
            font-size: 12px;
            color: #6ba8ff;
            text-shadow: 1px 1px 0 #000, 0 0 3px rgba(107, 168, 255, 0.5);
        }
        
        .custom-icon {
            width: 18px;
            height: 18px;
            object-fit: contain;
            vertical-align: middle;
        }
        
        .permanent-custom-icon {
            width: 25px;
            height: 25px;
            object-fit: contain;
            vertical-align: middle;
        }

/* Specific styling for 'active codes' */
.active-codes-icon {
    width: 20px; /* Example: slightly larger */
    height: 20px;
    object-fit: contain;
    vertical-align: middle;
    /* Add any other specific styling here */
    font-size: 16px; /* For text-based active codes */
    line-height: 18px;
    display: inline-block; /* Ensure it respects width/height */
}

/* Specific styling for 'blackmarket' codes */
.blackmarket-icon {
    width: 32px; /* Example: adjust as needed for blackmarket */
    height: 32px;
    object-fit: contain;
    vertical-align: middle;
    /* Add any other specific styling here */
    font-size: 20px; /* For text-based blackmarket codes */
    line-height: 25px;
    display: inline-block; /* Ensure it respects width/height */
}

/* General alignment for headers */
.code-header {
    display: flex;
    align-items: center;
    gap: 8px; /* Adjust spacing */
}
        
        .vault-symbol {
            font-size: 24px;
            margin-right: 10px;
            color: #ffc600;
            text-shadow: 1px 1px 0 #000, 0 0 5px rgba(255, 198, 0, 0.5);
        }
            
        .no-codes {
            color: #ff9e40;
            padding: 20px;
            text-shadow: 1px 1px 0 #000;
        }
        
        .clearfix::after {
            content: "";
            clear: both;
            display: table;
        }

    /*|||||||| active yellow check box color and shit  ||||| ||||||||||||||||||||| |||||||||||||||||||||||||||||*/      
 /* ========================================================== */
/*           PARENT FOOTER - THIS IS THE MAIN FIX             */
/* ========================================================== */
/* This rule targets the container holding the checkbox and the button */
.code-footer, .permanent-code-footer {
    display: flex;                  /* Turns it into a flex container */
    justify-content: space-between; /* MAGIC! Puts first item on left, last on right */
    align-items: center;            /* Vertically aligns everything neatly */
}

/* ========================================================== */
/*                 BM Codes CHECKBOX STYLES                     */
/* ========================================================== */
/* This no longer needs the margin-right: auto */
.bmredeem-checkbox {
    display: flex;
    align-items: center; 
    /* The 'margin-right: auto' has been REMOVED from here */
}

/* --- The rest of your styles are perfect and remain unchanged --- */

.bmredeem-checkbox input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid #FF0009;
    border-radius: 3px;
    background: rgba(0, 0, 0, 0.3);
    position: relative;
    cursor: pointer;
    margin-right: 8px;
}

.bmredeem-checkbox input[type="checkbox"]:checked::before {
    content: "‚úì";
    position: absolute;
    color: #FF4D53;
    font-size: 14px;
    font-weight: bold;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-shadow: 0 0 3px #000;
}

.bmredeem-checkbox label {
    color: #ffc600;
    font-size: 14px;
    cursor: pointer;
    text-shadow: 1px 1px 0 #000;
}


/* ========================================================== */
/*                  Active Codes CHECKBOX STYLES                     */
/* ========================================================== */
/* This no longer needs the margin-right: auto */
.actredeem-checkbox {
    display: flex;
    align-items: center; 
    /* The 'margin-right: auto' has been REMOVED from here */
}

/* --- The rest of your styles are perfect and remain unchanged --- */

.actredeem-checkbox input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid #FFD31E;
    border-radius: 3px;
    background: rgba(0, 0, 0, 0.3);
    position: relative;
    cursor: pointer;
    margin-right: 8px;
}

.actredeem-checkbox input[type="checkbox"]:checked::before {
    content: "‚úì";
    position: absolute;
    color: #FFDC4D;
    font-size: 14px;
    font-weight: bold;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-shadow: 0 0 3px #000;
}

.actredeem-checkbox label {
    color: #ffc600;
    font-size: 14px;
    cursor: pointer;
    text-shadow: 1px 1px 0 #000;
}

/* ========================================================== */
/*                 PERM Codes CHECKBOX STYLES                     */
/* ========================================================== */
/* --- PERMANENT: REDEEM CHECKBOX GROUP --- */
.permredeem-checkbox {
    display: flex;
    align-items: center;
    gap: 3px !important; /* TIGHTER GAP for checkbox/label */
    order: 1 !important; /* ENSURE FIRST */
    flex-shrink: 0;
}
/* --- The rest of your styles are perfect and remain unchanged --- */

.permredeem-checkbox input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid #FF1FE2;
    border-radius: 3px;
    background: rgba(0, 0, 0, 0.3);
    position: relative;
    cursor: pointer;
    margin-right: 3px !important; /* TIGHTER MARGIN */
}

.permredeem-checkbox input[type="checkbox"]:checked::before {
    content: "‚úì";
    position: absolute;
    color: #FF78F1;
    font-size: 14px;
    font-weight: bold;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-shadow: 0 0 3px #000;
}

.permredeem-checkbox label {
    color: #ffc600;
    font-size: 14px;
    cursor: pointer;
    text-shadow: 1px 1px 0 #000;
}

/* --- PERMANENT: NEW HIDE CODE BUTTON STYLE --- */
/* 3. NEW: Hide Code Button (Order 2 - Right next to checkbox) */
.permanent-code-box .hide-code-btn { 
    background: linear-gradient(to bottom, #333, #555);
    border: 1px solid #1c1c1c;
    color: #ffc600; 
    padding: 4px 8px;
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    font-size: 16px; 
    transition: all 0.2s;
    text-shadow: 1px 1px 0 #000;
    order: 2 !important; /* SECOND */
    margin: 0; 
    line-height: 1.0;
}

.permanent-code-box .hide-code-btn:hover {
    background: linear-gradient(to bottom, #555, #333);
    transform: scale(1.05);
}
/* --- PERMANENT: ACTION BUTTON GROUP (Preview/Copy/Share) --- */
.permanent-action-buttons-group { 
    display: flex;
    gap: 5px !important; /* TIGHTER GAP between Preview, Copy, Share */
    align-items: center;
    order: 3 !important; /* LAST */
    flex-shrink: 0; 
}

/* Ensure the container for the action buttons is visible */
.permanent-action-buttons-group {
    display: flex; /* Make sure this wrapper is a flex container */
}

/* --- Ensure the Black Market footer is NOT affected --- */
.black-market-code-box .code-footer {
    /* Revert any order settings from the global attempt to maintain the old BM layout */
    flex-direction: row; /* Likely row by default */
    justify-content: space-between;
}
.black-market-code-box .black-market-buttons-group {
    /* This group will naturally flow to the right if the checkbox group is on the left */
    order: unset; 
}
/* === END: MODIFIED PERMANENT FOOTER STYLES === */

  /*|||||||| check box color and shit  |||||||||||||*/      
        .redeem-checkbox {
            display: flex;
            align-items: center;
            margin: 0;
            order: 1;
        }
        
        .redeem-checkbox input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #878787;
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
            cursor: pointer;
            margin-right: 8px;
        }
        
        .redeem-checkbox input[type="checkbox"]:checked::before {
            content: "‚úì";
            position: absolute;
            color: #E5E5E5;
            font-size: 14px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 0 0 3px #000;
        }
        
        .redeem-checkbox label {
            color: #ffc600;
            font-size: 14px;
            cursor: pointer;
            text-shadow: 1px 1px 0 #000;
        }
        
        .redeemed {
            opacity: 0.7;
            position: relative;
        }
        
        .redeemed::after {
            content: "REDEEMED";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 24px;
            font-weight: bold;
            color: #7cff7c;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(124, 255, 124, 0.7);
            z-index: 10;
            pointer-events: none;

        }
        
        .redeemed .code-text {
            color: #7cff7c !important;
        }
        
        .permanent-redeemed {
            opacity: 0.7;
            position: relative;
        }
        
        .permanent-redeemed::after {
            content: "REDEEMED";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 24px;
            font-weight: bold;
            color: #7cff7c;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(124, 255, 124, 0.7);
            z-index: 10;
            pointer-events: none;
        }
        
        .permanent-redeemed .permanent-code-text {
            color: #7cff7c !important;
        }

/* Brute-force style for testing */
.permanent-code-box.permanent-redeemed {
    border: 2px solid #44ff44 !important; /* A bright, ugly, unmissable green border */
}
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
        .expired-text {
            color: #ff4444;
            font-weight: bold;
            margin-top: 8px;
            font-size: 13px;
            text-shadow: 1px 1px 0 #400000;
        }
        
        .info-content {
            background: linear-gradient(to bottom, #555, #333);
            color: white;
            padding: 15px;
            margin: 8px 0;
            border-radius: 4px;
            text-align: left;
            border: 1px solid #666;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .info-content p {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .info-content ul, .info-content ol {
            margin-left: 20px;
            margin-bottom: 10px;
        }
        
        .info-content li {
            margin-bottom: 5px;
        }
        
        .info-content a {
            color: #ffc600;
            text-decoration: underline;
            text-shadow: 1px 1px 0 #000;
        }
        
        .info-content a:hover {
            color: #ff7c00;
        }
        
        @media (max-width: 600px) {
            .social-links {
                gap: 10px;
            }
            
            .social-links a {
                font-size: 14px;
                padding: 6px 10px;
            }
        }

/* ... All your global PC/default CSS rules here ... */

/* =================================================== */
/* MOBILE-SPECIFIC STYLES ONLY                         */
/* =================================================== */
@media (max-width: 600px) {
    
    /* ... (Your other mobile styles) ... */

    /* ------------------------------------------------------------------ */
    /* 2. BLACK MARKET FOOTER LAYOUT: Tighten Gap */
    /* ------------------------------------------------------------------ */

    .black-market-code-box .code-footer {
        /* Reduce the gap between the code box and the button group */
        gap: 1px !important; 
        /* ... (other properties remain the same) ... */
    }

    /* 3. Target the button container: Tighten Gap */
    .black-market-code-box .black-market-buttons-group {
        /* Reduce the gap between individual buttons */
        gap: 1px !important; 
        /* ... (other properties remain the same, including the stacking fixes) ... */
    }

    /* 4. Shrink the individual buttons (THE SMALLEST POSSIBLE) */
    .black-market-code-box .black-market-buttons-group button {
        /* üî• NEW: Reduce font size to minimum legible */
        font-size: 8px !important; 
        
        /* üî• NEW: Minimal padding (e.g., 1px top/bottom, 2px left/right) */
        padding: 1px 2px !important; 
        
        /* Ensure sizing properties are flexible */
        width: auto !important; 
        min-width: unset !important; 
        max-width: fit-content !important; 
        box-sizing: border-box; 
        margin: 0 !important;
    }
    
    /* 5. Code/Checkbox element fix: Tighten padding */
    .black-market-code-box .code-checkbox-group {
        /* Reduce padding right to give more room to buttons */
        padding-right: 1px !important; 
        /* ... (other properties remain the same) ... */
    }
}


/* <-- THIS CLOSING BRACE MUST BE PRESENT TO END THE MOBILE STYLES */

/* ... End of style block or other scripts ... */

        .title-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 25px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            margin-bottom: 15px;
            border: 2px solid #ffc600;
        }

        .title-text {
            color: #ffc600;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(255, 198, 0, 0.7);
        }

        .icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ffc600;
        }
/* Normal blue preview button ||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||||||*/
        .preview-btn {
            background: linear-gradient(to bottom, #4a90e2, #2a70c2);
            border: 1px solid #6ba8ff;
            color: #fff;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .preview-btn:hover {
            background: linear-gradient(to bottom, #2a70c2, #4a90e2);
            transform: scale(1.05);
            box-shadow: 0 0 4px #6ba8ff;
        }

        /* perm active preview button ||||||||||||||||*/
        .prempreview-btn {
            background: linear-gradient(to bottom, #B634D7, #AA2EC9);
            border: 1px solid #DE57FF;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                order: unset !important;
}
        }

        .prempreview-btn:hover {
            background: linear-gradient(to bottom, #AA2EC9, #B634D7);
            transform: scale(1.05);
            box-shadow: 0 0 4px #DE57FF;
        }

        /* active preview button ||||||||||||||||*/
        .activepreview-btn {
            background: linear-gradient(to bottom, #ff7c00, #e56a00);
            border: 1px solid #FFDE00;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .activepreview-btn:hover {
            background: linear-gradient(to bottom, #e56a00, #ff7c00);
            transform: scale(1.05);
            box-shadow: 0 0 4px #FFDE00;
        }

        /* expire preview button ||||||||||||||||*/
        .exppreview-btn {
            background: linear-gradient(to bottom, #EE2222, #DF2525);
            border: 1px solid #FF5757;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .exppreview-btn:hover {
            background: linear-gradient(to bottom, #DF2525, #EE2222);
            transform: scale(1.05);
            box-shadow: 0 0 4px #FF5757;
        }
        /*||||||||||||||| ||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||||||*/
        .image-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }


/* --- END: Mobile Full-Screen Image Preview --- */

        .close-preview {
            position: absolute;
            top: -15px;
            right: -15px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Info content sections ||||||||||| ||||||||||||||||||||| |||||||||||||||||||||||||||||||*/
        #info-section .info-content {
            background: linear-gradient(to bottom, #555, #333);
            border: 2px solid #888;
            color: white;
        }

        #changelog-section .info-content {
            background: linear-gradient(to bottom, #6c757d, #495057);
            border: 2px solid #adb5bd;
            color: white;
        }

        #changelog-section .info-content a {
            color: #e9ecef;
            text-shadow: 0 0 5px #e9ecef;
        }

        #changelog-section .info-content a:hover {
            color: #ffffff;
        }

        #redeem-section .info-content {
            background: linear-gradient(to bottom, #00aa00, #0055aa);
            border: 2px solid #00ccff;
            color: white;
        }

        #redeem-section .info-content a {
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff;
        }

        #redeem-section .info-content a:hover {
            color: #ffffff;
        }

    /* Style for the new "View Roadmap" button |||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||||||||||*/
        .roadmap-button {
            background: linear-gradient(to bottom, #333, #111); /* Dark grey to black gradient */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 1px auto 5px auto; /* Top margin, auto left/right, bottom margin */
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #555; /* Dark grey border */
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
            display: block;
            width: fit-content;
            margin: 10px auto; /* Center horizontally, provide vertical spacing */
        }
        
        .roadmap-button:hover {
            background: linear-gradient(to bottom, #444, #222); /* Slightly lighter on hover */
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.1); /* Subtle white glow */
        }

        /* =================================================== */
/*           PASTE THE NEW BUTTON STYLE HERE           */
/* =================================================== */
/*  This is where you can easily customize the colors  */
.events-button {
    background: linear-gradient(to bottom, #f01a11, #fe9f17); /* SeaGreen gradient */
    color: white;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    font-size: 14px;
    text-transform: uppercase;
    border: 1px solid #890608; /* MediumSeaGreen border */
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    font-family: 'Chakra Petch', sans-serif;
    display: block;
    width: fit-content;
    margin: 10px auto; 
}

.events-button:hover {
    background: linear-gradient(to bottom, #fe9f17, #f01a11); /* Lighter green on hover */
    transform: scale(1.05);
    box-shadow: 0 0 8px rgba(255, 204, 61, 0.6); /* Green glow */
}
/* =================================================== */

/* Style for the new extra button inside the Black Market Vendor box ||||||| ||||||||||||||||||||| |||||||||||||||||||||||||||||||||||*/
        .black-market-extra-btn {
            background: linear-gradient(to bottom, #777, #555); /* Gray gradient */
            border: 1px solid #999;
            color: #fff;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px; /* Adds space from the "View Location" button */
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .black-market-extra-btn:hover {
            background: linear-gradient(to bottom, #888, #666);
            transform: scale(1.05);
            box-shadow: 0 0 4px #aaa;
        }


                /* Container for the two small Black Market buttons */
        .black-market-buttons-group {
            display: flex;
            flex-wrap: wrap; /* Allow buttons to wrap if screen is too small */
            gap: 8px; /* Space between the two buttons */
            align-items: center;
        }

        /* Base style for small Black Market buttons  |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
        .bm-small-btn {
            padding: 4px 8px; /* Reduced padding */
            font-size: 10px; /* Reduced font size */
            font-weight: bold;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            flex-shrink: 0; /* Prevent them from shrinking too much */
            line-height: 1.2; /* Adjust line height for smaller text */
        }
        
        .bm-small-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        /* Specific style for the Static Image button  ||||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||*/
        .bm-static-image-btn {
            background: linear-gradient(to bottom, #FF7A7F, #C92B31); /* Gray gradient */
            border: 1px solid #DA0007;
            color: #fff;
        }

        .bm-static-image-btn:hover {
            background: linear-gradient(to bottom, #C92B31, #FF7A7F);
        }

        /* Specific style for the MapGenie button  ||||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||*/
        .bm-mapgenie-btn {
            background: linear-gradient(to bottom, #C92B31, #FF7A7F); /* Blue gradient */
            border: 1px solid #DA0007;
            color: #fff;
        }

        .bm-mapgenie-btn:hover {
            background: linear-gradient(to bottom, #FF7A7F, #C92B31);
        }

        /* Ensure .redeem-checkbox is properly ordered in the footer */
        .code-footer .redeem-checkbox {
            order: unset; /* Clears any explicit order */
            margin-left: auto; /* <--- ADD THIS to push the checkbox to the far right */
            margin-right: 0; /* Ensure no conflicting right margin */
        }

        /* New group for active code's action buttons (COPY and optional PREVIEW) ||||||||||| |||||||||||||||||||||||||||||||*/
        .active-code-buttons-group {
            display: flex;
            gap: 10px; /* Space between preview and copy buttons */
            align-items: center;
            margin-left: auto; /* Pushes this group to the far right within the footer */
        }
        
        /* Ensure default display for the overall code-footer */
        .code-footer {
            display: flex;
            justify-content: space-between; /* Pushes children to opposite ends */
            align-items: center;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 198, 0, 0.3);
        }

        /* Make sure the redeem checkbox explicitly stays left  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
        /* This overrides any previous 'order' or 'margin-left: auto' */
        .code-footer .redeem-checkbox {
            order: unset; /* Remove any explicit order that might be set */
            margin-right: auto; /* Pushes itself to the left, allowing the button group to go right */
            margin-left: 0; /* Ensure no auto left margin interferes */
        }

        /* Ensure .small-copy-btn and .preview-btn revert to natural order/margins within their new group */
        .small-copy-btn, .preview-btn {
            order: unset; /* Remove any explicit order */
            margin: 0; /* Remove any external margins */
        }
        

/*  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/

        /* Utility class to hide elements ||||||||||||| |||||||||||||||||||||||||||||*/
        .hidden {
            display: none !important;
        }

        /* Styling for the settings items (checkbox and label) */
        .setting-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .setting-item input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #ffc600;
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
            cursor: pointer;
            margin-right: 8px;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .setting-item input[type="checkbox"]:checked::before {
            content: "‚úì";
            position: absolute;
            color: #ffc600;
            font-size: 14px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 0 0 3px #000;
        }

        .setting-item label {
            color: #ffc600;
            font-size: 14px;
            cursor: pointer;
            text-shadow: 1px 1px 0 #000;
            line-height: 1.2;
        }

        /* New wrapper for the top-most horizontal buttons ||||||| |||||||||||||||||||||||||||||||||||*/
        .top-header-buttons {
            display: flex;
            justify-content: center; /* Center the buttons within the row */
            flex-wrap: wrap; /* Allow buttons to wrap to the next line on small screens */
            gap: 10px; /* Space between the buttons */
            margin-bottom: 20px; /* Space below the top row */
        }

        /* Style for the Black Market credit text |||||||||||||||||||||*/
        .black-market-credit {
            font-size: 11px;
            color: #bbb; /* Lighter text for credit */
            margin-top: 10px; /* Space above the footer/buttons */
            text-align: left;
            padding: 0 5px; /* Little padding to match content */
            font-weight: bold; /* <--- ADD THIS LINE */
        }

        .black-market-credit a {
            color: #428bca; /* Gold color for links */
            text-decoration: underline;
        }

/* Hide any label that follows a checked checkbox within redeem-checkbox  |||||| ||||||||||||||||||||||||||||||||||||*/
.redeem-checkbox input:checked + label,
.bmredeem-checkbox input:checked + label,
.permredeem-checkbox input:checked + label,
.actredeem-checkbox input:checked + label {
    display: none;
}

/* flash text pulse for drops and limited time shit  |||||| ||||||||||||||||||||||||||||||||||*/  
.drops-pulse {
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
    100% {
        opacity: 1;
    }
}


/* date added text for boxes |||||||| ||||||||||||||||||||||||||||||||||*/
/* Active Codes Date Added */
.code-box .date-added {
    font-size: 0.8em;
    color: #FFC247; /* Yellow/Orange */
    margin: -10px 0 8px 0; /* Positive margins only */
    font-style: italic;
}

/* Permanent/Drops Codes Date Added */
.permanent-code-box .date-added {
    font-size: 0.75em;
    color: #F011FF; /* Green */
    margin: 3px 0 6px 0; /* Positive margins only */
    font-style: normal;
    font-weight: bold;
}

/* Black Market Date Added */
.black-market-code-box .date-added {
    font-size: 0.7em;
    color: #FF6B47; /* Red/Orange */
    margin: 2px 0 5px 0; /* Positive margins only */
    font-style: italic;
    opacity: 0.9;
}

/* Expired Codes Date Added */
.expired-code-box .date-added {
    font-size: 0.7em;
    color: #888888; /* Gray */
    margin: -10px 0 5px 0; /* Positive margins only */
    font-style: italic;
    text-decoration: line-through;
    opacity: 0.8;
}



/* =================================================== */
/*           NEW: CODE DESCRIPTION STYLING             */
/* =================================================== */
.code-description {
    font-size: 14px;
    color: #ffcc88; /* A lighter, less prominent gold */
    line-height: 1.4;
    margin-bottom: 12px;
    padding-left: 5px;
    border-left: 2px solid rgba(255, 198, 0, 0.4); /* Subtle left border */
}

/* Specific color for descriptions in permanent boxes */
.permanent-description {
    color: #cce5ff; /* A light blue to match the theme */
    border-left-color: rgba(74, 144, 226, 0.4);
}

/* Specific color for descriptions in expired boxes */
.expired-description {
    color: #ffbaba; /* A light red */
    border-left-color: rgba(255, 68, 68, 0.4);
}

/* Styling for any links inside a description */
.code-description a {
    color: #F6E261; /* Re-using the bright link color */
    font-weight: bold;
}

/* Specific style for the new Loot/Info button for blacmarket box ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
.bm-loot-info-btn {
    background: linear-gradient(to bottom, #C92B31, #FF7A7F); 
    border: 1px solid #DA0007;
    color: #fff;
}

.bm-loot-info-btn:hover {
    background: linear-gradient(to bottom, #FF7A7F, #C92B31); /* Invert on hover */
}

/* =================================================== */
/*           SMALL KEY INFO BUTTONS                    */
/* =================================================== */
/* Container for the small key info buttons */
.key-info-buttons-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 12px; /* Adds space below the "Updated" date */
}

/* Styling for the individual small buttons */
.key-info-btn {
    background: linear-gradient(to bottom, #ff7c00, #e56a00);
    border: 1px solid #ffc600;
    color: #fff;
    padding: 4px 10px; /* Small padding for a small button */
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    font-size: 11px; /* This makes the text very small */
    text-transform: uppercase;
    font-family: 'Chakra Petch', sans-serif;
    text-shadow: 1px 1px 0 #000;
    transition: all 0.2s;
}

.key-info-btn:hover {
    background: linear-gradient(to bottom, #ff8c00, #ff6a00);
    transform: scale(1.05);
    box-shadow: 0 0 6px #ffc600;
}

/* =================================================== */
/*           FLOATING SHARE BUTTON & MENU (CORRECTED)  */
/* =================================================== */
.floating-share-container {
    position: relative;
    bottom: 115px; /* This tightens up the spacing */
    left: 20px;    /* Moved to the LEFT corner */
    z-index: 1003;
    display: flex;
    flex-direction: column;
    align-items: flex-start; /* Aligns items to the LEFT */
}

/* START: Solid Thin Line Share Button */
.share-fab {
    background: linear-gradient(to bottom, #1e8e3e, #166d2e); /* The new solid background */
    border: 1px solid #34a853;
    color: #fff;                  /* Text is now white for contrast */
    width: auto;
    height: auto;
    border-radius: 4px;
    padding: 2px 10px;
    font-size: 14px;
    font-weight: bold;
    font-family: 'Chakra Petch', sans-serif;
    text-shadow: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3); /* Subtle drop shadow */
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1px;
}

.share-fab:hover {
    background: linear-gradient(to bottom, #34a853, #1e8e3e); /* Brighter on hover */
    transform: translateY(-1px); /* Add a slight lift */
    box-shadow: 0 0 10px #5bb974;
}
/* END: Solid Thin Line Share Button */
/* END: Thin Line Share Button */

/* The pop-up menu container */
.share-menu {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
    opacity: 0;
    transform: translateY(10px) scale(0.9);
    pointer-events: none;
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
}

.share-menu.active {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
}

/* Individual share buttons inside the menu */
.share-menu-item {
    color: white;
    padding: 10px 20px;
    border-radius: 4px;
    font-weight: bold;
    text-decoration: none;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    transition: transform 0.2s;
    width: 180px;
}

.share-menu-item:hover {
    transform: scale(1.05);
}

.twitter-btn { background: linear-gradient(to bottom, #1DA1F2, #0c85d0); border: 2px solid #1DA1F2; }
.facebook-btn { background: linear-gradient(to bottom, #1877F2, #1056ad); border: 2px solid #1877F2; }

.share-ish-container {
    position: relative; /* This is essential for positioning the menu */
}

#share-ish-menu {
    display: none; /* Hide the menu by default */
    position: absolute; /* This is the key fix: it takes the menu out of the layout flow */
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-top: 8px;
    z-index: 10000; /* Ensure it appears on top of other elements */
    background-color: #2a2a2a;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 5px;
    min-width: 180px;
}

/* This class is added by JavaScript to show the menu */
#share-ish-menu.active {
    display: block;
}

#share-ish-menu .share-menu-item {
    display: block; /* This makes each link take up its own full line, stacking them vertically. */
    margin: 5px;    /* This adds a little space between the two buttons. */
}

/* Mobile zoom back to normal css */
/* ADD THIS CSS to your main <style> tag */

/* --- START: Image Preview Modal Controls & Zoom --- */
.image-preview-content {
    max-width: 90%;
    max-height: 90%;
    position: relative;
    /* This allows scrolling inside the frame if the image is zoomed */
    overflow: auto; 
}

.image-preview-content img {
    /* Image should not be wider than its container */
    max-width: 100%; 
    /* Or taller than 90% of the screen height */
    max-height: 90vh; 
    /* The border and rounded corners for the PC view */
    border: 3px solid #ffc600;
    border-radius: 5px;
    /* Ensures the image scales down without stretching */
    object-fit: contain; 
}

/* This is the container for the new control buttons */
#image-preview-controls {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1001;
    background: rgba(10, 10, 10, 0.85);
    backdrop-filter: blur(5px);
    border-radius: 50px;
    padding: 8px;
    display: flex;
    gap: 10px;
    border: 1px solid #ffc600;
    box-shadow: 0 0 15px rgba(255, 198, 0, 0.5);
}

/* Styling for the individual buttons (Zoom In, Out, Reset, Close) */
.control-btn {
    background: linear-gradient(to bottom, #ff7c00, #e56a00);
    border: 1px solid #ffc600;
    color: #fff;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    font-weight: bold;
    font-size: 24px;
    text-shadow: 1px 1px 0 #000;
    transition: all 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    padding-bottom: 4px; /* Helps visually center some characters */
}

.control-btn:hover {
    background: linear-gradient(to bottom, #ff8c00, #ff6a00);
    transform: scale(1.1);
    box-shadow: 0 0 8px #ffc600;
}

/* Specific styling for the new close button */
#close-preview-btn {
    background: linear-gradient(to bottom, #EE2222, #DF2525);
    border-color: #FF5757;
}

#close-preview-btn:hover {
    box-shadow: 0 0 8px #FF5757;
}
/* --- END: Image Preview Modal Controls & Zoom --- */

/* ADD THIS SNIPPET AT THE END OF YOUR CSS */

/* --- START: Image Preview Modal Controls & Zoom --- */
.image-preview-content {
    overflow: auto;
}
#image-preview-controls {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1001; /* Should be lower than the modal's z-index */
    background: rgba(10, 10, 10, 0.85);
    backdrop-filter: blur(5px);
    border-radius: 50px;
    padding: 8px;
    display: flex;
    gap: 10px;
    border: 1px solid #ffc600;
    box-shadow: 0 0 15px rgba(255, 198, 0, 0.5);
}
.control-btn {
    background: linear-gradient(to bottom, #ff7c00, #e56a00);
    border: 1px solid #ffc600;
    color: #fff;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    font-weight: bold;
    font-size: 24px;
    text-shadow: 1px 1px 0 #000;
    transition: all 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    padding-bottom: 4px;
        touch-action: manipulation; /* <-- ADD THIS LINE */
}
.control-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 8px #ffc600;
}
#close-preview-btn {
    background: linear-gradient(to bottom, #EE2222, #DF2525);
    border-color: #FF5757;
}
/* ADD THIS SNIPPET AT THE END OF YOUR CSS */

/* --- END: Corrected Image Preview Styles --- */

/* hide kofi when preview is open */

/* When the preview modal is open (body has class 'modal-open')... */
body.modal-open iframe[id^="kofi"], /* ...Find the Ko-fi widget iframe... */
body.modal-open .floating-share-container { /* ...and the Share button container... */
    /* ...and hide them completely. */
    display: none !important; 
}

/* START: SITE OPTIONS CONTAINER STYLES */

/* START: SITE OPTIONS CONTAINER STYLES (v4 - Polished Buttons) */

/* --- The Main Wrapper (Unchanged) --- */
/* --- Main Wrapper & Title --- */
.site-options-container {
    border: 2px solid #adb5bd; padding: 20px 15px; margin: 20px 0;
    background: rgba(17, 26, 34, 0.6); box-shadow: 0 0 15px rgba(173, 181, 189, 0.2);
    text-align: center; clip-path: polygon(0 0, 100% 0, 100% 95%, 95% 100%, 0 100%); border-radius: 0;
}
.site-options-container .site-options-title {
    color: #adb5bd; font-family: 'Chakra Petch', sans-serif; text-transform: uppercase;
    font-weight: 700; font-size: 18px; letter-spacing: 2px; text-shadow: 0 0 2px rgba(173, 181, 189, 0.8);
    margin: 0; cursor: pointer; user-select: none; line-height: 1.3;
}
.updated-subtitle {
    display: block; font-size: 0.7em; font-weight: normal; color: #00ffff; text-shadow: 0 0 5px #00ffff;
}

/* --- Slide-down Logic --- */
.site-options-container .slide-down-content {
    max-height: 0; overflow: hidden; margin-top: 0;
    transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out;
}
.site-options-container.is-open .slide-down-content {
    max-height: 80vh; margin-top: 20px;
}

/* --- The 2x2 Button Grid Structure --- */
.options-button-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.button-row {
    display: flex;
    flex-direction: row;
    gap: 10px;
}

/* --- Polished Button Style --- */
.option-btn {
    flex: 1; 
    min-width: 140px; padding: 12px 5px; font-family: 'Chakra Petch', sans-serif;
    font-size: 14px; font-weight: bold; color: #fff; text-shadow: 0px 1px 3px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(0, 0, 0, 0.7); border-top-color: rgba(255, 255, 255, 0.2);
    border-radius: 6px; cursor: pointer; transition: all 0.2s ease-in-out;
    box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.1), 0 2px 3px rgba(0, 0, 0, 0.4);
}
.option-btn:hover {
    transform: translateY(-1px);
    box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.2), 0 4px 8px rgba(0, 0, 0, 0.5);
}
.option-btn:active {
    transform: translateY(1px);
    box-shadow: inset 0 2px 3px rgba(0, 0, 0, 0.3);
}

/* --- Button Colors --- */
.option-btn-faq { background: linear-gradient(to bottom, #36c2ca, #1c7b80); }
.option-btn-log { background: linear-gradient(to bottom, #6979d5, #3e4a8b); }
.option-btn-redeem { background: linear-gradient(to bottom, #05f515, #049efb); }

/* --- Content Panel Container --- */
.options-content-panels {
    margin-top: 15px;
}

/* --- Scrollbar for Content --- */
#info-section .info-content,
#changelog-section .info-content,
#redeem-section .info-content,
#settings-section .info-content {
    max-height: 40vh; overflow-y: auto; padding-right: 10px;
}
/* END: SITE OPTIONS CONTAINER STYLES */




/* =================================================================== */
/*           ‚≠ê FINAL, UNIFIED & ENHANCED MOBILE STYLES ‚≠ê             */
/* =================================================================== */
@media (max-width: 768px) {

    /* --- 1. Global & Container Adjustments --- */
    body {
        padding: 10px;
        font-size: 16px; 
    }
    .container {
        padding: 15px;
    }
    .floating-info-panel {
        width: calc(100%);
    }
    /* --- 2. Typography for Smaller Screens --- */
    h1, h2, h3 {
        font-size: 12px;
    }
    .title-text {
        font-size: 14px;
    }

    /* --- 3. Fix for "Site Options" Buttons --- */
    .button-row {
        flex-direction: column;
    }
    .option-btn {
        width: 100%;
        min-width: 0;
        padding: 14px 10px;
        font-size: 16px;
    }

    /* --- 4. Main Page Buttons (Collapse, Roadmap, etc.) --- */
    .info-button,
    .collapse-btn,
    .collapse-btn-exp,
    .collapse-btn-Perm,
    .collapse-btn-BlackMarket,
    .roadmap-button {
        display: block;
        width: 100%;
        margin: 10px 0;
        padding: 14px;
        font-size: 15px;
    }
    .rewards-link {
        padding: 12px;
    }

    /* --- 5. Code Box Styles --- */
    .code-box::before,
    .expired-code-box::before,
    .black-market-code-box::before,
    .permanent-code-box::before {
        background-size: contain !important;
    }
    .code-footer,
    .permanent-code-footer {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }
    
    /* MODIFIED: Removed .black-market-buttons-group from this rule */
    .active-code-buttons-group {
        display: flex;
        flex-direction: column;
        width: 100%;
        gap: 8px;
        margin: 0;
    }

    /* MODIFIED: Removed .bm-small-btn from this rule */
    .small-copy-btn,
    .permanent-copy-btn,
    .expired-copy-btn,
    .preview-btn,
    .prempreview-btn,
    .activepreview-btn,
    .exppreview-btn {
        width: 100%;
        padding: 12px;
        font-size: 14px;
        margin: 0;
    }
    
    .redeem-checkbox,
    .permredeem-checkbox,
    .actredeem-checkbox,
    .bmredeem-checkbox {
        margin: 0;
        order: -1;
        padding-bottom: 5px;
    }
    .redeem-checkbox label,
    .permredeem-checkbox label,
    .actredeem-checkbox label,
    .bmredeem-checkbox label {
        font-size: 16px;
    }

    /* --- 6. Image Preview Modal --- */
    .image-preview-content,
    .image-preview-content img {
        max-width: 100%;
        max-height: 100%;
        border: none;
        border-radius: 0;
        object-fit: contain;
    }

/* 1. Force the footer of ONLY the black market box back to a horizontal layout */
.black-market-code-box .code-footer {
    flex-direction: row !important;
    justify-content: space-between !important;
    align-items: center !important;
}

/* 2. Force the container holding the red buttons to be a wrapping horizontal row */
.black-market-code-box .black-market-buttons-group {
    flex-direction: row !important;
    flex-wrap: wrap !important;
    justify-content: flex-start !important; /* Align buttons to the left */
    gap: 5px !important;
}

/* 3. Force the red buttons themselves to be small and flexible, overriding the large style */
.black-market-code-box .bm-small-btn {
    width: auto !important;
    flex-grow: 1;
    padding: 8px 10px !important;
    font-size: 12px !important;
}

/* 4. Ensure the checkbox doesn't take up the full width */
.black-market-code-box .bmredeem-checkbox {
    padding-bottom: 0 !important;
    margin-right: 10px; /* Add some space between checkbox and buttons */
}
    /* --- END: YOUR INTEGRATED FIX --- */
}


/* START: NEW COMMUNITY CHALLENGE STYLES */
.challenge-button {
    background: linear-gradient(to bottom, #f8278a, #ca114f); /* Purple gradient */
    color: white;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    font-size: 14px;
    text-transform: uppercase;
    border: 1px solid #ff54a5; /* Light purple border */
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    font-family: 'Chakra Petch', sans-serif;
    display: block;
    width: fit-content;
    margin: 10px auto; 
}
.challenge-button:hover {
    background: linear-gradient(to bottom, #ca114f, #f8278a);
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(138, 43, 226, 0.7); /* Purple glow */
}

/* Style for the dropdown panel's content */
#challenge-section .info-content {
    background: linear-gradient(to bottom, #be1a68, #940d3a);
    border: 2px solid #ff54a5;
}
/* END: NEW COMMUNITY CHALLENGE STYLES */
/* EVENTS STYLES |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* START: FINAL & CORRECTED EVENTS DROPDOWN STYLE - REPLACE OLD VERSION */

.events-content-unique {
    /* FIX: New, richer Orange/Red theme to better match the button */
    background: linear-gradient(to bottom, #611815, #5c3a0e) !important; 
    border: 2px solid #fe9f17 !important; /* Bright orange border */
    color: #f0f0f0 !important;

    /* Base layout styles */
    padding: 15px !important;
    margin-top: 8px !important;
    border-radius: 4px !important;
    box-shadow: 0 4px 8px rgba(0,0,0,0.5) !important;
}

/* Styles for the content inside */
.events-content-unique b {
    color: #ffffff;
    font-size: 1.1em;
}
.events-content-unique ul {
    list-style-type: '‚Ä¢ ';
    padding-left: 20px;
    color: #f0f0f0;
}
.events-content-unique img {
    border: 2px solid #fe9f17; /* Match the main border */
    border-radius: 4px;
}

/* END: FINAL & CORRECTED EVENTS DROPDOWN STYLE */


/* --- Quick Update Button Style --- */
.quick-update-button {
    background: linear-gradient(to bottom, #090909, #000000); /* Custom Purple Gradient */
    color: #fff;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    font-size: 14px;
    text-transform: uppercase;
 /* border: 1px solid #ff54a5; /* Pink border */
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    display: block;
    width: fit-content;
    margin: 10px auto; 
}
/* .quick-update-button:hover {
    background: linear-gradient(to bottom, #2a677a, #7a2a7a);
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(255, 84, 165, 0.7); 
}*/


/* --- Quick Update Content Style (Reuses other section styling) --- */
#quick-update-section .info-content {
    background: linear-gradient(to bottom, #090909, #000000);
    /*  border: 2px solid #ff54a5;   */
    padding: 15px;
    border-radius: 4px;
    text-align: left;
}
#quick-update-content h4 { 
    color: #ff54a5; 
    margin-bottom: 10px;
    text-shadow: 1px 1px 0 #000;
}
#quick-update-content p { 
    color: #cccccc; 
    line-height: 1.5;
}



































































/* ||||||||||||||||||||||||||||||||css above not below|||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* START: COMPLETE & FINAL ACTION BUTTONS CSS - DELETE ALL PREVIOUS VERSIONS */

/* Hides the default Ko-fi floating icon */
iframe#kofi-chat-widget { display: none !important; }

/* Main container for the buttons */
.action-buttons-container {
    display: flex; 
    justify-content: center; 
    align-items: center;
    /* --- THE FIX IS HERE --- */
    flex-wrap: nowrap !important; 
    /* ----------------------- */
    gap: 8px; 
    margin: 15px 0;
}

/* Uniform style for all buttons in the row */
.action-btn {
    padding: 2px 10px !important; font-size: 12px !important;
    font-family: 'Chakra Petch', sans-serif !important; font-weight: bold !important;
    border-radius: 4px !important; cursor: pointer !important;
    transition: all 0.2s ease !important;
    text-shadow: 1px 1px 1px rgba(0,0,0,0.4) !important;
    line-height: 1.2 !important; border: 1px solid rgba(0,0,0,0.5) !important;
}
.action-btn:hover {
    transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

/* Removes old fixed positioning */
.action-buttons-container .floating-share-container,
.action-buttons-container .tally-button-wrapper,
.action-buttons-container .floating-poll-btn {
    position: static;
}

/* Specific button colors */
.action-buttons-container .share-fab { 
    background: linear-gradient(to bottom, #EBEBEB, #B7B7B7) !important; 
    color: #434747 !important;
    min-height: 52px; /* Ensures consistent height */
}
.action-buttons-container .floating-poll-btn { 
    background-color: #8A2BE2 !important; 
    color: white !important; 
    border: 1px solid #DDA0DD !important;
    min-height: 60px; /* Ensures consistent height */
    padding-top: 5px;
    padding-bottom: 5px;
}
.action-buttons-container .floating-feedback-btn {
    background: linear-gradient(to bottom, #0056A8, #003B75) !important;
    color: #fff !important;
    border: 1px solid #007BFF !important;
    min-height: 60px; /* Ensures consistent height */
    padding-top: 5px;
    padding-bottom: 5px;
}
.action-buttons-container .kofi-button { 
    background: linear-gradient(to bottom, #EBEBEB, #B7B7B7) !important; 
    color: #434747 !important;
    min-height: 52px; /* Ensures consistent height */
}
/* --- THE CRITICAL FIX FOR THE SHARE MENU --- */

/* The container for the share button and its dropdown menu */
.floating-share-container {
    position: relative; /* CRITICAL: This anchors the absolute menu below */
}

/* The dropdown menu itself */
.action-buttons-container .share-menu {
    display: none; /* Hide it completely by default */
    position: absolute;
    top: 100%; /* Position it right below its container */
    left: 50%;
    transform: translateX(-50%); /* Center the menu under the button */
    margin-top: 8px; /* Space from the button */
    z-index: 10000; /* CRITICAL: Ensures it appears on top of everything */
    background-color: #2a2a2a;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 5px;
    min-width: 180px; /* Set a minimum width */
}

/* The class that the JavaScript will add to show the menu */
.action-buttons-container .share-menu.active {
    display: block; /* This makes the menu visible */
}
/* END: COMPLETE & FINAL ACTION BUTTONS CSS */

/* START: FINAL, OVERRIDING SHARE BUTTON CSS - PASTE AT THE VERY END OF YOUR <style> TAG */

/* This uses a unique name to avoid conflicts */
.share-ish-container {
    position: relative; /* This is essential for positioning the menu */
}

/* This uses a unique ID (#) which gives it HIGH priority */
#final-share-menu {
    display: none; /* Hidden by default */
    position: absolute;
    top: 110%; /* Position it just below the button */
    left: 50%;
    transform: translateX(-50%); /* Center it horizontally */
    z-index: 10000; /* CRITICAL: Ensures it appears on top of EVERYTHING */
    background-color: #2a2a2a;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 5px;
    min-width: 180px;
}

/* This class is added by JavaScript to show the menu */
#final-share-menu.active {
    display: block;
}

/* These styles are for the links inside the pop-up menu */
#final-share-menu .share-menu-item {
    color: white;
    padding: 10px 20px;
    border-radius: 4px;
    font-weight: bold;
    text-decoration: none;
    text-align: center;
    display: block; /* Makes the links stack vertically */
    margin: 5px;
    transition: transform 0.2s;
}
#final-share-menu .share-menu-item:hover {
    transform: scale(1.05);
}
#final-share-menu .twitter-btn { background: #1DA1F2; }
#final-share-menu .facebook-btn { background: #1877F2; }

/* END: FINAL, OVERRIDING SHARE BUTTON CSS */


.modal-overlay {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 10005 !important;
    justify-content: center;
    align-items: center;
}
.modal-content {
    position: relative;
    padding: 20px;
    background: #1f1f1f;
    border: 2px solid #ffc600;
    border-radius: 8px;
    max-width: 90%;
}
.close-modal {
    position: absolute;
    top: -15px;
    right: -15px;
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 20px;
    cursor: pointer;
    font-weight: bold;
    line-height: 28px;
}

/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* START: Specific Ko-fi Modal Styles - Ensures proper sizing */
#kofi-modal-overlay {
    display: none;
    position: fixed;
    top: 0; 
    left: 0;
    width: 100%; 
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 10006;
    justify-content: center;
    align-items: center;
}

#kofi-modal-overlay .modal-content {
    background: transparent !important;  /* Remove grey background */
    border: none;
    border-radius: 8px;
    padding: 0;
    overflow: visible;  /* Changed from hidden */
    width: 400px;
    max-width: 90vw;
    height: 800px;
    max-height: 90vh;
    position: relative;
}

#kofi-modal-overlay .close-modal {
    position: absolute;
    top: 60px;  /* Position above the iframe */
    right: 15px;  /* Position outside the iframe */
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 50%;
    width: 35px;
    height: 35px;
    font-size: 22px;
    cursor: pointer;
    font-weight: bold;
    line-height: 32px;
    z-index: 10007; 
}

#kofi-iframe-container {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;  /* ADD THIS - makes iframe container the positioning context */
}

#kofi-iframe-container iframe {
    width: 100% !important;
    height: 700px !important;
    max-height: 85vh !important;
    border: none !important;
    margin: 0 !important;
    padding: 0 !important;
    border: 3px solid #ffc600 !important;
    border-radius: 8px !important;
    display: block !important;
    background: white !important;  /* Force white background */
}

/* Mobile */
@media (max-width: 768px) {
    #kofi-modal-overlay {
        padding: 0 5% !important; /* Force padding on the overlay itself */
        box-sizing: border-box !important;
    }
    
    #kofi-modal-overlay .modal-content {
        width: 100% !important; /* Use full available width */
        max-width: 340px !important;
        margin: 0 auto !important;
    }
    
    #kofi-iframe-container iframe {
        height: 650px !important;
        max-height: 80vh !important;
    }
    
    #kofi-modal-overlay .close-modal {
        top: 65px !important;
        right: 10px !important;
        width: 40px !important;
        height: 40px !important;
        font-size: 24px !important;
    }
}


/* END: Styles for the new Ko-fi Modal */













/* START: FINAL MOBILE BUTTON BAR FIX - PASTE AT END OF <style> TAG */

/* Style the new elements for all screen sizes */
.action-btn {
    display: flex;
    flex-direction: column; /* Allows text to stack vertically */
    align-items: center;
    justify-content: center;
    line-height: 1.3 !important;
}

.action-btn small {
    font-size: 0.8em;
    font-weight: normal;
    opacity: 0.8;
    margin-top: 3px;
    display: block; /* Ensures it takes its own line */
}

.kofi-icon {
    height: 16px;
    margin-bottom: 4px;
}

/* This media query only applies these styles to smaller screens */
@media (max-width: 768px) {
    .action-buttons-container {
        flex-wrap: nowrap; /* CRITICAL: Prevents buttons from wrapping to the next line */
        align-items: stretch; /* Makes all buttons the same height */
    }

    /* Target all buttons inside the container on mobile */
    .action-buttons-container > * {
        flex: 1; /* CRITICAL: Makes each button take up an equal amount of space */
        min-width: 0; /* Allows buttons to shrink smaller than their content */
    }

    /* Make the buttons and text smaller to fit */
    .action-btn {
        font-size: 11px !important; /* Smaller font */
        padding: 5px !important; /* Less padding */
    }
}
/* END: FINAL MOBILE BUTTON BAR FIX */

/* START: FINAL Style for the SQUARE Corner Report Button */

.report-btn-corner {
    /* Positioning */
    position: absolute;
    top: 8px;
    right: 8px;
    z-index: 5;

    /* APPEARANCE - Black, SQUARE button */
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid #7a2a2a;
    width: 30px;
    height: 30px;
    border-radius: 4px; /* Makes it a rounded square */
    
    /* Centering the icon */
    display: flex;
    align-items: center;
    justify-content: center;
    
    /* FIX: This nudges the emoji up to be perfectly centered */
    padding-bottom: 2px; 
    
    /* Text and other styles */
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.report-btn-corner:hover {
    background: rgba(0, 0, 0, 0.9);
    transform: scale(1.1);
    box-shadow: 0 0 8px #ff7a7a;
}

/* END: FINAL Style for the SQUARE Corner Report Button */

/* === START: MODERN REPORT MODAL STYLES === */
#report-modal .modal-content {
    background: linear-gradient(135deg, #1e1e1e, #2d2d2d);
    border: 2px solid #ff6b6b;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(255, 107, 107, 0.2);
}

#report-modal .modal-header {
    color: white;
    padding: 20px;
    border-radius: 10px 10px 0 0;
    text-align: center;
}

#report-modal .modal-header h3 {
    margin: 0;
    font-size: 1.4em;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

#report-modal .close-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 24px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
}

#report-modal .close-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

#report-modal .form-group {
    margin: 20px 0;
}

#report-modal .form-group label {
    display: block;
    margin-bottom: 8px;
    color: #ff6b6b;
    font-weight: bold;
    font-size: 14px;
}

#report-modal .form-group input,
#report-modal .form-group textarea {
    width: 100%;
    padding: 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid #444;
    border-radius: 6px;
    color: white;
    font-family: 'Chakra Petch', sans-serif;
    transition: all 0.3s ease;
}

/* === FIX DROPDOWN STYLES === */
#report-modal .form-group select {
    width: 100%;
    padding: 12px;
    background: #1a1a1a !important;
    border: 1px solid #444;
    border-radius: 6px;
    color: white !important;
    font-family: 'Chakra Petch', sans-serif;
    transition: all 0.3s ease;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
    background-repeat: no-repeat !important;
    background-position: right 12px center !important;
    background-size: 16px !important;
}

#report-modal .form-group select option {
    background: #1a1a1a !important;
    color: white !important;
    padding: 12px !important;
}

#report-modal .form-group select:focus {
    outline: none;
    border-color: #ff6b6b;
    box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.2);
}

#report-modal .form-group input:focus,
#report-modal .form-group textarea:focus {
    outline: none;
    border-color: #ff6b6b;
    box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.2);
}

#report-modal .form-actions {
    display: flex;
    gap: 12px;
    margin-top: 25px;
}

#report-modal .btn-cancel {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    border: 1px solid #5a6268;
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    flex: 1;
}

#report-modal .btn-submit {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
    border: 1px solid #ff8e8e;
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    flex: 1;
}

#report-modal .btn-cancel:hover {
    background: linear-gradient(135deg, #5a6268, #495057);
    transform: translateY(-2px);
}

#report-modal .btn-submit:hover {
    background: linear-gradient(135deg, #ff5252, #e53935);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
}

#report-modal .btn-submit:disabled {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
/* === END: MODERN REPORT MODAL STYLES === */

/* Add this new CSS for the reported button state */
.report-btn-corner.reported,
.report-btn-corner:disabled {
    background: rgba(42, 122, 59, 0.7) !important; /* Greenish background */
    border-color: #7aff8d !important;
    cursor: not-allowed;
}

.report-btn-corner.reported:hover,
.report-btn-corner:disabled:hover {
    transform: none; /* No zoom effect */
    box-shadow: none; /* No glow */
}

/* Styles for the new main button group */
.main-action-buttons {
    display: flex;
    flex-direction: column; /* Stacks the button rows vertically */
    align-items: center;   /* Centers them horizontally */
    gap: 10px;             /* Adds a nice space between the rows */
    margin-bottom: 20px;   /* Adds space below the whole group */
}

.submit-code-btn {
    margin-top: 8px; /* Adds a 15px space directly above ONLY this button */
}

/* Remove old margins to prevent double-spacing */
.main-action-buttons .submit-code-btn {
    margin-top: 25px; /* Adds a 15px space above the submit button */
}


/* START: Styles for Code Submission Feature */

/* The main button to open the modal */
.submit-code-btn {
    background: linear-gradient(to bottom, #ff7c00, #e56a00);
    border: 1px solid #ffc600;
    color: #fff;
    padding: 4px 10px; /* Small padding for a small button */
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    font-size: 11px; /* This makes the text very small */
    text-transform: uppercase;
    font-family: 'Chakra Petch', sans-serif;
    text-shadow: 1px 1px 0 #000;
    transition: all 0.2s;
}
.submit-code-btn:hover {
    background: linear-gradient(to bottom, #ff8c00, #ff6a00);
    transform: scale(1.05);
    box-shadow: 0 0 6px #ffc600;
}

/* The pop-up form styles */
.submit-modal-overlay {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 9999;
    justify-content: center;
    align-items: center;
}
.submit-modal-content {
    background: #1f1f1f;
    padding: 25px;
    border-radius: 8px;
    border: 2px solid #ffc600;
    width: 90%;
    max-width: 500px;
    position: relative;
    font-family: 'Chakra Petch', sans-serif;
}
.submit-modal-content h3 {
    color: #ffc600;
    margin-top: 0;
    margin-bottom: 10px;
}
.close-submit-modal {
    position: absolute; top: -15px; right: -15px;
    background: #ff4444; color: white; border: none;
    border-radius: 50%; width: 30px; height: 30px;
    font-size: 20px; cursor: pointer; font-weight: bold;
}

/* Style for required fields */
.form-group input:required {
    border-left: 3px solid #ff6b6b;
}

.form-group label[for]:after {
    content: " *";
    color: #ff6b6b;
}

/* Form element styles */
.form-group {
    margin: 15px 0;
    text-align: left;
}
.form-group label {
    display: block;
    margin-bottom: 5px;
    color: #ccc;
    font-size: 14px;
}
.form-group input {
    width: 100%;
    padding: 10px;
    background: #111;
    border: 1px solid #444;
    border-radius: 4px;
    color: #fff;
    font-family: 'Chakra Petch', sans-serif;
}
.submit-action-btn {
    background: #ff7c00; border: none; color: white;
    padding: 12px 20px; border-radius: 4px; font-size: 16px;
    font-weight: bold; cursor: pointer; width: 100%;
    text-transform: uppercase; margin-top: 10px;
}

/* Message styles */
#submit-message {
    padding: 10px;
    margin: 10px 0;
    border-radius: 4px;
    display: none; /* Hidden by default */
    font-weight: bold;
}
.submit-error {
    background: #5c1f1f; color: #ffaaaa; border: 1px solid #ff7a7a;
}
.submit-success {
    background: #166d2e; color: #a3ffb5; border: 1px solid #34a853;
}

/* Required field styling */
.form-group input:required,
.form-group select:required,
.form-group textarea:required {
    border-left: 3px solid #dc3545;
}

.form-group label[for]:after {
    content: " *";
    color: #dc3545;
}

.form-group label[for="reporter-name"]:after {
    content: ""; /* Name is optional */
}

/* Validation error styling */
.form-group input:invalid,
.form-group select:invalid,
.form-group textarea:invalid {
    border-color: #ffc600;
    background-color: #1f1f1f;
}

.error-message {
    color: #dc3545;
    font-size: 12px;
    margin-top: 5px;
    display: none;
}

/* === START: Styles for Dynamic Code Submission === */
#shift-code-container {
    display: flex;
    flex-direction: column;
    gap: 10px; /* Adds space between each code input row */
}

.code-input-row {
    display: flex;
    align-items: center;
    gap: 8px; /* Space between input and button */
}

.code-input-row input {
    flex-grow: 1; /* Allows the input to take up available space */
}

.code-action-btn {
    background: #444;
    border: 1px solid #666;
    color: white;
    font-weight: bold;
    font-size: 18px;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    flex-shrink: 0; /* Prevents the button from shrinking */
    line-height: 28px;
    padding: 0;
}

.code-action-btn.add {
    background: #166d2e;
    border-color: #34a853;
}

.code-action-btn.remove {
    background: #5c1f1f;
    border-color: #ff7a7a;
}
/* === END: Styles for Dynamic Code Submission === */

/* END: Styles for Code Submission Feature */

/* Style for the purpose dropdown */
/* Style for the dropdowns */
#submit-modal-overlay select {
    width: 100%;
    padding: 12px;
    background: #1a1a1a !important;
    border: 1px solid #444;
    border-radius: 6px;
    color: white !important;
    font-family: 'Chakra Petch', sans-serif;
    transition: all 0.3s ease;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
    background-repeat: no-repeat !important;
    background-position: right 12px center !important;
    background-size: 16px !important;
}

#submit-modal-overlay select option {
    background: #1a1a1a !important;
    color: white !important;
    padding: 12px !important;
}

#submit-modal-overlay select:focus {
    outline: none;
    border-color: #00ffff;
    box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.2);
}

#submit-modal-overlay select:required {
    border-left: 3px solid #ffc600;
}

        /* =================================================== */
        /*         START: SLICK FEEDBACK MODAL STYLES          */
        /* =================================================== */
        /* The CSS from the user request, updated with the radio-color variable */
        .feedback-modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            font-family: 'Chakra Petch', sans-serif;
        }
        .feedback-modal-content {
            background: #1a1a1a;
            color: #f0f0f0;
            padding: 25px;
            border-radius: 8px;
            border: 2px solid #007BFF;
            box-shadow: 0 5px 25px rgba(0, 123, 255, 0.3);
            width: 90%;
            max-width: 550px;
            position: relative;
            text-align: left;
        }
        .feedback-close-btn {
            position: absolute; top: -15px; right: -15px;
            background: #ff4444; color: white; border: none;
            border-radius: 50%; width: 30px; height: 30px;
            font-size: 20px; font-weight: bold;
            cursor: pointer; line-height: 28px;
            text-align: center;
            transition: transform 0.2s;
        }
        .feedback-close-btn:hover {
            transform: scale(1.1);
        }
        .feedback-modal-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #0056A8;
        }
        .feedback-modal-header h3 {
            margin: 0; color: #fff;
        }
        .feedback-modal-header p {
            margin: 5px 0 0 0; color: #007BFF; font-weight: bold;
        }

        /* Page styles */
        .feedback-page {
            display: none;
            animation: fadeIn 0.5s;
        }
        .feedback-page.active {
            display: block;
        }
        .page-title {
            font-weight: bold;
            color: #fff;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        .page-subtitle {
            font-size: 0.9em;
            color: #aaa;
            margin-top: -10px;
            margin-bottom: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Form group styles */
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ccc;
        }
        .form-group input[type="text"],
        .form-group textarea {
            width: 100%;
            padding: 10px;
            background: #111;
            border: 1px solid #444;
            border-radius: 4px;
            color: #fff;
            font-family: 'Chakra Petch', sans-serif;
            transition: border-color 0.3s;
        }
        .form-group input[type="text"]:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007BFF;
        }
        /* Highlight invalid inputs */
        .form-group input.invalid,
        .form-group textarea.invalid {
            border: 1px solid #ff4444 !important;
        }
        .radio-group.invalid {
            border: 1px solid #ff4444 !important;
            padding: 5px; /* Add padding when invalid to show the border nicely */
        }


        /* Custom Radio Buttons (using CSS variables for color) */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 1px solid transparent; /* For invalid state */
            padding: 5px 0; /* Adjusted padding to accommodate the invalid border */
            border-radius: 4px;
            /* Default radio color variable */
            --radio-color: #007BFF; 
        }
        .radio-group.horizontal {
            flex-direction: row;
            justify-content: space-around;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal;
            color: #ddd;
        }
        .radio-group input[type="radio"] {
            display: none;
        }
        .radio-group input[type="radio"] + span {
            padding-left: 30px;
            position: relative;
        }
        .radio-group input[type="radio"] + span::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid var(--radio-color); /* Uses variable */
            border-radius: 50%;
            background: #111;
        }
        .radio-group input[type="radio"]:checked + span::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--radio-color); /* Uses variable */
        }

        /* Navigation */
        .feedback-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #0056A8;
        }
        .feedback-nav-btn {
            background: linear-gradient(to bottom, #007BFF, #0056A8);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            font-family: 'Chakra Petch', sans-serif;
            transition: all 0.3s;
        }
        .feedback-nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
        }
        .feedback-nav-btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #feedback-prev-btn {
            background: #555;
        }
        #feedback-submit-btn {
            background: linear-gradient(to bottom, #28a745, #218838);
        }

        /* Thank You Page */
        .thank-you-page {
            text-align: center;
        }
        .thank-you-page h3 {
            color: #28a745; font-size: 1.5em;
        }
        .thank-you-page p {
            color: #ccc; line-height: 1.6;
        }

        #feedback-prev-btn {
    background: linear-gradient(to bottom, #007BFF, #0056A8); /* Blue gradient background */
    border: 1px solid #007BFF; /* Blue border */
    color: white; /* Ensure text is white */
}

#feedback-prev-btn:hover {
    background: linear-gradient(to bottom, #0056A8, #007BFF); /* Invert or lighten gradient on hover */
    transform: translateY(-2px); /* Keep existing hover effect */
    box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4); /* Blue shadow on hover */
}

/* Set default border color for textareas in the feedback modal to blue */
.feedback-modal-content .form-group textarea {
    border: 1px solid #007BFF; /* Blue border */
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.3); /* Optional: subtle blue glow */
}

/* Ensure the focus state also uses a blue border and glow */
.feedback-modal-content .form-group textarea:focus {
    border-color: #00BFFF; /* A slightly brighter blue for focus */
    box-shadow: 0 0 8px rgba(0, 191, 255, 0.6); /* Stronger blue glow on focus */
}

/* If you want the 'required' indicator (red asterisk) to also have a blue left border, add this: */
.feedback-modal-content .form-group textarea:required {
    border-left: 3px solid #007BFF; /* Blue left border for required fields */
}
/* =================================================== */
/*          END: SLICK FEEDBACK MODAL STYLES           */
/* =================================================== */

/* =================================================== */
/*    START: CONSOLIDATED COLOR & LAYOUT MODE STYLES   */
/* =================================================== */

/* 1. Base Stealth/Color Mode Setup */
body {
    --stealth-brightness: 0.7; /* Default fallback value */
    transition: background-color 0.5s ease;
}
body.stealth-mode .container {
    filter: grayscale(1) brightness(var(--stealth-brightness)) !important; 
    box-shadow: 0 0 10px rgba(128, 128, 128, 0.4) !important;
    border-color: #808080 !important;
    transition: filter 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out;
}
body.stealth-mode .container:before {
    background: linear-gradient(90deg, #808080, #555555, #808080) !important;
    box-shadow: 0 0 8px #555555 !important;
}
body.stealth-mode {
    background-image: none !important;
    background-color: #0d0d0d !important;
}
/* Keep Floating Elements UN-Filtered (use the new merged selector names) */
.stealth-mode .combined-floating-panel,
.stealth-mode .modal-overlay,
.stealth-mode .poll-modal-overlay,
.stealth-mode .floating-share-container,
.stealth-mode .action-buttons-container {
    filter: none !important; 
    box-shadow: none !important;
}

/* 2. Combined Floating Panel Styles (Replaces old 'floating-stealth-panel') */
.combined-floating-panel {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 1003;
    padding: 0;
    margin: 0;
    background: transparent;
    border: none;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}
#combined-toggle-btn {
    background: #1a1a1a;
    color: white;
    border: 1px solid #444;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}
/* Controls Wrapper/Collapse Logic (Replaces old 'stealth-controls-wrapper') */
#combined-controls-wrapper {
    background: #1a1a1a;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 10px;
    display: flex;
    flex-direction: column; /* This is important for the JS order to work */
    align-items: stretch;
    gap: 8px;
    position: absolute;
    bottom: 100%;
    left: 0;
    margin-bottom: 10px;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transform: translateY(10px);
    pointer-events: none;
    transition: all 0.3s ease-in-out;
    min-width: 170px;
}

.combined-floating-panel.is-open #combined-controls-wrapper {
    max-height: 450px; /* INCREASED HEIGHT to safely fit all 5 buttons + slider */
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    border: 1px solid #00ffff;
}
/* Control Styles */
#combined-controls-wrapper label, #combined-controls-wrapper button {
    font-size: 12px;
    font-family: 'Chakra Petch', sans-serif;
    color: #bbb;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    background: #333;
    border: 1px solid #555;
    padding: 8px 10px;
    border-radius: 4px;
    text-align: center;
    transition: background 0.2s;
}
#combined-controls-wrapper input[type="range"] { width: 100%; -webkit-appearance: none; background: transparent; }
/* (Slider track/thumb styles remain the same) */


/* 3. Expanded View Layout (The Layout Mode) */

/* CRITICAL FIX: Explicitly set default to vertical stack */
#active-codes-container,
#expired-codes-container,
#permanent-codes-container,
#black-market-codes-container {
    display: block; 
    padding: 0;
    margin: 0;
}

/* PC-Only Media Query */
/* =================================================== */
/*           PC-ONLY: "PC NO STACK" LAYOUT (CORRECTED)   */
/* =================================================== */

@media (min-width: 900px) {

    /* These styles ONLY apply when the 'expanded-view' class
       is present on the body tag. */

    body.expanded-view .container {
        max-width: 1400px;
        width: 95%;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }

    /*
      This rule defines all the buttons that should form flexible rows.
    */
    body.expanded-view .contact-me-section,
    body.expanded-view .site-options-container,
    body.expanded-view .roadmap-button,
    body.expanded-view .events-button,
    body.expanded-view .challenge-button,
    body.expanded-view .collapse-btn-BlackMarket,
    body.expanded-view .collapse-btn-Perm,
    body.expanded-view .collapse-btn-exp {
        flex: 1 1 300px;
        margin: 5px;
    }

    /*
      --- THIS IS THE KEY FIX ---
      This rule defines all the elements that must take up a full row.
      '#rewards-container' has been added to this list, forcing the
      "Redeem Codes" button to move down to its own line.
    */
    body.expanded-view .container h1,
    body.expanded-view .container h2,
    body.expanded-view .container h3,
    body.expanded-view .container .floating-info-panel,
    body.expanded-view .container .title-bar,
    body.expanded-view .container .action-buttons-container,
    body.expanded-view #rewards-container { /* <-- ADDED HERE */
        flex-basis: 100%;
        margin-top: 15px;
    }

    /* The rest of the layout rules remain correct */
    body.expanded-view #active-codes-container,
    body.expanded-view #expired-codes-container,
    body.expanded-view #permanent-codes-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        flex-basis: 100%;
    }

    body.expanded-view #black-market-codes-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        flex-basis: 100%;
    }

    body.expanded-view .black-market-code-box {
        flex: 1 1 400px;
        margin: 0;
    }

    body.expanded-view .code-footer,
    body.expanded-view .permanent-code-footer,
    body.expanded-view .black-market-code-box .code-footer {
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: center !important;
    }

    body.expanded-view .active-code-buttons-group {
        flex-direction: row !important;
        margin-left: auto !important;
    }
}

@media (max-width: 899px) {
    /* Hide the floating PC button */
    .floating-pc-btn {
        display: none !important;
    }
    
    /* Ensure non-expanded view (mobile) uses vertical stack */
    #active-codes-container, #expired-codes-container, #permanent-codes-container, #black-market-codes-container {
        display: block; 
    }
}
/* =================================================== */
/*    END: CONSOLIDATED COLOR & LAYOUT MODE STYLES     */
/* =================================================== */

/* START: Notification Bell Icon Style */
.floating-notif-bell {
    /* Positioning: 50px above the gear icon */
    position: fixed;
    bottom: 70px; 
    left: 20px; 
    z-index: 1003;

    /* Appearance */
    background: #444; /* Dark grey default */
    color: white;
    border: 1px solid #777;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    
    /* Content - Uses a CSS pseudo-element for the icon */
    font-family: 'Arial', sans-serif; /* Use a font that displays emojis reliably */
    font-size: 18px;
    content: 'üîî'; /* Default Bell */
    
    /* Center the icon */
    display: flex;
    align-items: center;
    justify-content: center;

    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    transition: all 0.2s ease-in-out;
}

/* Hover/Default Style */
.floating-notif-bell:hover {
    background: #666;
    transform: scale(1.1);
}

/* --- Styles added by JavaScript based on permission status --- */

/* State 1: Ready to be Clicked / Default Permission */
.floating-notif-bell:before {
    content: 'üîî'; /* Default Bell */
    color: #fff;
}

/* State 2: Permission DENIED (Blocking) */
.floating-notif-bell.denied {
    background: #ff4444; /* Red */
    border-color: #cc0000;
    cursor: not-allowed;
}
.floating-notif-bell.denied:before {
    content: 'üö´'; /* Blocked sign */
    color: #fff;
}

/* State 3: Permission GRANTED (Enabled, but Hidden by JS) */
.floating-notif-bell.granted {
    background: #00cc00; /* Green */
    border-color: #00aa00;
}
.floating-notif-bell.granted:before {
    content: '‚úÖ'; /* Checkmark */
    color: #fff;
}

/* State 4: Hidden (When permission is granted) */
.floating-notif-bell.hidden {
    display: none !important; 
}
/* END: Notification Bell Icon Style */
/* =================================================== */
/*    END: CONSOLIDATED COLOR & LAYOUT MODE STYLES     */
/* =================================================== */

/* =================================================== */
/*         START: POLL MODAL ISOLATED STYLES (FINAL ROBUST) */
/* =================================================== */

/* --- COLOR PALETTE AND CONFIGURATION --- */
.poll-modal-content {
    --poll-accent-color: #ff00ff; /* Bright Pink/Magenta (Primary Highlight) */
    --poll-border-color: #8a2be2; /* Blue Violet/Purple (Secondary Border) */
    --poll-bg-dark: #221a30;     /* Very Dark Purple/Black background */
    --poll-bg-light: #3b2e50;    /* Medium Dark Purple for hover/border */
    --poll-text-light: #c8aaee;  /* Lighter purple/lavender for title/text */
    --line-color-orange: #FF8C00;
    --line-color-blue: #007BFF;
}

/* --------------------------------------------------- */
/* === MODAL STRUCTURE STYLING === */
/* --------------------------------------------------- */

.poll-modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.9); z-index: 10000;
    display: none; justify-content: center; align-items: center;
    font-family: 'Chakra Petch', sans-serif;
}

.poll-modal-content {
    background-color: var(--poll-bg-dark); color: white;
    padding: 30px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.7);
    max-width: 90%; width: 450px; position: relative;
    border: 1px solid var(--poll-border-color); 
}

.poll-close-btn { 
    position: absolute; top: 10px; right: 15px; background: none; border: none;
    color: var(--poll-text-light); font-size: 24px; cursor: pointer; line-height: 1; 
}

/* --------------------------------------------------- */
/* === HEADER STYLE (CRITICAL FIX FOR THREE LINES) === */
/* --------------------------------------------------- */
.poll-modal-header { 
    text-align: center; margin-bottom: 0; padding-bottom: 0; border-bottom: none;
    position: relative; padding-top: 10px; 
}
.poll-modal-header h3 { margin: 0; color: var(--poll-text-light); }

/* New: Wrapper for the lines and indicator */
.poll-header-content {
    padding: 0; 
    margin-bottom: 15px;
}

/* Style for the Step Indicator */
#poll-step-indicator {
    display: block; margin: 8px 0; color: white; font-weight: bold; font-size: 1.1em;
}

/* Line DIVs */
.poll-header-line {
    display: block; width: 100%; height: 1px; margin: 5px 0;
}

/* Specific Line Colors */
.poll-header-line.orange {
    background-color: var(--line-color-orange);
    margin-top: 10px; 
}
.poll-header-line.pink {
    background-color: var(--poll-accent-color); 
}
.poll-header-line.blue {
    background-color: var(--line-color-blue);
}

/* --------------------------------------------------- */
/* === CRITICAL FIX: PAGE DISPLAY RULES === */
/* --------------------------------------------------- */

/* Base style for all pages, ensures they are not hidden by other CSS */
.poll-page {
    /* Use a simpler fade-in for now, but ensure 'display' is controlled by JS */
    opacity: 0;
    transition: opacity 0.5s;
    display: none !important; /* Start hidden */
}

/* VITAL: This ensures the active page shows up */
.poll-page.active {
    display: block !important; 
    opacity: 1;
}

/* --- TEXT INPUT STYLING --- */
.form-group input[type="text"] {
    width: 100%; padding: 10px; background: #111; border: 1px solid var(--poll-bg-light); 
    border-radius: 4px; color: #fff; font-family: 'Chakra Petch', sans-serif;
    transition: border-color 0.3s;
}
.form-group input[type="text"]:focus {
    outline: none; border-color: var(--poll-accent-color); 
}

/* --------------------------------------------------- */
/* === RADIO BUTTON & THUMBNAIL STYLES === */
/* --------------------------------------------------- */
.poll-page .radio-group label {
    display: flex; align-items: center; margin-bottom: 10px; cursor: pointer;
    padding: 12px 10px; padding-left: 35px; border: 1px solid var(--poll-bg-light); 
    border-radius: 4px; transition: background-color 0.2s, border-color 0.2s;
    position: relative; height: auto;
}
.poll-page .radio-group label:hover {
    background-color: var(--poll-bg-light); border-color: var(--poll-border-color); 
}
.poll-page .radio-group input[type="radio"] {
    position: absolute; opacity: 0; cursor: pointer; height: 100%; width: 100%;
    top: 0; left: 0; margin: 0; z-index: 1; 
}
.poll-page .radio-group label span { display: block; }
.poll-page .radio-group label input[type="radio"] + span::before {
    content: ''; position: absolute; left: 5px; top: 50%; transform: translateY(-50%);
    width: 20px; height: 20px; border: 2px solid var(--poll-border-color); 
    border-radius: 50%; background: var(--poll-bg-dark); z-index: 0; transition: border-color 0.2s;
}
.poll-page .radio-group label input[type="radio"]:checked + span::after {
    content: ''; position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
    width: 10px; height: 10px; border-radius: 50%; background: var(--poll-accent-color); 
    z-index: 0;
}
.poll-page .radio-group label input[type="radio"]:checked ~ span { 
    font-weight: bold; color: white; 
}
.poll-page .radio-group label input[type="radio"]:checked + span::before {
    border-color: var(--poll-accent-color); 
}
.poll-page .radio-group label:has(input[type="radio"]:checked) {
    border-color: var(--poll-accent-color); background-color: #3f264d; 
    box-shadow: 0 0 5px rgba(255, 0, 255, 0.5); 
}

/* --- NEW: THUMBNAIL STYLES --- */
.poll-thumbnail {
    max-width: 40px;
    max-height: 40px;
    margin-left: 15px;
    vertical-align: middle;
    border: 2px solid var(--poll-border-color);
    border-radius: 4px;
    cursor: pointer;
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}
.poll-thumbnail:hover {
    transform: scale(1.1);
    box-shadow: 0 0 8px var(--poll-accent-color);
}
/* --- END NEW STYLES --- */


/* --- Submit Button (Poll) - UPDATED FOR CONSISTENCY --- */
.poll-submit-btn {
    color: white; border: none; 
    padding: 10px 25px; 
    border-radius: 4px;
    font-weight: bold; cursor: pointer; font-family: 'Chakra Petch', sans-serif;
    transition: all 0.3s; 
    width: 48%; 
    margin-top: 25px;
    background: linear-gradient(to bottom, var(--poll-accent-color), var(--poll-border-color));
    height: auto; /* ADD FOR CONSISTENCY */
    line-height: normal; /* ADD FOR CONSISTENCY */
    box-sizing: border-box; /* ADD FOR CONSISTENCY */
}
.poll-submit-btn:hover {
    transform: translateY(-2px); box-shadow: 0 6px 15px rgba(255, 0, 255, 0.4); 
}

/* --- Navigation Button Styles (Previous Button) --- */
.poll-nav-btn {
    background: linear-gradient(to bottom, var(--poll-border-color), var(--poll-bg-light));
    color: white; border: none; 
    padding: 10px 25px; 
    border-radius: 4px;
    font-weight: bold; cursor: pointer; font-family: 'Chakra Petch', sans-serif;
    transition: all 0.3s; 
    width: 48%; 
    margin-top: 25px; /* ADD THIS LINE to match the submit button */
    height: auto; /* EXPLICITLY SET height */
    line-height: normal; /* ENSURE consistent line height */
    box-sizing: border-box; /* ENSURE padding is included in height calculation */
}
.poll-nav-btn:hover {
    transform: translateY(-2px); box-shadow: 0 4px 10px rgba(138, 43, 226, 0.4); 
}
.poll-nav-btn:disabled {
    background: #555; cursor: not-allowed; transform: none; box-shadow: none;
}

/* --- TEXT INPUT STYLING --- */
.form-group input[type="text"] {
    width: 100%; padding: 10px; background: #111; border: 1px solid var(--poll-bg-light);
    border-radius: 4px; color: #fff; font-family: 'Chakra Petch', sans-serif;
    transition: border-color 0.3s;
}
.form-group input[type="text"]:focus {
    outline: none; border-color: var(--poll-accent-color);
}

/* --- NEW: Textarea styling for radio-with-text questions (Explicitly targeting within poll modal) --- */
.poll-modal-content textarea.poll-text-input {
    width: 100%;
    padding: 10px;
    background: #111;
    border: 1px solid var(--poll-accent-color); /* Explicitly set pink border */
    border-radius: 4px;
    color: #fff;
    font-family: 'Chakra Petch', sans-serif;
    transition: border-color 0.3s, box-shadow 0.3s;
    box-shadow: 0 0 5px rgba(255, 0, 255, 0.3); /* Subtle pink glow */
}

.poll-modal-content textarea.poll-text-input:focus {
    outline: none;
    border-color: var(--poll-accent-color); /* Keep pink on focus */
    box-shadow: 0 0 8px rgba(255, 0, 255, 0.6); /* Stronger pink glow on focus */
}

.poll-modal-content textarea.poll-text-input.invalid {
    border: 1px solid #ff4444 !important;
    box-shadow: 0 0 5px rgba(255, 68, 68, 0.5) !important;
}

/* =================================================== */
/*          END: POLL MODAL ISOLATED STYLES            */
/* =================================================== */

/* =================================================== */
/*           FIX: IMAGE PREVIEW Z-INDEX                */
/* =================================================== */
#image-preview-modal {
    z-index: 10001 !important; /* This ensures it appears ON TOP of the poll modal */
}

/* =================================================== */
/* === START: SOFT COLOR MODE STYLES === */
/* =================================================== */
/* 1. Define Color Variables for Soft Mode */
body.soft-mode {
    /* Adjusting the base background color to be less harsh black */
    background-color: #181818 !important; 
}

body.soft-mode .container {
    /* Applying a slight filter for a muted, softer look. Less harsh than grayscale. */
    filter: brightness(0.9) contrast(1.1); 
    box-shadow: 0 0 15px rgba(255, 198, 0, 0.2) !important; /* Softer gold shadow */
    border-color: #e0b040 !important; /* Muted gold border */
    transition: filter 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out;
}

body.soft-mode .container:before {
    background: linear-gradient(90deg, #e0b040, #a08030, #e0b040) !important;
    box-shadow: 0 0 8px #a08030 !important;
}

/* 2. Keep Floating Elements UN-Filtered (Crucial for UX) */
.soft-mode .combined-floating-panel,
.soft-mode .modal-overlay,
.soft-mode .poll-modal-overlay,
.soft-mode .floating-share-container,
.soft-mode .action-buttons-container,
.soft-mode #image-preview-modal {
    filter: none !important; 
    box-shadow: none !important;
}

/* 3. Adjusting Specific Colors for Soft Mode (If needed - current borders are handled above) */
/* You can add more specific overrides here if primary colors like #ffc600 look too harsh in soft mode */
body.soft-mode h1,
body.soft-mode h2,
body.soft-mode h3 {
    text-shadow: 1px 1px 0 #000000 !important;
}
/* =================================================== */
/* === END: SOFT COLOR MODE STYLES === */
/* =================================================== */

/* =================================================== */
/* === START: SLIDER VISIBILITY CONTROL === */
/* =================================================== */

/* Default: Hide the entire stealth control group */
/* =================================================== */
/*         START: RELIABLE SLIDER VISIBILITY FIX       */
/* =================================================== */

#stealth-brightness-control {
    display: none;
    justify-content: center; /* This will center the slider horizontally */
    margin-top: 0px;
    padding-top: 0px;
    border-top: 0px solid #444;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}

/* When .is-visible is added, show it */
#stealth-brightness-control.is-visible {
    display: flex;
    opacity: 1;
}

/* Ensure the slider itself takes up a good amount of space */
#stealth-slider {
    width: 90%; 
}

/* =================================================== */
/*          END: RELIABLE SLIDER VISIBILITY FIX        */
/* =================================================== */

/* =================================================== */
/* === END: SLIDER VISIBILITY CONTROL === */
/* =================================================== */

/* =================================================== */
/*           START: MUTED GRIT THEME STYLES            */
/* =================================================== */

body.muted-grit-mode {
    background-color: #050505 !important;
}

/* --- General Container & Headings --- */
body.muted-grit-mode .container {
    border-color: #a17b00 !important;
    box-shadow: 0 0 15px rgba(161, 123, 0, 0.3) !important;
}
body.muted-grit-mode .container:before {
    background: linear-gradient(90deg, #a17b00, #7d5e00, #a17b00) !important;
}
body.muted-grit-mode h1 { color: #b8860b; } /* DarkGoldenRod */
body.muted-grit-mode h2 { color: #6a0dad; } /* DarkViolet */
body.muted-grit-mode h3 { color: #a11d1d; } /* DarkRed */

/* --- Code Boxes --- */
body.muted-grit-mode .code-box {
    background: linear-gradient(135deg, #4d3800, #2b2000);
    border-color: #b8860b;
}
body.muted-grit-mode .permanent-code-box {
    background: linear-gradient(135deg, #3a2052, #1b0f27);
    border-color: #6a0dad;
}
body.muted-grit-mode .expired-code-box,
body.muted-grit-mode .black-market-code-box {
    background: linear-gradient(135deg, #4d1010, #2b0808);
    border-color: #a11d1d;
}

/* --- Buttons --- */
body.muted-grit-mode .small-copy-btn,
body.muted-grit-mode .rewards-link {
    background: linear-gradient(to bottom, #a17b00, #7d5e00);
    border-color: #b8860b;
}
body.muted-grit-mode .permanent-copy-btn,
body.muted-grit-mode .collapse-btn-Perm {
    background: linear-gradient(to bottom, #6a0dad, #4b0082);
    border-color: #8a2be2;
}
body.muted-grit-mode .expired-copy-btn,
body.muted-grit-mode .collapse-btn-exp,
body.muted-grit-mode .collapse-btn-BlackMarket {
    background: linear-gradient(to bottom, #a11d1d, #800000);
    border-color: #dc143c;
}
body.muted-grit-mode .action-btn:hover, 
body.muted-grit-mode .option-btn:hover {
    filter: brightness(1.2);
}

/* --- Contact Section --- */
body.muted-grit-mode .contact-me-section { border-color: #4682b4; }
body.muted-grit-mode .contact-me-section .contact-me-title { color: #4682b4; }
body.muted-grit-mode .social-links a {
    border-color: #4682b4; /* SteelBlue */
    color: #4682b4;
    background: #1a2a38;
}

/* --- Keep floating UI unaffected --- */
body.muted-grit-mode .combined-floating-panel,
body.muted-grit-mode .modal-overlay,
body.muted-grit-mode .poll-modal-overlay,
body.muted-grit-mode .floating-share-container,
body.muted-grit-mode #image-preview-modal {
    filter: none !important;
}
/* =================================================== */
/*            END: MUTED GRIT THEME STYLES             */
/* =================================================== */

/* =================================================== */
/*           START: CRY BABES (CODES ONLY) MODE        */
/* =================================================== */

/* When this mode is active, hide the following elements */
body.cry-babes-mode .floating-info-panel,
body.cry-babes-mode .contact-me-section,
body.cry-babes-mode .site-options-container,
body.cry-babes-mode #rewards-container,
body.cry-babes-mode .roadmap-button,
body.cry-babes-mode .events-button,
body.cry-babes-mode #events-section,
body.cry-babes-mode .challenge-button,
body.cry-babes-mode #challenge-section,
body.cry-babes-mode .collapse-btn-BlackMarket,
body.cry-babes-mode #black-market-section,
body.cry-babes-mode .collapse-btn-exp,
body.cry-babes-mode #expired-section,
/* Hide specific action buttons, but NOT the kofi button, the share container, or the notification bell */
body.cry-babes-mode .floating-feedback-btn,
body.cry-babes-mode .share-ish-container,
body.cry-babes-mode #openPollBtn,
body.cry-babes-mode .floating-notif-bell { /* <-- ADDED THIS LINE to hide the bell too */
    display: none !important;
}

/* Keep floating UI unaffected */
body.cry-babes-mode .combined-floating-panel,
body.cry-babes-mode .modal-overlay,
body.cry-babes-mode .poll-modal-overlay,
body.cry-babes-mode #image-preview-modal {
    filter: none !important;
}
/* =================================================== */
/*            END: CRY BABES (CODES ONLY) MODE         */
/* =================================================== */

/* --- NEW SHARE MODAL AND BUTTON STYLES (Grey Theme Applied) --- */
/* --- NEW SHARE MODAL AND BUTTON STYLES (Grey Theme Applied) --- */

/* --- NEW SHARE MODAL AND BUTTON STYLES (Minimal Grey Theme) --- */

/* --- 1. Modal Content & Header (Kept for context) --- */
#share-modal .modal-content {
    background: #1f1f1f; /* Dark grey background for modal content */
    border-color: #999999; /* Grey border */
    box-shadow: 0 0 15px rgba(153, 153, 153, 0.3); /* Grey glow */
}
#share-modal h3 {
    color: #cccccc; /* Light grey title */
}

/* --- 2. Centering Fix and Container Styles (Kept for context) --- */
.share-actions {
    display: flex; 
    flex-direction: column; 
    gap: 10px; /* Tighter gap */
    margin-top: 20px;
    align-items: center;
    width: 100%;
}

/* --- 3. Large Text Button Styles (Applying Grey Theme) --- */
.share-actions button:not(.small-share-btn) {
    width: 90%; 
    max-width: 400px; 
    padding: 12px;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
    color: white; 
    display: block; 
    border: 1px solid #555; /* Dark grey border */
    text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
    /* BASE BACKGROUND IS NOW GREY */
    background-color: #444444; 
    border-color: #666666;
}

.share-actions button:not(.small-share-btn):hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(153, 153, 153, 0.2);
}

/* --- HOVER EFFECT: Apply Blue Accent on Hover ONLY --- */
.share-btn-discord:hover { background-color: #5865F2 !important; border-color: #4a54e1; box-shadow: 0 0 8px #5865F2; }
.share-btn-twitter:hover { background-color: #1DA1F2; border-color: #1488d6; box-shadow: 0 0 8px #1DA1F2; }
.share-btn-facebook:hover { background-color: #1877F2; border-color: #1056ad; box-shadow: 0 0 8px #1877F2; }

/* --- 4. Small Button Style (Kept Cyan) --- */
.small-share-btn {
    background: linear-gradient(to bottom, #3A3A3A, #252525); /* Cyan/Blue */
    border: 1px solid #00c6ff;
    color: #ffffff;
    padding: 4px 8px;      
    font-size: 12px;       
    line-height: 1.1;      
    height: 30px;          
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    text-transform: uppercase;
    font-family: 'Chakra Petch', sans-serif;
    text-shadow: 1px 1px 0 #000;
    transition: all 0.2s;
    flex-grow: 0; 
    width: auto;
}
.small-share-btn:hover {
    background: linear-gradient(to bottom, #252525, #3A3A3A);
    transform: scale(1.02);
    box-shadow: 0 0 6px #00c6ff;
}

/* === START: NEW HIDE CODE BUTTON STYLE === */

/* MODIFIED CSS for the eye button */
.hide-code-btn {
    background: transparent !important; /* Make the background transparent */
    border: 1px solid #1c1c1c !important; /* Small gold border to define the box */
    color: #1c1c1c !important; /* Gold icon color to match border/theme */
    padding: 4px 10px; /* Small padding */
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    font-size: 16px; 
    transition: all 0.2s;
    text-shadow: 1px 1px 0 #000;
    margin: 0; 
    line-height: 1.0;
}

.hide-code-btn:hover {
    background: linear-gradient(to bottom, #555, #333);
    transform: scale(1.05);
}


/* Also ensure this style for the wrapper is present: */
.code-footer-left-group {
    display: flex;
    align-items: center;
    gap: 8px; /* Or whatever gap you prefer between the check and eye buttons */
}

/* Style for the container when the code is hidden */
.code-box.hidden-code,
.permanent-code-box.hidden-code,
.expired-code-box.hidden-code,
.black-market-code-box.hidden-code {
    display: none !important;
}

/* Fix for the header checkmark icon when hidden */
.hidden-code .code-header .check-icon {
    opacity: 0.3; /* Make the green checkmark in the corner slightly faded */
}

/* === END: NEW HIDE CODE BUTTON STYLE === */

/* === START: NEW GLOBAL RESET BUTTON STYLE === */
.reset-all-hidden-btn {
    background: linear-gradient(to bottom, #333, #111); /* Dark grey to black gradient */
    color: white;
    border: none;
    padding: 8px 15px; /* Smaller padding than main buttons */
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    font-size: 12px; /* Smaller font size */
    text-transform: uppercase;
    border: 1px solid #555; /* Dark grey border */
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    font-family: 'Chakra Petch', sans-serif;
    display: block;
    width: fit-content;
    margin: 15px auto; /* Center it with some vertical space */
}

.reset-all-hidden-btn:hover {
    background: linear-gradient(to bottom, #444, #222); /* Slightly lighter on hover */
    transform: scale(1.03);
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.1); /* Subtle white glow */
}
/* === END: NEW GLOBAL RESET BUTTON STYLE === */

/* NEW: CSS to group the check button and eye button together */
.code-footer-left-group {
    /* 1. Use Flexbox to arrange items horizontally */
    display: flex;
    /* 2. Vertically align the items (buttons/checkbox) */
    align-items: center;
    /* 3. Add a small space between the two items */
    gap: 8px; 
}

.hidden-code {
    display: none !important;
}

/* =================================================== */
/*         START: NEW REPORT ISSUES MODAL STYLES (v4)  */
/* =================================================== */

/* --- The Main Button --- */
#open-report-issues-btn {
    background: linear-gradient(to bottom, #d9534f, #c9302c) !important;
    color: #fff !important;
    border: 1px solid #d43f3a !important;
    min-height: 60px;
}

/* --- Modal Content Box --- */
#report-issues-modal-overlay .feedback-modal-content {
    background: #2a2d30;
    border: 2px solid #3d4145;
    box-shadow: 0 5px 25px rgba(0,0,0,0.5);
}

/* --- Modal Header --- */
#report-issues-modal-overlay .feedback-modal-header {
    border-bottom: 2px solid #f0ad4e;
    padding-bottom: 15px;
    margin-bottom: 25px;
}
#report-issues-modal-overlay .feedback-modal-header h3 {
    color: #e0e0e0;
    font-size: 1.4em;
    font-weight: bold;
}
#report-issues-modal-overlay .feedback-modal-header p {
    color: #f0ad4e;
    font-weight: bold;
    font-size: 1.1em;
}

/* --- Form Labels & Required Asterisk --- */
#report-issues-modal-overlay .form-group label {
    color: #cccccc;
    font-size: 0.9em;
}
#report-issues-modal-overlay .form-group label[for]:after {
    content: " *";
    color: #e74c3c;
}

/* --- New Wrapper for Side-by-Side Elements --- */
.form-row {
    display: flex;
    gap: 15px;
    align-items: flex-end;
}
.form-row .form-group {
    flex: 1;
    margin-bottom: 0;
}

/* --- Form Inputs (All types) --- */
#report-issues-modal-overlay .form-group input[type="text"],
#report-issues-modal-overlay .form-group input[type="url"], /* <-- Added type="url" */
#report-issues-modal-overlay .form-group select,
#report-issues-modal-overlay .form-group textarea {
    background: #1c1e21;
    border: 1px solid #555;
    color: #e0e0e0;
    border-radius: 4px;
    padding: 10px;
    width: 100%;
}
#report-issues-modal-overlay .form-group input[type="text"]:focus,
#report-issues-modal-overlay .form-group input[type="url"]:focus, /* <-- Added type="url" */
#report-issues-modal-overlay .form-group select:focus,
#report-issues-modal-overlay .form-group textarea:focus {
    border-color: #f0ad4e;
    outline: none;
}
#report-issues-modal-overlay .form-group textarea,
#report-issues-modal-overlay .form-group select {
    border-color: #f0ad4e;
}

/* --- Dropdown Specific Styles --- */
#report-issues-modal-overlay select {
    appearance: none; -webkit-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23e0e0e0'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 1em;
}
#report-issues-modal-overlay .form-group option {
    background: white; color: black;
}

/* --- Checkbox Styling (Left Aligned) --- */
#report-issues-modal-overlay .checkbox-label {
    justify-content: flex-start; align-items: center; cursor: pointer; color: #ccc;
}
#report-issues-modal-overlay .checkbox-label input[type="checkbox"] {
    appearance: none; -webkit-appearance: none;
    width: 18px; height: 18px;
    background: transparent; border: 2px solid #888; border-radius: 3px;
    margin-right: 10px; position: relative; cursor: pointer; flex-shrink: 0;
}
#report-issues-modal-overlay .checkbox-label input[type="checkbox"]:checked {
    background: #f0ad4e; border-color: #f0ad4e;
}
#report-issues-modal-overlay .checkbox-label input[type="checkbox"]:checked::before {
    content: "‚úì"; position: absolute;
    color: #2a2d30; font-size: 14px; font-weight: bold;
    top: 50%; left: 50%; transform: translate(-50%, -50%);
}
#report-issues-modal-overlay .checkbox-label:after {
    content: " *"; color: #e74c3c;
}

/* --- Blue Separator Line --- */
hr.form-separator {
    border: none; height: 1px; background-color: #4a90e2; margin: 25px 0;
}

/* --- Submit Button --- */
#report-issues-submit-btn {
    background: #f0ad4e; color: #2a2d30; border: none; font-weight: bold; text-transform: uppercase;
}
#report-issues-submit-btn:hover {
    background: #ec971f; transform: translateY(-1px); box-shadow: none;
}
/* =================================================== */
/*          END: NEW REPORT ISSUES MODAL STYLES        */
/* =================================================== */

/* =================================================== */
/*          blackmarket vendor submit MODAL STYLES          */
/* =================================================== */
/* START OF FIX 1/3: CSS for BM Submit Button */
.bm-submit-info-btn {
    /* REMOVED: float: right; */
    background: linear-gradient(to bottom, #d9534f, #c9302c); /* Red Gradient */
    color: #fff;
    border: 1px solid #d43f3a;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    font-size: 10px;
    text-transform: uppercase;
    font-family: 'Chakra Petch', sans-serif;
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
    
    /* --- CENTERING FIX --- */
    margin: 5px auto; /* 5px top/bottom margin, auto left/right for centering */
    display: block;  /* Necessary for margin: auto to work */
    text-align: center; /* Centers text inside the button */
    /* --- END CENTERING FIX --- */
    
    /* REMOVED: margin-left: 10px; */
    line-height: 1.2;
}

.bm-submit-info-btn:hover {
    background: linear-gradient(to bottom, #c9302c, #d9534f);
    transform: scale(1.03);
    box-shadow: 0 0 6px #ff7a7a;
}

/* START OF FIX: Custom Black Market Select/Input Styling (Red Borders) */

/* 1. Target the dropdown element (select) */
#bm-submit-modal-overlay select {
    /* Set the background and color for the select box */
    background: #1a1a1a !important; 
    color: white !important;

    /* Apply the custom RED border */
    border: 1px solid #FF4444 !important;
    border-radius: 4px !important; 
}

/* Target the options inside the select when the list is open */
#bm-submit-modal-overlay select option {
    background-color: #000000 !important;
    color: white !important;
}

/* 2. Target all input/textarea elements */
#bm-submit-modal-overlay input[type="text"],
#bm-submit-modal-overlay input[type="url"],
#bm-submit-modal-overlay textarea {
    /* Apply the custom RED border and ensure dark background */
    border: 1px solid #FF4444 !important;
    background: #111 !important;
    color: white !important;
}

/* 3. Apply focused/active state styles */
#bm-submit-modal-overlay select:focus,
#bm-submit-modal-overlay input:focus,
#bm-submit-modal-overlay textarea:focus {
    outline: none !important;
    /* Use a brighter RED shadow for the focused state */
    border-color: #FF4444 !important; 
    box-shadow: 0 0 0 2px rgba(255, 68, 68, 0.5) !important;
}

/* 4. Ensure 'required' indicator uses the red theme color */
#bm-submit-modal-overlay .form-group label[for]:after {
    color: #FF4444 !important;
}

/* 5. Override the generic required left border if present */
#bm-submit-modal-overlay .form-group input:required,
#bm-submit-modal-overlay .form-group select:required,
#bm-submit-modal-overlay .form-group textarea:required {
    border-left: 3px solid #FF4444 !important;
}

/* END OF FIX */
/* END OF CORRECTED CSS */


/* =================================================== */
/*   drops and skins submit MODAL STYLES          */
/* =================================================== */
/* START OF FIX 1/3: CSS for Drop Submit Button and Modal Theme */

/* New Submit Drops Button Style (Pink/Purple Theme) */
.drops-submit-info-btn {
    background: linear-gradient(to bottom, #FF00FF, #A000A0); /* Pink/Purple Gradient */
    color: #fff;
    border: 1px solid #FF80FF;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    font-size: 10px;
    text-transform: uppercase;
    font-family: 'Chakra Petch', sans-serif;
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
    line-height: 1.2;
    /* CENTERING FIX */
    margin: 5px auto;
    display: block;
    text-align: center;
}

.drops-submit-info-btn:hover {
    background: linear-gradient(to bottom, #A000A0, #FF00FF);
    transform: scale(1.03);
    box-shadow: 0 0 6px #FF00FF;
}

/* Modal Styling for Drops Theme (using bm-submit-modal classes with new colors) */
#drops-submit-modal-overlay .submit-modal-content {
    border-color: #FF00FF !important; /* Pink Border */
    background: #2A1A2A !important; /* Dark Purple Background */
}
#drops-submit-modal-overlay h3 {
    color: #FF00FF !important; /* Pink Heading */
}
#drops-submit-modal-overlay .close-submit-modal {
    background: #FF00FF !important; /* Pink Close Button */
}
#drops-submit-modal-overlay .submit-action-btn {
    background: linear-gradient(to bottom, #FF00FF, #A000A0) !important; /* Pink Submit Button */
}

/* Dynamic Code Input Group Styles (New for this modal) */
#drops-code-container .code-input-row {
    margin-bottom: 8px;
}
#drops-code-container .code-action-btn.add {
    background: #4B0082; /* Dark Violet */
    border-color: #9370DB; /* Medium Purple */
}
#drops-code-container .code-action-btn.remove {
    background: #6A5ACD; /* Slate Blue */
    border-color: #8A2BE2; /* Blue Violet */
}

/* START OF FIX: Custom Styling for Drops Select Options */

/* Target the dropdown itself to set the primary border color */
#drops-submit-modal-overlay select {
    /* Background and text should be set by the previous fix, keeping them dark/white */
    
    /* ADD/MODIFY: Set the default border to Gold/Yellow */
    border: 1px solid #c619e5 !important;
    border-radius: 4px !important; 
    background-color: #111;
    
    /* Set the default text color */
    color: white !important;
}

/* Target the dropdown when it is actively focused (clicked) */
#drops-submit-modal-overlay select:focus {
    outline: none;
    /* ADD/MODIFY: Use a brighter Gold/Yellow shadow for the focused state */
    border-color: #c619e5 !important;
    box-shadow: 0 0 0 2px rgba(255, 222, 0, 0.5) !important;
}

/* Ensure the required field indicator (left border) uses the Gold/Yellow */
#drops-submit-modal-overlay select:required {
    border-left: 3px solid #c619e5 !important;
}

/* Target all inputs and textareas inside the Drops modal */
#drops-submit-modal-overlay input[type="text"],
#drops-submit-modal-overlay input[type="url"],
#drops-submit-modal-overlay textarea {
    /* Apply the custom purple border and ensure the dark background */
    border: 1px solid #C619E5 !important;
    background: #111 !important; /* Ensuring a dark background */
    color: white !important; /* Ensuring white text */
}

/* Target the inputs when they are focused (clicked/active) */
#drops-submit-modal-overlay input[type="text"]:focus,
#drops-submit-modal-overlay input[type="url"]:focus,
#drops-submit-modal-overlay textarea:focus {
    outline: none !important;
    /* Apply a distinct, bright purple focus shadow/border */
    border-color: #FF00FF !important; /* Brighter pink/purple on focus */
    box-shadow: 0 0 0 2px rgba(255, 0, 255, 0.4) !important;
}

/* Ensure 'required' indicator (left border) also uses the purple theme */
#drops-submit-modal-overlay label[for]:after {
    /* Use the same pink color for the required asterisk */
    color: #FF00FF !important;
}

/* END OF FIX */
/* END OF drops skins modal and button skin*/
/* =================================================== *
/* =================================================== *
/* =================================================== *


/* =================================================== */
/* =================================================== */
/* =================================================== */
/* === START: NEW "HIDE ISH" BUTTON & MENU STYLES === */

/* Style for the new main button in the top button row */
.option-btn.option-btn-hide {
    /* Reusing this existing style, but adding specific color/shadow for clarity */
    background: linear-gradient(to bottom, #444444, #2a2a2a); /* Dark Grey Gradient */
    border: 1px solid #777777;
    color: #ffc600; /* Gold text */
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}
.option-btn.option-btn-hide:hover {
    background: linear-gradient(to bottom, #555555, #333333);
    box-shadow: 0 0 8px rgba(255, 198, 0, 0.3);
}

/* Hide the main 'option-btn-hide' button itself, as we use a floating one now */
#hideem-toggle-btn {
    display: none !important;
}
/* =================================================== */


/* =================================================== */
/*   FIX FOR MOBILE: GROUP CHECKBOX & HIDE BUTTON      */
/* =================================================== */
@media (max-width: 768px) {
    /* 1. Ensure the main footer is a horizontal row and can justify content */
    .code-footer,
    .permanent-code-footer {
        display: flex !important;
        flex-direction: row !important;
        justify-content: space-between !important;
        align-items: center !important;
        gap: 5px !important;
        padding-top: 5px;
        width: 100% !important;
    }

    /* 2. Target the Left Group (Checkbox + Hide Button) */
    .code-footer-left-group {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 8px !important;
        order: 1 !important;
        flex-shrink: 0;
        margin-right: auto !important;
    }
    
    /* Ensure the left group's internal items don't have conflicting margins */
    .code-footer-left-group .actredeem-checkbox,
    .code-footer-left-group .permredeem-checkbox,
    .code-footer-left-group .redeem-checkbox,
    .code-footer-left-group .hide-code-btn {
        margin: 0 !important;
        order: unset !important;
    }

    /* 3. Target the Right Group (Preview, Copy, Share Buttons) */
    .active-code-buttons-group,
    .permanent-action-buttons-group {
        display: flex !important;
        flex-direction: row !important;
        gap: 5px !important;
        order: 2 !important;
        flex-shrink: 1;
        margin: 0 !important;
        margin-left: auto !important; /* ADD THIS LINE - pushes to right */
    }

    /* Make individual action buttons smaller */
    .small-copy-btn, .preview-btn, .activepreview-btn, .small-share-btn,
    .permanent-copy-btn, .prempreview-btn {
        padding: 4px 8px !important;
        font-size: 10px !important;
        width: auto !important;
        margin: 0 !important;
    }

    /* 4. CRITICAL: Override any flex-direction column rules */
    body .code-footer,
    body .permanent-code-footer {
        flex-direction: row !important;
    }

    /* 5. Ensure the button groups maintain their layout */
    .active-code-buttons-group,
    .permanent-action-buttons-group {
        flex-wrap: nowrap !important;
        justify-content: flex-end !important;
    }
}

/* --- Hide Notification Bell on Mobile --- */
    .floating-notif-bell {
        display: none !important;
    }



/* ========================================================== */
/*     MOBILE: oct 10/18/2025 FINAL & STABLE BUTTON ROW LAYOUT */
/* ========================================================== */
@media (max-width: 768px) {
  body:not(.mobile-old-layout) .container {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 10px;
  }

  body:not(.mobile-old-layout) .container > * {
    grid-column: 1 / -1;
    order: 99;
  }

  body:not(.mobile-old-layout) .container > .title-bar { order: 1; }
  body:not(.mobile-old-layout) .container > .action-buttons-container { order: 2; }
  body:not(.mobile-old-layout) .container > .floating-info-panel { order: 3; }

  body:not(.mobile-old-layout) .container > .contact-me-section,
  body:not(.mobile-old-layout) .container > .site-options-container,
  body:not(.mobile-old-layout) .container > .roadmap-button,
  body:not(.mobile-old-layout) .container > .events-button,
  body:not(.mobile-old-layout) .container > .challenge-button,
  body:not(.mobile-old-layout) .container > .collapse-btn-BlackMarket,
  body:not(.mobile-old-layout) .container > .collapse-btn-Perm {
    order: 4;
  }

  body:not(.mobile-old-layout) .contact-me-section { grid-column: 1 / 4; }
  body:not(.mobile-old-layout) .site-options-container { grid-column: 4 / 7; }

  body:not(.mobile-old-layout) .roadmap-button { grid-column: 1 / 3; }
  body:not(.mobile-old-layout) .events-button { grid-column: 3 / 5; }
  body:not(.mobile-old-layout) .challenge-button { grid-column: 5 / 7; }
  
  body:not(.mobile-old-layout) .collapse-btn-BlackMarket { grid-column: 1 / 4; }
  body:not(.mobile-old-layout) .collapse-btn-Perm { grid-column: 4 / 7; }

  body:not(.mobile-old-layout) .contact-me-section, 
  body:not(.mobile-old-layout) .site-options-container,
  body:not(.mobile-old-layout) .roadmap-button, 
  body:not(.mobile-old-layout) .events-button, 
  body:not(.mobile-old-layout) .challenge-button,
  body:not(.mobile-old-layout) .collapse-btn-BlackMarket, 
  body:not(.mobile-old-layout) .collapse-btn-Perm {
    padding: 12px 5px; margin: 0; min-height: 60px;
    align-content: center;
  }
  body:not(.mobile-old-layout) .roadmap-button, 
  body:not(.mobile-old-layout) .events-button, 
  body:not(.mobile-old-layout) .challenge-button { font-size: 11px; }
  body:not(.mobile-old-layout) .contact-me-section .contact-me-title, 
  body:not(.mobile-old-layout) .site-options-container .site-options-title { font-size: 14px; }

  body:not(.mobile-old-layout) .site-options-container.is-open,
  body:not(.mobile-old-layout) .contact-me-section:hover {
    grid-column: 1 / -1;
  }
  body:not(.mobile-old-layout) .site-options-container.is-open .site-options-title,
  body:not(.mobile-old-layout) .contact-me-section:hover .contact-me-title {
    font-size: 18px;
  }
  body:not(.mobile-old-layout) .contact-me-section .slide-down-content { max-height: 0; margin-top: 0; overflow: hidden; }
  body:not(.mobile-old-layout) .contact-me-section:hover .slide-down-content { max-height: 200px; margin-top: 20px; }
}
/* ============================================== */

/* =================================================== */
/* PC-ONLY: FIXED GRID VIEW - ACTIVE CODES AT BOTTOM */
/* =================================================== */
@media (min-width: 1024px) {
    body.compact-grid-active .container {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
    }

    /* Reset all children first */
    body.compact-grid-active .container > * {
        grid-column: 1 / -1;
        order: 999;
        margin: 0;
    }

    /* TOP: All the button sections */
    body.compact-grid-active .title-bar { order: 1; }
    body.compact-grid-active .action-buttons-container { order: 2; }
    body.compact-grid-active .floating-info-panel { order: 3; }
    body.compact-grid-active .contact-me-section { grid-column: 1 / 4; order: 4; }
    body.compact-grid-active .site-options-container { grid-column: 4 / 7; order: 4; }
    body.compact-grid-active .roadmap-button { grid-column: 1 / 3; order: 5; }
    body.compact-grid-active .events-button { grid-column: 3 / 5; order: 5; }
    body.compact-grid-active .challenge-button { grid-column: 5 / 7; order: 5; }
    body.compact-grid-active .collapse-btn-BlackMarket { grid-column: 1 / 4; order: 6; }
    body.compact-grid-active .collapse-btn-Perm { grid-column: 4 / 7; order: 6; }
    body.compact-grid-active #rewards-container { order: 7; }

    /* BOTTOM: Active codes section */
    body.compact-grid-active .container > h1:first-of-type {
        order: 999 !important;
    }
    
    /* FIX 1: Move reset button to be BELOW main buttons but ABOVE active codes */
    body.compact-grid-active .reset-all-hidden-btn {
    order: 1001 !important;
    grid-column: 3 / 5 !important; /* This will center it in the 6-column grid */
    text-align: center;
}

    body.compact-grid-active #active-codes-container {
        order: 1002 !important;
    }

    body.compact-grid-active .collapse-btn-exp {
        order: 1003 !important;
    }

    /* FIX 2: Make sure expired section appears at bottom when opened */
    body.compact-grid-active #expired-section {
        order: 1004 !important;
    }
}
/* ============================================== */
/* ============================================== */
/* ============================================== */

/* =================================================== */
/* =================================================== */
/* =================================================== */
/*   START: FINAL, DEFINITIVE MOBILE MODAL FIX (767.98px and below)  */
/* =================================================== */
@media (max-width: 767.98px) {

    /* --- 1. CRITICAL: BODY & HTML SCROLL LOCK AND ANTI-BOUNCE --- */
    /* This aggressively locks the entire document scroll on all platforms. */
    body.modal-open, 
    html.modal-open { 
        position: fixed !important;
        width: 100% !important;
        height: 100% !important;
        overflow: hidden !important;
        touch-action: none !important; /* Disables all touch actions on the root */
        overscroll-behavior-y: none !important; /* CRITICAL: Stops background page bounce */
    }
    
    /* Ensure the modal overlay itself cannot be dragged or bounced */
    .modal-overlay,
    .feedback-modal-overlay,
    .poll-modal-overlay,
    .submit-modal-overlay {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
        z-index: 9998 !important;
        background: rgba(0, 0, 0, 0.85) !important;
        
        /* The overlay must not scroll, as content scroll is handled by modal-content */
        overflow-y: hidden !important;
        touch-action: none !important; /* CRITICAL: Prevents dragging the whole fixed overlay */
        overscroll-behavior-y: none !important; 
    }

    /* --- 2. MODAL CONTENT STYLES (Fixed, Centered, Scrollable) --- */
    .modal-content,
    .feedback-modal-content,
    .poll-modal-content,
    .submit-modal-content {
        position: fixed !important; 
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important; 
        
        width: 95vw !important;
        max-width: 500px !important;
        max-height: 85vh !important; 
        
        /* Re-enabling internal vertical scroll (only pan-y allowed) */
        overflow-y: auto !important; 
        touch-action: pan-y !important; 
        -webkit-overflow-scrolling: touch !important;
        
        z-index: 9999 !important;
    }
    
    /* --- 3. FORM ROW STACKING FIXES (FOR ALL MODALS) --- */
    
    /* Fix for button groups in footers */
    #report-modal .form-actions,
    .feedback-navigation {
flex-direction: row !important;
        justify-content: space-between !important; /* Pushes Previous to left, Next/Submit to right */
        gap: 10px !important; /* Add space between buttons if they don't fully stretch */
    }

        .feedback-nav-btn {
        flex-grow: 1 !important; /* Allows them to grow equally to share space */
        max-width: 50% !important; /* Cap width to prevent massive buttons */
        padding: 8px 15px !important; /* Reduce vertical padding */
        font-size: 14px !important; /* Reduce font size */
    }
    
    /* Fix for custom form rows like in the Report Issues modal */
    #report-issues-modal-overlay .form-row {
        flex-direction: column !important;
        gap: 0 !important;
    }
    #report-issues-modal-overlay .form-row .form-group {
        width: 100% !important;
        flex: none !important;
        margin-bottom: 15px !important; 
    }

    /* --- 4. ACCESSIBILITY & ZOOM PREVENTION --- */
    input[type="text"],
    input[type="url"],
    input[type="email"],
    textarea,
    select {
        font-size: 16px !important; 
        min-height: 44px !important; 
        padding: 12px !important;
        touch-action: manipulation !important; 
        box-sizing: border-box !important;
    }

    /* Ensure the Close button is large and clickable */
    .close-btn,
    .feedback-close-btn,
    .poll-close-btn,
    .close-submit-modal,
    .close-preview {
        position: absolute !important;
        top: -15px !important;
        right: -15px !important;
        z-index: 10000 !important; 
        width: 44px !important;
        height: 44px !important;
        line-height: 44px !important;
        font-size: 20px !important;
        pointer-events: auto !important;
    }
    
    /* Force WebKit scrollbars to show */
    .modal-content::-webkit-scrollbar,
    .feedback-modal-content::-webkit-scrollbar,
    .poll-modal-content::-webkit-scrollbar,
    .submit-modal-content::-webkit-scrollbar {
        width: 8px !important;
        display: block !important; 
        background: #333333;
        border-radius: 4px;
    }
    .modal-content::-webkit-scrollbar-thumb,
    .feedback-modal-content::-webkit-scrollbar-thumb,
    .poll-modal-content::-webkit-scrollbar-thumb,
    .submit-modal-content::-webkit-scrollbar-thumb {
        background: #888888 !important;
        border-radius: 4px !important;
    }
    
    /* --- FINAL CRITICAL INJECTION FOR INNER CONTENT LOCK --- */
    .modal-content,
    .feedback-modal-content,
    .poll-modal-content,
    .submit-modal-content,
    #report-issues-form,
    #report-form {
        /* Prevents horizontal movement (pan-x) and horizontal scrolling/bouncing */
        overflow-x: hidden !important; 
        width: 100% !important;
        max-width: 100% !important;
    }
}
/* =================================================== */
/*   END: FINAL, DEFINITIVE MOBILE MODAL FIX   */
/* =================================================== */
/* =================================================== */
/* =================================================== */


    </style>
</head>

<!-- =================== -->
<!-- Report Dialog Modal -->
<!-- =================== -->
<div id="report-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üö® Report SHiFT Code Issue</h3>
            <button class="close-btn" onclick="closeReportModal()">&times;</button>
        </div>
        
        <div class="modal-body">
            <form id="report-form">
                <div class="form-group">
                    <label for="reporter-name">Your Name (Optional) | Reddit/Discord Username If Want Me To Contact You:</label>
                    <input type="text" id="reporter-name" placeholder="Enter your name or reddit/discord name if want me to contact you">
                </div>
                
                <div class="form-group">
                    <label for="issue-type">What's the issue? *</label>
                    <select id="issue-type" required>
                        <option value="">Select an issue...</option>
                        <option value="expired">Code is expired</option>
                        <option value="invalid">Code is invalid</option>
                        <option value="promo">Promo is done</option>
                        <option value="region-locked">Region locked</option>
                        <option value="platform-issue">Platform specific issue</option>
                        <option value="other">Other issue</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="issue-description">Description *</label>
                    <textarea 
                        id="issue-description" 
                        placeholder="Please describe the issue in detail. What happened when you tried to redeem the code?"
                        rows="3"
                        required
                    ></textarea>
                    <small>Please provide specific details about the problem</small>
                </div>
                
                <div class="form-group">
                    <label for="proof-link">Proof Link *</label>
                    <input 
                        type="url" 
                        id="proof-link" 
                        placeholder="https://example.com/screenshot.jpg"
                        required
                    >
                    <small>Required: Link to screenshot, video, or other proof showing the issue [imgur,postimage,s3nd] links only</small>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeReportModal()">Cancel</button>
                    <button type="submit" class="btn-submit">Submit Report</button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- ======================= -->
<!-- END Report Dialog Modal -->
<!-- ======================= -->


<!-- REPLACE the existing image-preview-modal div with this one -->
<div id="image-preview-modal" class="image-preview-modal">
    <div class="image-preview-content">
        <div id="preview-container" style="display: none;">
            <!-- Iframe or video will be injected here by JavaScript -->
        </div>
        <img id="preview-image" src="" alt="Preview" style="display: none;">
    </div>
    <!-- These are the new controls for zooming and closing -->
    <div id="image-preview-controls">
        <button class="control-btn" id="zoom-in-btn" title="Zoom In">+</button>
        <button class="control-btn" id="zoom-out-btn" title="Zoom Out">-</button>
        <button class="control-btn" id="reset-zoom-btn" title="Reset Zoom">‚ü≤</button>
        <button class="control-btn" id="close-preview-btn" title="Close">√ó</button>
    </div>
</div>
<!-- END of the replacement block -->



<body>




    <div class="noise"></div>
    <div class="scanlines"></div>
    
    <div class="container">
        <div class="title-bar">
            <img src="https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png" alt="Left Icon" class="icon">
            <div class="title-text">BL 4 SHiFT Code Tracker<br>Info Hub + More</div>
            <img src="https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png" alt="Right Icon" class="icon">
        </div>

<!-- DELETE your old action-buttons-container and REPLACE it with this one -->
<div class="action-buttons-container">

        <button class="action-btn kofi-button" onclick="openKofiModal()">
        <img src="https://storage.ko-fi.com/cdn/cup-border.png" alt="Ko-fi donations" class="kofi-icon"/>
        Support This via Dono
        <small>Means Alot If You Do</small>
    </button>

<button class="action-btn floating-feedback-btn">
    Feedback<br>Forum<br><small>Updated 10/14/2025</small>
</button>

<button class="action-btn" id="open-report-issues-btn">
    Report<br>Issue<br><small>üêû</small>
</button>

<button class="action-btn floating-poll-btn" id="openPollBtn" style="display: none;">
    <span class="drops-pulse">EH! New Poll</span><br><small>Oct 20-27th</small>
</button>
<!-- =================================================== -->
<!--         START: SHIFT CODE TRACKER - COMMUNITY POLL (MULTI-PAGE) -->
<!-- =================================================== -->

<!-- You MUST use this structure for the Data-Driven script to work -->
<div id="pollModal" class="poll-modal-overlay" style="display: none;">
    <div class="poll-modal-content">
        <button id="closePollBtn" class="poll-close-btn">&times;</button>
        <div class="poll-modal-header">
            <h3>üó≥Ô∏è Poll</h3>
            <div class="poll-header-content">
                <p id="poll-step-indicator">Step 1 of 1</p> 
                <div class="poll-header-line pink"></div>
            </div>
        </div>

        <form id="poll-form">
            <!-- üö® THIS IS THE VITAL INJECTION POINT üö® -->
            <div id="poll-pages-container">
                <!-- Pages are generated here by JavaScript -->
            </div>

            <!-- Thank You Page (Always LAST in the DOM) -->
            <div class="poll-page thank-you-page" id="poll-thank-you-page" data-page="-1" style="display: none;">
                <h3>Thank you for voting!, Done Feedback Forum yet?</h3>
                <p>Your vote has been successfully logged. Click the X to close.</p>
            </div>
            
            <!-- Navigation Buttons -->
            <div class="feedback-navigation">
                <button id="poll-nav-prev-btn" class="poll-nav-btn" style="display: none;">Previous</button>
                <button id="poll-nav-next-btn" class="poll-nav-btn" style="display: none;">Next</button>
                <button id="poll-nav-submit-btn" class="poll-submit-btn" style="display: none;">Submit Vote</button>
            </div>
        </form>
    </div>
</div>
    <!-- This container is the key -->
<div class="share-ish-container">
    <button class="action-btn share-fab" id="share-ish-button">
        üîó<br>Share It On Socials
        <small>Help It Get Seen :)</small>
    </button>
    <div class="share-ish-menu" id="share-ish-menu">
        <a href="https://twitter.com/intent/tweet?text=Vault%20Hunters%20This%20SHiFT%20Code%20tracker%20has%20it%20all%3A%20active%20codes%2C%20Black%20Market%20info%20%26%20weekly%20resets%20in%20one%20spot.%0A%0AThanks%20%40xsmashx88x%20for%20making%20this!%0A%0AEh%20%40Borderlands%20%40GearboxOfficial%2C%20show%20it%20some%20love!%20%3A)%0A%0A%23Borderlands%20%23ShiftCodes%20%23Borderlands4%20%23BL4&url=https://xsmashx88x.github.io/Shift-Codes/" class="share-menu-item twitter-btn" target="_blank">üê¶ Share on X</a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://xsmashx88x.github.io/Shift-Codes/&quote=Fellow%20Vault%20Hunters%2C%20check%20out%20this%20epic%20SHiFT%20Code%20tracker!%20It%20has%20it%20all%20in%20one%20place%3A%20active%20codes%2C%20Black%20Market%20locations%2C%20weekly%20reset%20info%2C%20and%20more.%20You%20won't%20need%20to%20hunt%20for%20codes%20again!" class="share-menu-item facebook-btn" target="_blank">üëç Share on FB</a>
    </div>
</div>



<!-- =================================================== -->
<!--          END: SHIFT CODE TRACKER - COMMUNITY POLL   -->
<!-- =================================================== -->


</div>



<!-- END: FINAL CORRECTED Floating Poll Button and Modal -->    

    <!-- === START: FINAL FLOATING INFO PANEL === -->
    <div class="floating-info-panel" id="floating-info-panel">
        
        <!-- This part is always visible -->
        <div class="visible-reminder-text">
            ‚Ä¢ FAV & CHECK DAILY ‚Ä¢
            
            <!-- This is the smaller, clickable link that triggers the dropdown -->
            <a class="thank-you-link" style="color: #ffffff;" onclick="toggleThankYouPanel(this)">
                ‚Ä¢ Supporters & Special Thanks ‚Ä¢ <br> <small style="font-size: 0.7em; color: #00ffff;">Click To Open/Close list | !Updated 10/18/2025</small>
            </a>
        </div>
        
        <!-- This is the content that is hidden by default -->
        <div class="thank-you-content">
            <h4>MSG TO YOU ALL</h4>
            <ul>
                <li><span style="color: gold; font-weight: bold;">Sticky</span>, For being a legend, Good Friend. Love Ya Man | ü´Çüëä</li>                
                <li>The amazing <span style="color: hotpink;">[/r/Borderlands]</span> Community! | ü´Çüëä</li>
                <li>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</li>
                <li><span style="font-weight: bold;">Peeps who donate a certain amount or above go below</span></li>
                <li><span style="color: gold; font-weight: bold;">CAPSxXxLOCK</span>, Holy shit eh THANK YOU | ü´Çüëäüëä</li>
                <li><span style="color: gold; font-weight: bold;">Pip (‚ÄòVirtual Pip‚Äô Xbox, ‚ÄòPip Was Here‚Äô Steam)</span>, Holy shit eh THANK YOU | ü´Çüëä</li>
                <li>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</li>
                <li><span style="font-weight: bold;">I am thankful for all donos dont think i am not :)</span></li>
                <li><span style="color: #F228BC;">To Everyone Who Has Supported This, An Will. Thank You</span>üëä</li>
                <li><span style="color: #28EBF2;">Means Alot, Its hard to express just how much this helps me on a personal level</span></li>
                <li><span style="color: #F2C928;">Will Thank You On Kofi :) </span>üçµ</li>
                </ul>
        </div>

    </div>


<!-- START: Code Submission Modal -->
<div id="submit-modal-overlay" class="submit-modal-overlay">
    <div class="submit-modal-content">
        <button class="close-submit-modal" onclick="closeCodeSubmitModal()">&times;</button>
        <h3>Submit a SHiFT Code</h3>
        <p>Found a code we're missing? Let us know!</p>
        
        <div class="form-group">
            <label for="submit-description">What is the code for? (e.g., "1 Gold Key", "Vex Skin") *</label>
            <input type="text" id="submit-description" placeholder="Enter a brief description..." required>
        </div>

        <!-- This is the new container for dynamic code inputs -->
        <div class="form-group">
            <label>SHiFT Code(s) *</label>
            <div id="shift-code-container">
                <!-- The first input row is created by JavaScript now -->
            </div>
        </div>

        <div class="form-group">
            <label for="submit-purpose">Code is for *</label>
            <select id="submit-purpose" required>
                <option value="">Select an option...</option>
                <option value="public_use">Public Use (Post on site, Multiple Redeems)</option>
                <option value="smash_only">Smash (One time use) (THANK YOU)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="submit-platform">Code is useable on *</label>
            <select id="submit-platform" required>
                <option value="">Select an option...</option>
                <option value="multi_platform">Multi Platform</option>
                <option value="xbox_only">Xbox</option>
                <option value="playstation_only">PlayStation</option>
                <option value="steam_only">Steam</option>
            </select>
        </div>

<div class="form-group">
            <label for="submit-expiry-date">Expiration Date (Optional)</label>
            <!-- CHANGED: type="date" to type="text" + added placeholder -->
            <input type="text" id="submit-expiry-date" placeholder="e.g., 2025-10-31 or 10/31/2025 or Oct,29,2025">
        </div>

        <div class="form-group">
            <label for="submit-code-source">Code Source (e.g., "Twitter @DuvalMagic", "Reddit u/user") (Optional)</label>
            <!-- Note: No 'required' attribute, so no red asterisk from CSS -->
            <input type="text" id="submit-code-source" placeholder="Enter the source link or name...">
        </div>

        <div class="form-group">
            <label for="submit-username">Username (for credit) or Discord/Reddit <br>can space them or use | to<br>if wanna list discord + reddit *</label>
            <input type="text" id="submit-username" placeholder="Enter your Discord or Reddit username" required>
        </div>

        <!-- This div will show success or error messages -->
        <div id="submit-message"></div>

        <button class="submit-action-btn" onclick="submitCode()">Submit to SMASH</button>
    </div>
</div>
<!-- END: Code Submission Modal -->
<!-- END: 
/* FEEDBACK QUESTIONS  |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  */
    /* =================================================== -->
    <!--         START: SLICK FEEDBACK MODAL                 -->
    <!-- =================================================== -->
    <div id="feedback-modal-overlay" class="feedback-modal-overlay">
        <div class="feedback-modal-content">
            <button class="feedback-close-btn">&times;</button>
            <div class="feedback-modal-header">
                <h3>üìú Feedback Forum</h3>
                <p id="feedback-step-indicator">Step 1 of 5</p> 
            </div>

            <form id="feedback-form">
                <!-- Page 1: User Info (Step 1) -->
                <div class="feedback-page active" data-step="1">
                    <div class="form-group">
                        <label for="username">What's Your Username/Name?</label>
                        <input type="text" id="username" name="Username" placeholder="Enter your name..." required>
                    </div>
                    <div class="form-group">
                        <label>Where did you hear about this?</label>
                        <div class="radio-group" data-required="Source">
                            <label><input type="radio" name="Source" value="Smash on Reddit" required><span>Smash on Reddit</span></label>
                            <label><input type="radio" name="Source" value="Others on Reddit"><span>Others on Reddit</span></label>
                            <label><input type="radio" name="Source" value="Discord"><span>Discord</span></label>
                            <label><input type="radio" name="Source" value="Twitter/X or Facebook"><span>Twitter/X or Facebook</span></label>
                            <label><input type="radio" name="Source" value="Google"><span>Google</span></label>
                        </div>
                    </div>
                </div>

                <!-- Page 2: Ratings (Step 2) -->
                <div class="feedback-page" data-step="2">
                    <p class="page-title">Feelings About The Site</p>
                    <div class="form-group">
                        <label>Overall Website View, Do You Like It?</label>
                        <div class="radio-group horizontal" data-required="Overall Website View">
                            <label><input type="radio" name="Overall Website View" value="Average" required><span>Average</span></label>
                            <label><input type="radio" name="Overall Website View" value="Good"><span>Good</span></label>
                            <label><input type="radio" name="Overall Website View" value="Great"><span>Great</span></label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Overall Website Experience, Easy To Find Stuff?</label>
                        <div class="radio-group horizontal" data-required="Website Experience">
                            <label><input type="radio" name="Website Experience" value="Average" required><span>Average</span></label>
                            <label><input type="radio" name="Website Experience" value="Good"><span>Good</span></label>
                            <label><input type="radio" name="Website Experience" value="Great"><span>Great</span></label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Do You Like The View for Active keys, Perm + Drops, Black Market?</label>
                        <div class="radio-group horizontal" data-required="Do You Like Key Sections View">
                            <label><input type="radio" name="Do You Like Key Sections View" value="Average" required><span>Average</span></label>
                            <label><input type="radio" name="Do You Like Key Sections View" value="Good"><span>Good</span></label>
                            <label><input type="radio" name="Do You Like Key Sections View" value="Great"><span>Great</span></label>
                        </div>
                    </div>
                </div>

                <!-- Page 3: Section Feedback (Step 3) -->
                <div class="feedback-page" data-step="3">
                    <p class="page-title">Section Feedback/Usage: Do you use or like them?</p>
                    <div class="form-group">
                        <label>Black Market</label>
                        <div class="radio-group horizontal" data-required="Do You Use Black Market Section">
                            <label><input type="radio" name="Do You Use Black Market Section" value="Yes" required><span>Yes</span></label>
                            <label><input type="radio" name="Do You Use Black Market Section" value="No"><span>No</span></label>
                            <label><input type="radio" name="Do You Use Black Market Section" value="Don't Use"><span>Don't Use</span></label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Drops + Skins</label>
                        <div class="radio-group horizontal" data-required="Do You Use Drops/Skins Section">
                            <label><input type="radio" name="Do You Use Drops/Skins Section" value="Yes" required><span>Yes</span></label>
                            <label><input type="radio" name="Do You Use Drops/Skins Section" value="No"><span>No</span></label>
                            <label><input type="radio" name="Do You Use Drops/Skins Section" value="Don't Use"><span>Don't Use</span></label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Roadmap/Events (when there is one)</label>
                        <div class="radio-group horizontal" data-required="Do You Use Roadmap/Events Section">
                            <label><input type="radio" name="Do You Use Roadmap/Events Section" value="Yes" required><span>Yes</span></label>
                            <label><input type="radio" name="Do You Use Roadmap/Events Section" value="No"><span>No</span></label>
                            <label><input type="radio" name="Do You Use Roadmap/Events Section" value="Don't Use"><span>Don't Use</span></label>
                        </div>
                    </div>
                </div>

                <!-- Page 4: Suggestions (Step 4) -->
                <div class="feedback-page" data-step="4">
                    <p class="page-title">Feedback On Site and Your Suggestions</p>
                    <div class="form-group">
                        <label for="overall-website">Did You Know, You Can Hide Buttons?</label>
                        <textarea id="overall-website" name="Did You know You Can Hide Buttons" rows="2" placeholder="For Things You Don't Use" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="how-to-improve">How can we make this better for you?</label>
                        <textarea id="how-to-improve" name="Improvement Suggestions" rows="2" placeholder="Your suggestions...(asking for older bl game shift codes) wont happen... did a poll and users said no for this" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="anything-else">Anything else you would like to share/Suggestions?</label>
                        <textarea id="anything-else" name="Additional Suggestions" rows="2" placeholder="Any other ideas..." required></textarea>
                    </div>
                </div>

                <!-- Page 5: Socials (Optional) (Step 5) -->
                <div class="feedback-page" data-step="5">
                    <p class="page-title">Put Your Twitter/Discord/Reddit Username</p>
                    <p class="page-subtitle">Only if you want me to contact you about the feedback/suggestions. You can skip this page if you want. (put N/A)</p>
                    <div class="form-group">
                        <label for="twitter-user">Twitter</label>
                        <input type="text" id="twitter-user" name="Twitter" placeholder="@username (optional)">
                    </div>
                    <div class="form-group">
                        <label for="discord-user">Discord</label>
                        <input type="text" id="discord-user" name="Discord" placeholder="username (optional)">
                    </div>
                    <div class="form-group">
                        <label for="reddit-user">Reddit</label>
                        <input type="text" id="reddit-user" name="Reddit" placeholder="u/username (optional)">
                    </div>
                </div>

                <!-- Page 6: Thank You (Final Step) -->
                <div class="feedback-page thank-you-page" data-step="6">
                    <h3>Thank you!</h3>
                    <p>Your feedback is helping me to improve and understand your feelings toward this, so I can offer you the best possible experience.</p>
                    <p>If you want to suggest stuff or talk, you can open a Reddit DM, or message me on Discord or Twitter. All info is under the "Connect/Contact" button on the main site. I can't reply to the forum here, but I do see everything you all put. :)</p>
                </div>
            </form>

            <div class="feedback-navigation">
                <button id="feedback-prev-btn" class="feedback-nav-btn" style="display: none;">Previous</button>
                <button id="feedback-next-btn" class="feedback-nav-btn">Next</button>
                <button id="feedback-submit-btn" class="feedback-nav-btn" style="display: none;">Submit</button>
            </div>
        </div>
    </div>
    <!-- =================================================== -->
    <!--          END: SLICK FEEDBACK MODAL                  -->
    <!-- =================================================== -->

<body>


<!-- === START: High-Tech Contact Me Section === -->
<div class="contact-me-section" id="contact-me-section">
    <h4 class="contact-me-title">Connect/Contact</h4>
    
    <!-- This new wrapper will handle the animation -->
    <div class="slide-down-content">

        <p class="info-text">
            Xbox/Shift : xsmashx88x
        </p>

        <div class="social-links">  
            <a href="https://x.com/xsmashx88x" target="_blank">üê¶ Twitter | xsmashx88x </a>
            <a href="https://discord.com/users/97484502628052992" target="_blank">üí¨ Discord | xsmashx88x</a>
            <a href="https://www.reddit.com/user/smashcanuckgamer/" target="_blank">üëæ Reddit | smashcanuckgamer</a>
        </div>

    </div>
</div>
<!-- === END: High-Tech Contact Me Section === -->



<!-- START: FINAL, CORRECTLY ORGANIZED SITE OPTIONS CONTAINER -->
<div class="site-options-container" id="site-options-container">
    <h4 class="site-options-title" onclick="toggleOptionsContainer(this)">
        SITE OPTIONS & INFO
        <small class="updated-subtitle">UPDATED 10/19/2025</small>
    </h4>
    
    <div class="slide-down-content">
        <!-- CONTAINER 1: THE BUTTON GRID (This now ONLY contains buttons) -->
        <div class="options-button-grid">
            <div class="button-row">
                                <button class="option-btn option-btn-faq" onclick="toggleOptionPanel('info-section')" id="infofaq-toggle-btn">‚ùóINFO/FAQ‚ùì<br><small>Updated 10/10/2025</small></button>
            </div>
            <div class="button-row">
                <button class="option-btn option-btn-log" onclick="toggleOptionPanel('changelog-section')" id="changlog-toggle-btn">üìãCHANGE LOGüõ†Ô∏è<br><small>Updated 10/19/2025</small></button>
                <button class="option-btn option-btn-redeem" onclick="toggleOptionPanel('redeem-section')" id="redeem-toggle-btn">üñ•Ô∏è HOW TO REDEEM ON CONSOLE üéÆ</button>
            </div>
        </div>

        <!-- CONTAINER 2: THE CONTENT PANELS (Now properly separated from the buttons) -->
        <div class="options-content-panels">
            <div id="info-section" class="info-section">
                <div class="info-content">
                    <p style="color:#E10B0B;"><strong>üÜïWelcome, Vault Hunter!</strong></p>
                    <ul style="color:#FD8787;">
                        <li><i>üÜïI created this tracker for a simple reason: I saw how many of us were struggling to keep up with SHiFT codes, constantly wondering if they were still active or when they might expire. Since not everyone wants to live on Twitter/X, I wanted to build a single, reliable home for the community.<br><br>Due to some personal health matters, I have a lot of time on my hands, and I decided to put it to good use for a community I like. So many others just don't update fast enough or fix when a code should be expired but works or worse IGN they want you to sub to a service smfh<br><br>Now, about the donation button. Frankly, I didn't want to add one, but it was created by popular request from users who wanted to show their support. So let me be crystal clear:<br><br>This site will stay updated for as long as it's helpful to you, donations or not. That is my promise.<br><br>That said, for those who have chosen to contribute, your support is incredibly helpful on a personal level and genuinely appreciated more than you know.<br>Thank you for being an amazing community. Now, go get that loot</i></li>
                    </ul>
                    <p style="color:#7AFD42;"><strong>A Note to the Community</strong></p>
                    <ul style="color:#C7FFB0;">
                        <li><i>This project was created solely to help the community, not for personal gain like followers or fame. It's simply a tool built for fellow Vault Hunters.</i></li>
                        <li><i>The donation button was added by popular request from community members who wished to support the project. It is, and always will be, completely optional.</i></li>
                        <li><i>If you find this tracker valuable and wish to show your appreciation, your support is incredibly helpful. Thank you!</i></li>
                    </ul>
                    <p style="color:#FA70CE;"><strong>F.A.Q</strong></p>
                    <ul style="color:#FFC1EB;">
                        <li>üÜï<b>Will you ever do older BL Games?</b> <i>Sadly, Did a poll and community got to pick and nope, they don't want it. <a href="https://i.postimg.cc/HkhmW7qV/screenshot-35.png">Poll View Image</a></i></li>
                        <li><b>How quickly are codes updated?</b> <i>Codes are typically added within minutes of being released. The primary goal of this site is to serve as a reliable, long-term tracker for the entire community, especially for those who don't monitor social media 24/7. This saves you the frustration of finding and trying codes that have already expired.</i></li>
                        <li><b>What is the purpose of this site?</b> <i>This tracker was built to provide a clear, simple solution for two things: to know for certain if a SHiFT code is still active, and to make redeeming them effortless with a one-click copy button.</i></li>
                        <li><b>How are codes added to the tracker?</b> <i>Every code is found and added manually. I monitor official social media channels and community hubs for new releases. There are no automated bots, which ensures the information is as accurate as possible.</i></li>
                        <li><b>"Haters that say : I can find keys faster than they get posted here."</b> <i>Congratulations on winning the race against a free public service! While you're refreshing social media 24/7, this site is busy being a reliable archive for people who have jobs, hobbies, or just better things to do. We'll be here when you need to check if that code from Tuesday is still good.</i></li>
                    </ul>
                    <p style="color:#FFDE59;"><strong>PSA</strong></p>
                    <ul style="color:#FFF3C4;">
                        <li><b>Gold Keys On Multi Systems :</b><i>if linked multi systems can redeem on each :) from what I hear.</i></li>
                        <li><b>They Don't Show Even Tho Did Redeem Them :</b><i>If the redeem site shows 3 codes lets say the 3 you did, then close and restart your game they should show up.</i></li>
                    </ul>
                </div>
            </div>
            <div id="changelog-section" class="info-section">
                <div class="info-content">
                    <p><strong>Change Log | Info On Changes/Updates/ An More</strong></p>
                    <ul>
                        <li>üÜï<b>10|19|2025:</b> Lil Fixs/Added : Modals AKA when clicking a button and has questions/inputs it should be less buggy/glitchy hopefully.. not moving around as much or glitch and scroll the background and so on.. still testing and will fix more if needed </li>
                        <li><b>10|18|2025:</b> Lil Fixs/Added : Many layout options/fixes/changes and ya :)  </li>
                        <li><b>10|18|2025:</b> Lil Fixs/Added : Mobile View is changed, Plz do the poll and let me know what you think.. </li>
                        <li><b>10|17|2025:</b> Lil Fixs/Added : Redid the hide button called "Hide Ish" so you haters can now hide everything pretyt much enjoy.. stop hating an sending me shit now</li>
                        <li><b>10|17|2025:</b> Lil Fixs/Added : Many of you asked for share option, discord/twitter/fb is there discord has two methods, twitter works fine,fb will copy it to clipboard open the page for you then you can paste it in :) enjoy</li>
                        <li><b>10|16|2025:</b> Lil Fixs/Added : So many ask for things, yet so many bash the buttons/options... so for yous who bash turn on (cry babes) mode | smh haters :(</li>
                        <li><b>10|14|2025:</b> Lil Fixs/Added : Dark Mode/Wide Mode... Things might break in wide.. not fully tested.. Dark Mode has a slider for how dark as well :)</li>
                        <li><b>10|13/14|2025:</b> Lil Fixs/Added : A report not working codes + submit codes button :  if its truly expired i will get an alert and will remove it as soon as i can</li>
                        <li><b>10/12/2025:</b> Lil Fixs/Added : Lil Tweaks, UI Changes (moved floating buttons based on feedback)<br>sorry you gamers didnt see the check cause of the floating donate button</li>
                        <li><b>10/8/2025:</b> Lil Fixs/Added : Lil Tweaks, UI Changes</li>
                        <li><b>10/5/2025:</b> Lil Fixs/Added : Lil Tweaks, Added A Remember Copy Hightlight</li>
                        <li><b>10/4/2025:</b> Fixed/Added : Lil Tweaks, Added Chest/View Keys Button (links to pics)</li>
                        <li><b>10/2/2025:</b> Fixed/Added : Lil Tweaks</li>
                        <li><b>9/29/2025:</b> Fixed/Added : New Codes, Some Lil Changes.</li>
                        <li><b>9/28/2025:</b> Fixed/Added : Fixed Few Things, Added Wildcard/Encore Boss Info</li>
                        <li><b>9/27/2025:</b> Fixed/Added : Just some small tweaks..</li>
                        <li><b>9/26/2025:</b> Fixed/Added : Few Things... Might or Might Not Notice :)</li>
                        <li><b>9/25/2025:</b> Fixed : Should Be More Mobile Friendly</li>
                        <li><b>9/25/2025:</b> Added : Hide Buttons Option (should stick on refresh)</li>
                        <li><b>9/25/2025:</b> Fixed : Mobile Button Issues For Black Market</li>
                        <li><b>9/25/2025:</b> Added : Maurices Black Market, Static View</li>
                        <li><b>9/25/2025:</b> Added : Maurices Black Market, With Map View</li>
                        <li><b>9/24/2025:</b> Fixed time issues</li>
                        <li><b>9/24/2025:</b> Fixed refresh issue on Android/some browsers</li>
                        <li><b>9/23/2025:</b> Added "Mark as redeemed" feature with local storage</li>
                        <li><b>9/22/2025:</b> Added preview button for image rewards</li>
                        <li><b>9/21/2025:</b> Improved countdown timer functionality</li>
                        <li><b>9/20/2025:</b> Added permanent/unknown expiration codes section</li>
                        <li><b>9/19/2025:</b> Initial website launch with basic functionality</li>
                    </ul>
                </div>
            </div>
            <div id="redeem-section" class="info-section">
                <div class="info-content">
                    <p><strong>In-Game</strong></p>
                    <ol>
                        <li>Open the Pause Menu while in-game Or On Main Menu</li>
                        <li>Click "SHiFT"</li>
                        <li>Click "Rewards"</li>
                        <li>Enter codes and redeem them</li>
                    </ol>
                    <p><strong>Online</strong></p>
                    <p>CLICK THAT BUTTON BELOW AND WILL OPEN THE SHIFT REDEEM SITE</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END: FINAL, CORRECTLY ORGANIZED SITE OPTIONS CONTAINER -->

<div id="rewards-container">
    <a href="https://shift.gearboxsoftware.com/rewards" target="_blank" class="rewards-link">
        üîó CLICK HERE | TO REDEEM CODES üåê <br>
        <small style="font-size: 0.9em; opacity: 0.6; color: black;">Opens Official SHIFT Rewards Site</small>
    </a>
</div>

        <button class="roadmap-button" onclick="openRoadmapImage()" id="roadmap-btn">üó∫Ô∏è VIEW BL4 ROADMAP üõ£Ô∏è</button>
                <button class="events-button hidden" onclick="toggleInfo('events-section')" id="events-btn"></button>
<div id="events-section" class="info-section events-content-unique">
    <a href="javascript:void(0);" onclick="openImagePreview(EVENTS_CONFIG.imageUrl)">
        <img id="events-image" src="" alt="Events Image" style="width: 100%; cursor: pointer;">
    </a>
    <p id="events-description" style="margin-top: 15px; line-height: 1.5; text-align: left;"></p>
</div>
                        <button class="challenge-button hidden" onclick="toggleInfo('challenge-section')" id="challenge-btn"></button>
        <div id="challenge-section" class="info-section">
            <div class="info-content">
                <!-- The clickable image -->
                <a href="javascript:void(0);" onclick="openImagePreview(COMMUNITY_CHALLENGE_CONFIG.imageUrl)">
                    <img id="challenge-image" src="" alt="Community Challenge Image" style="width: 100%; border-radius: 4px; border: 2px solid #BF40BF; cursor: pointer;">
                </a>
                <!-- The description text -->
                <p id="challenge-description" style="margin-top: 15px; color: #E6E6FA; line-height: 1.5;"></p>
            </div>
        </div>
        <!-- ADD THIS NEW DIV for the events dropdown -->

      <button class="collapse-btn-BlackMarket" onclick="toggleInfo('black-market-section')" id="maurices-toggle-btn">üíµ Maurices Black Market/Boss + WildCardü´∞<br> <small style="font-size: 0.7em; opacity: 0.9; ">After Reset, Give Me A Few To Update Images/Info Plz.</small><br><small style="font-size: 0.7em; color: #FF7979;" class="drops-pulse">!Updated 10/16/2025!</small> </button>
        
<div id="black-market-section" class="info-section">
    <h2  style="font-size: 1.2em;">
        <button id="open-bm-submit-btn" class="bm-submit-info-btn">Submit BM Info</button>
        üíµ Maurices Black Market/Boss + Wild Card ü´∞
    </h2>
    <div id="black-market-codes-container">
                <!-- Black Market Vendor will be inserted here by JavaScript -->
            </div>
        </div>

<button class="collapse-btn-Perm" onclick="togglePermanent()" id="permanent-toggle-btn">
    üéÅ [View] Drops/Skins + Limited Time Codes + More ‚åõ
    <br>
    <small style="font-size: 0.9em; color: #be46ff;" class="drops-pulse">!Updated 10/14/2025!</small>
</button>
        
<div id="permanent-section" class="permanent-section">
    <h2 style="text-align: center;">
        <!-- NEW BUTTON FOR DROPS SUBMISSION -->
        <button id="open-drops-submit-btn" class="drops-submit-info-btn">Submit Drops Info</button>
        <!-- END NEW BUTTON -->
        üéÅ Drops/Skins + Limited Time Codes + More ‚åõ<br> 
        <small style="font-size: 0.9em; opacity: 0.9; ">Anything Besides Gold Keys Will Go Here</small> 
    </h2>                
    <div id="permanent-codes-container">
        <!-- Permanent codes will be inserted here by JavaScript -->
    </div>
</div>

<h1>üëç Active BL4 SHiFT Codes (New At Top) üóùÔ∏è <br> <small style="font-size: 0.6em; opacity: 0.9; "> ‚¨á Gold Keys Only ‚¨á | ‚¨Ü Drops Button For Skins + Others ‚¨Ü</small> 
    <br>
    <small style="font-size: 0.7em; opacity: 0.8; color: #FFD114;" class="drops-pulse">!Updated 10/18/2025!</small><br>
    
    <!-- === NEW BUTTONS CONTAINER === -->
    <div class="key-info-buttons-container">
        <button class="key-info-btn" onclick="openImagePreview('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/seekeysyouhave.png')">
            Check Gold Keys
        </button>
        <button class="key-info-btn" onclick="openImagePreview('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/%5BDate%20%202025-10-04%5D%20%2B%20%5BTime%20%2003-32-50AM%5D.png')">
            Find Gold Chest
        </button>
    </div>

    <button class="submit-code-btn" onclick="openCodeSubmitModal()">üìù Submit a Code</button>

    <!-- === QUICK MESSAGE UPDATE BUTTON INJECTION POINT (Directly below Submit) === -->
    <button class="quick-update-button hidden" onclick="toggleInfo('quick-update-section')" id="quick-update-btn">
        <!-- Content injected by JavaScript -->
    </button>
    <!-- === END INJECTION POINT === -->
</h1>

<!-- === QUICK MESSAGE CONTENT INJECTION POINT (Directly below the H1 block) === -->
<!-- Note: The initial content structure is added here, then JS styles and fills it -->
<div id="quick-update-section" class="info-section">
    <div id="quick-update-content" class="info-content">
        <!-- Message content injected by JavaScript -->
    </div>
</div>

</div>

<button class="reset-all-hidden-btn" onclick="resetAllHiddenCodeStates()">Reset All Hidden Codes</button>

</h1>
        <div id="active-codes-container">
            <!-- Active codes will be inserted here by JavaScript -->
        </div>

        <button class="collapse-btn-exp" id="collapse-btn-exp" onclick="toggleExpired()">
            ‚ùå Expired Ish üò≠
        </button>
        
        <div id="expired-section" class="expired-section">
            <h3>‚ùå Expired Ish : Damn Look At Them All üëé</h3>
            <div id="expired-codes-container">
                <!-- Expired codes will be inserted here by JavaScript -->
            </div>
        </div>
    </div>

<!-- START: COMBINED LAYOUT & COLOR MODE PANEL (Corrected) -->
<div class="combined-floating-panel" id="combined-panel">
    
    <!-- The main black circle button (the trigger) - onclick has been removed -->
    <button id="combined-toggle-btn">‚ùó</button>

    <!-- The pop-out control wrapper (hidden by default) -->
    <div id="combined-controls-wrapper">
        
        <button id="hide-ish-toggle-btn" onclick="openHideIshModal()">
            Hide Ish: üëÅÔ∏è
        </button>

        <button id="mobile-layout-toggle-btn" onclick="toggleMobileLayoutMode()">
    Mobile Old: OFF üì±
</button>

        <!-- 1. EXPANDED PC VIEW TOGGLE -->
        <button id="pc-view-toggle" onclick="toggleLayoutMode()">
            Wide Mod [PC only]: OFF üñ•Ô∏è
        </button>
        
<button id="compact-grid-toggle-btn" onclick="toggleCompactGridView()">
    Grid View [PC only]: OFF üì±
</button>

        <!-- STEALTH MODE TOGGLE -->
        <label id="stealth-mode-label" onclick="handleColorModeToggle('stealth')">
            Stealth Mode: OFF üåà
        </label>
        
        <!-- THIS IS THE CRITICAL WRAPPER for the slider -->
        <div id="stealth-brightness-control">
            <input 
                type="range" 
                id="stealth-slider" 
                min="0.4" 
                max="1.0" 
                step="0.05" 
                value="0.7" 
                oninput="updateStealthBrightness(this.value)"
                title="Brightness">
        </div>
        
        <!-- SOFT MODE TOGGLE -->
        <button id="soft-mode-toggle-btn" onclick="handleColorModeToggle('soft')">
            Soft Mode: OFF üå∏
        </button>
    
        <button id="grit-mode-toggle-btn" onclick="handleColorModeToggle('muted-grit')">
            Grit Mode: OFF üíÄ
        </button>

        <!-- Cry Babes Mode Button -->
        <button id="cry-babes-toggle-btn" onclick="handleColorModeToggle('cry-babes')">
            Codes Only Mode: OFF üë∂
        </button>

    </div>
</div>
<!-- END: COMBINED LAYOUT & COLOR MODE PANEL -->

<button class="floating-notif-bell" id="notif-permission-btn" title="Enable Notifications"></button>

<div id="custom-alert-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <h2 id="modal-title">NEW CODE ALERT!</h2>
        <p id="modal-message">New SHiFT codes are available! Click OK to see them.</p>
        <button id="modal-ok-button" class="btn">OK</button>
    </div>
</div>

<!-- === START: Code Share Modal === -->
<div id="share-modal" class="image-preview-modal" style="display: none; z-index: 2001; background: rgba(0, 0, 0, 0.9);">
    <div class="modal-content" style="background: #1f1f1f; border-color: #00ffff; box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);">
        <button class="close-preview" onclick="closeShareModal()" style="background: #ff4444; right: -15px; top: -15px;">&times;</button>
        <h3 style="color: #00ffff; text-align: center; margin-bottom: 20px;">üîó Share Code</h3>
        
        <div id="share-code-display" style="font-size: 1.2em; font-weight: bold; color: #ffcc00; text-align: center; margin-bottom: 20px;">[CODE WILL APPEAR HERE]</div>
        
        <div class="share-actions" style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
            
            <div class="discord-share-group" style="display: flex; gap: 10px;">
                <button class="share-btn-discord small-share-btn" id="share-discord-post-btn" style="flex-grow: 1; background: #5865F2; color: white; padding: 10px; border-radius: 8px;">
                    Discord Post üöÄ
                </button>
                <button class="share-btn-discord small-share-btn" id="share-discord-copy-btn" style="flex-grow: 1; background: #5865F2; color: white; padding: 10px; border-radius: 8px;">
                    Discord Copy üìã
                </button>
            </div>
            
            <!-- NEW RESET WEBHOOK BUTTON -->
            <button class="share-btn-utility small-share-btn" id="reset-webhook-btn" style="background: #333; color: #aaa; border: 1px solid #444; padding: 10px; border-radius: 8px;">
                Reset Saved Discord Webhook üóëÔ∏è
            </button>

            <button class="share-btn-twitter" id="share-twitter-btn" style="background: #1DA1F2; color: white; padding: 10px; border-radius: 8px;">
                Share on X (Twitter)
            </button>
            
            <button class="share-btn-facebook" id="share-facebook-btn" style="background: #1877F2; color: white; padding: 10px; border-radius: 8px;">
                Share on Facebook (Click to Copy & Open)
            </button>
            
        </div>
    </div>
</div>

<!-- === END: Code Share Modal === -->

<!-- START: Hide Ish Options Modal -->
<div id="hide-ish-modal" class="modal-overlay" style="z-index: 3001;">
    <div class="modal-content" style="max-width: 450px;">
        <button class="close-modal" onclick="closeHideIshModal()">&times;</button>
        <h3 style="color: #ffc600; text-align: center; margin-bottom: 2px;">üëÅÔ∏è Hide Ish üö´</h3>
        <p style="text-align: center; color: #ccc;">Click To Hide Things.<br><small>Based on the view, this might leave gaps/spaces (more on a grid/wide options) I am working on a fix not the most easy thing to fix<small></p>
        
        <div id="hide-options-container" style="max-height: 70vh; overflow-y: auto; padding-right: 15px;">
            <!-- Checkboxes will be rendered here by JavaScript -->
        </div>

        <div style="margin-top: 0px; text-align: center;">
            <button class="submit-action-btn" onclick="closeHideIshModal()" style="width: auto; padding: 10px 30px;">
                Save & Close
            </button>
        </div>
    </div>
</div>
<!-- END: Hide Ish Options Modal -->

<!-- =================================================== -->
<!--         START: NEW REPORT ISSUES MODAL              -->
<!-- =================================================== -->
<div id="report-issues-modal-overlay" class="feedback-modal-overlay">
    <div class="feedback-modal-content" id="report-issues-modal-content">
        <button class="feedback-close-btn" id="report-issues-close-btn">&times;</button>
        <div class="feedback-modal-header">
            <h3>üêû REPORT A SITE ISSUE</h3>
            <p>Anything Bugged/Broken/Glitched? Let me know!</p> 
        </div>

        <form id="report-issues-form">
            <div class="form-group">
                <label for="report-issue-type">What type of issue is it?</label>
                <select id="report-issue-type" required>
                    <option value="">-- Please select an option --</option>
                    <option value="Visual Bug / Glitch">Visual Bug / Glitch (Something looks broken)</option>
                    <option value="Typo / Incorrect Info">Typo / Incorrect Information</option>
                    <option value="Broken Feature">Broken Feature (A button/link doesn't work)</option>
                    <option value="Mobile Issue">Mobile Specific Issue</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label for="report-description">Please describe the issue in detail</label>
                <textarea id="report-description" rows="4" placeholder="e.g., 'On the mobile view, the Black Market button overlaps the text.' Please be as specific as possible!" required></textarea>
            </div>
            
            <!-- NEW: Optional Link Field -->
            <div class="form-group">
                <label for="report-proof-link">Link for Pics/Videos (Optional)</label>
                <input type="url" id="report-proof-link" placeholder="e.g., https://imgur.com/a/123xyz">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="report-username">Your Name/Username</label>
                    <input type="text" id="report-username" placeholder="Enter your username..." required>
                </div>
                <div class="form-group">
                    <label for="report-username-platform">Username Platform</label>
                    <select id="report-username-platform" required>
                        <option value="">-- Select Platform --</option>
                        <option value="Discord">Discord</option>
                        <option value="Reddit">Reddit</option>
                        <option value="Twitter/X">Twitter/X</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="report-reloaded-check" required>
                    I have already tried clearing cache / reloading the page. <br><small>(cache clearning removes all check marks)</small>
                </label>
            </div>

            <hr class="form-separator">

            <div class="feedback-navigation" style="justify-content: center;">
                <button type="submit" id="report-issues-submit-btn" class="feedback-nav-btn">Send Report</button>
            </div>
        </form>
    </div>
</div>
<!-- =================================================== -->
<!--          END: NEW REPORT ISSUES MODAL               -->
<!-- =================================================== -->

<!-- =================================================== -->
<!--  black Market Info Submission Modal MODAL    -->
<!-- =================================================== -->
<div id="bm-submit-modal-overlay" class="submit-modal-overlay">
    <div class="submit-modal-content" style="border-color: #ff4444; background: #2a1a1a;">
        <button class="close-submit-modal" onclick="closeBmSubmitModal()" style="background: #ff4444;">&times;</button>
        <h3 style="color: #ff4444;">Submit Black Market/Boss Info</h3>
        <p style="color: #ffaaaa;">Help us get the weekly vendor and boss drops/locations updated fast!</p>
        
        <!-- === INFO TYPE SELECTOR (CRITICAL: Added onchange) === -->
        <div class="form-group">
            <label for="bm-type">Info Type *</label>
            <select id="bm-type" required onchange="toggleBmFields(this.value)">
                <option value="">Select one...</option>
                <option value="Maurice Black Market Vendor">Maurice Black Market Vendor</option>
                <option value="Weekly WildCard Mission">Weekly WildCard Mission</option>
                <option value="Weekly Big Encore Boss">Weekly Big Encore Boss</option>
            </select>
        </div>
        
        <!-- 1. MAURICES BLACK MARKET VENDOR FIELDS -->
        <div id="maurice-fields" class="dynamic-bm-fields" style="display: none;">
            <div class="form-group">
                <label for="maurice-location">Maurice's Location *</label>
                <input type="text" id="maurice-location" placeholder="e.g., Desolation's Edge" required>
            </div>
            <div class="form-group">
                <label for="maurice-proof-link">Proof/Map Image Link (Optional URL)</label>
                <input type="url" id="maurice-proof-link" placeholder="https://i.imgur.com/map.png">
            </div>
        </div>

        <!-- 2. WEEKLY WILD CARD MISSION FIELDS -->
        <div id="wildcard-fields" class="dynamic-bm-fields" style="display: none;">
            <div class="form-group">
                <label for="wildcard-name">Mission Name (e.g., The Council Divided) *</label>
                <input type="text" id="wildcard-name" placeholder="Enter Mission Name" required>
            </div>
            <div class="form-group">
                <label for="wildcard-location">Location/Zone *</label>
                <input type="text" id="wildcard-location" placeholder="e.g., Fadefields, Dissected Plateau" required>
            </div>
            <div class="form-group">
                <label for="wildcard-info-card">Info Card Image Link (Optional URL)</label>
                <input type="url" id="wildcard-info-card" placeholder="https://i.imgur.com/infocard.png">
            </div>
            <div class="form-group">
                <label for="wildcard-map-link">Map/Location Image Link (Optional URL)</label>
                <input type="url" id="wildcard-map-link" placeholder="https://i.imgur.com/map.png">
            </div>
        </div>

        <!-- 3. WEEKLY BIG ENCORE BOSS FIELDS -->
        <div id="encore-fields" class="dynamic-bm-fields" style="display: none;">
            <div class="form-group">
                <label for="encore-name">Boss Name (e.g., The Oppressor) *</label>
                <input type="text" id="encore-name" placeholder="Enter Boss Name" required>
            </div>
            <div class="form-group">
                <label for="encore-location">Location/Zone *</label>
                <input type="text" id="encore-location" placeholder="e.g., The Killing Floors" required>
            </div>
            <div class="form-group">
                <label for="encore-loot">Weapons/Gear Drops (One per line)</label>
                <textarea id="encore-loot" rows="3" placeholder="e.g., Asher's Rise (Sniper), Streamer (Heavy)"></textarea>
            </div>
        </div>
        
        <!-- === COMMON FIELDS === -->
        <div class="form-group">
            <label for="bm-username">Your Username/Credit (Optional)</label>
            <input type="text" id="bm-username" placeholder="Discord or Reddit Username">
        </div>

        <div id="bm-submit-message" class="submit-error" style="display: none;"></div>

        <button class="submit-action-btn" id="bm-submit-btn" style="background: linear-gradient(to bottom, #ff4444, #cc0000);" onclick="submitBlackMarketInfo(this)">Submit Info</button>
    </div>
</div>
<!-- END OF FIX 2/3 -->

<!-- =================================================== -->
<!--        START OF NEW DROPS SUBMISSION MODAL -->
<!-- =================================================== -->
<div id="drops-submit-modal-overlay" class="submit-modal-overlay">
    <div class="submit-modal-content" style="border-color: #ff00ff; background: #2a1a2a;">
        <button class="close-submit-modal" onclick="closeDropsSubmitModal()" style="background: #FF00FF;">&times;</button>
        <h3 style="color: #FF00FF;">Submit Drops/Skins Info</h3>
        <p style="color: #ffaaaa;">Use this for Skins, Cosmetics, Gear, or Codes that are NOT Gold Keys.</p>
        
        <!-- Dropdown for Kind of Drop -->
        <div class="form-group">
            <label for="drops-kind">Kind of Drop/Item *</label>
            <select id="drops-kind" required>
                <option value="">Select a drop type...</option>
                <option value="Skin Drop">Skin Drop</option>
                <option value="Cosmetics Pack">Cosmetics Pack</option>
                <option value="Twitch Drop">Twitch Drop</option>
                <option value="Discord Quest">Discord Quest</option>
                <option value="3rd Party Forum/Quest">3rd Party Forum/Quest</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <!-- Inputs for Code (Dynamic/Optional) -->
        <div class="form-group" id="drops-code-group">
            <label>SHiFT Code(s) (If Applicable)</label>
            <div id="drops-code-container">
                <!-- Dynamic code inputs go here -->
            </div>
            <button class="code-action-btn add" type="button" onclick="addDropsCodeInput()">+</button>
        </div>

        <!-- Name of Item/Drops -->
        <div class="form-group">
            <label for="drops-name">Name of Item/Drop *</label>
            <input type="text" id="drops-name" placeholder="e.g., Vex Vault Hunter Skin" required>
        </div>
        
        <!-- Preview Link -->
        <div class="form-group">
            <label for="drops-preview">Preview Image/Video Link (Optional URL)</label>
            <input type="url" id="drops-preview" placeholder="https://i.imgur.com/preview.png">
        </div>

        <!-- Expiration Date (Optional) -->
        <div class="form-group">
            <label for="drops-expires">When Does it Expire? (Optional)</label>
            <input type="text" id="drops-expires" placeholder="e.g., Oct 25, 2025, 4:00 PM EST or UED">
        </div>

        <!-- Original Post Link -->
        <div class="form-group">
            <label for="drops-link">Link to Original Post/Info (Optional URL)</label>
            <input type="url" id="drops-link" placeholder="https://x.com/Borderlands/status/...">
        </div>

        <!-- Username/Credit -->
        <div class="form-group">
            <label for="drops-username">Your Username/Credit (Optional)</label>
            <input type="text" id="drops-username" placeholder="Discord or Reddit Username">
        </div>

        <div id="drops-submit-message" class="submit-error" style="display: none;"></div>

        <button class="submit-action-btn" id="drops-submit-btn" style="background: linear-gradient(to bottom, #FF00FF, #A000A0);" onclick="submitDropsInfo(this)">Submit Drops Info</button>
    </div>
</div>
<!-- END OF NEW DROPS SUBMISSION MODAL -->
<!-- =================================================== -->
<!-- =================================================== -->
<!-- =================================================== -->


    <script>
/* =================================================== */
/* =================================================== */        
/* =================================================== */
/*   scroll lock SCRIPT, for modals           */
/* =================================================== */

// Hook into existing functions to add 'modal-open' to <html> element
document.addEventListener('DOMContentLoaded', function() {
    
    /**
     * Universally toggles the modal-open class on both <body> and <html>.
     * This ensures the CSS fixed-position scroll lock is fully activated.
     * Note: Your core modal functions (like closeKofiModal) still need to be updated 
     * to call this, which is handled by the wrapModalFunction below.
     * @param {boolean} lock - true to lock, false to unlock.
     */
function toggleGlobalScrollLock(lock, modalId = '') { // <-- Added modalId parameter
    // --- NEW: Skip scroll lock for Ko-fi modal ---
    if (modalId === 'kofi-modal-overlay') {
        return; // Do NOT apply scroll lock/unlock for Ko-fi
    }
        const action = lock ? 'add' : 'remove';
        // Targetting <html> is the CRITICAL, final fix for mobile scroll lock
        document.documentElement.classList[action]('modal-open');
        // Targeting <body> is standard practice and keeps your existing code happy
        document.body.classList[action]('modal-open'); 
    }

    /**
     * Helper to wrap existing modal open/close functions with the scroll lock logic.
     * This is safer than rewriting each function manually.
     * @param {string} funcName - The name of the global function to wrap (e.g., 'openKofiModal').
     * @param {boolean} isOpener - True if it's an opening function, false if closing.
     */
    function wrapModalFunction(funcName, isOpener) {
        const originalFunc = window[funcName];
        if (typeof originalFunc === 'function') {
            window[funcName] = function() {
                toggleGlobalScrollLock(isOpener);
                return originalFunc.apply(this, arguments);
            };
        }
    }

    // --- APPLY SCROLL LOCK TO ALL GLOBAL MODAL FUNCTIONS ---

    // 1. Kofi Modal (Needs to be wrapped as it doesn't use the simple DOMContentLoaded listener)
    
    // 2. Original SHiFT Code Report Modal (#report-modal)
    wrapModalFunction('openReportModal', true);
    wrapModalFunction('closeReportModal', false);

    wrapModalFunction('openReportModal', true);
    wrapModalFunction('closeReportModal', false);

    // 3. Code Submission Modal
    wrapModalFunction('openCodeSubmitModal', true);
    wrapModalFunction('closeCodeSubmitModal', false);

    // 4. Black Market Submission Modal
    wrapModalFunction('openBmSubmitModal', true);
    wrapModalFunction('closeBmSubmitModal', false);

    // 5. Drops Submission Modal
    wrapModalFunction('openDropsSubmitModal', true);
    wrapModalFunction('closeDropsSubmitModal', false);

    // 6. Share Modal
    wrapModalFunction('openShareModal', true);
    wrapModalFunction('closeShareModal', false);

    // 7. Hide Ish Options Modal
    wrapModalFunction('openHideIshModal', true);
    wrapModalFunction('closeHideIshModal', false);

    // 8. Image Preview Modal (for generic image/video/iframe previews)
    wrapModalFunction('openImagePreview', true);
    wrapModalFunction('closeImagePreview', false);

        wrapModalFunction('openPollModal', true);
    wrapModalFunction('closePollModal', false);

    // --- Special Handlers for Event-Driven Modals ---
    
    // 9. Report Issues Modal (Report Bug) - Hooks into the original onclick logic
    const openReportIssuesBtn = document.getElementById('open-report-issues-btn');
    if (openReportIssuesBtn) {
        // Wrap the existing anonymous function bound to onclick
        const originalOpenReportIssuesModal = openReportIssuesBtn.onclick;
        openReportIssuesBtn.onclick = function() {
            toggleGlobalScrollLock(true);
            originalOpenReportIssuesModal.apply(this, arguments);
        };
    }
    const closeReportIssuesBtn = document.getElementById('report-issues-close-btn');
    if (closeReportIssuesBtn) {
        // Hook into the close button's action
        closeReportIssuesBtn.addEventListener('click', () => toggleGlobalScrollLock(false));
    }

    // 10. Poll Modal (EH! Poll Time)
    document.getElementById('openPollBtn')?.addEventListener('click', () => {
        toggleGlobalScrollLock(true);
    });
    document.getElementById('closePollBtn')?.addEventListener('click', () => {
        toggleGlobalScrollLock(false);
    });
    
    // 11. Feedback Forum Modal (Floating button opens modal, not simple function call)
    document.querySelector('.floating-feedback-btn')?.addEventListener('click', () => {
        // Assuming your Feedback modal's opening logic happens instantly after this click
        toggleGlobalScrollLock(true);
    });
    // The Feedback Modal's close button relies on a close function, 
    // so we hook into the inner close button element if possible.
    document.querySelector('#feedback-modal-overlay .feedback-close-btn')?.addEventListener('click', () => {
        toggleGlobalScrollLock(false);
    });
    
    // 12. Reset Global Scroll on Modal Overlay Click (for modals that are not closed by a button inside)
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', function(e) {
            // Check if the click was on the overlay itself, not the modal content
            if (e.target === overlay) {
                // Assuming all modals follow the same pattern for an X button
                // We run the unlock function when the overlay is clicked
                toggleGlobalScrollLock(false);
                // Optionally call the close function for that specific modal type
                // e.g. closeModal(); or closeReportModal(); etc.
            }
        });
    });

    // --- Your original hook that should still be in your code block ---
    const originalOpenReportIssuesModal = document.getElementById('open-report-issues-btn')?.onclick;
    if (originalOpenReportIssuesModal) {
        document.getElementById('open-report-issues-btn').onclick = function() {
            document.documentElement.classList.add('modal-open');
            originalOpenReportIssuesModal.apply(this, arguments);
        };
    }
    
    const originalCloseReportIssuesModal = document.getElementById('report-issues-close-btn')?.onclick;
    if (originalCloseReportIssuesModal) {
        document.getElementById('report-issues-close-btn').onclick = function() {
            document.documentElement.classList.remove('modal-open');
            originalCloseReportIssuesModal.apply(this, arguments);
        };
    }
    
    // Example hook for Poll modal:
    const openPollBtn = document.getElementById('openPollBtn');
    if (openPollBtn) {
        openPollBtn.addEventListener('click', () => {
            document.documentElement.classList.add('modal-open');
        });
    }
    const closePollBtn = document.getElementById('closePollBtn');
    if (closePollBtn) {
        closePollBtn.addEventListener('click', () => {
            document.documentElement.classList.remove('modal-open');
        });
    }
});
/* =================================================== */
/* =================================================== */
/* =================================================== */
/* =================================================== */
// --- START: QUICK UPDATE MESSAGE FEATURE (ARRAY-BASED) ---

const UPDATE_FILE_URL = "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/update.json";

document.addEventListener('DOMContentLoaded', function() {
    const updateBtn = document.getElementById('quick-update-btn');
    const updateContentDiv = document.getElementById('quick-update-content');
    const updateSection = document.getElementById('quick-update-section');

    if (!updateBtn || !updateContentDiv || !updateSection) return;

    const fetchUrl = UPDATE_FILE_URL + '?t=' + new Date().getTime();

    fetch(fetchUrl)
        .then(response => {
            if (!response.ok) throw new Error('Network response was not ok');
            return response.json();
        })
        .then(data => {
            let activeMessage = null;

            // --- Robust Check: Is it an Array or a Single Object? ---
            if (Array.isArray(data)) {
                // If it's an array, find the first active message
                activeMessage = data.find(item => item.active === true);
            } else if (data && data.messageContent) {
                // If it's a single object (old format), use it directly
                activeMessage = data;
            }
            // --- End Robust Check ---

            if (activeMessage && activeMessage.buttonDate && activeMessage.messageContent) {
                
                // 1. Update Button Text
                updateBtn.innerHTML = `
                     ${activeMessage.lastUpdateText} 
                    <br><small style="opacity: 0.9;">  ${activeMessage.buttonDate}!</small>
                `;
                updateBtn.classList.remove('hidden');

                // 2. Inject Content (building the message structure)
                const innerContentHtml = `
                    <h4>${activeMessage.messageTitle || 'Updates'}</h4>
                    <hr style="border-top: 1px solid #ff54a5; margin: 10px 0;">
                    <p>${activeMessage.messageContent}</p>
                `;
                
                // 3. Set the click handler to toggle the display section
                updateBtn.onclick = () => toggleInfo('quick-update-section');
                
                // 4. Wrap the inner HTML in a new div with the 'info-content' class and inject it.
                updateSection.innerHTML = `
                    <div class="info-content">
                        ${innerContentHtml}
                    </div>
                `;
                
            } else {
                // If no valid active message (or single message) is found, the button remains hidden
                console.warn("No active message found in the update file, or file is not configured correctly.");
            }
        })
        .catch(error => {
            console.error("Failed to fetch or parse quick update file:", error);
            // Button remains hidden if fetch fails
        });
});


// --- END: QUICK UPDATE MESSAGE FEATURE ---
/* =================================================== */
/* =================================================== */
/* =================================================== */
/* =================================================== */
/* =================================================== */
/* ============only below stuff goes not above=================== */






























































/* =================================================== */
/*   START: Drops Submission MODAL SCRIPT           */
/* =================================================== */
// START OF FIX 2/3: Drops Submission JavaScript

// **WARNING: REPLACE THIS URL with your actual Drops/Skins Webhook URL.**
const DROPS_WEBHOOK_URL = "https://discord.com/api/webhooks/1429326145731694753/C-mbSZxx4R7T-8Gi5yFdRHYQW03ZMY7N63kg4tOZjMiOlUNmuvyToiHyriYaN98HtCkn";

// --- DYNAMIC CODE INPUT FUNCTIONS ---

function addDropsCodeInput() {
    const container = document.getElementById('drops-code-container');
    const inputCount = container.children.length;
    
    // Prevent adding more than 5 codes for cleanliness
    if (inputCount >= 5) return; 

    const newRow = document.createElement('div');
    newRow.className = 'code-input-row';

    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'shift-code-input drops-code-input'; 
    input.placeholder = 'XXXXX-XXXXX-XXXXX-XXXXX-XXXXX';

    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.className = 'code-action-btn remove';
    removeBtn.textContent = '-';
    removeBtn.onclick = () => newRow.remove();

    newRow.appendChild(input);
    newRow.appendChild(removeBtn);
    container.appendChild(newRow);
}

function initializeDropsCodeInputs() {
    const container = document.getElementById('drops-code-container');
    // Clear old inputs
    container.innerHTML = ''; 
    // Add one initial, non-removable input if none exist
    const initialRow = document.createElement('div');
    initialRow.className = 'code-input-row';
    initialRow.innerHTML = `<input type="text" class="shift-code-input drops-code-input" placeholder="XXXXX-XXXXX-XXXXX-XXXXX-XXXXX">`;
    container.appendChild(initialRow);
}

// --- MODAL CONTROL FUNCTIONS ---

function openDropsSubmitModal() {
    document.getElementById('drops-submit-modal-overlay').style.display = 'flex';
    document.getElementById('drops-submit-message').style.display = 'none';
    const submitBtn = document.getElementById('drops-submit-btn');
    if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Drops Info';
    }
    
    // Clear all fields and initialize code inputs
    document.getElementById('drops-kind').value = '';
    document.getElementById('drops-name').value = '';
    document.getElementById('drops-preview').value = '';
    document.getElementById('drops-expires').value = '';
    document.getElementById('drops-link').value = '';
    document.getElementById('drops-username').value = '';
    
    // Clear all existing dynamic inputs and add one fresh one
    initializeDropsCodeInputs(); 
}

function closeDropsSubmitModal() {
    document.getElementById('drops-submit-modal-overlay').style.display = 'none';
}

// --- SUBMISSION LOGIC ---

async function submitDropsInfo(buttonElement) {
    const kind = document.getElementById('drops-kind').value;
    const name = document.getElementById('drops-name').value.trim();
    const previewLink = document.getElementById('drops-preview').value.trim();
    const expires = document.getElementById('drops-expires').value.trim();
    const originalLink = document.getElementById('drops-link').value.trim();
    const username = document.getElementById('drops-username').value.trim() || 'Anonymous Vault Hunter';
    const messageDiv = document.getElementById('drops-submit-message');

    // Collect all codes
    const codeInputs = document.querySelectorAll('.drops-code-input');
    const codes = [];
    let allCodesValid = true;
    const shiftCodePattern = /^[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}$/i;

    codeInputs.forEach(input => {
        const codeValue = input.value.trim().toUpperCase();
        if (codeValue) {
            if (shiftCodePattern.test(codeValue)) {
                codes.push(codeValue);
            } else {
                allCodesValid = false;
            }
        }
    });

    // --- 1. VALIDATION ---
    if (!kind || !name) {
        messageDiv.textContent = 'Please select a drop type and enter the name of the item.';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        return;
    }
    if (codes.length > 0 && !allCodesValid) {
        messageDiv.textContent = 'One or more codes are in an invalid format. Please use: XXXXX-XXXXX-XXXXX-XXXXX-XXXXX';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        return;
    }
    
    // Check for duplicates against PERMANENT_CODES and ACTIVE CODES
    if (codes.length > 0) {
        const allExistingCodes = [...ALL_CODES_CONFIG, ...PERMANENT_CODES].map(c => c.code.toUpperCase());
        const duplicates = codes.filter(c => allExistingCodes.includes(c));
        if (duplicates.length > 0) {
            messageDiv.textContent = `The following code(s) are ALREADY on the list (Drop/Active): ${duplicates.join(', ')}`;
            messageDiv.className = 'submit-error';
            messageDiv.style.display = 'block';
            return;
        }
    }


    // --- 2. SUBMISSION PAYLOAD ---
    buttonElement.disabled = true;
    buttonElement.textContent = 'Sending...';

    const embed = {
        title: `üéÅ NEW DROPS/SKINS SUBMISSION: ${kind}`,
        color: 0xff00ff, // Pink color
        fields: [
            { name: "Item Name", value: name, inline: false },
            { name: "Item Type", value: kind, inline: true },
            { name: "Code(s)", value: codes.length > 0 ? `\`\`\`${codes.join('\n')}\`\`\`` : "No Code", inline: false },
            { name: "Expires", value: expires || "N/A (Likely Permanent)", inline: true },
            { name: "Preview Link", value: previewLink || "No Link", inline: false },
            { name: "Source Link", value: originalLink || "No Link", inline: false },
            { name: "Submitted By", value: username, inline: true }
        ],
        timestamp: new Date().toISOString()
    };

    try {
        const response = await fetch(DROPS_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ embeds: [embed] })
        });

        if (response.ok) {
            messageDiv.textContent = 'Success! Drop/Skin info submitted for review.';
            messageDiv.className = 'submit-success';
            messageDiv.style.display = 'block';
            setTimeout(closeDropsSubmitModal, 3000);
        } else {
            throw new Error(`Discord API Error: ${response.statusText}`);
        }
    } catch (error) {
        console.error('Error submitting Drops/Skins info:', error);
        messageDiv.textContent = 'Error sending info! Check console.';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        buttonElement.disabled = false;
        buttonElement.textContent = 'Submit Drops Info';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    // ... (Your existing DOMContentLoaded logic)
    // START OF FIX: Add Drops Submit Button Listener
    const dropsSubmitBtnInH2 = document.getElementById('open-drops-submit-btn');
    if (dropsSubmitBtnInH2) {
        dropsSubmitBtnInH2.addEventListener('click', openDropsSubmitModal);
    }
});
// END OF drops an skins modal
/* =================================================== */
/* =================================================== */ 

/* =================================================== */
/*   START: BM Submission Functions MODAL SCRIPT           */
/* =================================================== */
// START OF FIX 3/3: BM Submission Functions
// Function to toggle visible fields and update 'required' attributes
function toggleBmFields(selectedType) {
    const allFieldGroups = document.querySelectorAll('.dynamic-bm-fields');
    
    // Hide all groups and remove 'required' from their inputs/textareas
    allFieldGroups.forEach(group => {
        group.style.display = 'none';
        group.querySelectorAll('input, textarea').forEach(input => {
            input.removeAttribute('required');
        });
    });

    let currentFields = null;

    if (selectedType === 'Maurice Black Market Vendor') {
        currentFields = document.getElementById('maurice-fields');
        document.getElementById('maurice-location').setAttribute('required', 'true');
    } else if (selectedType === 'Weekly WildCard Mission') {
        currentFields = document.getElementById('wildcard-fields');
        document.getElementById('wildcard-name').setAttribute('required', 'true');
        document.getElementById('wildcard-location').setAttribute('required', 'true');
    } else if (selectedType === 'Weekly Big Encore Boss') {
        currentFields = document.getElementById('encore-fields');
        document.getElementById('encore-name').setAttribute('required', 'true');
        document.getElementById('encore-location').setAttribute('required', 'true');
    }

    if (currentFields) {
        currentFields.style.display = 'block';
    }
}

// Call the function on load to set the initial state (hidden)
document.addEventListener('DOMContentLoaded', () => {
    // ... (Your existing DOMContentLoaded logic)

    const bmSubmitBtnInH2 = document.getElementById('open-bm-submit-btn');
    if (bmSubmitBtnInH2) {
        bmSubmitBtnInH2.addEventListener('click', openBmSubmitModal);
    }
    // ... (rest of DOMContentLoaded content)
});
// **WARNING: REPLACE THIS PLACEHOLDER URL with your ACTUAL webhook URL for BM info.**
const BM_WEBHOOK_URL = "https://discord.com/api/webhooks/1429304632596762635/gjESx8fEfws1pebkxRLciAa6r7H3XxQNFJ1oQWK93f4UW_P5hXWYTZlMtQ9zMCHBEA_s";

// Function to toggle visible fields and update 'required' attributes
function toggleBmFields(selectedType) {
    const allFieldGroups = document.querySelectorAll('.dynamic-bm-fields');
    
    // Hide all groups and remove 'required' from their inputs/textareas
    allFieldGroups.forEach(group => {
        group.style.display = 'none';
        group.querySelectorAll('input, textarea').forEach(input => {
            input.removeAttribute('required');
        });
    });

    let currentFields = null;

    if (selectedType === 'Maurice Black Market Vendor') {
        currentFields = document.getElementById('maurice-fields');
        // Only Maurice's location is required
        document.getElementById('maurice-location').setAttribute('required', 'true');
    } else if (selectedType === 'Weekly WildCard Mission') {
        currentFields = document.getElementById('wildcard-fields');
        // Name and Location are required
        document.getElementById('wildcard-name').setAttribute('required', 'true');
        document.getElementById('wildcard-location').setAttribute('required', 'true');
    } else if (selectedType === 'Weekly Big Encore Boss') {
        currentFields = document.getElementById('encore-fields');
        // Name and Location are required
        document.getElementById('encore-name').setAttribute('required', 'true');
        document.getElementById('encore-location').setAttribute('required', 'true');
    }

    if (currentFields) {
        currentFields.style.display = 'block';
    }
}

function openBmSubmitModal() {
    document.getElementById('bm-submit-modal-overlay').style.display = 'flex';
    document.getElementById('bm-submit-message').style.display = 'none';
    const submitBtn = document.getElementById('bm-submit-btn');
    if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Info';
    }
    
    // Clear form fields using their new dynamic IDs
    document.getElementById('bm-type').value = '';
    document.getElementById('bm-username').value = '';

    // Clear all inputs in the dynamic fields
    document.querySelectorAll('.dynamic-bm-fields input, .dynamic-bm-fields textarea').forEach(input => {
        input.value = '';
    });
    
    // Call toggling function to set initial required status and hide fields
    toggleBmFields(''); 
}

function closeBmSubmitModal() {
    document.getElementById('bm-submit-modal-overlay').style.display = 'none';
}

async function submitBlackMarketInfo(buttonElement) {
    const infoType = document.getElementById('bm-type').value;
    const username = document.getElementById('bm-username').value.trim() || 'Anonymous Vault Hunter';
    const messageDiv = document.getElementById('bm-submit-message');

    // --- 1. COLLECT DATA & VALIDATE ---
    let fields = [];
    let isValid = true;
    
    // Validate the Info Type first
    if (!infoType) {
        messageDiv.textContent = 'Please select a valid Info Type.';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        return;
    }
    
    // Collect data based on Info Type
    if (infoType === 'Maurice Black Market Vendor') {
        const location = document.getElementById('maurice-location').value.trim();
        const proof = document.getElementById('maurice-proof-link').value.trim();
        if (!location) isValid = false;
        
        fields.push({ name: "Location", value: location || "N/A", inline: false });
        if (proof) fields.push({ name: "Proof/Map Link", value: proof, inline: false });
        
    } else if (infoType === 'Weekly WildCard Mission') {
        const name = document.getElementById('wildcard-name').value.trim();
        const location = document.getElementById('wildcard-location').value.trim();
        const infoCard = document.getElementById('wildcard-info-card').value.trim();
        const mapLink = document.getElementById('wildcard-map-link').value.trim();
        if (!name || !location) isValid = false;
        
        fields.push({ name: "Mission Name", value: name || "N/A", inline: true });
        fields.push({ name: "Location/Zone", value: location || "N/A", inline: true });
        if (infoCard) fields.push({ name: "Info Card URL", value: infoCard, inline: false });
        if (mapLink) fields.push({ name: "Map/Location Link", value: mapLink, inline: false });

    } else if (infoType === 'Weekly Big Encore Boss') {
        const name = document.getElementById('encore-name').value.trim();
        const location = document.getElementById('encore-location').value.trim();
        const loot = document.getElementById('encore-loot').value.trim();
        if (!name || !location) isValid = false;

        fields.push({ name: "Boss Name", value: name || "N/A", inline: true });
        fields.push({ name: "Location/Zone", value: location || "N/A", inline: true });
        fields.push({ name: "Drops/Loot", value: `\`\`\`${loot || "Not specified"}\`\`\``, inline: false });
    }

    // Final required field check (for fields that had 'required' set via JS)
    if (!isValid) {
        messageDiv.textContent = 'Please fill out all required fields for the selected Info Type.';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        // Re-enable button after failed validation
        buttonElement.disabled = false;
        buttonElement.textContent = 'Submit Info';
        return;
    }
    
    // --- 2. SUBMISSION PAYLOAD ---
    buttonElement.disabled = true;
    buttonElement.textContent = 'Sending...';

    const embed = {
        title: `üö® ${infoType} Info Submitted!`,
        color: 0xff4444, 
        fields: [
            ...fields,
            { name: "Submitted By", value: username, inline: true }
        ],
        timestamp: new Date().toISOString()
    };

    try {
        const response = await fetch(BM_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ embeds: [embed] })
        });

        if (response.ok) {
            messageDiv.textContent = 'Success! Info submitted for review.';
            messageDiv.className = 'submit-success';
            messageDiv.style.display = 'block';
            setTimeout(closeBmSubmitModal, 3000);
        } else {
            throw new Error(`Discord API Error: ${response.statusText}`);
        }
    } catch (error) {
        console.error('Error submitting BM info:', error);
        messageDiv.textContent = 'Error sending info! Check console.';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        buttonElement.disabled = false;
        buttonElement.textContent = 'Submit Info';
    }
}

// --- ATTACH EVENT LISTENER FOR THE BUTTON (Ensure this is run on DOMContentLoaded) ---
document.addEventListener('DOMContentLoaded', () => {
    // ... (Your existing DOMContentLoaded logic)

    const bmSubmitBtnInH2 = document.getElementById('open-bm-submit-btn');
    if (bmSubmitBtnInH2) {
        bmSubmitBtnInH2.addEventListener('click', openBmSubmitModal);
    }
});
// END OF bm modal
/* =================================================== */
/* =================================================== */       

/* =================================================== */
/*         START: REPORT ISSUES MODAL SCRIPT           */
/* =================================================== */
document.addEventListener('DOMContentLoaded', () => {

    // --- CONFIGURATION ---
    const reportWebhookUrl = "https://discord.com/api/webhooks/1429200995933753404/zKzybWhcbuCQiz9Or2yXXogcLT0HJvs3VrTEZ8uiJGKZPQzi16vvx49BHGNRrN1PQSDI";

    // --- ELEMENT SELECTORS (Using unique IDs for isolation) ---
    const openBtn = document.getElementById('open-report-issues-btn');
    const modalOverlay = document.getElementById('report-issues-modal-overlay');
    const closeBtn = document.getElementById('report-issues-close-btn');
    const form = document.getElementById('report-issues-form');
    const submitBtn = document.getElementById('report-issues-submit-btn');

    // This check prevents errors if the elements don't exist
    if (!openBtn || !modalOverlay || !closeBtn || !form || !submitBtn) {
        console.log("Report Issues modal elements not found. Script will not run.");
        return;
    }

    // --- MODAL VISIBILITY FUNCTIONS ---
    function openReportIssuesModal() {
        form.reset();
        // Reset validation styles from previous attempts
        form.querySelectorAll('.invalid').forEach(el => el.classList.remove('invalid'));
        form.querySelector('.checkbox-label').style.color = '#ccc';
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Report';
        modalOverlay.style.display = 'flex';
    }

    function closeReportIssuesModal() {
        modalOverlay.style.display = 'none';
    }

    // --- FORM VALIDATION ---
    function validateReportForm() {
        let isValid = true;
        const requiredFields = [
            form.querySelector('#report-issue-type'),
            form.querySelector('#report-description'),
            form.querySelector('#report-username'),
            form.querySelector('#report-username-platform')
        ];
        const reloadedCheck = form.querySelector('#report-reloaded-check');

        // Reset previous invalid visual feedback
        requiredFields.forEach(field => field.classList.remove('invalid'));
        reloadedCheck.closest('.checkbox-label').style.color = '#ccc';

        // Validate standard fields
        requiredFields.forEach(field => {
            if (!field.value || (field.id === 'report-description' && field.value.trim().length < 10)) {
                field.classList.add('invalid');
                isValid = false;
            }
        });

        // Validate checkbox
        if (!reloadedCheck.checked) {
            reloadedCheck.closest('.checkbox-label').style.color = '#e74c3c'; // Highlight label text in red
            isValid = false;
        }
        
        return isValid;
    }

    // --- DISCORD WEBHOOK SUBMISSION ---
    async function handleFormSubmit(event) {
        event.preventDefault();

        if (!validateReportForm()) {
            alert('Please fill out all required fields marked with an asterisk (*). The description must be at least 10 characters long.');
            return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';

        const formData = {
            type: form.querySelector('#report-issue-type').value,
            description: form.querySelector('#report-description').value,
            username: form.querySelector('#report-username').value,
            platform: form.querySelector('#report-username-platform').value,
            proofLink: form.querySelector('#report-proof-link').value.trim()
        };

        const embed = {
            title: "üêû New Site Issue Report",
            color: 15773222, // Orange/Yellow color
            fields: [
                { name: "Reporter", value: `${formData.username} (${formData.platform})`, inline: true },
                { name: "Issue Type", value: formData.type, inline: true },
                { name: "Description", value: `\`\`\`${formData.description}\`\`\`` }
            ],
            footer: { text: "Report submitted" },
            timestamp: new Date().toISOString()
        };
        
        if (formData.proofLink) {
            embed.fields.push({ name: "Proof Link", value: formData.proofLink, inline: false });
        }

const payload = {
    // REMOVE username and avatar_url to use the webhook's default settings
    // username: "Site Issue Reporter",  <-- REMOVE THIS LINE
    // avatar_url: "",                  <-- REMOVE THIS LINE
    embeds: [embed]
};

        try {
            const response = await fetch(reportWebhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                alert('Thank you! Your report has been sent successfully.');
                closeReportIssuesModal();
            } else {
                throw new Error(`Discord API Error: ${response.statusText}`);
            }
        } catch (error) {
            console.error('Error sending report to Discord:', error);
            alert('A network error occurred or the webhook failed. Could not send the report.');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Send Report';
        }
    }

    // --- EVENT LISTENERS (Correctly Isolated) ---
    openBtn.addEventListener('click', openReportIssuesModal);
    closeBtn.addEventListener('click', closeReportIssuesModal);
    form.addEventListener('submit', handleFormSubmit);

    // NOTE: The event listener for clicking outside the modal has been intentionally removed
    // as per your request.
});

/* =================================================== */
/*          END: REPORT ISSUES MODAL SCRIPT            */
/* =================================================== */

/* =================================================== */
/*           START: HIDE ISH CONFIG & SCRIPT           */
/* =================================================== */

// --- HIDEABLE ELEMENTS CONFIGURATION ---
const HIDEABLE_ELEMENTS_CONFIG = [
    { id: 'floating-info-panel', label: 'Supporters & Thanks Panel' },
    { id: 'contact-me-section', label: 'Connect/Contact Section' },
    { id: 'site-options-container', label: 'Site Options' },
    { id: 'rewards-container', label: 'Redeem SHiFT Button' },
    { id: 'roadmap-btn', label: 'Roadmap Button' },
    { id: 'events-btn', label: 'Events Button/Section' },
    { id: 'challenge-btn', label: 'Challenge Button/Section' },
    { id: 'maurices-toggle-btn', label: 'Black Market Button/Section' },
    { id: 'permanent-toggle-btn', label: 'Drops/Skins Button/Section' },
    { id: 'collapse-btn-exp', label: 'Expired Codes Section' },
    // Global action buttons (target their unique ID or class)
    { id: 'openPollBtn', label: 'Poll Button' },
    { id: 'open-report-issues-btn', label: 'Report Button' },
    { className: 'floating-feedback-btn', label: 'Feedback Forum Button' },
    { id: 'share-ish-button', label: 'Share Socials Button' },
];

const HIDE_ISH_STORAGE_KEY = 'hideIshPreferences';

// --- MODAL & RENDERING FUNCTIONS ---

function renderHideIshOptions() {
    const container = document.getElementById('hide-options-container');
    if (!container) return;

    let html = '';
    const preferences = JSON.parse(localStorage.getItem(HIDE_ISH_STORAGE_KEY)) || {};

    HIDEABLE_ELEMENTS_CONFIG.forEach((config, index) => {
        // Use a persistent key for localStorage, favoring ID over index
        const storageKey = config.id || config.className || `element-${index}`; 
        const isChecked = preferences[storageKey] === true ? 'checked' : '';

        html += `
            <div class="setting-item">
                <input 
                    type="checkbox" 
                    id="hide-ish-check-${index}" 
                    data-storage-key="${storageKey}"
                    ${isChecked}
                    onchange="handleHideIshToggle(this)">
                <label for="hide-ish-check-${index}">${config.label}</label>
            </div>
        `;
    });
    container.innerHTML = html;
}

function openHideIshModal() {
    renderHideIshOptions();
    const modal = document.getElementById('hide-ish-modal');
    if (modal) modal.style.display = 'flex';
}

function closeHideIshModal() {
    const modal = document.getElementById('hide-ish-modal');
    if (modal) modal.style.display = 'none';
}

// --- CORE LOGIC FUNCTIONS ---

function handleHideIshToggle(checkbox) {
    const storageKey = checkbox.getAttribute('data-storage-key');
    const isChecked = checkbox.checked;

    // 1. Save the new preference state
    try {
        const preferences = JSON.parse(localStorage.getItem(HIDE_ISH_STORAGE_KEY)) || {};
        preferences[storageKey] = isChecked;
        localStorage.setItem(HIDE_ISH_STORAGE_KEY, JSON.stringify(preferences)); // CRITICAL: Ensure it is set
        console.log(`Saved ${storageKey} as hidden: ${isChecked}`); // Log for verification
    } catch (e) {
        console.error("Error saving hide ish preference:", e);
    }
    
    // 2. Immediately apply the change to the DOM
    applyHideIshPreferences();
}

/**
 * Applies the saved hiding preferences to all elements on the page.
 */
function applyHideIshPreferences() {
    const preferences = JSON.parse(localStorage.getItem(HIDE_ISH_STORAGE_KEY)) || {};
    const hideIshButton = document.getElementById('hide-ish-toggle-btn');
    let isAnythingHidden = false;

    // Iterate through the configuration to find and hide/show elements
    HIDEABLE_ELEMENTS_CONFIG.forEach(config => {
        const storageKey = config.id || config.className || 'invalid';
        const isHidden = preferences[storageKey] === true;
        
        // Target elements by ID or ClassName
        let elements = [];
        if (config.id) {
            const el = document.getElementById(config.id);
            if (el) elements.push(el);
        }
        if (config.className) {
            elements.push(...document.getElementsByClassName(config.className));
        }

        elements.forEach(el => {
            // Special handling for the main Black Market/Drops sections to hide the content too
            if (config.id === 'maurices-toggle-btn' && document.getElementById('black-market-section')) {
                document.getElementById('black-market-section').classList.toggle('hidden', isHidden);
            }
            if (config.id === 'permanent-toggle-btn' && document.getElementById('permanent-section')) {
                document.getElementById('permanent-section').classList.toggle('hidden', isHidden);
            }
            if (config.id === 'expired-section' && document.getElementById('expired-section')) {
                document.getElementById('expired-section').classList.toggle('hidden', isHidden);
                // Note: The button to open the expired section is not explicitly defined in the config, 
                // you would need to add its ID to the config if you want to hide the button.
            }

            el.classList.toggle('hidden', isHidden);
            if (isHidden) isAnythingHidden = true;
        });
    });

    // 3. Update the Hide Ish button text and icon
    if (hideIshButton) {
        hideIshButton.innerHTML = isAnythingHidden ? 'Hide Ish: üö´' : 'Hide Ish: üëÅÔ∏è';
    }
}

// --- JAVASCRIPT FIX: REORDER FLOATING BUTTONS (IMPORTANT) ---


function reorderFloatingButtons() {
    const wrapper = document.getElementById('combined-controls-wrapper');
    if (!wrapper) return;

    // üö® UPDATED ORDER ARRAY üö®
    const buttons = [
        document.getElementById('compact-grid-toggle-btn'),
        document.getElementById('pc-view-toggle'),       // 3. Layout Mode
        document.getElementById('toggleDashboardView'),
        document.getElementById('hide-ish-toggle-btn'),  // 1. NEW HIDE ISH
        document.getElementById('cry-babes-toggle-btn'), // 2. Button Hater Mode
        document.getElementById('stealth-mode-label'),    // 4. Stealth Mode
        document.getElementById('soft-mode-toggle-btn'),  // 5. Soft Mode
        document.getElementById('grit-mode-toggle-btn')   // 6. Grit Mode
    ];
    
    // Filter out any null elements
    const validButtons = buttons.filter(btn => btn);

    // Clear existing order
    validButtons.forEach(btn => btn.style.order = ''); 

    // Re-add buttons in the desired order (1 to 6)
    validButtons.forEach((btn, index) => {
        btn.style.order = index + 1; 
    });

    // Preserve original logic for the slider visibility
    const sliderControl = document.getElementById('stealth-brightness-control');
    if (sliderControl) {
        const currentState = document.body.classList.contains('stealth-mode') ? 'stealth' : 'none';
        sliderControl.classList.toggle('is-visible', currentState === 'stealth');
    }
}


// --- INITIALIZATION (Crucial Fix) ---

// You must call applyHideIshPreferences on load to ensure elements start hidden
document.addEventListener('DOMContentLoaded', () => {
    // ... (Your existing DOMContentLoaded code) ...

    // 1. Initialize the element hiding states immediately on load
    applyHideIshPreferences(); 

    // 2. Re-apply floating button order (This will run the corrected function)
    reorderFloatingButtons();
});

/* =================================================== */
/*            END: HIDE ISH CONFIG & SCRIPT            */
/* =================================================== */

/* =================================================== */
// === START: NEW GLOBAL RESET FUNCTION ===
/* =================================================== */
/**
 * Clears all saved hidden code states from localStorage and visually updates ALL code boxes on the page.
 */
function resetAllHiddenCodeStates() {
    try {
        localStorage.removeItem('hiddenCodeStates');
        
        // Reset all code boxes visually
        document.querySelectorAll('.code-box, .permanent-code-box, .expired-code-box, .black-market-code-box').forEach(el => {
            el.classList.remove('hidden-code');
            const hideButton = el.querySelector('.hide-code-btn');
            if (hideButton) {
                hideButton.innerHTML = 'üëÅÔ∏è';
                hideButton.title = 'Hide Code Box';
            }
        });
        
        alert("‚úÖ All hidden code boxes have been reset and are now visible!");
        
    } catch (e) {
        console.error("Error resetting hidden code states:", e);
        alert("‚ö†Ô∏è Error: Failed to reset hidden codes. Check console for details.");
    }
}

// NEW: Generate unique IDs for code boxes without unique codes
function generateUniqueId(codeData, type, index) {
    // If there's a real code, use it as the unique identifier
    if (codeData.code && codeData.code.trim() !== "" && codeData.code !== "No Code") {
        return codeData.code;
    }
    
    // For "No Code" or empty codes, create a unique identifier using title + description
    const titlePart = codeData.title ? codeData.title.replace(/\s+/g, '_').substring(0, 20) : 'notitle';
    const descPart = codeData.description ? codeData.description.replace(/\s+/g, '_').substring(0, 10) : 'nodesc';
    return `${type}_${index}_${titlePart}_${descPart}`;
}

// Function to toggle visibility and save state
function toggleCodeVisibility(type, index) { // Note: it should only accept type and index now
    const uniqueId = `${type}-${index}`; // e.g., "permanent-15"
    const containerIdPrefix = type === 'active' ? 'active-' : type === 'permanent' ? 'permanent-' : type === 'expired' ? 'expired-' : 'black-market-vendor-';
    const container = document.getElementById(`${containerIdPrefix}${index}`);
    const hideButton = container ? container.querySelector('.hide-code-btn') : null;
    
    if (!container) return;

    const isHidden = container.classList.toggle('hidden-code');
    
    if (hideButton) {
        if (isHidden) {
            hideButton.innerHTML = '‚ùå'; // Set to X when hidden
            hideButton.title = 'Show Code Box';
        } else {
            hideButton.innerHTML = 'üëÅÔ∏è'; // Set to Eye when visible
            hideButton.title = 'Hide Code Box';
        }
    }

    // Save the state using the uniqueId
    try {
        const hiddenStates = JSON.parse(localStorage.getItem('hiddenCodeStates')) || {};
        hiddenStates[uniqueId] = isHidden;
        localStorage.setItem('hiddenCodeStates', JSON.stringify(hiddenStates));
    } catch (e) {
        console.error("Error saving hidden state:", e);
    }
}

// Function to apply saved visibility state on load
function applySavedCodeVisibility() {
    try {
        const hiddenStates = JSON.parse(localStorage.getItem('hiddenCodeStates')) || {};
        console.log('Applying saved hidden states:', hiddenStates);
        
        // Apply to all code boxes
        document.querySelectorAll('[data-code-value]').forEach(element => {
            const codeValue = element.getAttribute('data-code-value');
            
            if (hiddenStates[codeValue] === true) {
                element.classList.add('hidden-code');
                const hideButton = element.querySelector('.hide-code-btn');
                if (hideButton) {
                    hideButton.innerHTML = '‚ùå';
                    hideButton.title = 'Show Code Box';
                }
                console.log('Applied hidden state to:', codeValue);
            }
        });
    } catch (e) {
        console.error("Error applying saved hidden states:", e);
    }
}

// Enhanced initialization with retry for dynamic content
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing hide functionality...');
    
    // Initial apply after short delay to ensure DOM is ready
    setTimeout(() => {
        applySavedCodeVisibility();
    }, 100);
    
    // Additional apply after longer delay for any dynamically loaded content
    setTimeout(() => {
        applySavedCodeVisibility();
    }, 500);
});

// Override the initializePage function to ensure our hide states are applied
if (typeof initializePage === 'function') {
    const originalInitializePage = initializePage;
    initializePage = function() {
        originalInitializePage();
        // Re-apply hide states after page initialization
        setTimeout(() => {
            applySavedCodeVisibility();
        }, 200);
    };
}

// UPDATED: Override createActiveCodeBox to use unique IDs
if (typeof createActiveCodeBox === 'function') {
    const originalCreateActiveCodeBox = createActiveCodeBox;
    createActiveCodeBox = function(codeData, index) {
        // Generate unique ID before calling original function
        const uniqueId = generateUniqueId(codeData, 'active', index);
        
        // Call original function and modify the result
        let html = originalCreateActiveCodeBox(codeData, index);
        
        // Replace the data-code-value with our unique ID
        if (html && codeData.code) {
            // Replace the onclick handler to use unique ID
            html = html.replace(
                `onclick="toggleCodeVisibility('${codeData.code}', 'active', ${index})"`,
                `onclick="toggleCodeVisibility('${uniqueId}', 'active', ${index})"`
            );
            
            // Replace the data-code-value attribute
            html = html.replace(
                `data-code-value="${codeData.code}"`,
                `data-code-value="${uniqueId}"`
            );
            
            console.log('Updated active code box with unique ID:', uniqueId);
        }
        return html;
    };
}

// UPDATED: Override createPermanentCodeBox to use unique IDs
if (typeof createPermanentCodeBox === 'function') {
    const originalCreatePermanentCodeBox = createPermanentCodeBox;
    createPermanentCodeBox = function(codeData, index) {
        // Generate unique ID before calling original function
        const uniqueId = generateUniqueId(codeData, 'permanent', index);
        
        // Call original function and modify the result
        let html = originalCreatePermanentCodeBox(codeData, index);
        
        // Replace the data-code-value with our unique ID
        if (html && codeData.code) {
            // Replace the onclick handler to use unique ID
            html = html.replace(
                `onclick="toggleCodeVisibility('${codeData.code}', 'permanent', ${index})"`,
                `onclick="toggleCodeVisibility('${uniqueId}', 'permanent', ${index})"`
            );
            
            // Replace the data-code-value attribute
            html = html.replace(
                `data-code-value="${codeData.code}"`,
                `data-code-value="${uniqueId}"`
            );
            
            console.log('Updated permanent code box with unique ID:', uniqueId);
        }
        return html;
    };
}

// NEW: Also override createExpiredCodeBox and createBlackMarketCodeBox if they exist
if (typeof createExpiredCodeBox === 'function') {
    const originalCreateExpiredCodeBox = createExpiredCodeBox;
    createExpiredCodeBox = function(codeData, index) {
        const uniqueId = generateUniqueId(codeData, 'expired', index);
        let html = originalCreateExpiredCodeBox(codeData, index);
        
        if (html && codeData.code) {
            html = html.replace(
                `onclick="toggleCodeVisibility('${codeData.code}', 'expired', ${index})"`,
                `onclick="toggleCodeVisibility('${uniqueId}', 'expired', ${index})"`
            );
            html = html.replace(
                `data-code-value="${codeData.code}"`,
                `data-code-value="${uniqueId}"`
            );
        }
        return html;
    };
}

if (typeof createBlackMarketCodeBox === 'function') {
    const originalCreateBlackMarketCodeBox = createBlackMarketCodeBox;
    createBlackMarketCodeBox = function(codeData, index) {
        const uniqueId = generateUniqueId(codeData, 'blackmarket', index);
        let html = originalCreateBlackMarketCodeBox(codeData, index);
        
        if (html && codeData.code) {
            html = html.replace(
                `onclick="toggleCodeVisibility('${codeData.code}', 'black-market', ${index})"`,
                `onclick="toggleCodeVisibility('${uniqueId}', 'black-market', ${index})"`
            );
            html = html.replace(
                `data-code-value="${codeData.code}"`,
                `data-code-value="${uniqueId}"`
            );
        }
        return html;
    };
}

/* =================================================== */
/* =================================================== */
/* =================================================== */
// === START: NEW SHARE MODAL SCRIPT (FINALIZED FOR TEXT ONLY & NO WEBHOOK FOR DISCORD) ===

let currentShareCode = '';
let currentShareType = '';
let currentShareIndex = -1;

// --- LOCAL STORAGE HELPERS ---
const WEBHOOK_STORAGE_KEY = 'userDiscordWebhookUrl';

function saveWebhookUrl(url) {
  try {
    localStorage.setItem(WEBHOOK_STORAGE_KEY, url);
    return true;
  } catch (e) {
    console.error("Failed to save webhook URL to local storage:", e);
    return false;
  }
}

function getWebhookUrl() {
  try {
    return localStorage.getItem(WEBHOOK_STORAGE_KEY) || null;
  } catch (e) {
    return null;
  }
}
// -----------------------------

// 1. Modal Control Functions (Unchanged)
function openShareModal(code, type, index) {
  currentShareCode = code;
  currentShareType = type;
  currentShareIndex = index;
 
  const displayEl = document.getElementById('share-code-display');
  if (displayEl) displayEl.textContent = code;
 
  const modal = document.getElementById('share-modal');
  if (modal) modal.style.display = 'flex';
}

function closeShareModal() {
  const modal = document.getElementById('share-modal');
  if (modal) modal.style.display = 'none';
 
  currentShareCode = '';
  currentShareType = '';
  currentShareIndex = -1;
}

// 2. Sharing Functions

// Helper to find the code data object (MUST BE ACCESSIBLE - assumes ALL_CODES_CONFIG, PERMANENT_CODES, formatDate, MAIN_URL are defined elsewhere)
function getCodeDataByType(code, type) {
  if (type === 'active') return ALL_CODES_CONFIG.find(c => c.code === code);
  if (type === 'permanent') return PERMANENT_CODES.find(c => c.code === code);
  if (type === 'expired') return ALL_CODES_CONFIG.concat(PERMANENT_CODES).find(c => c.code === code);
  return null;
}

// Helper to format the expiry text for the simple share format
function formatExpiryForShare(codeData) {
  if (codeData.expires === "UED") {
    return "Expires: Unknown";
  }
  if (!codeData.expires) {
    return "Expires: Permanent (or very long time)";
  }
 
  let expiresDate;
  try {
    expiresDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
    if (isNaN(expiresDate.getTime())) return "Expires: Invalid Date";
    return `Expires: ${formatDate(expiresDate)}`;
  } catch (e) {
    return "Expires: Error Reading Date";
  }
}

// --- DISCORD (WEBHOOK POST METHOD - Uses Local Storage) ---
function shareToDiscord(code, type) {
  const storedUrl = getWebhookUrl();
  let webhookUrl = storedUrl;

  if (!webhookUrl) {
webhookUrl = prompt(
      "Enter your Discord Webhook URL to save it locally for future quick shares:\n\n" +
      "GUIDE:\n" +
      "1. Go to the channel you want to post in.\n" +
      "2. Click 'Edit Channel' (gear icon).\n" +
      "3. Go to 'Integrations' > 'Webhooks'.\n" +
      "4. Create a new webhook or edit an existing one.\n" +
      "5. Copy the webhook URL.\n" +
      "6. Paste the URL back here."
    );
   
    if (!webhookUrl) {
      alert("Webhook post cancelled. Please use the 'Copy' button if you prefer manual sharing.");
      return;
    }

    if (!webhookUrl.startsWith('https://discord.com/api/webhooks/')) {
      alert("Invalid Webhook URL format. Please try again or use the 'Copy' button.");
      return;
    }

    saveWebhookUrl(webhookUrl);
    alert("Webhook URL saved locally! Future 'Post' clicks will use this URL automatically.");
  }
 
  const codeData = getCodeDataByType(code, type);
  if (!codeData) {
    alert("Error: Could not retrieve code details.");
    return;
  }
 
  const expiryText = formatExpiryForShare(codeData);
  const siteUrl = MAIN_URL;

  const discordMessage = `**SHiFT Code:** \`${code}\`\n${expiryText}\n\nPS: *You can click where code is on mobile and will stick it on clipboard*\n\nCheck out the full tracker here: ${siteUrl}`;
 
  // Construct the payload
  const payload = {
    content: discordMessage,
  };

  // Attempt to send the webhook request
  fetch(webhookUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(response => {
    if (response.ok) {
      alert(`‚úÖ Success! Message sent to Discord (via stored webhook).`);
    } else {
      alert(`‚ö†Ô∏è Error: Failed to send message (Status: ${response.status}). The webhook may be invalid or rate-limited. The URL has been removed. Please try again.`);
      // If the webhook fails, clear it from local storage so the user is prompted next time.
      localStorage.removeItem(WEBHOOK_STORAGE_KEY);
    }
    closeShareModal();
  })
  .catch(error => {
    console.error('Webhook Error:', error);
    alert("An error occurred during the request. Check console for details.");
    localStorage.removeItem(WEBHOOK_STORAGE_KEY); // Clear on network/fetch error too
    closeShareModal();
  });
}

// --- DISCORD (TEXT COPY METHOD - FOR MANUAL SHARING) ---
function copyForDiscord(code, type) {
  const codeData = getCodeDataByType(code, type);
  if (!codeData) {
    alert("Error: Could not retrieve code details.");
    return;
  }
 
  const expiryText = formatExpiryForShare(codeData);
  const siteUrl = MAIN_URL;
 
  const discordMessage = `**SHiFT Code:** \`${code}\`\n${expiryText}\n\nPS: <i>You can click where code is on mobile and will stick it on clipboard</i>\n\nCheck out the full tracker here: ${siteUrl}`;
 
  navigator.clipboard.writeText(discordMessage)
    .then(() => {
      alert("‚úÖ Code details copied to clipboard! Paste it (Ctrl+V or Cmd+V) into your Discord channel.");
      closeShareModal();
    })
    .catch(err => {
      console.error('Could not copy text: ', err);
      alert("Failed to copy text. Please copy the code manually.");
    });
}

// --- DISCORD (WEBHOOK RESET METHOD) ---
function resetDiscordWebhook() {
    try {
        localStorage.removeItem(WEBHOOK_STORAGE_KEY);
        // Using alert for feedback, matching the style of the existing functions
        alert("‚úÖ Discord Webhook URL has been cleared. You will be prompted for a new URL next time you click 'Post'.");
        closeShareModal();
    } catch (e) {
        console.error("Failed to clear webhook URL from local storage:", e);
        alert("‚ö†Ô∏è Error: Failed to clear the stored Webhook URL. Check console for details.");
    }
}
// -----------------------------

function shareToTwitter(code, type) {
  const codeData = getCodeDataByType(code, type);
  const expiresText = formatExpiryForShare(codeData);
  const siteUrl = MAIN_URL;
 
  const tweetText = encodeURIComponent(`New SHiFT Code: ${code}. ${expiresText}. Check the tracker: `);
 
  const url = `https://twitter.com/intent/tweet?text=${tweetText}&url=${encodeURIComponent(siteUrl)}`;
  window.open(url, '_blank');
  closeShareModal();
}

function shareToFacebook(code, type) {
  const codeData = getCodeDataByType(code, type);
  if (!codeData) {
    alert("Error: Could not retrieve code details.");
    return;
  }
 
  const expiresText = formatExpiryForShare(codeData);
  const siteUrl = MAIN_URL;
 
  const shareText = `New SHiFT Code: ${code}\n${expiresText}\n\nCheck the tracker for full details: ${siteUrl}`;

  navigator.clipboard.writeText(shareText)
    .then(() => {
      const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(siteUrl)}`;
      window.open(url, '_blank');
     
      alert("‚úÖ Code copied! Please PASTE the details (Ctrl+V or Cmd+V) into the Facebook post description.");
      closeShareModal();
    })
    .catch(err => {
      console.error('Could not copy text: ', err);
      alert("Failed to copy text automatically. Please copy the code manually and paste it into Facebook.");
    });
}

// 3. Initializer for Share Modal and Buttons
document.addEventListener('DOMContentLoaded', function() {
  const shareButton = document.getElementById('final-share-button');
  const shareMenu = document.getElementById('final-share-menu');
    // Added reference for the new reset button
    const resetWebhookBtn = document.getElementById('reset-webhook-btn'); 

  // Dropdown/Menu toggle logic
  if (shareButton) {
    shareButton.addEventListener('click', function(event) {
      event.stopPropagation();
      if(shareMenu) shareMenu.classList.toggle('active');
    });
  }

  document.addEventListener('click', function() {
    if(shareMenu && shareMenu.classList.contains('active')) {
      shareMenu.classList.remove('active');
    }
  });

  // --- NEW: Event Listeners for Share Buttons ---
  const discordPostBtn = document.getElementById('share-discord-post-btn');
  const discordCopyBtn = document.getElementById('share-discord-copy-btn');
  const twitterBtn = document.getElementById('share-twitter-btn');
  const facebookBtn = document.getElementById('share-facebook-btn');
 
  if (discordPostBtn) {
    discordPostBtn.addEventListener('click', function() {
      shareToDiscord(currentShareCode, currentShareType); // This is the Webhook/Post function
    });
  }
  if (discordCopyBtn) {
    discordCopyBtn.addEventListener('click', function() {
      copyForDiscord(currentShareCode, currentShareType); // This is the Copy function
    });
  }
  if (twitterBtn) {
    twitterBtn.addEventListener('click', function() {
      shareToTwitter(currentShareCode, currentShareType);
    });
  }
  if (facebookBtn) {
    facebookBtn.addEventListener('click', function() {
      shareToFacebook(currentShareCode, currentShareType);
    });
  }

    // --- NEW: Reset Webhook Listener ---
    if (resetWebhookBtn) {
        resetWebhookBtn.addEventListener('click', resetDiscordWebhook);
    }
});

// === END: NEW SHARE MODAL SCRIPT (Focusing on Prompt/Link Sharing ONLY) ===
/* =================================================== */
/* =================================================== */
/* =================================================== */

/* =================================================== */
// --- NEW: AUTO-REFRESH TIMER FUNCTION ---
/* =================================================== */
const REFRESH_INTERVAL_MINUTES = 10; // Set the desired refresh interval in minutes

function setupAutoRefresh() {
    const refreshIntervalMs = REFRESH_INTERVAL_MINUTES * 60 * 1000; // Convert minutes to milliseconds
    
    console.log(`Auto-refresh timer set to ${REFRESH_INTERVAL_MINUTES} minutes (${refreshIntervalMs / 1000} seconds).`);
    
    setInterval(() => {
        console.log("Auto-refresh triggered: Reloading page to fetch latest codes.");
        location.reload();
    }, refreshIntervalMs);
}
// --- END NEW: AUTO-REFRESH TIMER FUNCTION ---      
/* =================================================== */
/* =================================================== */
/* =================================================== */



/* =================================================== */
/* START: UNIFIED AND CORRECTED NOTIFICATION LOGIC (WITH CUSTOM MODAL) */
/* =================================================== */
// --- VITAL CONSTANTS ---
const NOTIFICATION_STORAGE_KEY = 'shiftNotificationVersion';
const MAIN_URL = 'https://xsmashx88x.github.io/Shift-Codes/';
const VERSION_FILE_URL = 'https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/code_version.txt';
const POLLING_INTERVAL_MS = 60000; // 60 seconds (1 minute)

// --- GLOBAL STATE FOR TAB ALERTING ---
const ORIGINAL_TITLE = document.title; 
let hasPendingAlert = false; 
// ----------------------------------------------------------------------

// --- MODAL CONTROL FUNCTIONS (UNCHANGED) ---
function showCustomAlert() {
    const modal = document.getElementById('custom-alert-modal');
    if (modal) {
        modal.style.display = 'flex'; // Show the modal
    }
}

function hideCustomAlertAndReload() {
    const modal = document.getElementById('custom-alert-modal');
    if (modal) {
        modal.style.display = 'none'; // Hide the modal
    }
    document.title = ORIGINAL_TITLE; // Restore the title
    hasPendingAlert = false;         // Reset the flag
    location.reload();               // **RELIABLE RELOAD**
}
// -----------------------------

// --- FUNCTION 1: Updates the button's text/style based on permission status (UNCHANGED) ---
function updateButtonDisplay(permission) {
    const button = document.getElementById('notif-permission-btn');
    if (!button) return;
    button.className = 'floating-notif-bell';
    button.disabled = false;
    button.title = 'Enable Notifications';
    if (permission === 'granted') {
        button.classList.add('granted');
        button.classList.add('hidden'); 
        button.title = 'Notifications Enabled';
    } else if (permission === 'denied') {
        button.classList.add('denied');
        button.disabled = true;
        button.title = 'Notifications Blocked by your browser/OS settings.';
    } else {
        button.title = 'Click to enable real-time new code alerts!';
    }
}

// -----------------------------------------------------------------------------
// --- FUNCTION 2: Requests permission from the browser (UNCHANGED) ---
function requestNotificationPermission() {
    if (!("Notification" in window)) {
        console.log("Browser doesn't support notifications.");
        return;
    }
    Notification.requestPermission(function (permission) {
        updateButtonDisplay(permission); 
    });
}

// --- NEW HELPER FUNCTION TO DETECT MOBILE ---
function isMobileDevice() {
    return window.innerWidth <= 768;
}

// -----------------------------------------------------------------------------
// --- FUNCTION 3: Checks for new codes and shows the notification (CORE LOGIC) ---
async function checkAndShowNotification() {

    if (isMobileDevice()) {
        return;
    }

    try {
        const response = await fetch(VERSION_FILE_URL + '?nocache=' + new Date().getTime());
        const latestVersionString = (await response.text()).trim();
        
        const LATEST_VERSION = parseInt(latestVersionString);
        
        // --- CRITICAL VALIDATION ADDED ---
        // 1. Check if the fetched version is a valid, positive number.
        if (isNaN(LATEST_VERSION) || LATEST_VERSION <= 0) {
             console.warn("Version file contains invalid or zero value. Aborting notification check.");
             return; 
        }

        const lastNotifiedVersion = parseInt(localStorage.getItem(NOTIFICATION_STORAGE_KEY)) || 0;

        if (LATEST_VERSION > lastNotifiedVersion) {
            
            // A new version is detected! Start alerting process.
            hasPendingAlert = true; 
            
            // 1. Show Desktop Notification 
            if (Notification.permission === "granted") {
                const newCodeNotif = new Notification('üö® New SHiFT Codes Dropped! üóùÔ∏è', {
                    body: 'Vault Hunter! New codes are here! Click to view (refresh page).',
                    icon: 'https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png',
                    requireInteraction: true 
                });
                newCodeNotif.onclick = function() {
                    window.open(MAIN_URL, '_self');
                    this.close();
                };
            }
            
            // 2. Change the Tab Title
            document.title = 'üö® NEW CODE ALERT! üö® - ' + ORIGINAL_TITLE;

            // 3. Update the stored version
            // ONLY update localStorage *after* confirming a valid, new version was found.
            localStorage.setItem(NOTIFICATION_STORAGE_KEY, LATEST_VERSION);
        }
    } catch (error) {
        console.error("Error during version check:", error);
        // Do NOT update localStorage here, as the version check failed.
    }
}
// -----------------------------------------------------------------------------

// --- FUNCTION 4: Handles tab focusing to show custom modal (UNCHANGED) ---
function handleVisibilityChange() {

        // ** ADD THIS LINE: Stop the function if on a mobile device **
    if (isMobileDevice()) {
        return;
    }
    // Only run if the tab is now visible AND a new code was detected while it was hidden.
    if (!document.hidden && hasPendingAlert) {
        
        // Show the custom HTML alert modal instead of the native alert()
        showCustomAlert();
    }
}
// -----------------------------------------------------------------------------

// --- FINAL EXECUTION BLOCK: Initializes everything on page load (UNCHANGED) ---
document.addEventListener('DOMContentLoaded', () => {
    
    // Set up the notification button and permission check
    const notifButton = document.getElementById('notif-permission-btn');
    if ("Notification" in window && notifButton) {
        updateButtonDisplay(Notification.permission);
        notifButton.onclick = requestNotificationPermission;
    }
    
    // Set up the OK button on the custom modal to hide and reload
    const modalOkButton = document.getElementById('modal-ok-button');
    if (modalOkButton) {
        modalOkButton.addEventListener('click', hideCustomAlertAndReload);
    }
    
    // Start the Polling check
    setTimeout(checkAndShowNotification, 3000); 
    setInterval(checkAndShowNotification, POLLING_INTERVAL_MS); 

    // Add event listener to detect when the tab comes back into focus
    document.addEventListener('visibilitychange', handleVisibilityChange);
});
/* =================================================== */
/* END: UNIFIED AND CORRECTED NOTIFICATION LOGIC (WITH CUSTOM MODAL) */
/* =================================================== */
/* =================================================== */
/* =================================================== */



/* =================================================== */
/*         START: NEW COMPACT GRID VIEW SCRIPT         */
/* =================================================== */

// Use a unique key to store the state for this new mode
const COMPACT_GRID_KEY = 'compactGridViewEnabled';

/**
 * Toggles the Compact Grid View layout for PC and saves its state.
 */
function toggleCompactGridView() {
    const body = document.body;
    const isNowActive = body.classList.toggle('compact-grid-active');

    try {
        localStorage.setItem(COMPACT_GRID_KEY, isNowActive);
    } catch (e) {
        console.error("Error saving Compact Grid View state:", e);
    }

    updateCompactGridButton(isNowActive);
}

/**
 * Updates the text and icon of the Compact Grid View button.
 * @param {boolean} isActive - Whether the grid view is currently active.
 */
function updateCompactGridButton(isActive) {
    const gridButton = document.getElementById('compact-grid-toggle-btn');
    if (gridButton) {
        gridButton.innerHTML = isActive ? 'Grid View [PC only]: ON üì±' : 'Grid View [PC only]: OFF üñ•Ô∏è';
    }
}

/**
 * Reads the saved state from local storage and applies it when the page loads.
 */
function applySavedCompactGridView() {
    // Only apply this layout on larger screens
    if (window.matchMedia("(min-width: 1024px)").matches) {
        const isSaved = localStorage.getItem(COMPACT_GRID_KEY) === 'true';
        if (isSaved) {
            document.body.classList.add('compact-grid-active');
        }
        updateCompactGridButton(isSaved);
    }
}


// Add the initialization call to your main page load event
document.addEventListener('DOMContentLoaded', () => {
    applySavedCompactGridView();
    reorderFloatingButtons(); // Re-run reordering to include the new button
});

/* =================================================== */
/*          END: NEW COMPACT GRID VIEW SCRIPT          */
/* =================================================== */

/* =================================================== */
/*    START: UNIFIED COLOR & LAYOUT MODE SCRIPT (UPDATED)   */
/* =================================================== */

// --- CONSTANTS ---
const BRIGHTNESS_STORAGE_KEY = 'stealthBrightness';
const COLOR_TOGGLE_KEY = 'colorModeState'; // Stores 'stealth', 'soft', 'muted-grit', 'cry-babes', or 'none'
const LAYOUT_TOGGLE_KEY = 'expandedViewEnabled';
const MOBILE_LAYOUT_KEY = 'mobileOldLayoutEnabled'; // <-- NEW
const DEFAULT_BRIGHTNESS = '0.7';

// --- NEW FUNCTIONS for Mobile Layout ---
function toggleMobileLayoutMode() {
    const body = document.body;
    const isCurrentlyOld = body.classList.toggle('mobile-old-layout');
    try {
        localStorage.setItem(MOBILE_LAYOUT_KEY, isCurrentlyOld);
    } catch (e) {
        console.error("Error saving mobile layout mode:", e);
    }
    updateMobileLayoutButton(isCurrentlyOld);
}

function updateMobileLayoutButton(isOldLayout) {
    const button = document.getElementById('mobile-layout-toggle-btn');
    if (button) {
        button.innerHTML = isOldLayout ? 'Mobile Old: ON ‚è™' : 'Mobile Old: OFF üì±';
    }
}

// --- EXISTING LOGIC (Functions are the same) ---

function updateStealthBrightness(value) {
    const body = document.body;
    body.style.setProperty('--stealth-brightness', value);
    try { localStorage.setItem(BRIGHTNESS_STORAGE_KEY, value); } catch (e) { console.error("Error saving brightness:", e); }
}

function updateFloatingColorButtonLabels(currentState) {
    const stealthLabel = document.getElementById('stealth-mode-label');
    const softButton = document.getElementById('soft-mode-toggle-btn');
    const gritButton = document.getElementById('grit-mode-toggle-btn');
    const cryBabesButton = document.getElementById('cry-babes-toggle-btn');
    
    if (stealthLabel) {
        stealthLabel.innerHTML = currentState === 'stealth' ? 'Stealth Mode: ON üï∂Ô∏è' : 'Stealth Mode: OFF üåà';
    }
    if (softButton) {
        softButton.innerHTML = currentState === 'soft' ? 'Soft Mode: ON üå∏' : 'Soft Mode: OFF üå∏';
    }
    if (gritButton) {
        gritButton.innerHTML = currentState === 'muted-grit' ? 'Grit Mode: ON üíÄ' : 'Grit Mode: OFF üíÄ';
    }
    if (cryBabesButton) {
        cryBabesButton.innerHTML = currentState === 'cry-babes' ? 'Codes Only Mode: ON üë∂' : 'Codes Only Mode: OFF üë∂';
    }
}

function handleColorModeToggle(mode) {
    const body = document.body;
    const sliderControl = document.getElementById('stealth-brightness-control');
    const currentClass = body.classList.contains(`stealth-mode`) ? 'stealth' :
                         body.classList.contains(`soft-mode`) ? 'soft' :
                         body.classList.contains(`muted-grit-mode`) ? 'muted-grit' :
                         body.classList.contains(`cry-babes-mode`) ? 'cry-babes' : 'none';

    const newState = (currentClass === mode) ? 'none' : mode;

    body.classList.remove('stealth-mode', 'soft-mode', 'muted-grit-mode', 'cry-babes-mode');
    if (newState !== 'none') {
        body.classList.add(`${newState}-mode`);
    }

    if (newState === 'stealth') {
        sliderControl.classList.add('is-visible');
    } else {
        sliderControl.classList.remove('is-visible');
    }
    
    try { localStorage.setItem(COLOR_TOGGLE_KEY, newState); } catch (e) { console.error("Error saving color mode state:", e); }
    updateFloatingColorButtonLabels(newState);
}


// --- INITIALIZATION (Updated) ---
function applySavedCombinedMode() {
    const body = document.body;
    const slider = document.getElementById('stealth-slider');
    const sliderControl = document.getElementById('stealth-brightness-control');
    const layoutButton = document.getElementById('pc-view-toggle');
    
    // 1. Apply Color Mode State
    const savedColorState = localStorage.getItem(COLOR_TOGGLE_KEY) || 'none';
    body.classList.remove('stealth-mode', 'soft-mode', 'muted-grit-mode', 'cry-babes-mode');
    if (savedColorState !== 'none') {
        body.classList.add(`${savedColorState}-mode`);
    }

    const savedBrightness = localStorage.getItem(BRIGHTNESS_STORAGE_KEY) || DEFAULT_BRIGHTNESS;
    if(slider) slider.value = savedBrightness;
    
    // 2. Apply Layout Mode (PC View)
    const isSavedLayoutMode = localStorage.getItem(LAYOUT_TOGGLE_KEY) === 'true';
    if (window.matchMedia("(min-width: 900px)").matches) {
        if (isSavedLayoutMode) {
            body.classList.add('expanded-view');
            layoutButton.textContent = 'Wide Mode [PC only]: ON üíª';
        }
    } else {
        body.classList.remove('expanded-view');
        layoutButton.textContent = 'Wide Mode [PC only]: OFF üñ•Ô∏è';
    }

    // 3. APPLY SAVED MOBILE LAYOUT MODE <-- NEW
    const isSavedOldMobile = localStorage.getItem(MOBILE_LAYOUT_KEY) === 'true';
    if (isSavedOldMobile) {
        document.body.classList.add('mobile-old-layout');
    }
    updateMobileLayoutButton(isSavedOldMobile);
    
    // 4. Update Labels AND Reorder Buttons
    updateFloatingColorButtonLabels(savedColorState);
    reorderFloatingButtons();
}


// --- GLOBAL/SHARED FUNCTIONS ---
function toggleCombinedPanel() {
    const panel = document.getElementById('combined-panel');
    if (panel) {
        panel.classList.toggle('is-open');
    }
}
function toggleLayoutMode() {
    const body = document.body;
    const layoutButton = document.getElementById('pc-view-toggle');
    const isCurrentlyExpanded = body.classList.toggle('expanded-view');
    try {
        localStorage.setItem(LAYOUT_TOGGLE_KEY, isCurrentlyExpanded);
    } catch (e) {
        console.error("Error saving layout mode state:", e);
    }
    if (layoutButton) {
        layoutButton.textContent = isCurrentlyExpanded ? 'Wide Mode [PC only]: ON üíª' : 'Wide Mode [PC only]: OFF üñ•Ô∏è';
    }
}

// --- DOMContentLoaded LISTENER ---
document.addEventListener('DOMContentLoaded', () => {
    // 1. Initialize combined mode settings
    applySavedCombinedMode();
    
    // 2. Attach listener to the Combined Panel Trigger Button
    const combinedToggleBtn = document.getElementById('combined-toggle-btn');
    if (combinedToggleBtn) {
        combinedToggleBtn.addEventListener('click', toggleCombinedPanel);
    }
    
    // 3. Ensure the saved Cry Babes state is reflected immediately
    const savedColorState = localStorage.getItem(COLOR_TOGGLE_KEY) || 'none';
    updateFloatingColorButtonLabels(savedColorState);
    
    // ... (The rest of your other script initializations would follow here) ...
});
/* =================================================== */
/*     END: UNIFIED COLOR & LAYOUT MODE SCRIPT (v3)    */
/* =================================================== */
/* =================================================== */
/*     END: UNIFIED COLOR & LAYOUT MODE SCRIPT         */
/* =================================================== */

// Extract key from page content
function extractKeyFromPage() {
    const keyPattern = /[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}/;
    const match = document.body.textContent.match(keyPattern);
    return match ? match[0] : null;
}

// Local storage functions
function saveReportedStatus(code, isReported) {
    try {
        const reportedCodes = JSON.parse(localStorage.getItem('shiftReportedCodes')) || {};
        reportedCodes[code] = isReported;
        localStorage.setItem('shiftReportedCodes', JSON.stringify(reportedCodes));
    } catch (e) { 
        console.error("Error saving reported status:", e); 
    }
}

function getReportedStatus(code) {
    try {
        const reportedCodes = JSON.parse(localStorage.getItem('shiftReportedCodes')) || {};
        return reportedCodes[code] || false;
    } catch (e) { 
        console.error("Error reading reported status:", e); 
        return false; 
    }
}


// UI Functions
function showKeyAlreadyReported() {
    const reportBtn = document.querySelector('#report-button');
    if (reportBtn) {
        reportBtn.disabled = true;
        reportBtn.textContent = 'Already Reported';
        reportBtn.style.backgroundColor = '#6b7280';
    }
    
    const statusDiv = document.createElement('div');
    statusDiv.innerHTML = `
        <strong>‚úÖ This key has already been reported</strong>
        <br><small>Other users can see that this key is no longer valid</small>
    `;
    statusDiv.style.cssText = 'background: #dcfce7; color: #166534; padding: 10px; border-radius: 4px; margin: 10px 0; border: 1px solid #bbf7d0;';
    
    const keyElement = document.querySelector('.key-display') || document.querySelector('code') || document.querySelector('pre');
    if (keyElement) {
        keyElement.parentNode.insertBefore(statusDiv, keyElement.nextSibling);
    }
}

function enableReportingUI() {
    const reportBtn = document.querySelector('#report-button');
    if (reportBtn) {
        reportBtn.disabled = false;
        reportBtn.textContent = 'Report as Used/Broken';
        reportBtn.style.backgroundColor = '#ef4444';
        reportBtn.onclick = () => {
            const key = extractKeyFromPage();
            if (key) {
                reportCode(key, reportBtn);
            }
        };
    }
}

// Page initialization
async function initializePage() {
    const currentKey = extractKeyFromPage();
    
    if (currentKey && isKeyReported(currentKey)) {
        showKeyAlreadyReported();
    } else {
        enableReportingUI();
    }
}

// Event listeners and modal functions
function setupEventListeners() {
    const zoomInButton = document.getElementById('zoom-in-btn');
    const zoomOutButton = document.getElementById('zoom-out-btn');
    const resetZoomButton = document.getElementById('reset-zoom-btn');
    const closeButton = document.getElementById('close-preview-btn');

    if (zoomInButton) zoomInButton.addEventListener('click', zoomIn);
    if (zoomOutButton) zoomOutButton.addEventListener('click', zoomOut);
    if (resetZoomButton) resetZoomButton.addEventListener('click', resetZoom);

    const newCloseButton = document.getElementById('close-preview-btn');
    if (newCloseButton) newCloseButton.addEventListener('click', closeImagePreview);
    
    const modal = document.getElementById('image-preview-modal');
    if(modal) {
        modal.addEventListener('click', function(e) {
            if (e.target.id === 'image-preview-modal') {
                closeImagePreview();
            }
        });
    }
}

let currentReportCode = '';

// Open report modal
function openReportModal(code) {
    currentReportCode = code;
    const modal = document.getElementById('report-modal');
    modal.style.display = 'flex';
    
    // Reset form and clear errors
    document.getElementById('report-form').reset();
    clearValidationErrors();
    
    // Set focus to first field
    document.getElementById('issue-type').focus();
}

// Close report modal
function closeReportModal() {
    const modal = document.getElementById('report-modal');
    modal.style.display = 'none';
    currentReportCode = '';
    clearValidationErrors();
}

// Clear validation errors
function clearValidationErrors() {
    document.querySelectorAll('.error-message').forEach(error => {
        error.style.display = 'none';
    });
    document.querySelectorAll('.form-group input, .form-group select, .form-group textarea').forEach(field => {
        field.style.borderColor = '#ddd';
    });
}

// Show validation error
function showError(fieldId, message) {
    const field = document.getElementById(fieldId);
    const errorElement = field.parentNode.querySelector('.error-message') || createErrorElement(field.parentNode);
    
    field.style.borderColor = '#dc3545';
    errorElement.textContent = message;
    errorElement.style.display = 'block';
}

// Create error element if it doesn't exist
function createErrorElement(parent) {
    const errorElement = document.createElement('div');
    errorElement.className = 'error-message';
    parent.appendChild(errorElement);
    return errorElement;
}

// Hide error
function hideError(fieldId) {
    const field = document.getElementById(fieldId);
    const errorElement = field.parentNode.querySelector('.error-message');
    if (errorElement) {
        errorElement.style.display = 'none';
        field.style.borderColor = '#ddd';
    }
}

// Enhanced validation
function validateForm(formData) {
    let isValid = true;
    
    // Validate issue type
    if (!formData.issueType) {
        showError('issue-type', 'Please select an issue type');
        isValid = false;
    } else {
        hideError('issue-type');
    }
    
    // Validate description
    if (!formData.description || formData.description.trim().length < 10) {
        showError('issue-description', 'Please provide a detailed description (at least 10 characters)');
        isValid = false;
    } else {
        hideError('issue-description');
    }
    
    // Validate proof link
    if (!formData.proofLink) {
        showError('proof-link', 'Proof link is required');
        isValid = false;
    } else if (!isValidUrl(formData.proofLink)) {
        showError('proof-link', 'Please enter a valid URL (https://example.com)');
        isValid = false;
    } else {
        hideError('proof-link');
    }
    
    return isValid;
}

// URL validation
function isValidUrl(string) {
    try {
        new URL(string);
        return true;
    } catch (_) {
        return false;
    }
}

// Handle form submission
function handleReportSubmit(event) {
    event.preventDefault();
    
    const formData = {
        code: currentReportCode,
        reporterName: document.getElementById('reporter-name').value.trim(),
        issueType: document.getElementById('issue-type').value,
        description: document.getElementById('issue-description').value.trim(),
        proofLink: document.getElementById('proof-link').value.trim(),
        timestamp: new Date().toISOString()
    };
    
    // Enhanced validation - all these should still be required
    if (!validateForm(formData)) {
        // Scroll to first error
        const firstError = document.querySelector('.error-message[style*="display: block"]');
        if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
    }
    
    // Submit the report
    submitDetailedReport(formData);
}

function validateForm(formData) {
    let isValid = true;
    
    // Validate issue type
    if (!formData.issueType) {
        showError('issue-type', 'Please select an issue type');
        isValid = false;
    } else {
        hideError('issue-type');
    }
    
    // Validate description
    if (!formData.description || formData.description.trim().length < 10) {
        showError('issue-description', 'Please provide a detailed description (at least 10 characters)');
        isValid = false;
    } else {
        hideError('issue-description');
    }
    
    // Validate proof link
    if (!formData.proofLink) {
        showError('proof-link', 'Proof link is required');
        isValid = false;
    } else if (!isValidUrl(formData.proofLink)) {
        showError('proof-link', 'Please enter a valid URL (https://example.com)');
        isValid = false;
    } else {
        hideError('proof-link');
    }
    
    return isValid;
}

// Rest of your existing functions remain the same...
function updateButtonToReported(code) {
    const buttons = document.querySelectorAll('.report-btn-corner');
    buttons.forEach(btn => {
        if (btn.onclick && btn.onclick.toString().includes(code)) {
            btn.innerHTML = '‚úîÔ∏è';
            btn.title = 'Reported! Thank you.';
            btn.classList.add('reported');
            btn.disabled = true;
            btn.onclick = null;
        }
    });
    
    saveReportedStatus(code, true);
}

function showReportSuccess() {
    const modal = document.getElementById('report-success-modal');
    if (modal) {
        modal.classList.add('show');
        setTimeout(() => { modal.classList.remove('show'); }, 3000);
    }
}

/////////////////////////////////////////
/////////////////////////////////////////
/////////////////////////////////////////

// Code submission modal functions
// New function to add a code input row
function addCodeInput() {
    const container = document.getElementById('shift-code-container');
    const newRow = document.createElement('div');
    newRow.className = 'code-input-row';

    const input = document.createElement('input');
    input.type = 'text';
    input.className = 'shift-code-input'; // Use a class for easy selection
    input.placeholder = 'XXXXX-XXXXX-XXXXX-XXXXX-XXXXX';
    input.required = true;

    const removeBtn = document.createElement('button');
    removeBtn.type = 'button'; // Prevent form submission
    removeBtn.className = 'code-action-btn remove';
    removeBtn.textContent = '-';
    removeBtn.onclick = () => newRow.remove();

    newRow.appendChild(input);
    newRow.appendChild(removeBtn);
    container.appendChild(newRow);
}

// Code submission modal functions
// **FINAL, CORRECTED FUNCTION**
function openCodeSubmitModal() {
    document.getElementById('submit-message').style.display = 'none';
    document.getElementById('submit-description').value = '';
    document.getElementById('submit-purpose').value = '';
    document.getElementById('submit-platform').value = '';
        document.getElementById('submit-expiry-date').value = ''; 
    document.getElementById('submit-code-source').value = ''; 
    document.getElementById('submit-username').value = '';
    
    // **FIXED**: Only clear the container, and then insert the first input row.
    const container = document.getElementById('shift-code-container');
    
    // Clear the container (removes all previously added code input rows)
    container.innerHTML = '';
    
    // Manually insert the very first row with the '+' button
    const initialRow = document.createElement('div');
    initialRow.className = 'code-input-row';
    // Note: Removed ID='submit-code' as it's no longer needed for a single code input
    initialRow.innerHTML = `
        <input type="text" class="shift-code-input" placeholder="XXXXX-XXXXX-XXXXX-XXXXX-XXXXX" required>
        <button type="button" class="code-action-btn add" onclick="addCodeInput()">+</button>
    `;
    container.appendChild(initialRow);

    document.getElementById('submit-modal-overlay').style.display = 'flex';
}

function closeCodeSubmitModal() {
    document.getElementById('submit-modal-overlay').style.display = 'none';
}

// Significantly updated submission function
// Significantly updated submission function (Unchanged from your previous correct version)
function submitCode() {
    const description = document.getElementById('submit-description').value.trim();
    const purpose = document.getElementById('submit-purpose').value;
    const platform = document.getElementById('submit-platform').value;
    const username = document.getElementById('submit-username').value.trim();
    const expiryDate = document.getElementById('submit-expiry-date').value.trim();
    const codeSource = document.getElementById('submit-code-source').value.trim();
    const messageDiv = document.getElementById('submit-message');

    // **NEW**: Collect all code inputs
    const codeInputs = document.querySelectorAll('.shift-code-input');
    const codes = [];
    let allCodesValid = true;
    let anyCodeIsEmpty = false;
    const shiftCodePattern = /^[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}$/i;

    codeInputs.forEach(input => {
        const codeValue = input.value.trim().toUpperCase();
        
        if (codeValue) {
            if (shiftCodePattern.test(codeValue)) {
                codes.push(codeValue);
            } else {
                allCodesValid = false;
            }
        } else {
            // A code input row exists, but the value is empty
            anyCodeIsEmpty = true; 
        }
    });

    // --- 1. CRITICAL VALIDATION FIX ---
    if (!description || !purpose || !platform || !username) {
        messageDiv.textContent = 'Please fill out ALL required fields marked with a red asterisk (**).';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        return;
    }
    
    // --- 2. CODE COUNT VALIDATION ---
    if (codes.length === 0) {
        messageDiv.textContent = 'Please enter at least one SHiFT code.';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        return;
    }

    // --- 3. CODE FORMAT VALIDATION ---
    if (!allCodesValid) {
        messageDiv.textContent = 'One or more codes are in an invalid format. Please use: XXXXX-XXXXX-XXXXX-XXXXX-XXXXX';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        return;
    }
    
    // --- 4. DUPLICATE CHECK ---
    if (purpose === 'public_use') {
        // Assuming ALL_CODES_CONFIG and PERMANENT_CODES are defined globally
        const allExistingCodes = [...ALL_CODES_CONFIG, ...PERMANENT_CODES].map(c => c.code.toUpperCase());
        const duplicates = codes.filter(c => allExistingCodes.includes(c));
        if (duplicates.length > 0) {
            messageDiv.textContent = `The following code(s) are already on the list: ${duplicates.join(', ')}`;
            messageDiv.className = 'submit-error';
            messageDiv.style.display = 'block';
            return;
        }
    }

    // --- SUBMISSION ---
    const webhookUrl = "https://discord.com/api/webhooks/1427252615942770783/ODC4nIRGAlupTRTwtlYXGDUyeZlvUz5cnr-6ATlf6KDeCP5hJo_MSf3x9DyNUrMdY56P";
    const purposeMap = { 'public_use': 'Public Use', 'smash_only': 'Smash (One time use)' };
    const platformMap = { 'multi_platform': 'Multi Platform', 'xbox_only': 'Xbox', 'playstation_only': 'PlayStation', 'steam_only': 'Steam' };

    // Format codes for Discord embed
    const formattedCodes = "```\n" + codes.join("\n") + "\n```";

    // Build the core fields array
    const fields = [
        { name: "Description", value: description },
        { name: `Submitted Code(s) (${codes.length})`, value: formattedCodes },
        { name: "Code Purpose", value: purposeMap[purpose] || purpose },
        { name: "Platform", value: platformMap[platform] || platform },
        { name: "Submitted By", value: username }
    ];
    
    // Append optional fields only if they have a value
    if (expiryDate) {
        fields.push({ name: "Expiration Date", value: expiryDate, inline: true });
    }
    if (codeSource) {
        fields.push({ name: "Code Source", value: codeSource, inline: true });
    }

    const embed = {
        title: "üì¨ New SHiFT Code Submission!",
        color: 5814783,
        fields: fields, // Use the new fields array
        timestamp: new Date().toISOString()
    };

    fetch(webhookUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ embeds: [embed] })
    });

    messageDiv.textContent = 'Success! Your code(s) have been submitted. Thank you!';
    messageDiv.className = 'submit-success';
    messageDiv.style.display = 'block';

    setTimeout(closeCodeSubmitModal, 3000);
}


// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', async () => {
    console.log('üöÄ Starting initialization...');
    
    
    // Initialize page if version check passes
    if (!checkCodesVersion()) {
        initializePage();
    }
    
    setupEventListeners();
});

// ADD THESE THREE NEW FUNCTIONS to your main script tag     



function extractKeyFromPage() {
    // This depends on your page structure - adjust accordingly
    // Example: look for elements containing the key pattern
    const keyPattern = /[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}/;
    
    // Try different selectors where your key might be displayed
    const possibleElements = [
        document.body.textContent.match(keyPattern),
        document.querySelector('code')?.textContent,
        document.querySelector('pre')?.textContent
    ];
    
    for (let element of possibleElements) {
        if (element && keyPattern.test(element)) {
            const match = element.match(keyPattern);
            return match ? match[0] : null;
        }
    }
    
    return null;
}

async function submitDetailedReport(formData) {
    const submitBtn = document.querySelector('#report-form .btn-submit');
    const originalText = submitBtn.textContent;
    
    try {
        submitBtn.textContent = 'Submitting...';
        submitBtn.disabled = true;
        
        const discordWebhookUrl = "https://discord.com/api/webhooks/1428465379558035606/KKxolbs4Ej4Tosts9FTINR-czL1HuiCd_ZWeT_jFlOGGKQeSqySm6dknuTwBnfSIxUnK";

        const embed = {
            title: "üìã Detailed SHiFT Code Report",
            color: 0xff4444,
            fields: [
                {
                    name: "Reported Code",
                    value: `\`\`\`${formData.code}\`\`\``,
                    inline: false
                },
                {
                    name: "Issue Type",
                    value: formData.issueType || "Not specified",
                    inline: true
                },
                {
                    name: "Reporter",
                    value: formData.reporterName || "Anonymous",
                    inline: true
                },
                {
                    name: "Description",
                    value: formData.description || "No description provided",
                    inline: false
                },
                {
                    name: "Proof Link",
                    value: formData.proofLink || "No proof provided",
                    inline: false
                },
                {
                    name: "Timestamp",
                    value: new Date(formData.timestamp).toLocaleString() || new Date().toLocaleString(),
                    inline: true
                }
            ],
            timestamp: new Date().toISOString(),
            footer: {
                text: "SHiFT Code Tracker - Detailed Report"
            }
        };

        const response = await fetch(discordWebhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ embeds: [embed] })
        });

        if (response.ok) {
            console.log('‚úÖ Detailed report submitted to Discord:', formData);
            
            // Update UI
            updateButtonToReported(formData.code);
            
            // Close modal and show success
            closeReportModal();
            showReportSuccess();
            
        } else {
            throw new Error('Failed to submit to Discord');
        }
    } catch (error) {
        console.error('‚ùå Failed to submit detailed report:', error);
        alert('Failed to submit report. Please try again.');
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
}


// Your existing openKofiModal function
function openKofiModal() {
    const kofiModal = document.getElementById('kofi-modal-overlay');
    const kofiModalContent = kofiModal ? kofiModal.querySelector('.modal-content') : null;
    const kofiIframeContainer = document.getElementById('kofi-iframe-container');
    
    if (!kofiModal || !kofiIframeContainer || !kofiModalContent) return;

    // 1. Manually set a MINIMUM size on the modal-content to ensure the Ko-fi content is visible
    // These sizes are reasonable for the Ko-fi embedded widget.
    kofiModalContent.style.minWidth = '400px'; 
    kofiModalContent.style.minHeight = '800x'; 

    // 2. Inject the iframe
    kofiIframeContainer.innerHTML = `
        <iframe 
            id='kofiframe' 
            src='https://ko-fi.com/xsmashx88x/?hidefeed=true&widget=true&frame=true' 
            style='border:none;width:100%;height:100%;padding:0;margin:0;' 
            title='xsmashx88x'
            allow='clipboard-write'>
        </iframe>`;
            
    // 3. Display the modal
    kofiModal.style.display = 'flex'; 
}

// ... You also need a function to close the modal ...

function closeKofiModal() {
    const kofiModal = document.getElementById('kofi-modal-overlay');
    if (kofiModal) {
        kofiModal.style.display = 'none';
        // Optional: Remove iframe content to stop playback/save memory
        document.getElementById('kofi-iframe-container').innerHTML = '';
    }
}


// NEW, DEDICATED function to clear Black Market statuses
function clearBlackMarketStatusOnReset() {
    try {
        console.log("A weekly reset has been detected. Clearing Black Market redemption statuses...");
        const redeemedCodes = JSON.parse(localStorage.getItem('shiftRedeemedCodes')) || {};

        // Loop through the vendor config and remove each corresponding key
        BLACK_MARKET_VENDORS.forEach((vendorData, index) => {
            const uniqueId = vendorData.code.replace(/\s+/g, '-') + '-' + index;
            if (redeemedCodes.hasOwnProperty(uniqueId)) {
                delete redeemedCodes[uniqueId];
                console.log(`Removed status for: ${uniqueId}`);
            }
        });

        // Save the cleaned object back to localStorage
        localStorage.setItem('shiftRedeemedCodes', JSON.stringify(redeemedCodes));
    } catch (e) {
        console.error("Error during Black Market status cleanup:", e);
    }
}        

// Function to toggle the main container
function toggleOptionsContainer(titleElement) {
    const container = titleElement.closest('.site-options-container');
    if (container) {
        container.classList.toggle('is-open');
    }
}

// Function to manage the content panels, ensuring only one is open at a time
function toggleOptionPanel(sectionIdToShow) {
    const panelIds = ['settings-section', 'info-section', 'changelog-section', 'redeem-section'];
    const targetPanel = document.getElementById(sectionIdToShow);
    if (!targetPanel) return;
    const isAlreadyOpen = targetPanel.classList.contains('show');
    panelIds.forEach(id => {
        const panel = document.getElementById(id);
        if (panel) {
            panel.classList.remove('show');
            saveSectionState(id, false);
        }
    });
    if (!isAlreadyOpen) {
        targetPanel.classList.add('show');
        saveSectionState(sectionIdToShow, true);
    }
}

        // === START: NEW FUNCTION TO CLEAR HIGHLIGHT ===

function clearLastCopied() {
    try {
        // Remove the ID from browser memory
        localStorage.removeItem('lastCopiedCodeId');
        
        // Find whichever element currently has the highlight and remove the class
        const highlightedBox = document.querySelector('.last-copied');
        if (highlightedBox) {
            highlightedBox.classList.remove('last-copied');
        }
    } catch (e) {
        console.error("Error clearing last copied state:", e);
    }
}

// === END: NEW FUNCTION ===

// === START: NEW FUNCTIONS FOR LAST COPIED ===

function setLastCopied(codeId) {
    try {
        localStorage.setItem('lastCopiedCodeId', codeId);
        // First, remove the highlight from any element that might have it
        document.querySelectorAll('.last-copied').forEach(el => el.classList.remove('last-copied'));
        // Then, find the specific element we just copied and add the highlight
        const newLastCopiedBox = document.querySelector(`[data-code-id="${codeId}"]`);
        if (newLastCopiedBox) {
            newLastCopiedBox.classList.add('last-copied');
        }
    } catch (e) { console.error("Error in setLastCopied:", e); }
}

function applyLastCopiedState() {
    try {
        const lastCopiedId = localStorage.getItem('lastCopiedCodeId');
        if (lastCopiedId) {
            // This runs on page load to find and highlight the saved item
            const element = document.querySelector(`[data-code-id="${lastCopiedId}"]`);
            if (element) {
                element.classList.add('last-copied');
            }
        }
    } catch (e) { console.error("Error applying last copied state:", e); }
}

// === END: NEW FUNCTIONS ===        

// ADD THESE TWO NEW FUNCTIONS

// === START: NEW FUNCTIONS FOR SAVING STATE ===

/**
 * Saves the open/closed state of a specific section to localStorage.
 * @param {string} sectionId - The ID of the section (e.g., 'info-section').
 * @param {boolean} isOpen - True if the section is open, false if closed.
 */
function saveSectionState(sectionId, isOpen) {
    try {
        const sectionStates = JSON.parse(localStorage.getItem('sectionStates')) || {};
        sectionStates[sectionId] = isOpen;
        localStorage.setItem('sectionStates', JSON.stringify(sectionStates));
    } catch (e) {
        console.error("Error saving section state:", e);
    }
}

/**
 * Reads the saved states from localStorage and applies them when the page loads.
 */
function applySavedSectionStates() {
    try {
        const savedStates = JSON.parse(localStorage.getItem('sectionStates')) || {};
        for (const sectionId in savedStates) {
            const section = document.getElementById(sectionId);
            const isOpen = savedStates[sectionId];
            if (section && isOpen) {
                section.classList.add('show');
            }
        }
    } catch (e) {
        console.error("Error applying saved section states:", e);
    }
}
// === END: NEW FUNCTIONS ===     


/* =================================================== */
/*           FIX: POLL IMAGE PREVIEW HANDLER           */
/* =================================================== */
/**
 * This special function handles clicks on poll image thumbnails.
 * 1. It stops the click event from "bubbling up" and closing the poll modal.
 * 2. It then calls the normal openImagePreview function to show the image.
 */
function openPollImagePreview(event, url) {
    event.stopPropagation(); 
    openImagePreview(url);
}

// --- NEW FUNCTION: Dynamically show/hide and set 'required' for text input ---
function handleRadioWithTextChange(questionId) {
    const radios = document.querySelectorAll(`input[name="${questionId}"]`);
    // Assuming the text input ID is constructed as: questionId + '_details'
    const textInputEl = document.getElementById(`${questionId}_details`); 
    
    // Find the question config to check if it's requiredIfYes
    const questionConfig = POLL_QUESTIONS.find(q => q.id === questionId);
    
    if (textInputEl && questionConfig && questionConfig.textInput) {
        let isYesSelected = false;
        radios.forEach(radio => {
            if (radio.checked && radio.value === "Yes") { // Check if "Yes" is selected
                isYesSelected = true;
            }
        });

        if (isYesSelected) {
            textInputEl.style.display = 'block';
            if (questionConfig.textInput.requiredIfYes) {
                textInputEl.setAttribute('required', 'true');
            }
        } else {
            textInputEl.style.display = 'none';
            textInputEl.removeAttribute('required');
            textInputEl.value = ''; // Clear text if hiding
            textInputEl.classList.remove('invalid'); // Remove invalid state if cleared/hidden
        }
    }
}


/* =================================================== */
/* START: STANDALONE POLL MODAL SCRIPT (FINAL, ROBUST FIX) */
/* =================================================== */
document.addEventListener('DOMContentLoaded', () => {
    
    // --- 0. Config and Element Setup ---
    const openPollBtn = document.getElementById('openPollBtn'); 
    
    // NOTE: POLL_CONFIG and POLL_QUESTIONS MUST be defined globally (in a <script> tag before this one)
    if (typeof POLL_CONFIG === 'undefined' || !POLL_CONFIG.isEnabled) {
        if (openPollBtn) openPollBtn.style.display = 'none';
        return; 
    }
    if (openPollBtn) { openPollBtn.style.display = 'block'; }
    
    const pollModal = document.getElementById('pollModal');
    const closePollBtn = document.getElementById('closePollBtn');
    const pollForm = document.getElementById('poll-form');
    const pagesContainer = document.getElementById('poll-pages-container');
    const pollThankYouPage = document.getElementById('poll-thank-you-page');
    const pollPrevBtn = document.getElementById('poll-nav-prev-btn');
    const pollNextBtn = document.getElementById('poll-nav-next-btn'); // Correct Element ID
    const pollSubmitBtn = document.getElementById('poll-nav-submit-btn');
    const stepIndicator = document.getElementById('poll-step-indicator');
    
    if (!pollModal || !pagesContainer) {
        console.error("Poll Modal HTML structure not found. Cannot initialize.");
        return;
    }
    
    const activeQuestions = POLL_QUESTIONS.filter(q => q.active !== false);

    const questionsByPage = activeQuestions.reduce((acc, q) => {
        const pageNum = q.page || 1;
        if (!acc[pageNum]) acc[pageNum] = [];
        acc[pageNum].push(q);
        return acc;
    }, {});

    const pageNumbers = Object.keys(questionsByPage).map(Number).sort((a, b) => a - b);
    const totalPages = pageNumbers.length;
    let currentPageIndex = 0;

    // ---------------------------------------------------------------------------------
    // --- QUESTION GENERATION FUNCTION (VITAL) ---
    // ---------------------------------------------------------------------------------
    const generatePollHtml = () => {
        let allPagesHtml = '';
        
        pageNumbers.forEach((pageNum, index) => {
            let pageContentHtml = '';
            
            questionsByPage[pageNum].forEach(q => {
                const isRequired = q.required ? 'required' : '';
                const titleText = `${q.title}${q.required ? ' *' : ''}`;

                pageContentHtml += `<p class="page-title">${titleText}</p>`;
                if (q.subtitle) pageContentHtml += `<p class="page-subtitle">${q.subtitle}</p>`;
                
                pageContentHtml += `<div class="form-group">`;
                
                // --- MODIFIED BLOCK STARTS HERE ---
                if (q.type === 'radio' || q.type === 'radio-with-text') { // Check for both types
                    pageContentHtml += `<div class="radio-group vertical" data-required="${q.id}">`;
                    q.options.forEach(opt => {
                        const imageHtml = opt.image ? 
                            ` <a href="javascript:void(0);" onclick="openPollImagePreview(event, '${opt.image}')">
                                <img src="${opt.image}" class="poll-thumbnail" alt="${opt.text}">
                            </a>` : '';
                        
                        pageContentHtml += `
                            <label>
                                <input type="radio" name="${q.id}" value="${opt.value}" ${isRequired} onchange="handleRadioWithTextChange('${q.id}')">
                                <span>${opt.text}${imageHtml}</span>
                            </label>
                        `;
                    });
                    pageContentHtml += `</div>`;

                    // Add the text input field if the type is "radio-with-text"
                    if (q.type === 'radio-with-text' && q.textInput) {
                        // The 'required' attribute will be handled dynamically by handleRadioWithTextChange
                        pageContentHtml += `
                            <textarea 
                                id="${q.textInput.id}" 
                                name="${q.textInput.id}" 
                                rows="2" 
                                placeholder="${q.textInput.placeholder}" 
                                class="poll-text-input"
                                style="display: none; margin-top: 10px;" 
                            ></textarea>
                        `;
                    }

                } 
                // --- MODIFIED BLOCK ENDS HERE ---
                else if (q.type === 'textarea') {
                    pageContentHtml += `<textarea id="${q.id}" name="${q.id}" rows="3" placeholder="${q.placeholder || ''}" ${isRequired}></textarea>`;
                }
                
                pageContentHtml += `</div><hr style="border: 0; border-top: 1px solid var(--poll-bg-light); margin: 20px 0;">`;
            });
            
            // Add Username field only to the last page of questions
            if (index === totalPages - 1) {
                pageContentHtml += `
                    <div class="form-group" style="margin-top: 30px;">
                        <label for="poll-username">List One Username (Optional)<br>Might msg you an talk about layout</label>
                        <input type="text" id="poll-username" name="Username" placeholder="Enter your Username (e.g., Discord/twitter/reddit)">
                    </div>
                `;
            } else {
                pageContentHtml = pageContentHtml.replace(/<hr.*>$/, ''); 
            }


            // Wrap the content into a poll-page div. Style it initially hidden.
            allPagesHtml += `
                <div class="poll-page" id="poll-page-${pageNum}" data-page="${pageNum}" style="display: none;">
                    ${pageContentHtml}
                </div>
            `;
        });
        
        if(pagesContainer) pagesContainer.innerHTML = allPagesHtml;
    };
    
    // ---------------------------------------------------------------------------------
    // --- DISCORD PAYLOAD FUNCTION (Collects ALL answers dynamically) ---
    // ---------------------------------------------------------------------------------
    const sendToDiscord = async () => {
        const PLACEHOLDER_CHECK = 'PASTE_YOUR_DISCORD_WEBHOOK_URL_HERE';
        
        if (!POLL_CONFIG.DISCORD_WEBHOOK_URL || POLL_CONFIG.DISCORD_WEBHOOK_URL.includes(PLACEHOLDER_CHECK) || POLL_CONFIG.DISCORD_WEBHOOK_URL.trim() === '') {
            console.error("Discord Webhook URL is missing in POLL_CONFIG. Data not sent.");
            return;
        }

        const formData = new FormData(pollForm);
        const fields = [];
        let usernameText = 'Anonymous';
        
        activeQuestions.forEach(q => {
            const answer = formData.get(q.id) || "No Answer Given";
            fields.push({
                name: q.title,
                value: `*${answer}*`, 
                inline: false
            });
            
            // --- ADDED: Collect data from the text input if it exists and is relevant ---
            if (q.type === 'radio-with-text' && q.textInput) {
                const textInputValue = formData.get(q.textInput.id) || "No additional details provided";
                // Only add if "Yes" was selected for the radio, or if text was entered anyway
                if (answer === "Yes" || textInputValue.trim() !== "No additional details provided") {
                     fields.push({
                         name: `${q.title} - Details`, // Or a more specific name like "Preferred Layout Details"
                         value: `*${textInputValue}*`,
                         inline: false
                     });
                }
            }
            // --- END ADDED ---
        });
        
        const username = formData.get('Username') || '';
        usernameText = (username.trim() === '' || username.toLowerCase() === 'n/a') ? 'Anonymous' : username;
        fields.push({ name: "Voter Username", value: usernameText, inline: true });


        const payload = {
            embeds: [{
                title: `üó≥Ô∏è New Community Poll Vote (${activeQuestions.length} Questions on ${totalPages} Pages)`,
                color: 16711935, 
                fields: fields,
                footer: {
                    text: `Vote submitted on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}`
                }
            }]
        };

        try {
            await fetch(POLL_CONFIG.DISCORD_WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });
            console.log("Poll data successfully sent to Discord.");
        } catch (error) {
            console.error("Error sending data to Discord:", error);
        }
    };

    // ---------------------------------------------------------------------------------
    // --- NAVIGATION AND VALIDATION LOGIC ---
    // ---------------------------------------------------------------------------------
    
    const validateCurrentPollPage = (pageIndex) => {
        const currentPageNum = pageNumbers[pageIndex];
        const currentPageDiv = document.querySelector(`#poll-page-${currentPageNum}`);
        if (!currentPageDiv) return true;

        let allValid = true;
        
        const questionsOnPage = questionsByPage[pageNumbers[pageIndex]];
        
        questionsOnPage.forEach(q => {
            if (q.required) {
                const name = q.id;
                const inputElement = pollForm.querySelector(`[name="${name}"]`);
                
                const radioGroup = inputElement ? inputElement.closest('.radio-group') : null;
                if(radioGroup) radioGroup.classList.remove('invalid');
                if (inputElement) inputElement.classList.remove('invalid');

                if (q.type === 'radio' || q.type === 'radio-with-text') { // Check for both radio types
                    if (!pollForm.querySelector(`input[name="${name}"]:checked`)) {
                        const targetElement = pollForm.querySelector(`[data-required="${name}"]`);
                        if(targetElement) targetElement.classList.add('invalid');
                        allValid = false;
                    }
                } else if (q.type === 'textarea' || q.type === 'input') {
                    if (inputElement && inputElement.value.trim() === '') {
                        inputElement.classList.add('invalid');
                        allValid = false;
                    }
                }
            }
            
            // --- ADDED VALIDATION FOR RADIO-WITH-TEXT TEXT INPUT ---
            if (q.type === 'radio-with-text' && q.textInput) {
                const textInputEl = document.getElementById(q.textInput.id);
                textInputEl.classList.remove('invalid'); // Clear previous invalid state

                if (textInputEl && textInputEl.hasAttribute('required') && textInputEl.value.trim() === '') {
                    textInputEl.classList.add('invalid');
                    allValid = false;
                }
            }
            // --- END ADDED VALIDATION ---
        });
        
        return allValid;
    };
    
    const showPollStep = (index) => {
        const currentPageNum = pageNumbers[index];
        const currentPollPage = document.querySelector(`#poll-page-${currentPageNum}`);
        const thankYouPage = document.getElementById('poll-thank-you-page');
        
        document.querySelectorAll('.poll-page').forEach(page => {
            page.style.display = 'none';
            page.classList.remove('active');
        });

        if (currentPollPage) {
            currentPollPage.style.display = 'block';
            currentPollPage.classList.add('active');
            currentPageIndex = index;

            // --- NEW: Call handleRadioWithTextChange for all radio-with-text questions on the current page ---
            questionsByPage[pageNumbers[index]]?.forEach(q => {
                if (q.type === 'radio-with-text') {
                    handleRadioWithTextChange(q.id);
                }
            });
            // --- END NEW ---

        } else if (index >= totalPages) {
            thankYouPage.style.display = 'block';
            thankYouPage.classList.add('active');
        }

        // Update step indicator
        if (stepIndicator && index < totalPages) {
            stepIndicator.textContent = `Step ${currentPageIndex + 1} of ${totalPages}`;
            stepIndicator.style.display = 'block';
        }
        
        // Update navigation buttons
        pollPrevBtn.style.display = currentPageIndex > 0 && currentPageIndex < totalPages ? 'inline-block' : 'none';
        pollNextBtn.style.display = currentPageIndex < totalPages - 1 ? 'inline-block' : 'none';
        pollSubmitBtn.style.display = currentPageIndex === totalPages - 1 ? 'block' : 'none';
        
        // Final check: Hide all nav elements on the Thank You page or if it's a single page submit
        if (index >= totalPages || totalPages === 1) { 
            pollPrevBtn.style.display = 'none';
            pollNextBtn.style.display = 'none';
        }
        
        // If it is a single page poll, the Next button should be hidden, and Submit should be visible.
        if (totalPages === 1 && currentPageIndex === 0) {
            pollNextBtn.style.display = 'none';
            pollSubmitBtn.style.display = 'block';
        }
        
        if (index >= totalPages) {
            pollSubmitBtn.style.display = 'none';
            if (stepIndicator) stepIndicator.style.display = 'none';
        } else if (pollModal) {
             pollModal.querySelectorAll('.invalid').forEach(el => el.classList.remove('invalid'));
        }
    };
    
    // --- Modal Control Functions ---
    const openPollModal = () => {
        if (!pollModal) return;
        pollModal.style.display = 'flex';
        pollForm.reset();
        currentPageIndex = 0;
        showPollStep(currentPageIndex);
    };

    const closePollModal = () => {
        if (!pollModal) return; // Add null check for pollModal
        pollModal.style.display = 'none';
    };
    
    const showPollThankYou = () => {
        showPollStep(totalPages);
    };


    // ---------------------------------------------------------------------------------
    // --- EVENT LISTENERS ---
    // ---------------------------------------------------------------------------------

    if (openPollBtn) openPollBtn.addEventListener('click', openPollModal); 
    if (closePollBtn) closePollBtn.addEventListener('click', closePollModal);
    
    if (pollModal) { //stop it from being closed
    //    pollModal.addEventListener('click', (e) => {
    //        if (e.target === pollModal) closePollModal();
    //   });
    }
    
    if (pollPrevBtn) {
        pollPrevBtn.addEventListener('click', (e) => {
            e.preventDefault();
            showPollStep(currentPageIndex - 1);
        });
    }

    if (pollNextBtn) {
        pollNextBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (validateCurrentPollPage(currentPageIndex)) {
                showPollStep(currentPageIndex + 1);
            } else {
                const firstInvalid = pollForm.querySelector('.invalid');
                if (firstInvalid) firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });
    }

    if (pollSubmitBtn) {
        pollSubmitBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            
            if (validateCurrentPollPage(currentPageIndex)) {
                
                pollSubmitBtn.disabled = true;
                pollSubmitBtn.textContent = 'Submitting...';

                await sendToDiscord();
                
                showPollThankYou();
            } else {
                const firstInvalid = pollForm.querySelector('.invalid');
                if (firstInvalid) firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            pollSubmitBtn.disabled = false;
            pollSubmitBtn.textContent = 'Submit Vote';
        });
    }
    
    if (pollForm) {
        pollForm.addEventListener('change', (e) => { validateCurrentPollPage(currentPageIndex); });
        pollForm.addEventListener('input', (e) => { 
            if (e.target.hasAttribute('required') && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA')) {
                 validateCurrentPollPage(currentPageIndex);
            }
        });
    }

    // ---------------------------------------------------------------------------------
    // --- INITIALIZATION ---
    // ---------------------------------------------------------------------------------
    
    generatePollHtml(); 
    if (totalPages > 0) {
        showPollStep(0);
    }
});

/* =================================================== */

    // ==========================================================
    // === PASTE THE NEW CLICK LISTENER CODE BLOCK RIGHT HERE ===
    // ==========================================================
document.addEventListener('click', function(event) {
    // Check if the thing that was clicked is INSIDE a code box of any type.
    const isInsideCodeBox = event.target.closest('.code-box, .permanent-code-box, .expired-code-box, .black-market-code-box');

    // If the click was NOT inside a code box, clear the highlight.
    if (!isInsideCodeBox) {
        clearLastCopied();
    }
});
    // ==========================================================


/* mobile image zoom fix maybe */
// ADD THIS code block at the top of your <script> tag

// --- START: Image Preview Zoom ---
function zoomIn() {
    if (panzoomInstance) {
        panzoomInstance.zoomIn();
    }
}
// --- END: Image Preview Zoom ---

// --- SCRIPT FOR FLOATING SHARE BUTTON (CORRECTED) ---
// START: FINAL SHARE BUTTON JAVASCRIPT - DELETE ALL PREVIOUS VERSIONS
document.addEventListener('DOMContentLoaded', function() {
    // Look for the new, unique ID
    const shareIshButton = document.getElementById('share-ish-button');
    const shareIshMenu = document.getElementById('share-ish-menu');

    if (shareIshButton && shareIshMenu) {
        // This runs ONLY when the share-ish button is clicked
        shareIshButton.addEventListener('click', function(event) {
            event.stopPropagation(); // Stops the click from closing the menu instantly
            shareIshMenu.classList.toggle('active'); // Shows or hides the menu
        });

        // This runs when you click anywhere else on the page
        document.addEventListener('click', function() {
            if (shareIshMenu.classList.contains('active')) {
                shareIshMenu.classList.remove('active');
            }
        });
    }
});
// END: FINAL SHARE BUTTON JAVASCRIPT

// --- ADD THIS FUNCTION for the new floating panel refresh and thanks ---

        function toggleThankYouPanel(linkElement) {
            const panel = linkElement.closest('.floating-info-panel');
            if (panel) {
                panel.classList.toggle('is-open');
            }
        }

// ==================== 12-HOUR FORMAT HELPER ====================
// This function correctly handles 12-hour AM/PM and 1-indexed months (1=Jan, 12=Dec).
        function createDate(year, month, day, hour, minute, second, isPM) {
            let hour24 = hour;
            if (isPM && hour < 12) {
                hour24 = hour + 12;
            } else if (!isPM && hour === 12) {
                hour24 = 0;
            }
            return new Date(year, month - 1, day, hour24, minute, second);
        }

//** Hide Redeem shift button **///
        function toggleRewardsLink(isChecked) {
          const rewardsDiv = document.getElementById('rewards-container');
          if (isChecked) {
            rewardsDiv.style.display = 'none';
          } else {
            rewardsDiv.style.display = 'block';
          }
        }


















/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* Active codes ||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
// ==================== CONFIGURATION ====================

const ALL_CODES_CONFIG = [
        {
        code: "T9RJB-BFKRR-3RBTW-B33TB-KCZB9",
        description: 'All Platforms<br>Perm Key, Good For A Long Time',
        title: '1 Gold Key',
        showReportButton: false,
        showCopyButton: true,
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/skulliconkey.png"
    },
                    {
        code: "TZR3T-JZJKJ-WXJTC-T33TB-RFCFR",
        expires: createDate(2025, 10, 20, 9, 9, 0, 1), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1979656181175271889" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-18",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
                    {
        code: "3S6TT-CZJWT-WXJT5-3B3BJ-JS3JZ",
        expires: createDate(2025, 10, 20, 9, 9, 0, 1), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1979656181175271889" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-18",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
                    {
        code: "J96BJ-RZJWB-C6TJC-BBJJJ-5B5W9",
        expires: createDate(2025, 10, 20, 9, 9, 0, 1), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1979656181175271889" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-18",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
                    {
        code: "WZK3B-SHTHF-JZ59K-SBT3B-TWHXT",
        description: 'All Platforms<br>PAX AU 2K Code : link your 2K account to redeem <br> User Sent This In (Cant give credit.. no name was given) <br> not sure if its a perm or not will remove if it expires <br> <i> its from a email i hear, sadly i didnt get this one hmm </i> ',
        dateAdded: "2025-10-13",
        expires: createDate(2025, 10, 19, 4, 59, 0, 0),
        title: '1 Gold Key',
        showReportButton: true,
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/skulliconkey.png"
    },
                {
        code: "No Code",
        expires: createDate(2025, 11, 14, 11, 59, 0, 1), // 
        description: 'Geforce Experince App<br> One Time Use <br><br>Head to the GeForce Experience App | Nvidia App <br> Click on the Redeem tab <br> You will find the Borderlands 4 promotion there. <br> Hover over it, and a Redeem button will appear. <br> Click on it and it will take you to the page with the SHiFT code.<br><br>Not everyone will have this show btw',
        title: '1 Gold Key',
        showReportButton: true,
        showCopyButton: false,
        showPreviewButton: true,
        imagePreview: "https://i.postimg.cc/25gNxrpN/screenshot-35.png",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/skulliconkey.png"
    },
            {
        code: "J9FB3-9XTW3-56JJK-TBBTJ-TF9X3",
        expires: createDate(2025, 10, 14, 0, 23, 0, 0), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1977228544901366119" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-12",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: false,
        showCopyButton: true
    },
        {
        code: "BZX3B-6RTWB-5FTBW-TBT3B-3XZCT",
        expires: createDate(2025, 10, 14, 0, 23, 0, 0), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1977228544901366119" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-12",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: false,
        showCopyButton: true
    },
        {
        code: "BHXBB-W6BCB-WXJ3W-B3BTT-FTW3Z",
        expires: createDate(2025, 10, 14, 0, 23, 0, 0), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1977228544901366119" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-12",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: false,
        showCopyButton: true
    },
            {
        code: "TZ6TT-FKBKB-W6T35-BTTB3-636SR",
        expires: createDate(2025, 10, 11, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1976415477862895671" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-9",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
            {
        code: "JH63B-S5TK3-KFJJC-BBB3T-5KR63",
        expires: createDate(2025, 10, 11, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1976415477862895671" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-9",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
            {
        code: "T963J-TRBKB-56JBW-3BJBJ-ZZ3JR",
        expires: createDate(2025, 10, 11, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1976415477862895671" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-9",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
            {
        code: "T9XTB-93BC3-56T35-TBBJT-KF5TW",
        expires: createDate(2025, 10, 5, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1974287733985325112" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-3",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "TZRBJ-3KTWT-KX3BC-TT3TB-B9ZSK",
    expires: createDate(2025, 10, 5, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1974287733985325112" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-3",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
        {
        code: "3HR33-KWBKT-KRJ3W-JBBTJ-FSTC3",
        expires: createDate(2025, 10, 5, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1974287733985325112" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-3",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
                {
        code: "TZFT3-K9Z33-5FT3W-BJ33T-WZ5X5",
        expires: "UED", // 
        description: 'üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200166888104169" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
            {
        code: "J9RT3-RBJ5T-WRTBK-JB3J3-5TB3R",
        expires: createDate(2025, 10, 3, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200166888104169" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
            {
        code: "TH6BJ-WJTC3-W6B3C-3TTBT-5HTTH",
        expires: createDate(2025, 10, 3, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200166888104169" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
            {
        code: "3HXTT-JBJCT-CR33W-JJTJJ-BCR5W",
        expires: createDate(2025, 10, 2, 9, 35, 0, 1), // 
                dateAdded: "2025-09-30",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200166888104169" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
           {
        code: "BH6TJ-Z993B-5RJBK-JT3B3-RXT3Z",
        expires: createDate(2025, 10, 3, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200020347428912" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "3S6TT-RSHJ3-WFJ3K-BBJB3-W5ZKS",
        expires: createDate(2025, 10, 3, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200020347428912" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "JH6BB-6RST3-5FB35-JT3BB-R3WCB",
        expires: createDate(2025, 9, 29, 4, 45, 0, 1), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1972042073701528063" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-27",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "JZRTJ-SR9BB-W6T35-BJBTT-36FZR",
        expires: createDate(2025, 9, 29, 4, 45, 0, 1), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1972042073701528063" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-27",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "BSFTB-TZ9BB-KRJBK-TTJB3-6S3KS",
        expires: createDate(2025, 9, 29, 4, 45, 0, 1), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1972042073701528063" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-27",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
    {
        code: "BHRBJ-ZWHT3-W6JBK-BT3BB-CW3ZK",
        expires: createDate(2025, 9, 26, 4, 19, 0, 1), // 4:19 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1970946292131188745" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-24",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
    {
        code: "JSX3J-B6SBJ-CXTBC-B3T3B-BZZZT",
        expires: createDate(2025, 9, 26, 4, 19, 0, 1), // 4:19 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1970946292131188745" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-24",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "BHFJ3-WXHBB-W63JK-B33B3-5HX95",
        expires: createDate(2025, 9, 26, 4, 19, 0, 1), // 4:19 PM
        title: '1 Gold Key- <a href="https://x.com/DuvalMagic/status/1970946292131188745" target="_blank">Via Twit</a> | 9/24/2025',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "J9XBB-KK9T3-CRTBW-BBT3T-KTBTW",
        expires: createDate(2025, 9, 24, 12, 28, 0, 1), // 12:28 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1970163226441547832" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
    {
        code: "JHFTJ-R5HBT-KF3TK-TBJT3-JJTHH",
        expires: createDate(2025, 9, 24, 12, 28, 0, 1), // 12:28 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1970163226441547832" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "THRBT-WW6CB-56TB5-3B3BJ-XBW3X",
        expires: createDate(2025, 9, 30, 0, 0, 0, 1), // Fixed: September 30, 2025 (month is 0-indexed)
        title: '1 Gold Key',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "3H63J-Z3S3J-KR3BK-BTJ33-ZWKTK",
        expires: createDate(2025, 9, 22, 12, 36, 0, 1), // 12:36 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1969440522528792653" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "TSR3B-J5S3T-KRBJW-BTTBJ-JRCXX",
        expires: createDate(2025, 9, 22, 12, 36, 0, 1), // 12:36 PM
        title: '1 : Gold Key - <a href="https://x.com/DuvalMagic/status/1969440522528792653" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "3ZXJB-53STT-56T3W-B3TT3-HTS95",
        expires: createDate(2025, 9, 21, 11, 58, 1, 1), // 11:58 AM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1969068501215170641" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "BSRT3-FTZBJ-K6BTW-JB3T3-WXT99",
        expires: createDate(2025, 9, 21, 11, 58, 1, 1), // 11:58 AM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1969068501215170641" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "B9XT3-HX6TT-W6BBW-TTJT3-JTFKX",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM (no isPM specified, defaults to AM)
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },              
    {
        code: "39RTT-3ZR3T-5FJBK-3J3J3-C5CRT",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },          
    {
        code: "WHWJB-XH3SX-39CZW-H3BBB-BTF55",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },          
    {
        code: "3SR3J-CS63T-CFB3K-J3JTT-RZ5JR",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "3SRBB-X9RBJ-CRTBW-3BBB3-KJFW6",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "WEWJB-XH3SX-39CZW-H3BBB-BPF55",
        expires: createDate(2025, 9, 20, 12, 0, 0, 0), // September 20, 2025, 12:00 PM
        title: '1 Gold Key - Requires linked My2K Games account - <a href="https://shift.gearboxsoftware.com/associations" target="_blank">Associate Account</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    }       
];

const PERMANENT_CODES = [
    {
        code: "BZ6JJ-CB6CT-WXJJW-3TT3B-56FZ5",
        title: 'Vex | Mass Market Appeal | Vault Hunter Skin',
        description: 'Community Challenge : run the Rippers out of 1.8M Ripper Drill Sites as Vex from Oct. 10-13<br><a href="https://x.com/Borderlands/status/1978151314447339664" target="_blank">Link To Tweet</a> ',
        dateAdded: "10/14/2025",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: true,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/death4all-vex-chal.jpeg",
        expires: createDate(2030, 12, 31, 0, 0, 0, 0) // 
    },
                {
        code: "JZ6BJ-SBR5J-WF3BK-BT3BB-TX9HB",
        title: 'Amon Cult Classic | Vault Hunter Skin',
        description: 'Community Challenge : Defeat 300,000 Vault Bosses from Oct 3-5 as Amon<br><a href="https://x.com/Borderlands/status/1974172598222352649" target="_blank">Link To Tweet</a> ',
        dateAdded: "10/6/2025",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: true,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/weeklyeventchal/oct3oct5chal.png",
        expires: createDate(2030, 12, 31, 0, 0, 0, 0) // 
    },
                {
        code: "TZXT3-XJXCB-CXBJW-BTTJT-9SK6B",
        title: 'Rafas Savings Savior | Vault Hunter Skin',
        description: 'Community Challenge : Get 20 million Second Winds from Sep. 26-28 as Rafa<br><a href="https://x.com/Borderlands/status/1971651935104098527" target="_blank">Link To Tweet</a> ',
        dateAdded: "9/27/2025",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: true,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/G1y2OQYXEAAqQVZ.jpeg",
        expires: createDate(2030, 12, 31, 0, 0, 0, 0) // September 29, 2025, midnight AM (explicitly set to avoid default issues)
    },
            {
        code: "JS63J-JSCWJ-CFTBW-3TJ3J-WJS5R",
        title: 'Break Free cosmetics pack and Legendary Ripper shield <br><br>‚Ä¢ [Break Free] Vault Hunter Skin (for Vex, Rafa, Amon, and Harlowe)<br>‚Ä¢ [Firebreak] Legendary Ripper Shield (with minimum level of 25)<br>‚Ä¢ [Break Free] ECHO-4 Drone Skin<br>‚Ä¢ [Kn0x] ECHO-4 Drone Skin',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: true,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/breakfree.png",
        expires: createDate(2031, 1, 1, 2, 45, 0, 1) // Fixed: December 31, 2030, midnight AM
    },
            {
        code: "No Code",
        title: 'Discord  |  Borderlands Bundles + Single Items',
        description:'Click On Shop, Look for the Borderlands 4 Image or Scroll down and will find it. <br>Items Range from $10.99CAD to $5.99CAD Being The Lowest<br><br>NO ETA ON WHEN IT GOES AWAY, COULD BE A WEEK OR MONTH OR MONTHS FROM NOW<br><br> [Click the preview button to see video of the effects]',        
        dateAdded: "9/26/2025",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/discordiconorange.png",
        showCopyButton: false,
        showReportButton: true,
        showPreviewButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/smaller%20%20cbr%20%20%20%202025-09-26%2012-09-25_1.mp4",
    },
               {
        code: " ",
        title: 'Twitch Drops : Watch Drop and Roll ECHO-4 Drone Skin cosmetic',
        description:'<a href="https://borderlands.2k.com/twitch-drops/" target="_blank">Read About It Here Or Via Info Below</a><br><br>Sep  27, 2025 - Oct 25, 2025<br><br>‚Ä¢ Watch any livestream in the Borderlands 4 category on the official <a href="http://twitch.tv/Borderlands" target="_blank">Borderlands 4 Twitch channel</a> or <a href="https://www.twitch.tv/gearboxofficial" target="_blank">Gearbox Twitch channel</a> for 15 minutes and claim the reward',        
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/twitchorange.png",
        showCopyButton: false,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/BL4_Echobot_Drop_Wide_textless.png",
                expires: createDate(2025, 10, 25, 0, 0, 0, 0)
    },
    {
        code: "No Code",
        title: 'Twitch Drops 2 : Forsaken Chaos Legendary shotgun',
        description:'<a href="https://borderlands.2k.com/twitch-drops/" target="_blank">Read About It Here Or Via Info Below</a><br><br>September 11, 2025 - September 30, 2025<br><br>‚Ä¢ Watch any Borderlands 4 Twitch livestream in the <a href="https://www.twitch.tv/directory/category/borderlands-4" target="_blank">Borderlands 4 category</a> for 2 hours and claim the reward',        
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/twitchorange.png",
        showCopyButton: false,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/BL4_ForsakenChaos.png",
        expires: createDate(2025, 9, 30, 0, 0, 0, 0) // September 30, 2025, midnight AM
    },
    {
        code: "No Code",
        title: 'Twitch Drops 3 : Midnight Defiance Legendary sniper rifle',
        description:'<a href="https://borderlands.2k.com/twitch-drops/" target="_blank">Read About It Here Or Via Info Below</a><br><br>September 11, 2025 - September 30, 2025<br><br>‚Ä¢ Watch any Borderlands 4 Twitch livestream in the <a href="https://www.twitch.tv/directory/category/borderlands-4" target="_blank">Borderlands 4 category</a> hosted by a <a href="https://borderlands.2k.com/borderlands-4/partnered-creators/" target="_blank">partnered creator</a> for 2 hours and claim the reward',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/twitchorange.png",
        showCopyButton: false,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/BL4_MidnightDefiance.png",
        expires: createDate(2025, 9, 30, 0, 0, 0, 0) // September 30, 2025, midnight AM
    },
    {
        code: "NO CODE - SIGNED UP AN IS SENT",
        title: 'Butterfinger ECHO-4 Drone Skin',
        description:'This shift code is can be acquired in two ways<br>Enter the  <a href="https://www.gamewithbutterfinger.com/home?path=Echo4" target="_blank">Butterfinger x Borderlands 4 online sweepstakes. </a> Note that theres no guarantee this will be available after September 2025. (US Only) <br> By purchasing the <a href="https://www.gamestop.com/collectibles/collectors-boxes/products/borderlands-4-echo-4-bundle-gamestop-exclusive/426330.html" target="_blank">GameStop Madrinas Coffee Collectors Box (US Only).</a> <br><i>USE A VPN, then search and use a fake usa number/address gen, if live outside the usa, Its what I did and I  got emailed the key :)</i>" ',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: false,
        showPreviewButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/butter%20fingers%20skin.png",
        expires: createDate(2025, 9, 22, 0, 0, 0, 0) // September 22, 2025, midnight AM
    }
];


// ==================== BLACK MARKET VENDOR SYSTEM ====================
const BLACK_MARKET_VENDORS = [
    {
        code: "Black Market Vendor",
        title: 'Maurices Black Market - Refreshes every Thursday at 12:00 PM EDT',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/MauricesBlackMarket.png",
        description:'<b>Static Image Button</b> : <i>Is where he is</i><br><br><b>View Location (MAP)</b> : <i>It Shows few Spots He Can Be <br> <br> If Static Button Is Missing, Means Update Is Happening</i>',
        dateAdded: "10/16/2025", // <-- will show updated on
        showCopyButton: false,
        showPreviewButton: true,
        mapGenieLocation: "https://mapgenie.io/borderlands-4/maps/kairos?embed=light&catIds=13472",
        staticImageLocation: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bmvendorlocation/mBm__carcadia--ruined-sumplands.png",
        staticImageCredit: 'Static Image Can Be From : <a href="https://mentalmars.com/borderlands-4/loot/black-market/" target="_blank">MentalMars (Check Them Out)</a>',
        type: 'weekly-vendor'
    },
    {
        code: "Weekly WildCard Mission",
        title: 'The Council Divided - Refreshes every Thursday at 12:00 PM EDT',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/weeklymission.png",
        description:'<b>Drop</b> : <i>Ohm I Got (Maliwan Submachine Gun)</i><br><br><b>Where To Go?</b> : <i>Start the mission via the conrner of the map via the button there, It will reload the map and can track an get to the mission.<br><br>PS : If any of the 3 buttons are missing, means still updating</i>', // <--- COMMA ADDED HERE
        dateAdded: "10/16/2025", // <-- will show updated on
        showCopyButton: false,
        showPreviewButton: true,
        loot: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyweapons/OhmIgot--smg.png",
        infoUrl: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyact/TheCouncilDivided-cardinfo.png",
        staticImageLocation: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyact/The%20Council%20Divided--location.png",
        staticImageCredit: 'Image Credit : Me,Others',
        type: 'weekly-vendor'
    },
    {
        code: "Weekly Big Encore Boss",
        dateAdded: "10/16/2025", // <-- will show updated on
        title: 'The Oppressor - Refreshes every Thursday at 12:00 PM EDT',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/BigEncoreBoss.png",
                customButtons: {
            "üí∞Ashers Rise (Sniper)": "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyweapons/ashersrise--sniper.png",   // Replace with actual URL        
            "üí∞Streamer (Heavy)": "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyweapons/streamer-heavy.png", // Replace with actual URL
            "üí∞Blood Analyzer(Repkit)": "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyweapons/Blood%20Analyzer---repkit.png" // Replace with actual URL
        },
        description:'<b>Drops</b> : <i>Ashers Rise (Sniper), Streamer (Heavy), Blood Analyzer (Repkit)</i> <br><br> <b>Location : </b>The Killing Floors (Fadefields,Dissected Plateau)<br><br>PS : No Info For Drops/Location Its Being Updated</i>', // <--- COMMA ADDED HERE
        dateUpdated: "10/16/2025", // <-- will show updated on
        showCopyButton: false,
        showPreviewButton: true,
        staticImageLocation: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyact/TheOppressor--Encore_location.png",
        staticImageCredit: '<b>TIP :</b> <i>If you dont see the skull with hat icon, just means you have not done anything around there... use image button an go to around that area :)</i> <br> <b>Image Credit : </b><i>Me,Others</i>',
        type: 'weekly-vendor'
    }
    // You can add more vendor objects here, separated by commas
];

// üö® PLACE YOUR CONFIGURATION AND WEBHOOK URL HERE üö®
const POLL_CONFIG = {
    isEnabled: true, // Set to true to enable the poll button
    DISCORD_WEBHOOK_URL: 'https://discord.com/api/webhooks/1429844983523053568/7gFdMgkH6t_eLPviW3jHQCfxLIIXnG0oDR9CAeb44vlauUJeFEt1l7Fs8eRRS-RU5Kn1' // <--- üîë ADD YOUR URL HERE
};
/* =================================================== */
/*             POLL QUESTION CONFIGURATION             */
/* =================================================== */
const POLL_QUESTIONS = [
    {
        page: 1,
        active: true,
        id: "q1_grid",
        title: "Hide Ish Button Breaks : Mobile Default View/PC Grid View",
        subtitle: "Leaves nasty/ugly gaps peeps hate.. if i cant have this be fixed where things slide into place and such should i remove the grid layout or keep it?",
        type: "radio",
        required: true,
        options: [
            { value: "Remove Grid (I Like To Hide Ish)", text: "Remove Grid (I Like To Hide Ish)" },
            { value: "Keep it (I Don't Use Hide Ish Button)", text: "Keep it (I Don't Use Hide Ish Button)" }

        ]
    },
    {
        page: 2,
        active: true,
        id: "q2_view",
        title: "I know the normal view works very very good with Hide Ish option",
        subtitle: "Would you want me to do a diff layout thats not grid/stacking view?",
        type: "radio-with-text", // <--- NEW TYPE HERE
        required: true,
        options: [
            { value: "Yes", text: "Yes" },
            { value: "No Diff Layout Needed", text: "No Diff Layout Needed" },
        ],
                textInput: {
            id: "q2_view_details",
            placeholder: "Please describe your preferred layout (e.g., more compact, different sections for specific codes, etc.)",
            requiredIfYes: true // This will make it required only if "Yes" is selected
        }
    },
        {
        page: 3,
        active: false,
        id: "q3_dark_wide",
        title: "Do you like the Darkmode/Wide Mode Button/Hide ish?",
        subtitle: "Haters/Bashers caused me to make the hide ish that fully allows all to be  hidden",
        type: "radio",
        required: true,
        options: [
            { value: "Yes", text: "Yes" },
            { value: "No", text: "No" }
        ]
    },
            {
        page: 4,
        active: false,
        id: "q3_notfi",
        title: "Added Notification Alert For Browser, Will You Use It?",
        subtitle: "For this to work, have to leave tab open on browser",
        type: "radio",
        required: true,
        options: [
            { value: "Yes", text: "Yes" },
            { value: "No", text: "No" }
        ]
    },
               {
        page: 5,
        active: false,
        id: "q4_device",
        title: "What device you view from most?",
        subtitle: "Need to know as will be working on better mobile view",
        type: "radio",
        required: true,
        options: [
            { value: "Computer", text: "Computer" },
            { value: "Apple Device", text: "Apple Device" },
            { value: "Android Device", text: "Android Device" },
            { value: "Console Browser", text: "Console Browser" },
            { value: "Other", text: "Other" }
        ]
    },
        { 
        // --- Question 4 (INACTIVE) ---
        page: 6, 
        active: false, // <-- SET TO FALSE
        id: "q5_checking",
        title: "How often do you check the site??",
        subtitle: "Daily? Few Times A Day?",
        type: "textarea",
        required: false,
        placeholder: "Enter answer here"
    },
    { 
        // --- Question 3 (INACTIVE) ---
        page: 7, 
        active: false, // <-- SET TO FALSE (Will be filtered out)
        id: "q6_gunpic",
        title: "For the BLACK MARKET VENDOR WEAPON/GEAR BUTTONS.. WHAT WOULD YOU WANT TO SEE?",
        subtitle: "Click the image to zoom in (Optional). | Can Skip This If You Want",
        type: "radio",
        required: false,
        options: [
            { value: "View Style Gun Info https://i.postimg.cc/J7pkshsY/screenshot-35.png ", text: "View Style A : Gun Info", image: "https://i.postimg.cc/rppP1s8g/screenshot-35.png" },
            { value: "View Style Gun Info + Gun View https://i.postimg.cc/3xv4fCt7/screenshot-35.png", text: "View Style B : Gun Info + Gun View", image: "https://i.postimg.cc/HsCvSBY3/screenshot-35.png" }
        ]
    },
        { 
        // --- Question 3 (INACTIVE) ---
        page: 8, 
        active: false, // <-- SET TO FALSE (Will be filtered out)
        id: "q7_mobile",
        title: "Mobile Users What Layout Is Better",
        subtitle: "Click the image to zoom in (Optional).",
        type: "radio",
        required: true,
        options: [
            { value: "New Layout Style https://i.postimg.cc/nLq8kntR/screenshot-35.png ", text: "New Layout Style", image: "https://i.postimg.cc/nLq8kntR/screenshot-35.png" },
            { value: "Old Layout Style https://i.postimg.cc/cHJmJcT7/screenshot-35.png", text: "Old Layout Style", image: "https://i.postimg.cc/cHJmJcT7/screenshot-35.png" }
        ]
    },
                   {
        page: 8,
        active: false,
        id: "q8_moblayout",
        title: "With new layout should it be default or turn on option?",
        subtitle: "means it will be the old layout, users can toggle new view",
        type: "textarea",
        required: false,
        placeholder: "Enter answer here"
    },
    { 
        // --- Question 4 (INACTIVE) ---
        page: 2, 
        active: false, // <-- SET TO FALSE
        id: "q4_improvement",
        title: "How can we make the tracker better for you?",
        subtitle: "Your suggestions are welcome!",
        type: "textarea",
        required: false,
        placeholder: "Enter suggestions here..."
    }
];
/* =================================================== */

const ROADMAP_CONFIG = {
    imageUrl: "https://i.postimg.cc/PqwXK6rS/screenshot-35.png", // <--- CHANGE THIS TO YOUR ACTUAL ROADMAP IMAGE URL
};

// REPLACE your old EVENTS_CONFIG object with this one

const EVENTS_CONFIG = {
    isEnabled: true, // This makes the button visible
    buttonText: "üéâ Harlowes Boots To The Face üìÖ<br><small>CURRENT EVENT CHALLENGE | OCT 17 - OCT 19</small>",
    imageUrl: "https://i.postimg.cc/dVv0dwvp/screenshot-35.png", // <-- I have found and added the correct image URL for you
    descriptionText: `
        <b>Boots To Face Challenge:</b>
        <ul>
            <li>Complete 350,000 Contracts as Harlowe from Oct. 17-19 </li>
            <li>Community Gets | Maliwannabee outfit inspired by her character short "Family Reunion."</li>
            <li>xxxx-shift-code-coming-soon-xxxx | Will be posted under drops after this event buttons goes away</li>
        <li><a href="https://x.com/Borderlands/status/1979243646580068577" target="_blank">Link To Tweet</a></li>
        </ul>
    `
};

// --- ADD THIS NEW CONFIGURATION OBJECT ---
const COMMUNITY_CHALLENGE_CONFIG = {
    isEnabled: true, // Set to true to show the button, false to hide it
    buttonText: "üèÜ Horrors of Kairos üèÜ<br><small>Seasonal Mini-Event | Oct 23 - Nov 6</small>",
    imageUrl: "https://i.postimg.cc/0QdYjZvh/screenshot-35.png", // The image inside the dropdown
    descriptionText: `
        <b>Key Takeaways:</b>
        <ul>
            <li>The Horrors of Kairos Seasonal Mini-Event takes place from October 23 to November 6, 2025</li>
            <li>Blood rains down during World Boss Encounters (Rifts)</li>
            <li>World Boss Reward Chests can contain new Legendaries</li>
        </ul>
        <br>
        <b>Horrors of Kairos Loot:</b>
        <ul>
            <li>Murmur <i>Tediore Assault Rifle</i> | Executes weakened enemies with guaranteed crits on targets under 35% health.</li>
            <li>Skully <i>Order Grenade</i> | This death-dealing grenade fires out projectiles as it seeks out the nearest target.</li>
            <li>Gourd Your Loins <i>Pumpkin Head</i> | xxxx-shift-code-coming-soon-xxxx</li>
            <li>Hex Appeal <i>Weapon Skin</i> | xxxx-shift-code-coming-soon-xxxx</li>
        </ul>
    `
};

const BLACK_MARKET_EXTRA_CONFIG = {
    imageUrl: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/gh-pages/BL4-Black-Market-Location-003-Grindstone-of-the-Worthysep25-oct2.jpg", // <--- !!! REPLACE THIS WITH THE ACTUAL IMAGE URL !!!
};
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */















        // Helper function to format the date added
         // =======================================================
        //      FINAL: SMART & MANUAL DATE ADDED FUNCTION
        // =======================================================
        /**
         * A smart function that gets and formats the "Added On" date based on specific rules:
         * - If `dateAdded` is a valid date string, it's used.
         * - If `dateAdded` is an empty string (""), it auto-generates today's date.
         * - If the `dateAdded` property is completely missing, it does nothing.
         * @param {object} codeData - The entire code object from your config.
         * @returns {string} - The formatted date string (e.g., "Sep 27, 2025") or an empty string.
         */
function getFormattedDateAdded(codeData) {
            // Check if the dateAdded property exists and has a value.
            if (codeData.hasOwnProperty('dateAdded') && codeData.dateAdded.trim() !== '') {
                // If it exists, return the text exactly as you wrote it.
                return codeData.dateAdded;
            }
            
            // If the property is missing or the string is empty, return nothing.
            return '';
        }


// Helper for Black Market Vendor's weekly refresh
        function getNextVendorRefresh() {
            const now = new Date();
            const nextRefresh = new Date(now);
            
            // Set target day (Thursday = 4) and time (12:00 PM)
            const targetDay = 4; // Thursday (Sunday is 0, Monday is 1, ..., Saturday is 6)
            const targetHour = 12; // 12 PM in 24-hour format
            const targetMinute = 0;
            
            // Calculate days until next Thursday
            let daysUntilTarget = (targetDay + 7 - now.getDay()) % 7;
            
            // If it's the same day, check if the time has already passed
            if (daysUntilTarget === 0) {
                if (now.getHours() > targetHour || 
                    (now.getHours() === targetHour && now.getMinutes() >= targetMinute)) {
                    daysUntilTarget = 7; // If the time has passed, schedule for the next week
                }
            }
            
            // Set the next refresh date
            nextRefresh.setDate(now.getDate() + daysUntilTarget);
            nextRefresh.setHours(targetHour, targetMinute, 0, 0);
            
            return nextRefresh;
        }

// FINAL, BACKWARD-COMPATIBLE version of the function
// FINAL, COMPLETE, AND CORRECT version of the function
function createBlackMarketVendorBox(vendorData, index) {
    const nextRefresh = getNextVendorRefresh();
    const now = new Date();
    const timeLeft = nextRefresh.getTime() - now.getTime();
    
    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
    
    const iconHtml = createIconHtml(vendorData.icon, false, 'blackmarket');
    
    const uniqueId = vendorData.code.replace(/\s+/g, '-') + '-' + index;
    const isRedeemed = getRedemptionStatus(uniqueId);
    const redeemedClass = isRedeemed ? 'redeemed' : '';

    // --- THIS IS THE KEY CHANGE ---
    // It gets the date and then adds the "Updated:" label specifically for this box type.
    const formattedDate = getFormattedDateAdded(vendorData);
    const dateAddedHtml = formattedDate ? `<div class="date-added">Updated: ${formattedDate}</div>` : '';

    let dynamicButtonsHtml = '';
    if (vendorData.customButtons) {
        for (const buttonText in vendorData.customButtons) {
            const url = vendorData.customButtons[buttonText];
            dynamicButtonsHtml += `<button class="bm-small-btn bm-loot-info-btn" onclick="openImagePreview('${url}')">  ${buttonText}</button>`;
        }
    } 
    else if (vendorData.loot && vendorData.loot.trim() !== '') {
        dynamicButtonsHtml = `<button class="bm-small-btn bm-loot-info-btn" onclick="openImagePreview('${vendorData.loot}')">üí∞ View Loot</button>`;
    }

    let infoButtonHtml = '';
    if (vendorData.infoUrl && vendorData.infoUrl.trim() !== '') {
        infoButtonHtml = `<button class="bm-small-btn bm-loot-info-btn" onclick="openImagePreview('${vendorData.infoUrl}')">üì∞ View Info</button>`;
    }
    let staticImageButtonHtml = '';
    if (vendorData.staticImageLocation) {
        staticImageButtonHtml = `<button class="bm-small-btn bm-static-image-btn" onclick="openImagePreview('${vendorData.staticImageLocation}')">üìç View Location (STATIC)</button>`;
    }
    let mapGenieButtonHtml = '';
    if (vendorData.mapGenieLocation) {
        mapGenieButtonHtml = `<button class="bm-small-btn bm-mapgenie-btn" onclick="openImagePreview('${vendorData.mapGenieLocation}')">üó∫Ô∏è View Location (MAP)</button>`;
    }
    
    let descriptionHtml = vendorData.description ? `<div class="code-description">${vendorData.description}</div>` : '';

    return `
        <div class="black-market-code-box ${redeemedClass}" id="black-market-vendor-${index}">
            <div class="code-header">
                ${iconHtml}
                <div class="title-container">${vendorData.title}</div>
            </div>
            
            ${dateAddedHtml}
            
            <div class="code-text">${vendorData.code}</div>
            
            ${descriptionHtml}
            
            <div class="expire-date">Next refresh: ${formatDate(nextRefresh)}</div>
            <div class="countdown" data-refreshtime="${nextRefresh.getTime()}">Refreshes in: ${days}d ${hours}h ${minutes}m ${seconds}s</div>
            ${vendorData.staticImageCredit ? `<div class="black-market-credit">${vendorData.staticImageCredit}</div>` : ''}
            <div class="code-footer">
                <div class="black-market-buttons-group">
                    ${dynamicButtonsHtml}
                    ${infoButtonHtml}
                    ${staticImageButtonHtml}
                    ${mapGenieButtonHtml}
                </div>
                <div class="bmredeem-checkbox">
                    <input type="checkbox" id="bm-redeemed-${index}" ${isRedeemed ? 'checked' : ''} 
                        onchange="handleRedemptionChange('${uniqueId}', this, document.getElementById('black-market-vendor-${index}'))">
                    <label for="bm-redeemed-${index}">üí∞</label>
                </div>
            </div>
        </div>
    `;
}

function updateVendorTimer() {
    // Find ALL vendor boxes on the page that have a countdown element
    const vendorBoxes = document.querySelectorAll('.black-market-code-box .countdown');
    
    vendorBoxes.forEach(countdownElement => {
        const vendorBox = countdownElement.closest('.black-market-code-box');
        if (!vendorBox) return;

        const nextRefresh = getNextVendorRefresh();
        const now = new Date();
        const timeLeft = nextRefresh.getTime() - now.getTime();

        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        
        const expireDateElement = vendorBox.querySelector('.expire-date');
        
        countdownElement.textContent = `Refreshes in: ${days}d ${hours}h ${minutes}m ${seconds}s`;
        
        if (expireDateElement) {
            expireDateElement.textContent = `Next refresh: ${formatDate(nextRefresh)}`;
        }
    });
}
        // Make sure to call updateVendorTimer regularly (e.g., every second)
        setInterval(updateVendorTimer, 1000);




        // --- START: Panzoom Integration with Buttons ---
        // This variable will hold our active Panzoom instance.
        let panzoomInstance = null;

        // NEW button functions that control the Panzoom library
        function zoomIn() {
            if (panzoomInstance) {
                panzoomInstance.zoomIn();
            }
        }

        function zoomOut() {
            if (panzoomInstance) {
                panzoomInstance.zoomOut();
            }
        }

        function resetZoom() {
            if (panzoomInstance) {
                panzoomInstance.reset();
            }
        }

function openImagePreview(url) {
            const modal = document.getElementById('image-preview-modal');
            const imageElement = document.getElementById('preview-image');
            const container = document.getElementById('preview-container');

            // Reset any previous instance
            if (panzoomInstance) panzoomInstance.reset();
            
            imageElement.style.display = 'none';
            container.style.display = 'none';

            // Body scroll lock
            scrollYPosition = window.scrollY;
            document.body.style.top = `-${scrollYPosition}px`;
            document.body.classList.add('modal-open');
            
            if (url.match(/\.(jpeg|jpg|gif|png|svg|webp|bmp)$/i)) {
                imageElement.src = url;
                imageElement.style.display = 'block';

                panzoomInstance = Panzoom(imageElement, {
                    maxScale: 4,
                    minScale: 0.5,
                    canvas: true,
                    disableDblclick: true, // <-- ADD THIS LINE
                });
                modal.addEventListener('wheel', panzoomInstance.zoomWithWheel);

            } else if (url.match(/\.(mp4|webm|ogg|mov|avi|mkv|flv|wmv|m4v|3gp)$/i)) {
                container.innerHTML = `<video controls autoplay style="width: 800px; height: auto; max-width: 90vw; max-height: 80vh; border: 2px solid #ffc600; border-radius: 5px;"><source src="${url}" type="video/mp4"></video>`;
                container.style.display = 'block';
            } else {
                container.innerHTML = `<iframe src="${url}" style="width: 800px; height: 600px; max-width: 90vw; max-height: 80vh; border: 2px solid #ffc600; border-radius: 5px;" onerror="showPreviewFallback('${url}')"></iframe>`;
                container.style.display = 'block';
            }
            
            modal.style.display = 'flex';
        }

        // --- NEW: Function to open the Roadmap image ---
function openRoadmapImage() {
    openImagePreview(ROADMAP_CONFIG.imageUrl);
}

function openEventsImage() {
    openImagePreview(EVENTS_CONFIG.imageUrl);
}


// REPLACE your entire setupOptionalButtons function with this one
function setupOptionalButtons() {
    // --- Logic for the Community Challenge Button ---
    const challengeButton = document.getElementById('challenge-btn'); 
    const challengeImage = document.getElementById('challenge-image');
    const challengeDescription = document.getElementById('challenge-description');
    if (COMMUNITY_CHALLENGE_CONFIG.isEnabled) {
        challengeButton.innerHTML = COMMUNITY_CHALLENGE_CONFIG.buttonText;
        if(challengeImage) challengeImage.src = COMMUNITY_CHALLENGE_CONFIG.imageUrl;
        if(challengeDescription) challengeDescription.innerHTML = COMMUNITY_CHALLENGE_CONFIG.descriptionText;
        challengeButton.classList.remove('hidden');
    }

    // --- New Logic for the Events Button ---
    const eventsButton = document.getElementById('events-btn');
    const eventsImage = document.getElementById('events-image');
    const eventsDescription = document.getElementById('events-description');
    if (EVENTS_CONFIG.isEnabled) {
        eventsButton.innerHTML = EVENTS_CONFIG.buttonText;
        if(eventsImage) eventsImage.src = EVENTS_CONFIG.imageUrl;
        if(eventsDescription) eventsDescription.innerHTML = EVENTS_CONFIG.descriptionText;
        eventsButton.classList.remove('hidden');
    }
}


        function showPreviewFallback(url) {
            const container = document.getElementById('preview-container');
            container.innerHTML = `
                <div style="color: white; text-align: center; padding: 40px;">
                    <h3>üåê Cannot Embed Website</h3>
                    <p>Click below to open in new tab:</p>
                    <button onclick="window.open('${url}', '_blank'); closeImagePreview();" 
                            style="background: #ffc600; color: black; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                        Open MapGenie
                    </button>
                </div>
            `;
        }

function closeImagePreview() {
            if (panzoomInstance) {
                panzoomInstance.destroy();
                panzoomInstance = null;
            }

            const modal = document.getElementById('image-preview-modal');
            modal.style.display = 'none';

            document.body.classList.remove('modal-open');
            document.body.style.top = '';
            window.scrollTo(0, scrollYPosition);
        }


        // Close when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.id === 'image-preview-modal') {
                closeImagePreview();
            }
        });

function toggleInfo(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
        section.classList.toggle('show');
        // This saves the new state (open or closed) so it remembers for next time
        saveSectionState(sectionId, section.classList.contains('show'));
    }
}

function toggleExpired() {
    const expiredSection = document.getElementById('expired-section');
    expiredSection.classList.toggle('show');
    // Save the new state
    saveSectionState('expired-section', expiredSection.classList.contains('show'));
}

function togglePermanent() {
    const permanentSection = document.getElementById('permanent-section');
    permanentSection.classList.toggle('show');
    // Save the new state
    saveSectionState('permanent-section', permanentSection.classList.contains('show'));
}

        function copyToClipboard(text, index, type) {
            navigator.clipboard.writeText(text).then(() => {
                const message = document.getElementById(`copied-${type}-${index}`);
                if (message) {
                    message.style.display = 'inline';
                    setTimeout(() => {
                        message.style.display = 'none';
                    }, 2000);
                }
            }).catch(err => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const message = document.getElementById(`copied-${type}-${index}`);
                if (message) {
                    message.style.display = 'inline';
                    setTimeout(() => {
                        message.style.display = 'none';
                    }, 2000);
                }
            });
    // ADD THIS LINE AT THE END
    setLastCopied(text);
}

        function saveRedemptionStatus(code, isRedeemed) {
            try {
                const redeemedCodes = JSON.parse(localStorage.getItem('shiftRedeemedCodes')) || {};
                redeemedCodes[code] = isRedeemed;
                localStorage.setItem('shiftRedeemedCodes', JSON.stringify(redeemedCodes));
            } catch (e) {
                console.error("Error saving to localStorage:", e);
            }
        }

        function getRedemptionStatus(code) {
            try {
                const redeemedCodes = JSON.parse(localStorage.getItem('shiftRedeemedCodes')) || {};
                return redeemedCodes[code] || false;
            } catch (e) {
                console.error("Error reading from localStorage:", e);
                return false;
            }
        }

        function handleRedemptionChange(code, checkbox, container) {
            const isRedeemed = checkbox.checked;
            saveRedemptionStatus(code, isRedeemed);
            
            if (isRedeemed) {
                container.classList.add('redeemed');
            } else {
                container.classList.remove('redeemed');
            }
        }

        function handlePermanentRedemptionChange(code, checkbox, container) {
            const isRedeemed = checkbox.checked;
            saveRedemptionStatus(code, isRedeemed);
            
            if (isRedeemed) {
                container.classList.add('permanent-redeemed');
            } else {
                container.classList.remove('permanent-redeemed');
            }
        }

        // New functions for Black Market Vendor redemption status
        function saveBlackMarketRedemptionStatus(isRedeemed) {
            try {
                localStorage.setItem('blackMarketRedeemed', JSON.stringify(isRedeemed));
            } catch (e) {
                console.error("Error saving Black Market redemption status to localStorage:", e);
            }
        }

        function getBlackMarketRedemptionStatus() {
            try {
                const status = localStorage.getItem('blackMarketRedeemed');
                return status ? JSON.parse(status) : false;
            } catch (e) {
                console.error("Error reading Black Market redemption status from localStorage:", e);
                return false;
            }
        }

        function isImageUrl(str) {
            return str.match(/\.(jpeg|jpg|gif|png|svg|webp)$/i) !== null;
        }

// REFINED createIconHtml function
function createIconHtml(icon, isPermanent = false, iconType = null) {
    let baseClassName;

    if (isPermanent) {
        // Permanent codes will use their specific classes
        baseClassName = isImageUrl(icon) ? 'permanent-custom-icon' : 'permanent-key-icon';
    } else if (iconType === 'active-code') {
        // Active codes will use the new active-codes-icon class
        baseClassName = 'active-codes-icon';
    } else if (iconType === 'blackmarket') {
        // Black market codes will use the new blackmarket-icon class
        baseClassName = 'blackmarket-icon';
    } else {
        // Fallback for any other context, using the original custom/key icons
        // This handles cases where you might call createIconHtml without a specific iconType
        baseClassName = isImageUrl(icon) ? 'custom-icon' : 'key-icon';
    }

    const finalClassName = baseClassName; // In this simple case, finalClassName is just baseClassName

    if (!icon) {
        // Default to a key icon if no icon data is provided
        return `<span class="${finalClassName}">üîë</span>`;
    } else if (isImageUrl(icon)) {
        return `<img src="${icon}" class="${finalClassName}" alt="Icon">`;
    } else {
        // It's text/emoji
        return `<span class="${finalClassName}">${icon}</span>`;
    }
}

        // --- MODIFIED organizeCodes function for robust date comparison and error handling ---
        // --- MODIFIED organizeCodes function for robust date comparison and error handling ---
       function organizeCodes() {
            const now = new Date();
            const nowTimestamp = now.getTime(); // Get timestamp once for consistent comparison
            const regularActiveCodes = [];
            const permanentActiveCodes = [];
            const expiredCodes = [];

            // Process ALL_CODES_CONFIG (regular codes)
            ALL_CODES_CONFIG.forEach(codeData => {
                
                // NEW: Handle Unknown Expire Date (UED)
                if (codeData.expires === "UED") {
                    regularActiveCodes.push(codeData);
                    return; // Classify as active and move to the next code
                }

                // --- FIX STARTS HERE ---
                // First, check if the 'expires' property even exists.
                // If it doesn't, we know it's a permanent active code.
                if (!codeData.expires) {
                    regularActiveCodes.push(codeData);
                    return; // Move to the next code in the loop
                }
                // --- FIX ENDS HERE ---

                // The rest of this logic will now only run for codes that DO have an 'expires' property.
                let expiresDate;
                try {
                    expiresDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                } catch (e) {
                    console.error(`Error parsing expires date for regular code "${codeData.code}":`, codeData.expires, e);
                    expiredCodes.push(codeData);
                    return;
                }

                if (isNaN(expiresDate.getTime())) {
                    console.error("Invalid expires date for regular code (isNaN check):", codeData.code, codeData.expires);
                    expiredCodes.push(codeData);
                    return;
                }

                if (expiresDate.getTime() > nowTimestamp) {
                    regularActiveCodes.push(codeData);
                } else {
                    expiredCodes.push(codeData);
                }
            });

            // Process PERMANENT_CODES (This part remains the same)
            PERMANENT_CODES.forEach(codeData => {
                // NEW: Handle Unknown Expire Date (UED) for permanent codes
                if (codeData.expires === "UED") {
                    permanentActiveCodes.push(codeData);
                    return;
                }

                let expiresDate = null;
                if (codeData.expires) {
                    try {
                        expiresDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                    } catch (e) {
                        console.error(`Error parsing expires date for permanent code "${codeData.code}":`, codeData.expires, e);
                        permanentActiveCodes.push(codeData);
                        return;
                    }

                    if (isNaN(expiresDate.getTime())) {
                        console.error("Invalid expires date for permanent code (isNaN check):", codeData.code, codeData.expires);
                        permanentActiveCodes.push(codeData);
                        return;
                    }
                }
                
                if (!expiresDate || expiresDate.getTime() > nowTimestamp) {
                    permanentActiveCodes.push(codeData);
                } else { 
                    expiredCodes.push({
                        ...codeData,
                        wasPermanent: true
                    });
                }
            });
            
            return { regularActiveCodes, permanentActiveCodes, expiredCodes };
        }

        function formatDate(date) {
            // Ensure the date object is valid before formatting
            if (!date || isNaN(date.getTime())) {
                return "Invalid Date";
            }
            // Convert to user's local time with clear timezone info
            const userLocalTime = date.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZoneName: 'short'
            });
            
            // Get the user's timezone
            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            return `${userLocalTime} (Your Timezone: ${userTimezone})`; 
        }

function createPermanentCodeBox(codeData, index) {
    const hasCopyButton = codeData.showCopyButton !== false;
    const hasPreviewButton = codeData.showPreviewButton;
    const isRedeemed = getRedemptionStatus(codeData.code);
    const redeemedClass = isRedeemed ? 'permanent-redeemed' : '';
    const iconHtml = createIconHtml(codeData.icon, true);
    
    const descriptionHtml = codeData.description ? `<div class="code-description permanent-description">${codeData.description}</div>` : '';

    const formattedDate = getFormattedDateAdded(codeData);
    const dateAddedHtml = formattedDate ? `<div class="date-added">Added Here On : ${formattedDate}</div>` : '';
    
    // --- START: ADDED THIS BLOCK TO HANDLE THE REPORT BUTTON ---
    let reportButtonHtml = '';
    // Only show the button if showReportButton is explicitly set to true or implied
    if (codeData.showReportButton === true || codeData.showReportButton === undefined) {
        const codeToCheck = codeData.code.trim();
        const isReportedLocally = getReportedStatus(codeToCheck);
        if (isReportedLocally) {
            reportButtonHtml = `<button class="report-btn-corner reported" title="This Has Been Reported" disabled>‚úîÔ∏è</button>`;
        } else {
            reportButtonHtml = `<button class="report-btn-corner" onclick="openReportModal('${codeToCheck}')" title="Reports As Not Working">‚ö†Ô∏è</button>`;
        }
    }
    // --- END: ADDED BLOCK ---

    let expirationHtml = '';
    if (codeData.expires === "UED") {
        expirationHtml = `<div class="expire-date">Expires: Unknown</div>`;
    } else if (codeData.expires) {
        let expiresDate;
        try {
            expiresDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
            if (!isNaN(expiresDate.getTime())) {
                const timeLeft = expiresDate.getTime() - new Date().getTime();
                let countdownHtml = '';
                
                // *** THIS IS THE KEY: Include the countdown if time is left OR if it's a known event/drop (like "No Code") ***
                if (timeLeft > 0) { 
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    
                    // Ensure countdown is generated if time remains
                    countdownHtml = `<div class="countdown">Time left: ${days}d ${hours}h ${minutes}m</div>`;
                }
                
                expirationHtml = `<div class="expire-date">Expires: ${formatDate(expiresDate)}</div>${countdownHtml}`;
            }
        } catch (e) {
            console.error("Error parsing expires date:", e);
        }
    }
    
    let copyButtonHtml = ''; if (hasCopyButton) { copyButtonHtml = `<button class="permanent-copy-btn" onclick="copyToClipboard('${codeData.code}', ${index}, 'permanent')">COPY</button><span id="copied-permanent-${index}" class="permanent-copied-message">‚úì Copied!</span>`; }
    let previewButtonHtml = ''; if (hasPreviewButton && codeData.imagePreview) { previewButtonHtml = `<button class="prempreview-btn" onclick="openImagePreview('${codeData.imagePreview}')">üì∑ PREVIEW</button>`; }
    
    return `
        <div class="permanent-code-box clearfix ${redeemedClass}" id="permanent-${index}" data-code-id="${codeData.code}" data-code-value="permanent-${index}">
            ${reportButtonHtml}
            <div class="permanent-code-header">${iconHtml}<div class="permanent-code-text">${codeData.code}</div></div>
            ${dateAddedHtml}
            <div class="permanent-title-container">${codeData.title}</div>
            ${descriptionHtml}
            ${expirationHtml}
<div class="permanent-code-footer">
            
          <div class="code-footer-left-group">           <div class="permredeem-checkbox">
             <input type="checkbox" id="permanent-redeemed-${index}" ${isRedeemed ? 'checked' : ''} onchange="handlePermanentRedemptionChange('${codeData.code}', this, document.getElementById('permanent-${index}'))">
             <label for="permanent-redeemed-${index}">üéÅ</label>
           </div>
          
               <button class="hide-code-btn" onclick="toggleCodeVisibility('permanent', ${index})">üëÅÔ∏è</button>
         </div>          <div class="permanent-action-buttons-group">
             ${previewButtonHtml}${copyButtonHtml}
             <button class="permanent-copy-btn" style="background: linear-gradient(to bottom, #3A3A3A, #252525);" onclick="openShareModal('${codeData.code}', 'permanent', 5)">üîó</button>
           </div>

        </div>
        </div>`;
}


// REPLACE your entire createActiveCodeBox function with this one

function createActiveCodeBox(codeData, index) {
    const hasCopyButton = codeData.showCopyButton !== false;
    const hasPreviewButton = codeData.showPreviewButton;
    const isRedeemed = getRedemptionStatus(codeData.code);
    const redeemedClass = isRedeemed ? 'redeemed' : '';
    const iconHtml = createIconHtml(codeData.icon, false, 'active-code');
    const descriptionHtml = codeData.description ? `<div class="code-description">${codeData.description}</div>` : '';
    const formattedDate = getFormattedDateAdded(codeData);
    const dateAddedHtml = formattedDate ? `<div class="date-added">Added Here On : ${formattedDate}</div>` : '';

    let expirationDetailsHtml = '';
    // ... (rest of expiration logic is unchanged, so I've shortened it for clarity) ...
    if (codeData.expires === "UED") { expirationDetailsHtml = `<div class="expire-date">Expires: Unknown</div>`; } else if (codeData.expires) { let expiresDate; try { expiresDate = new Date(codeData.expires); if (!isNaN(expiresDate.getTime())) { const timeLeft = expiresDate.getTime() - new Date().getTime(); if (timeLeft > 0) { const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24)); const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60)); expirationDetailsHtml = `<div class="expire-date">Expires: ${formatDate(expiresDate)}</div><div class="countdown">Time left: ${days}d ${hours}h ${minutes}m</div>`; } } } catch (e) { console.error("Error parsing expires date:", e); } } else { expirationDetailsHtml = `<div class="expire-date">Expires: Never (Permanent Code)</div>`; }
    
    // --- START: FIXED LOGIC BLOCK ---
    let reportButtonHtml = '';
    if (codeData.showReportButton !== false) {
        
        const codeToCheck = codeData.code.trim();
        const isReportedLocally = getReportedStatus(codeToCheck);
        
        if (isReportedLocally) {
            // Consolidated logic: If reported, show the checked icon and disable
            reportButtonHtml = `<button class="report-btn-corner reported" title="You have already reported this code. Thank you!" disabled>‚úîÔ∏è</button>`;
        } else {
            // If not reported, show the report button
            reportButtonHtml = `<button class="report-btn-corner" onclick="openReportModal('${codeToCheck}')" title="Reports As Not Working">‚ö†Ô∏è</button>`;
        }
    }
    // --- END: FIXED LOGIC BLOCK ---

    let copyButtonHtml = ''; if (hasCopyButton) { copyButtonHtml = `<button class="small-copy-btn" onclick="copyToClipboard('${codeData.code}', ${index}, 'active')">COPY</button>`; }
    let previewButtonHtml = ''; if (hasPreviewButton && codeData.imagePreview) { previewButtonHtml = `<button class="activepreview-btn" onclick="openImagePreview('${codeData.imagePreview}')">üì∑ PREVIEW</button>`; }
    
    return `
<div class="code-box ${redeemedClass}" id="active-${index}" data-code-id="${codeData.code}" data-code-value="active-${index}"> 
            ${reportButtonHtml}
            <div class="code-header">${iconHtml}<div class="title-container">${codeData.title}</div></div>
            ${dateAddedHtml}
            ${descriptionHtml}
            <div class="code-text">${codeData.code}</div>
            ${expirationDetailsHtml}
            <div class="code-footer">
                <div class="actredeem-checkbox"><input type="checkbox" id="redeemed-${index}" ${isRedeemed ? 'checked' : ''} onchange="handleRedemptionChange('${codeData.code}', this, document.getElementById('active-${index}'))"><label for="redeemed-${index}">üëç</label></div>

    <button class="hide-code-btn" onclick="toggleCodeVisibility('active', ${index})"> üëÅÔ∏è </button> <!-- CHANGED: Calls with type and index -->

                <div class="active-code-buttons-group">${previewButtonHtml}${copyButtonHtml} <button class="small-share-btn" onclick="openShareModal('${codeData.code}', 'active')">üîó</button> </div>
            </div>
        </div>`;
}


        function createExpiredCodeBox(codeData, index) {
            const hasPreviewButton = codeData.showPreviewButton;
            const isRedeemed = getRedemptionStatus(codeData.code);
            const redeemedClass = isRedeemed ? 'redeemed' : '';
            const iconHtml = createIconHtml(codeData.icon, false);
            
            const descriptionHtml = codeData.description ? 
                `<div class="code-description expired-description">${codeData.description}</div>` : '';
            
            const formattedDate = getFormattedDateAdded(codeData);
            const dateAddedHtml = formattedDate ? `<div class="date-added">Added Here On : ${formattedDate}</div>` : '';
            
            // --- NEW LOGIC STARTS HERE ---
            // Check for the showCopyButton property, defaulting to true if it's missing.
            const hasCopyButton = codeData.showCopyButton !== false;
            let copyButtonHtml = ''; // Create an empty placeholder

            // Only create the button HTML if hasCopyButton is true.
            if (hasCopyButton) {
                copyButtonHtml = `
                    <button class="expired-copy-btn" onclick="copyToClipboard('${codeData.code}', ${index}, 'expired')">
                        COPY
                    </button>
                    <span id="copied-expired-${index}" class="copied-message">‚úì Copied!</span>
                `;
            }
            // --- NEW LOGIC ENDS HERE ---
            
            let previewButtonHtml = '';
            if (hasPreviewButton && codeData.imagePreview) { 
                previewButtonHtml = `<button class="exppreview-btn" onclick="openImagePreview('${codeData.imagePreview}')">üì∑ PREVIEW</button>`;
            }
            
            let expiresDate;
            try {
                expiresDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                if (isNaN(expiresDate.getTime())) { expiresDate = new Date(); }
            } catch (e) {
                expiresDate = new Date();
            }

            return `
                <div class="expired-code-box ${redeemedClass}" id="expired-${index}" data-code-id="${codeData.code}">
                    <div class="code-header">
                        ${iconHtml}
                        <div class="title-container">${codeData.title}</div>
                    </div>
                    
                    ${dateAddedHtml}
                    ${descriptionHtml}
                    
                    <div class="code-text">${codeData.code}</div>
                    <div class="expire-date">Expired: ${formatDate(expiresDate)}</div>
                    <div class="code-footer">
                        <div class="redeem-checkbox">
                            <input type="checkbox" id="expired-redeemed-${index}" ${isRedeemed ? 'checked' : ''} 
                                onchange="handleRedemptionChange('${codeData.code}', this, document.getElementById('expired-${index}'))">
                            <label for="expired-redeemed-${index}">üëé</label>
                        </div>
                        <div class="active-code-buttons-group">
                            ${previewButtonHtml} 
                            
                            <!-- Use the new variable which is either the button or an empty string -->
                            ${copyButtonHtml}
                            
                        </div>
                    </div>
                    <div class="expired-text">‚ùå EXPIRED</div>
                </div>
            `;
        }

        function updateCountdowns() {
            const now = new Date();
            const nowTimestamp = now.getTime();
            
            // Update active codes
            const activeContainers = document.querySelectorAll('#active-codes-container .code-box');
            activeContainers.forEach((container) => {
                const countdownElement = container.querySelector('.countdown');
                const codeTextElement = container.querySelector('.code-text');
                
                if (!countdownElement || !codeTextElement) return;
                
                const codeText = codeTextElement.textContent;
                // Find the correct code data from ALL_CODES_CONFIG (excluding the vendor for this loop)
                const codeData = ALL_CODES_CONFIG.find(code => code.code === codeText);
                
                // NEW: Skip if no codeData, no expires property, or if expires is "UED"
                if (!codeData || !codeData.expires || codeData.expires === "UED") {
                    return;
                }
                
                let expireDate;
                try {
                    expireDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                    if (isNaN(expireDate.getTime())) {
                        console.error("Invalid expires date in updateCountdowns (active) for:", codeData.code, codeData.expires);
                        countdownElement.textContent = 'Invalid Date';
                        countdownElement.style.color = '#ff4444';
                        return;
                    }
                } catch (e) {
                    console.error("Error parsing expires date in updateCountdowns (active) for:", codeData.code, codeData.expires, e);
                    countdownElement.textContent = 'Error Date';
                    countdownElement.style.color = '#ff4444';
                    return;
                }

                const timeLeft = expireDate.getTime() - nowTimestamp;
                
                if (timeLeft <= 0) {
                    countdownElement.textContent = 'EXPIRED';
                    countdownElement.style.color = '#ff4444';
                    // Note: This only updates the text. To *move* the box, you'd need more complex DOM manipulation
                    // or re-initialize the page which happens on a full refresh.
                } else {
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                    
                    countdownElement.textContent = `Time left: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                    countdownElement.style.color = '#ff7c00';
                }
            });
            
            // Update permanent codes countdowns
            const permanentContainers = document.querySelectorAll('#permanent-codes-container .permanent-code-box');
            permanentContainers.forEach((container) => {
                const countdownElement = container.querySelector('.countdown');
                const codeTextElement = container.querySelector('.permanent-code-text');
                
                if (!countdownElement || !codeTextElement) return;
                
                const codeText = codeTextElement.textContent;
                const codeData = PERMANENT_CODES.find(code => code.code === codeText);
                
                // NEW: Skip if no codeData, no expires property, or if expires is "UED"
                if (!codeData || !codeData.expires || codeData.expires === "UED") {
                    if (countdownElement) countdownElement.textContent = ''; 
                    return;
                }
                
                let expireDate;
                try {
                    expireDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                    if (isNaN(expireDate.getTime())) {
                        console.error("Invalid expires date in updateCountdowns (permanent) for:", codeData.code, codeData.expires);
                        countdownElement.textContent = 'Invalid Date';
                        countdownElement.style.color = '#ff4444';
                        return;
                    }
                } catch (e) {
                    console.error("Error parsing expires date in updateCountdowns (permanent) for:", codeData.code, codeData.expires, e);
                    countdownElement.textContent = 'Error Date';
                    countdownElement.style.color = '#ff4444';
                    return;
                }

                const timeLeft = expireDate.getTime() - nowTimestamp;
                
                if (timeLeft <= 0) {
                    countdownElement.textContent = 'EXPIRED';
                    countdownElement.style.color = '#ff4444';
                } else {
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                    
                    countdownElement.textContent = `Time left: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                    countdownElement.style.color = '#ff7c00';
                }
            });
        }

        // ==================== AUTO CACHE DETECTION ====================
function getCodesHash() {
    // Include all code configs and the Black Market vendor's next refresh time
    const allCodesData = [...ALL_CODES_CONFIG, ...PERMANENT_CODES]; 
    const hashString = allCodesData.map(code => 
code.code + (code.expires ? (new Date(code.expires).getTime() || '') : '') + (code.dateAdded || '')
    ).join('|');

    // Add the next vendor refresh time to the hash to ensure refresh on vendor change
    const nextVendorRefreshTimestamp = getNextVendorRefresh().getTime();
    return btoa(hashString + `|VendorRefresh:${nextVendorRefreshTimestamp}`).substring(0, 32); 
}

        function checkCodesVersion() {
            const currentHash = getCodesHash();
            const savedHash = localStorage.getItem('shiftCodesHash');
            
            if (savedHash !== currentHash) {
                // Codes have changed - update and refresh
                localStorage.setItem('shiftCodesHash', currentHash);
                console.log('Codes updated, refreshing page...');
                location.reload();
                return true; // Page will refresh
            }
            
            return false; // No changes, continue normally
        }

function initializePage() {
        // === ADD THIS BLOCK AT THE TOP OF THE FUNCTION ===
    const pollButton = document.getElementById('openPollBtn');
    if (pollButton && !POLL_CONFIG.isEnabled) {
        pollButton.classList.add('hidden');
    }
    // 
    const permanentContainer = document.getElementById('permanent-codes-container');
    const activeContainer = document.getElementById('active-codes-container');
    const expiredContainer = document.getElementById('expired-codes-container');
    const blackMarketContainer = document.getElementById('black-market-codes-container'); 
    
    // Clear all containers to prevent duplicates
    permanentContainer.innerHTML = '';
    activeContainer.innerHTML = '';
    expiredContainer.innerHTML = '';
    blackMarketContainer.innerHTML = '';

    const { regularActiveCodes, permanentActiveCodes, expiredCodes } = organizeCodes();
    
    // --- THIS IS THE CORRECTED LOGIC ---
    // It now loops through your BLACK_MARKET_VENDORS array
    if (BLACK_MARKET_VENDORS && BLACK_MARKET_VENDORS.length > 0) {
        BLACK_MARKET_VENDORS.forEach((vendorData, index) => {
            blackMarketContainer.innerHTML += createBlackMarketVendorBox(vendorData, index);
        });
    } else {
        blackMarketContainer.innerHTML = '<div class="no-codes">Black Market Vendor information is currently unavailable.</div>';
    }
    // --- END OF CORRECTION ---
    
    // Render active codes
    if (regularActiveCodes.length > 0) {
        regularActiveCodes.forEach((codeData, index) => {
            activeContainer.innerHTML += createActiveCodeBox(codeData, index);
        });
    } else {
        activeContainer.innerHTML += '<div class="no-codes">No active regular codes at the moment. Check back later, Vault Hunter!</div>';
    }
    
    // Render permanent codes
    if (permanentActiveCodes.length > 0) {
        permanentActiveCodes.forEach((codeData, index) => {
            permanentContainer.innerHTML += createPermanentCodeBox(codeData, index);
        });
    } else {
        permanentContainer.innerHTML += '<div class="no-codes">No permanent codes available at this time.</div>';
    }
    
    // Render expired codes
    if (expiredCodes.length > 0) {
        expiredCodes.forEach((codeData, index) => {
            expiredContainer.innerHTML += createExpiredCodeBox(codeData, index);
        });
    } else {
        expiredContainer.innerHTML += '<div class="no-codes">No expired codes to display.</div>';
    }

        setupOptionalButtons();
    
    updateCountdowns(); // Initial call
// ... (rest of the function) ...
    setInterval(updateCountdowns, 1000); 
    applyDisplayPreferences();
    applySavedSectionStates();
        applyLastCopiedState();
        applyHideIshPreferences(); 
}

  let scrollYPosition = 0; // Defining this globally for the lock function

document.addEventListener('DOMContentLoaded', () => {
    // --- THIS IS THE NEW, ROBUST RESET LOGIC ---
    try {
        const nextRefreshTimestamp = getNextVendorRefresh().getTime();
        const lastKnownRefresh = localStorage.getItem('lastKnownRefresh');

        // If the upcoming refresh time is different from the last one we saved,
        // it means a weekly reset has happened since the last visit.
        if (lastKnownRefresh !== nextRefreshTimestamp.toString()) {
            clearBlackMarketStatusOnReset();
            // After cleaning up, save the new upcoming refresh time so we don't clean up again until the *next* reset.
            localStorage.setItem('lastKnownRefresh', nextRefreshTimestamp);
            console.log(`New refresh time set for: ${new Date(nextRefreshTimestamp)}`);
        }
    } catch (e) {
        console.error("Error in weekly reset detection logic:", e);
    }
    // --- END OF NEW LOGIC ---

    // The rest of the function remains the same
    if (!checkCodesVersion()) {
        initializePage();
    }

    // Connect the buttons to the NEW Panzoom control functions
            const zoomInButton = document.getElementById('zoom-in-btn');
            const zoomOutButton = document.getElementById('zoom-out-btn');
            const resetZoomButton = document.getElementById('reset-zoom-btn');
            const closeButton = document.getElementById('close-preview-btn');

            if (zoomInButton) zoomInButton.addEventListener('click', zoomIn);
            if (zoomOutButton) zoomOutButton.addEventListener('click', zoomOut);
            if (resetZoomButton) resetZoomButton.addEventListener('click', resetZoom);

            // This button's ID was different in my example, let's use the correct one from your HTML.
            // Assuming the close button in the control bar is the main one now.
            const newCloseButton = document.getElementById('close-preview-btn');
            if (newCloseButton) newCloseButton.addEventListener('click', closeImagePreview);
            
             // Close when clicking outside on the modal background
            const modal = document.getElementById('image-preview-modal');
            if(modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target.id === 'image-preview-modal') {
                        closeImagePreview();
                    }
                });
            }
        });

        // --- NEW: Functions for User Display Preferences ---
        function saveDisplayPreference(elementId, isHidden) {
            try {
                const preferences = JSON.parse(localStorage.getItem('userDisplayPreferences')) || {};
                preferences[elementId] = isHidden; // Store true if hidden, false if visible
                localStorage.setItem('userDisplayPreferences', JSON.stringify(preferences));
            } catch (e) {
                console.error("Error saving display preference to localStorage:", e);
            }
        }

        function getDisplayPreference(elementId) {
            try {
                const preferences = JSON.parse(localStorage.getItem('userDisplayPreferences')) || {};
                // Default to false (not hidden) if no preference is saved
                return preferences[elementId] || false; 
            } catch (e) {
                console.error("Error reading display preference from localStorage:", e);
                return false;
            }
        }

        function applyDisplayPreferences() {
            const controlledElements = ['settings-toggle-btn', 'redeem-toggle-btn', 'roadmap-btn', 'maurices-toggle-btn', 'permanent-toggle-btn'];

            controlledElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    const isHidden = getDisplayPreference(id);
                    element.classList.toggle('hidden', isHidden); // Add/remove 'hidden' class
                    
                    // Also update the state of the checkbox in the settings panel
                    const checkbox = document.getElementById(`hide-${id}`);
                    if (checkbox) {
                        checkbox.checked = isHidden;
                    }
                }
            });
        }

        function handleSettingChange(elementId, isHidden) {
            saveDisplayPreference(elementId, isHidden);
            applyDisplayPreferences(); // Re-apply all preferences immediately
        }
        // -- END NEW FUNCTIONS --

/* FEEDBACK QUESTIONS Webhook |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  */
/* =================================================== */
/* START: SLICK FEEDBACK MODAL SCRIPT          */
/* =================================================== */
document.addEventListener('DOMContentLoaded', () => {

    // --- 1. CONFIGURATION ---
    //
    // üö® FIX: PASTE YOUR REAL DISCORD WEBHOOK URL HERE! üö®
    const discordWebhookUrl = "https://discord.com/api/webhooks/1427139309588189265/ep1T-rbIqqhpwfes6t_86sgu8RqNrFaw782DrJozkrbKEJbYDbzL17bWKdZDrPUMJs2O";
    //
    const openModalButton = document.querySelector('.floating-feedback-btn');

    // --- 2. GETTING ELEMENTS ---
    const modalOverlay = document.getElementById('feedback-modal-overlay');
    const closeButton = document.querySelector('.feedback-close-btn');
    const feedbackForm = document.getElementById('feedback-form');
    const pages = document.querySelectorAll('.feedback-page');
    const prevBtn = document.getElementById('feedback-prev-btn');
    const nextBtn = document.getElementById('feedback-next-btn');
    const submitBtn = document.getElementById('feedback-submit-btn');
    const stepIndicator = document.getElementById('feedback-step-indicator');
    
    let currentPage = 0;
    // ‚úÖ FIX: totalFormSteps is the count of pages *before* the thank-you screen.
    // If you have 5 pages total, the last is index 4 (Thank You), so there are 4 steps.
    const totalFormSteps = pages.length - 1; 
    
    // --- 3. CORE FUNCTIONS ---
    
    function showPage(pageIndex) {
        pages.forEach((page, index) => {
            page.classList.toggle('active', index === pageIndex);
        });

        // The step indicator should only show for the stepping pages (not the final page)
        if (pageIndex < totalFormSteps) {
            stepIndicator.textContent = `Step ${pageIndex + 1} of ${totalFormSteps}`;
            stepIndicator.style.display = 'block';
        } else {
            stepIndicator.style.display = 'none';
        }
        
        // Hide 'Prev' on the first page
        prevBtn.style.display = pageIndex === 0 ? 'none' : 'inline-block';
        
        // Hide 'Next' on the page *before* the submit page and the final page
        nextBtn.style.display = pageIndex < totalFormSteps - 1 ? 'inline-block' : 'none';
        
        // Show 'Submit' on the last step page (which is totalFormSteps - 1)
        submitBtn.style.display = pageIndex === totalFormSteps - 1 ? 'inline-block' : 'none';

        // Hide all controls on the final 'Thank You' page
        if (pageIndex === totalFormSteps) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'none';
        }
    }

    function openModal() {
        if (!modalOverlay) return;
        currentPage = 0;
        feedbackForm.reset();
        showPage(currentPage);
        modalOverlay.style.display = 'flex';
    }

    function closeModal() {
        if (!modalOverlay) return;
        modalOverlay.style.display = 'none';
    }
    
    function validatePage(pageIndex) {
        // Validation is skipped for the optional social link page (Page 4) 
        // and the final "Thank You" page (Page 5, index 4 if total is 5 pages)
        if (pageIndex === 4 || pageIndex >= totalFormSteps) { // ‚úÖ FIX: Use totalFormSteps for the final page check
            return true; 
        }
        const currentPageElement = pages[pageIndex];
        let allValid = true;
        
        // 1. --- Validate required text/textarea inputs ---
        currentPageElement.querySelectorAll('input[required]:not([type="radio"]), textarea[required]').forEach(input => {
            input.classList.remove('invalid');
            if (input.value.trim() === '') {
                allValid = false;
                input.classList.add('invalid');
            }
        });
        
        // 2. --- Validate required radio groups ---
        const requiredRadioGroupNames = new Set();
        currentPageElement.querySelectorAll('.radio-group input[type="radio"][required]').forEach(input => {
            requiredRadioGroupNames.add(input.name);
        });

        requiredRadioGroupNames.forEach(name => {
            const isChecked = feedbackForm.querySelector(`input[name="${name}"]:checked`);
            const radioGroupElement = currentPageElement.querySelector(`input[name="${name}"]`)?.closest('.radio-group');
            
            // Clear prior visual error state
            if (radioGroupElement) {
                radioGroupElement.classList.remove('invalid');
            }
            
            if (!isChecked) {
                allValid = false;
                // Apply visual error state to the outer wrapper
                if (radioGroupElement) {
                    radioGroupElement.classList.add('invalid');
                }
            }
        });

        // If validation fails, scroll to the first invalid field/group
        if (!allValid) {
             const firstInvalid = currentPageElement.querySelector('.invalid');
             if (firstInvalid) firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        return allValid;
    }

async function submitFeedback() {
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    const formData = new FormData(feedbackForm);
    let messageContent = "**üìù New Feedback Submission!**\n\n";
    formData.forEach((value, key) => {
        if (value.trim() !== '') {
            messageContent += `**${key}:**\n\`\`\`${value}\`\`\`\n`;
        }
    });
    
    // THIS IS THE CORRECTED PAYLOAD
    const payload = {
        username: "Feedback Bot",
        avatar_url: "https://cdn-icons-png.flaticon.com/512/3991/3991971.png",
        content: messageContent,
        thread_name: `Feedback from: ${formData.get('Username') || 'Anonymous'}` // Dynamic title!
    };

    try {
        const response = await fetch(discordWebhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
        });

        if (response.ok) {
            currentPage++;
            showPage(currentPage);
        } else {
            // This alert will now give you a more specific error from Discord
            const errorData = await response.json();
            alert(`Error from Discord: ${errorData.message}`);
        }
    } catch (error) {
        alert('A network error occurred. Please check your connection and try again.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit';
    }
}

    // --- 4. EVENT LISTENERS ---
    if (openModalButton) openModalButton.addEventListener('click', openModal);
    if (closeButton) closeButton.addEventListener('click', closeModal);
    // REMOVED THE COMMENT SLASHES TO ALLOW CLOSING ON OVERLAY CLICK
    if (modalOverlay) modalOverlay.addEventListener('click', e => { if (e.target === modalOverlay) closeModal(); }); 
    if (nextBtn) nextBtn.addEventListener('click', () => { if (validatePage(currentPage)) { currentPage++; showPage(currentPage); } });
    // NO CHANGE NEEDED HERE
    if (prevBtn) prevBtn.addEventListener('click', () => { currentPage--; showPage(currentPage); }); 
    if (submitBtn) submitBtn.addEventListener('click', submitFeedback);
});
/* =================================================== */
/* END: SLICK FEEDBACK MODAL SCRIPT          */
/* =================================================== */

    </script>

<!-- START: New Ko-fi Modal -->
<div id="kofi-modal-overlay" style="display: none;">
    <div class="modal-content">
        <button class="close-modal" onclick="closeKofiModal()">√ó</button>
        <div id="kofi-iframe-container"></div>
    </div>
</div>

<!-- This is your image preview modal from your original HTML -->
<div id="image-preview-modal" class="image-preview-modal">
    <div class="image-preview-content">
        <div id="preview-container" style="display: none;">
            <!-- Iframe or video will be injected here by JavaScript -->
        </div>
        <img id="preview-image" src="" alt="Preview" style="display: none;">
    </div>
    <!-- These are the new controls for zooming and closing -->
    <div id="image-preview-controls">
        <button class="control-btn" id="zoom-in-btn" title="Zoom In">+</button>
        <button class="control-btn" id="zoom-out-btn" title="Zoom Out">-</button>
        <button class="control-btn" id="reset-zoom-btn" title="Reset Zoom">‚ü≤</button>
        <button class="control-btn" id="close-preview-btn" title="Close">√ó</button>
    </div>
</div>
<!-- END: New Ko-fi Modal -->
<script>

 /* =================================================== */
/*          start: report  MODAL SCRIPT           */
/* =================================================== */   
document.addEventListener('DOMContentLoaded', () => {
    const reportForm = document.getElementById('report-form');
    
    // Define allowed domains here for easy maintenance
    const ALLOWED_DOMAINS = ['imgur.com', 'postimg.cc', 's3nd.me'];

    /**
     * Validates the proof link against the allowed domains.
     * @param {string} url The URL string to validate.
     * @returns {boolean} True if the domain is allowed, false otherwise.
     */
    function isValidProofLink(url) {
        if (!url || typeof url !== 'string') return false;
        try {
            const hostname = new URL(url).hostname;
            return ALLOWED_DOMAINS.some(domain => 
                hostname === domain || hostname.endsWith('.' + domain)
            );
        } catch (e) {
            return false; // Invalid URL format
        }
    }

    // The function that handles the submission logic
    function handleReportSubmit(event) {
        event.preventDefault(); // Stop default form submission

        const proofLinkInput = document.getElementById('proof-link');
        const linkValue = proofLinkInput.value.trim();

        // --- LINK VALIDATION ---
        if (!isValidProofLink(linkValue)) {
            alert(`Invalid proof link. Please use a link from one of the supported services: ${ALLOWED_DOMAINS.join(', ')}`);
            return; // Stop submission if validation fails
        }
        // --- END LINK VALIDATION ---

        // If validation passes, proceed with your actual submission logic here:
        console.log("Report is valid. Submitting data...");
        
        // e.g., send data via fetch/XHR, then call closeReportModal() on success.
        
        // TEMPORARY: For demonstration, we close the modal immediately after successful validation
        closeReportModal(); 
    }

    // If the form exists on the page...
    if (reportForm) {
        // ...listen for its 'submit' event and call the handleReportSubmit function when it happens.
        reportForm.addEventListener('submit', handleReportSubmit);
    }
});

// Assuming closeReportModal is defined elsewhere in your script
function closeReportModal() {
    const modal = document.getElementById('report-modal');
    if (modal) {
        modal.style.display = 'none';
    }
}
 /* =================================================== */
/*          END: report  MODAL SCRIPT           */
/* =================================================== */ 

 /* =================================================== */
/*                 notifcation script                    */
/* =================================================== */ 
document.addEventListener('DOMContentLoaded', () => {
    
    // 1. Setup (unchanged)
    const notifButton = document.getElementById('notif-permission-btn');

    if ("Notification" in window && notifButton) {
        updateButtonDisplay(Notification.permission);
        notifButton.onclick = requestNotificationPermission; 
    }
    
    // 2. Run the check once immediately (with a short delay to load)
    setTimeout(checkAndShowNotification, 3000); 
    
    // 3. Start the continuous polling loop (THE VITAL STEP)
    // The browser will now run this in the background, triggering the notification.
    setInterval(checkAndShowNotification, POLLING_INTERVAL_MS);
});
 /* =================================================== */
/*             end  notifcation script                    */
/* =================================================== */ 

 /* =================================================== */
/*                     AUTO-REFRESH                    */
/* =================================================== */ 
// === NEW: ISOLATED DOMContentLoaded FOR AUTO-REFRESH ===
document.addEventListener('DOMContentLoaded', () => {
    // This listener ONLY starts the 10-minute periodic refresh.
    // It does not interfere with version checking or other initializations.
    setupAutoRefresh(); 
});
 /* =================================================== */
/*                END  AUTO-REFRESH                     */
/* =================================================== */ 

</script>

</body>
</html>
