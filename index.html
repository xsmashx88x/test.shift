<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" type="image/png" href="https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png">
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHiFT Codes - Tracker + More</title>
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="Borderlands SHiFT Codes - Tracker + More">
    <meta property="og:description" content="Track and manage Borderlands SHiFT codes + More">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card tags -->
    <meta name="twitter:title" content="Borderlands SHiFT Codes - Tracker + More">
    <meta name="twitter:description" content="Track and manage Borderlands SHiFT codes + More">
        <script src="https://cdn.jsdelivr.net/npm/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
  <body>



    <div class="noise"></div>
    <div class="scanlines"></div>
    
    <div class="container">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;600;700&display=swap');
        

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Chakra Petch', sans-serif;
            text-align: center;
            padding: 20px;
            background: #000000;
            color: #fff;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 30%, #000000 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, #000000 0%, transparent 50%);
        }
        
        .container {
            max-width: 650px;
            margin: 0 auto;
            background: rgb(31 31 31);
            padding: 25px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(255, 198, 0, 0.4);
            border: 2px solid #ffc600;
            position: relative;
        }
        
        .container:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ffc600, #ff7c00, #ffc600);
            box-shadow: 0 0 10px #ffc600;
        }
/* button for feedback |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
/* START: Thin Line Tally Button */
/* START: Corrected Thin Line Tally Button Styles */

/* START: Solid Thin Line Tally Button */


/* === START: NEW STYLE FOR LAST COPIED ITEM === */
.code-box.last-copied,
.permanent-code-box.last-copied,
.expired-code-box.last-copied,
.black-market-code-box.last-copied {
    border: 2px solid #00ffff !important; /* A bright cyan border */
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.6) !important; /* A matching cyan glow */
}
/* === END: NEW STYLE === */

/* === START: FINAL CORRECTED & FORCED POLL STYLES === */
.floating-poll-btn {
    position: fixed;
    bottom: 125px;
    left: 20px;
    z-index: 1003;
    background-color: #8A2BE2; /* Purple */
    color: white;
    border: 2px solid #fff;
    border-radius: 50px;
    padding: 10px 25px;
    font-family: 'Chakra Petch', sans-serif;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    transition: all 0.2s ease-in-out;
}

.floating-poll-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px #8A2BE2;
}

.poll-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 2500;
    justify-content: center;
    align-items: center;
}

/* This container now FORCES the size and shape */
.poll-modal-content {
    position: relative;
    width: 800px !important;  /* Force width */
    height: 380px !important; /* Force height */
    border: 3px solid #8A2BE2;
    border-radius: 8px;
    overflow: hidden; /* Crucial for rounding iframe corners */
    display: flex;
}

.close-poll-btn {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    line-height: 30px;
    text-align: center;
    z-index: 2501;
}

/* These rules force the poll content to fill the container */
.poll-modal-content .strawpoll-embed,
.poll-modal-content .strawpoll-embed iframe {
    width: 100% !important;
    height: 100% !important;
    display: block; /* Removes extra spacing */
}
/* === END: FINAL CORRECTED & FORCED POLL STYLES === */
/* ===== FAINT BACKGROUND IMAGE FOR ACTIVE CODES ===== */

/* 1. Prepare the main code box to contain a background layer */
.code-box {
    position: relative; /* This is crucial for positioning the background image */
    overflow: hidden;   /* This prevents the background image from spilling outside the box */
}

/* 2. Create a pseudo-element that will act as the background image layer */
.code-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;

    /* --- CUSTOMIZE YOUR IMAGE HERE --- */
    background-image: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/activekeysv2.png'); /* URL to the Vault Symbol image */

    background-repeat: no-repeat;
    background-position: center;
    background-size: cover; /* 'contain' fits the whole image; 'cover' fills the whole box */
    
    /* --- MAKE IT FAINT --- */
    opacity: 0.1; /* Adjust between 0.0 (invisible) and 1.0 (fully visible) */
    
    z-index: 0; /* Places this layer behind the text and other content */
}

/* 3. Ensure the actual content (text, buttons, etc.) sits on top of the new background */
.code-box > * {
    position: relative;
    z-index: 1;
}

/* =================================================== */
/*    FAINT BACKGROUND IMAGES FOR OTHER CODE BOXES     */
/* =================================================== */

/* ===== 1. EXPIRED CODES ===== */
.expired-code-box {
    position: relative;
    overflow: hidden;
}
.expired-code-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    /* --- CUSTOMIZE YOUR IMAGE HERE --- */
    background-image: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/expiredcodes.png'); /* Suggested: Red/Cracked Vault Symbol */
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    opacity: 0.1; /* Very faint for expired boxes */
    z-index: 0;
}

/* ===== 2. BLACK MARKET CODES ===== */
.black-market-code-box {
    position: relative;
    overflow: hidden;
}
.black-market-code-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    /* --- CUSTOMIZE YOUR IMAGE HERE --- */
    background-image: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/blackmarketbgv1.png'); /* Suggested: Maurice Icon */
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    opacity: 0.1; /* Adjust faintness */
    z-index: 0;
}

/* ===== 3. PERMANENT/DROP CODES ===== */
.permanent-code-box {
    position: relative;
    overflow: hidden;
}
.permanent-code-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    /* --- CUSTOMIZE YOUR IMAGE HERE --- */
    background-image: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/dropskinsanmore.png'); /* Suggested: Diamond Key Icon */
    background-repeat: no-repeat;
    background-position: center;
    background-size: cover;
    opacity: 0.1; /* Adjust faintness */
    z-index: 0;
}

/* ===== 4. ENSURE CONTENT STAYS ON TOP (Apply to all boxes) ===== */
.expired-code-box > *,
.black-market-code-box > *,
.permanent-code-box > * {
    position: relative;
    z-index: 1;
}


/* =================================================== */
/*        FINAL: INTERACTIVE FLOATING INFO PANEL       */
/* =================================================== */

/* --- 1. The Main Container --- */
/* This is the element that floats and contains everything */
.floating-info-panel {
    /* REMOVED: position, top, left, transform, z-index */
    position: relative; /* This makes it a normal block element */
    width: 100%;      /* Make it span the full width of the container */
    margin-bottom: 0px; /* Add space between it and the "Connect/Contact" button below */
    
    background: rgba(20, 15, 25, 0.9);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid #ff7c00;
    border-radius: 4px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.6);
    
    text-align: center;
    transition: all 0.3s ease-in-out;
}

/* --- 2. The Always-Visible Text Block --- */
.visible-reminder-text {
    color: #ffc600;
    font-family: 'Chakra Petch', sans-serif;
    font-size: 12px;
    font-weight: 600;
    text-shadow: 1px 1px 1px #000;
    text-transform: uppercase;
    padding: 8px 12px;
    user-select: none;
    line-height: 1.0;
}

/* --- 3. The Smaller Clickable Link --- */
.thank-you-link {
    display: block; /* Makes it take its own line */
    margin-top: 5px; /* Space from the text above */
    color: #00ffff; /* A different color to show it's a special link */
    font-size: 12px;
    font-weight: 700;
    text-decoration: none;
    cursor: pointer;
    transition: color 0.2s ease;
    position: relative; /* Needed for the arrow */
}

.thank-you-link:hover {
    color: #fff;
}

/* --- 4. The Hidden Content (Default State) --- */
.thank-you-content {
    color: #f7f4f0;
    font-size: 14px;
    line-height: 1.6;
    text-align: left;
    
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out, border 0.3s ease;
    padding: 0 15px;
    border-top: 1px solid transparent;
}

.thank-you-content h4 { color: #fff; margin-bottom: 8px; }
.thank-you-content ul { list-style-type: none; padding-left: 0; }
.thank-you-content li { margin-bottom: 5px; }

/* --- 5. The "Open" State --- */
.floating-info-panel.is-open .thank-you-content {
    max-height: 70vh; /* Set a max height based on 70% of the screen's height */
    overflow-y: auto; /* Add a vertical scrollbar ONLY when the content is too long */
    padding: 15px;
    border-top: 1px solid rgba(255, 124, 0, 0.5);
}

/* --- 6. The Animated Arrow on the Link --- */
.thank-you-link::after {
    content: '‚ñº';
    font-size: 10px;
    margin-left: 8px;
    display: inline-block;
    transition: transform 0.3s ease-in-out;
}

.floating-info-panel.is-open .thank-you-link::after {
    transform: rotate(180deg); /* Flips arrow up */
}


/*|||||||||||||||||||||||||||||||||||||||||||||||||||||*/

 /* Title section text ish        ||||||||||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||*/
      /* activekeys title color |||||||||||||||||||||||||*/    
        h1 {
            color: #ffc600;
            margin-bottom: 15px;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 0 #000, 0 0 2px rgba(255, 198, 0, 0.7);
            font-weight: 700;
        }
    /* perm drops title color |||||||||||||||||||||||||*/
        h2 {
            color: #FF00F7;
            margin: 25px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #ff7c00;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 0 #000;
        }
            /* expired |||||||||||||||||||||||||*/
        h3 {
            color: #F91515;
            margin: 25px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #ff7c00;
            font-size: 22px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 1px 1px 0 #000;
        }
        
        /* Social links styling ||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||||||||||||*/
/* =================================================== */
/*           HIGH-TECH CONTACT ME SECTION              */
/* =================================================== */

/* =================================================== */
/*    INTERACTIVE HIGH-TECH CONTACT ME SECTION (v2)    */
/* =================================================== */

/* --- The Main Wrapper --- */
.contact-me-section {
    border: 2px solid #00ffff;
    padding: 20px 15px;
    margin: 10px 0;
    background: rgba(17, 26, 34, 0.6);
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
    text-align: center;
    clip-path: polygon(0 0, 100% 0, 100% 95%, 95% 100%, 0 100%);
    border-radius: 0;
    
    /* NEW: Add a transition to the container itself for smooth size changes */
    transition: padding-bottom 0.4s ease-in-out;
}

/* --- The "Contact Me" Title --- */
.contact-me-title {
    color: #00ffff;
    font-family: 'Chakra Petch', sans-serif;
    text-transform: uppercase;
    font-weight: 700;
    font-size: 18px;
    letter-spacing: 2px;
    text-shadow: 0 0 2px rgba(0, 255, 255, 0.8);
    margin: 0;
    
    /* NEW: Make the title look clickable */
    cursor: pointer;
}

/* =================================================== */
/*           THE SLIDE-DOWN EFFECT LOGIC (CORRECTED)   */
/* =================================================== */

/* 1. This new wrapper now handles the slide-down animation */
.slide-down-content {
    /* --- HIDING & ANIMATION LOGIC --- */
    max-height: 0;
    overflow: hidden;
    margin: 0;
    transition: max-height 0.4s ease-in-out, margin-top 0.4s ease-in-out;
}

/* 2. The hover effect now targets the new wrapper to reveal everything */
.contact-me-section:hover .slide-down-content {
    max-height: 200px; /* Adjust if content gets taller */
    margin-top: 20px;
}

/* --- REPLACE THE OLD .info-text RULE WITH THIS --- */
.info-text {
    /* Copied from your .social-links a style */
    color: #00ffff;
    text-decoration: none;
    font-size: 16px;
    font-weight: 700;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    clip-path: polygon(0 0, 100% 0, 100% 75%, 90% 100%, 0 100%);
    border-radius: 0;
    background: #111a22;
    border: 2px solid #00ffff;
    text-shadow: 0 0 2px rgba(0, 255, 255, 0.7);
    box-shadow: inset 0 0 5px rgba(0, 255, 255, 0.3);

    /* Properties to make it center and wrap nicely */
    display: block;           /* Make it a block element */
    width: fit-content;       /* Size the "button" to the text inside it */
    margin: 0 auto 15px auto; /* Center it horizontally and add space below */
}

/* 4. Your original .social-links rule, now ONLY for button layout */
.social-links {
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
}

/* 5. YOUR ORIGINAL BUTTON STYLES - UNCHANGED AND PERFECT */
.social-links a {
    color: #00ffff;
    text-decoration: none;
    font-size: 16px;
    font-weight: 700;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 15px;
    clip-path: polygon(0 0, 100% 0, 100% 75%, 90% 100%, 0 100%);
    border-radius: 0;
    background: #111a22;
    border: 2px solid #00ffff;
    text-shadow: 0 0 2px rgba(0, 255, 255, 0.7);
    box-shadow: inset 0 0 5px rgba(0, 255, 255, 0.3);
    transition: all 0.2s ease;
}

.social-links a:hover,
.social-links a:focus-visible {
    color: #111a22;
    background: #00ffff;
    transform: translateY(-2px);
    box-shadow: 0 2px 15px rgba(0, 255, 255, 0.5);
    outline: none;
}

/*||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/

 /* active and perm code boxs |||||||||||||||||||||||||*/       
        .code-box {
            background: linear-gradient(135deg, #3A2A1A, #5C3C10); /* Gold-themed */
            color: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            text-align: left;
            transition: transform 0.2s;
            border: 2px solid #D4A017; 
            box-shadow: 0 0 8px rgba(212, 160, 23, 0.3); 
            position: relative;
        }

        .code-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 12px rgba(255, 179, 71, 0.5); 
        }
  /* old perm box? keep as it does the style |||||||||||||||||||||||||*/       
        .permanent-code-box {
            background: linear-gradient(135deg, #1b3b6a 0%, #0f2552 100%);
            color: white;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: left;
            transition: transform 0.2s;
            border: 1px solid #4a90e2;
            box-shadow: 0 0 4px rgba(74, 144, 226, 0.4);
            position: relative;
        }
        
        .permanent-code-box:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 6px rgba(74, 144, 226, 0.6);
        }
/* New style for Black Market Vendor */
.black-market-code-box {
    background: linear-gradient(135deg, #4d0000, #2d0000); /* Dark red/black */
    border: 2px solid #ff4444; /* Red border */
    box-shadow: 0 0 8px rgba(255, 68, 68, 0.3);
    color: #ffcccc; /* Default text color */
    padding: 15px; /* This padding was already correct */
    margin: 12px 0; /* Changed from 15px to 12px to match .code-box */
    border-radius: 4px;
    text-align: left;
    transition: transform 0.2s;
    position: relative;
}
        .black-market-code-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 12px rgba(255, 68, 68, 0.5);
        }
        .black-market-code-box .code-text { color: #ffaa99; }
        .black-market-code-box .title-container { color: #ff9999; }
        .black-market-code-box .expire-date { color: #ffcccc; }
        .black-market-code-box .countdown {
            color: #ffaaaa;
            border: 1px solid #ffaaaa;
        }
        /* Redeemed style for black market vendor */
        .black-market-code-box.redeemed {
            opacity: 0.7;
            position: relative;
                        border: 2px solid #44ff44;
        }
        .black-market-code-box.redeemed::after {
            content: "REDEEMED";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 24px;
            font-weight: bold;
            color: #7cff7c; /* Green checkmark color */
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(124, 255, 124, 0.7);
            z-index: 10;
            pointer-events: none;
        }
        .black-market-code-box.redeemed .code-text {
            color: #7cff7c !important;
        }

/* style change for the  code box section |||||||||||||||||||||||||*/        
        .code-box {
            background: linear-gradient(135deg, #3A2A1A 0%, #5C3C10 100%);
            color: #D4A017;
            padding: 15px;
            margin: 12px 0;
            border-radius: 4px;
            text-align: left;
            border: 2px solid #D4A017;
            box-shadow: 0 0 5px rgba(255, 68, 68, 0.3);
            position: relative;
        }
        
        .code-box .code-text {
            color: #FFBC01;
            text-shadow: 1px 1px 0 #400000;
        }
        
        .code-box .title-container {
            color: #FFBC01;
        }
        
        .code-box .expire-date {
            color: #FFBC01;
        }
        
        .code-box.redeemed {
        /*    background: linear-gradient(135deg, #2c5a2c 100%, #1c3a1c 100%); */
            border: 2px solid #44ff44;
            box-shadow: 0 0 5px rgba(68, 255, 68, 0.3);
        }
        
        .code-boxredeemed .code-text {
            color: #7cff7c !important;
            text-shadow: 1px 1px 0 #004000;
        }
        
       /*    .expired-code-box.redeemed .title-container {
            color: #9eff9e;
        }  */
        
         /*  .expired-code-box.redeemed .expire-date {
            color: #aaffaa; 
        } */

/* style change for the expired code box section |||||||||||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||||||*/        
        .expired-code-box {
            background: linear-gradient(135deg, #5a2c2c 0%, #3a1c1c 100%);
            color: #ff9999;
            padding: 15px;
            margin: 12px 0;
            border-radius: 4px;
            text-align: left;
            border: 2px solid #ff4444;
            box-shadow: 0 0 5px rgba(255, 68, 68, 0.3);
            position: relative;
        }
        
        .expired-code-box .code-text {
            color: #ff6666;
            text-shadow: 1px 1px 0 #400000;
        }
        
        .expired-code-box .title-container {
            color: #ff9999;
        }
        
        .expired-code-box .expire-date {
            color: #ffaaaa;
        }
        
        .expired-code-box.redeemed {
        /*    background: linear-gradient(135deg, #2c5a2c 100%, #1c3a1c 100%); */
            border: 2px solid #44ff44;
            box-shadow: 0 0 5px rgba(68, 255, 68, 0.3);
        }
        
        .expired-code-box.redeemed .code-text {
            color: #7cff7c !important;
            text-shadow: 1px 1px 0 #004000;
        }
        
       /*    .expired-code-box.redeemed .title-container {
            color: #9eff9e;
        }  */
        
         /*  .expired-code-box.redeemed .expire-date {
            color: #aaffaa; 
        } */
/* active code text color gold  |||||||||||||||||||||||||*/            
        .code-text {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            margin: 12px 0;
            word-break: break-all;
            letter-spacing: 1px;
            color: #ffc600;
            text-shadow: 1px 1px 0 #000;
        }
 /* active code text color gold ffc600 : not sure if works  |||||||||||||||||||||||||*/          
        .permanent-code-text {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            margin: 0 0 4px 0;
            word-break: break-all;
            letter-spacing: 0.5px;
            color: #ffc600;
            text-shadow: 1px 1px 0 #000, 0 0 5px rgba(255, 198, 0, 0.7);
            line-height: 1.2;
        }
        
        .code-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 198, 0, 0.3);
        }
        
        .permanent-code-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding-top: 5px;
            border-top: 1px solid rgba(107, 168, 255, 0.3);
        }

 /* active copy button |||||||||||||||||||||*/       
        .small-copy-btn {
            background: linear-gradient(to bottom, #ff7c00, #e56a00);
            border: 1px solid #ffc600;
            color: #fff;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            order: 2;
        }
        
        .small-copy-btn:hover {
            background: linear-gradient(to bottom, #ff8c00, #ff6a00);
            transform: scale(1.05);
            box-shadow: 0 0 6px #ffc600;
        }
   /* permanent copy button |||||||||||||||||||||*/         
        .permanent-copy-btn {
            background: linear-gradient(to bottom, #B634D7, #AA2EC9);
            border: 1px solid #DE57FF;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            order: 2;
        }
        
        .permanent-copy-btn:hover {
            background: linear-gradient(to bottom, #AA2EC9, #B634D7);
            transform: scale(1.05);
            box-shadow: 0 0 4px #DE57FF;
        }
       /* expired copy button |||||||||||||||||||||*/         
        .expired-copy-btn {
            background: linear-gradient(to bottom, #EE2222, #DF2525);
            border: 1px solid #FF5757;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            order: 2;
        }
        
        .expired-copy-btn:hover {
            background: linear-gradient(to bottom, #DF2525, #EE2222);
            transform: scale(1.05);
            box-shadow: 0 0 4px #FF5757;
        }    
        .countdown {
            font-size: 14px;
            font-weight: bold;
            color: #ff7c00;
            margin: 8px 0;
            padding: 4px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            text-shadow: 1px 1px 0 #000;
            border: 1px solid #ff7c00;
        }
        
        .expire-date {
            font-size: 13px;
            color: #ff9e40;
            margin: 4px 0;
            font-style: italic;
            text-shadow: 1px 1px 0 #000;
        }
 /* active code text color gold 6ba8ff : not sure if works  |||||||||||||||||||||||||*/         
        .permanent-text {
            font-size: 10px;
            color: #E600FF;
            margin: 0;
            font-weight: bold;
            text-shadow: 1px 1px 0 #000, 0 0 3px rgba(107, 168, 255, 0.5);
            display: inline-block;
        }
        
        .copied-message {
            color: #7cff7c;
            font-weight: bold;
            display: none;
            margin-left: 5px;
            font-size: 11px;
            text-shadow: 1px 1px 0 #000;
            order: 3;
        }
        
        .permanent-copied-message {
            color: #7cff7c;
            font-weight: bold;
            display: none;
            margin-left: 5px;
            font-size: 11px;
            text-shadow: 1px 1px 0 #000;
            order: 3;
        }
        /* redeem button orange go to shift site ///////////////////*/        
/* This is the NEW button style */
.rewards-link {
    display: block;
    width: fit-content;            
    
    /* --- CHANGES ARE HERE --- */
    background: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/logo-cab3d495b9331db152448ceb0d5a52ebc2001b33aeca60e74419b730ee5a630f.png') no-repeat 15px center, linear-gradient(to bottom, #ff7c00, #e56a00);
    background-size: 320px 50px, auto; /* First value for image, second for gradient */
    padding: 2px 24px 2px 50px;       /* Increased left padding to make room for the image */
    /* --- END OF CHANGES --- */

    color: white;
    text-decoration: none;
    border-radius: 4px;
    margin: 10px auto 15px auto;
    font-weight: bold;
    transition: all 0.3s;
    font-size: 14px;
    text-transform: uppercase;
    border: 2px solid #ffc600;
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.5);
    font-family: 'Chakra Petch', sans-serif;
}
        
.rewards-link:hover {
    /* Add the image layer to the hover effect as well */
    background: url('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/logo-cab3d495b9331db152448ceb0d5a52ebc2001b33aeca60e74419b730ee5a630f.png') no-repeat 15px center, linear-gradient(to bottom, #ff8c00, #ff6a00);
    background-size: 320px 50px, auto; /* Don't forget to include size here too */
    
    transform: scale(1.05);
    box-shadow: 0 0 10px #ffc600;
}
              
            .info-button {
            display: block; /* Default to block for stacking */
            width: fit-content; /* Make width fit content */
            margin: 10px auto; /* Default for stacking: center horizontally, provide vertical space */
            flex-shrink: 0; /* Prevent shrinking when inside flex container */
            }
                    /* Specific adjustments for buttons inside .top-header-buttons */
        .top-header-buttons .info-button {
            margin: 0; /* Remove auto margins when inside flex, let gap handle spacing */
            margin-bottom: 10px; /* Add vertical margin for wrapping on mobile */
        }
        }
        
        /*|||||||||||||||||||||||||*/

        .collapse-btn {
            background: linear-gradient(to bottom, #555, #333);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 8px 0;
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #666;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
        }
        
        .collapse-btn:hover {
            background: linear-gradient(to bottom, #666, #444);
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }
        /* expired button color and style |||||||||||||||||||||||||*/
        .collapse-btn-exp {
            background: linear-gradient(to bottom, #46171D, #E82740);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 8px 0;
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #FF0022;
            text-shadow: 1px 1px 0 #FF0022;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
        }
        
        .collapse-btn-exp:hover {
            background: linear-gradient(to bottom, #E82740, #46171D);
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }
 /* drops an limited time codes an more button ish  |||||||||||||| ||||||||||||||||||||||||||||||||*/          
        .collapse-btn-Perm {
                        display: block;
            width: fit-content;
            background: linear-gradient(to bottom, #541375, #8519bb);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
margin: 10px auto;
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #b200ff;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
        }
        
        .collapse-btn-Perm:hover {
            background: linear-gradient(to bottom, #8519bb, #541375);
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }       
 
 /* New Black Market button style  ||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||||||||*/       
.collapse-btn-BlackMarket { 
                display: block;
                            width: fit-content;
            background: linear-gradient(to bottom, #CC0000, #800000); /* Red */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px auto;
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #FF4444; /* Brighter red border */
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
        }
        
        .collapse-btn-BlackMarket:hover {
            background: linear-gradient(to bottom, #FF0000, #600000); /* Brighter red on hover */
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 68, 68, 0.4); /* Red glow */
        }

 /* Style for the container inside the Black Market dropdown */
#black-market-codes-container {
    /* All the red box styling has been removed from here */
    margin-top: 8px;
    text-align: left;
}
        /* Ensure the H2 inside the black market section has appropriate styling */
        #black-market-section h2 {
            color: #ff9999; /* Lighter red for heading */
            border-bottom-color: #ff6666;
        }    
        
/* Only when permanent section is visible (has 'show' class) change title text color an more */
#permanent-section.show .permanent-code-box {
    background: linear-gradient(180deg, #451565, #6D1489);
    border: 1px solid #920F74;
    box-shadow: 0 0 6px rgba(54, 54, 0, 0.6);
}

#permanent-section.show .permanent-code-box:hover {
    background: linear-gradient(180deg, #6D1489, #451565);
    border: 1px solid #920F74;
    box-shadow: 0 0 8px rgba(245, 76, 217, 0.8);
}
/* Text color for where tittle is like discord or twitch drop */
#permanent-section.show .permanent-code-text {
    color: #d50eeb;
    text-shadow: 1px 1px 0 #000, 0 0 10px rgba(54, 54, 54, 1);
    font-weight: bold;
}
/* info or body text color for perm box */
#permanent-section.show .permanent-title-container {
    color: #FF99FF;
    text-shadow: 1px 1px 0 #000, 0 0 2px #000;
    font-weight: bold;
}
        
        .expired-section, .permanent-section, .info-section {
            display: none;
            margin-top: 8px;
        }
        
        .expired-section.show, .permanent-section.show, .info-section.show {
            display: block;
        }
        .permanent-code-box .expire-date { color: #E830B7; }
        .permanent-code-box .countdown { color: #E144FF !important; border: 1px solid #F5BFFF;         }
/* ========================================================== */
/*     STYLES FOR EXPIRATION & COUNTDOWN (PURPLE SECTIONS)    */
/* ========================================================== */

/* --- Styling for the "Expires:" text --- */
#permanent-codes-section .expire-date,
#twitch-drops-section .expire-date {
    color: #DD8BFF; /* Golden/Orange text color */
    font-size: 11px;
    text-shadow: 1px 1px 0 #000;
    margin-bottom: 6px; /* Adds a little space below it */
    text-align: left;
}


/* --- Styling for the "Time left:" countdown box --- */
#permanent-codes-section .countdown,
#twitch-drops-section .countdown {
    border: 1px solid #ff9e40; /* Orange border */
    border-radius: 4px; /* Slightly rounded corners */
    color: #FF76DB; /* Orange text color */
    font-weight: bold;
    text-shadow: 1px 1px 0 #000;
    padding: 6px 10px; /* Space inside the box */
    margin-top: 5px; /* Space above the box */
    margin-bottom: 10px; /* Space below the box */
    text-align: left;
}


    /* =================================================== */
/*           STYLES FOR THE GOLD SECTION               */
/*         ( üëç ACTIVE BL4 SHIFT CODES )                */
/* =================================================== */

.title-container {
    font-size: 14px;
    color: #ff9e40;
    margin-bottom: 8px;
    min-height: 18px;
    text-shadow: 1px 1px 0 #000;
}

/* This targets links like "Via Twit" */
.title-container a {
    color: #F6E261; /* Teal color */
    text-decoration: underline;
    text-shadow: 1px 1px 0 #000;
    font-weight: bold;
}

.title-container a:hover {
    color: #DBBE00; /* Lighter teal for hover */
}


/* =================================================== */
/*          STYLES FOR THE PURPLE SECTION              */
/* (Twitch Drops & Permanent Codes like the cosmetics) */
/* =================================================== */

/* --- STYLES FOR THE PURPLE SECTION (TWITCH DROPS, ETC.) --- */

.permanent-title-container {
    /* This styles the container itself, you can leave it empty if you want */
    font-size: 11px;
    color: #F2D7EE; /* This is the gold/orange text color */
    /* ... other container styles ... */
}

/* This targets ALL links inside the purple container */
.permanent-title-container a {
    color: #FF5BDA; /* Light Sky Blue color for links */
    text-decoration: underline;
    font-weight: bold;
    text-shadow: 1px 1px 0 #000;
}

.permanent-title-container a:hover {
    color: #FFB7FE; /* Lighter blue for hover */
}

/* --- Style for links ONLY inside an EXPIRED code box --- */
.expired-code-box .title-container a {
    color: #CD2F2F; /* Pale Yellow - looks good on the red background */
    text-decoration: underline;
    font-weight: bold;
    text-shadow: 1px 1px 0 #000;
}

/* --- Hover effect for the expired code links --- */
.expired-code-box .title-container a:hover {
    filter: brightness(1.2); /* A subtle pop on hover */
}

/*||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||||||*/        
        .code-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    padding-right: 40px; /* This pushes text away from the report button */
}
        
        .permanent-code-header {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 2px;
    padding-right: 40px; /* This pushes text away from the report button */
}
        
        .key-icon {
            font-size: 18px;
            color: #ffc600;
            text-shadow: 1px 1px 0 #000;
        }
        
        .permanent-key-icon {
            font-size: 12px;
            color: #6ba8ff;
            text-shadow: 1px 1px 0 #000, 0 0 3px rgba(107, 168, 255, 0.5);
        }
        
        .custom-icon {
            width: 18px;
            height: 18px;
            object-fit: contain;
            vertical-align: middle;
        }
        
        .permanent-custom-icon {
            width: 25px;
            height: 25px;
            object-fit: contain;
            vertical-align: middle;
        }

/* Specific styling for 'active codes' */
.active-codes-icon {
    width: 20px; /* Example: slightly larger */
    height: 20px;
    object-fit: contain;
    vertical-align: middle;
    /* Add any other specific styling here */
    font-size: 16px; /* For text-based active codes */
    line-height: 18px;
    display: inline-block; /* Ensure it respects width/height */
}

/* Specific styling for 'blackmarket' codes */
.blackmarket-icon {
    width: 32px; /* Example: adjust as needed for blackmarket */
    height: 32px;
    object-fit: contain;
    vertical-align: middle;
    /* Add any other specific styling here */
    font-size: 20px; /* For text-based blackmarket codes */
    line-height: 25px;
    display: inline-block; /* Ensure it respects width/height */
}

/* General alignment for headers */
.code-header {
    display: flex;
    align-items: center;
    gap: 8px; /* Adjust spacing */
}
        
        .vault-symbol {
            font-size: 24px;
            margin-right: 10px;
            color: #ffc600;
            text-shadow: 1px 1px 0 #000, 0 0 5px rgba(255, 198, 0, 0.5);
        }
            
        .no-codes {
            color: #ff9e40;
            padding: 20px;
            text-shadow: 1px 1px 0 #000;
        }
        
        .clearfix::after {
            content: "";
            clear: both;
            display: table;
        }

    /*|||||||| active yellow check box color and shit  ||||| ||||||||||||||||||||| |||||||||||||||||||||||||||||*/      
 /* ========================================================== */
/*           PARENT FOOTER - THIS IS THE MAIN FIX             */
/* ========================================================== */
/* This rule targets the container holding the checkbox and the button */
.code-footer, .permanent-code-footer {
    display: flex;                  /* Turns it into a flex container */
    justify-content: space-between; /* MAGIC! Puts first item on left, last on right */
    align-items: center;            /* Vertically aligns everything neatly */
}

/* ========================================================== */
/*                 BM Codes CHECKBOX STYLES                     */
/* ========================================================== */
/* This no longer needs the margin-right: auto */
.bmredeem-checkbox {
    display: flex;
    align-items: center; 
    /* The 'margin-right: auto' has been REMOVED from here */
}

/* --- The rest of your styles are perfect and remain unchanged --- */

.bmredeem-checkbox input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid #FF0009;
    border-radius: 3px;
    background: rgba(0, 0, 0, 0.3);
    position: relative;
    cursor: pointer;
    margin-right: 8px;
}

.bmredeem-checkbox input[type="checkbox"]:checked::before {
    content: "‚úì";
    position: absolute;
    color: #FF4D53;
    font-size: 14px;
    font-weight: bold;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-shadow: 0 0 3px #000;
}

.bmredeem-checkbox label {
    color: #ffc600;
    font-size: 14px;
    cursor: pointer;
    text-shadow: 1px 1px 0 #000;
}


/* ========================================================== */
/*                  Active Codes CHECKBOX STYLES                     */
/* ========================================================== */
/* This no longer needs the margin-right: auto */
.actredeem-checkbox {
    display: flex;
    align-items: center; 
    /* The 'margin-right: auto' has been REMOVED from here */
}

/* --- The rest of your styles are perfect and remain unchanged --- */

.actredeem-checkbox input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid #FFD31E;
    border-radius: 3px;
    background: rgba(0, 0, 0, 0.3);
    position: relative;
    cursor: pointer;
    margin-right: 8px;
}

.actredeem-checkbox input[type="checkbox"]:checked::before {
    content: "‚úì";
    position: absolute;
    color: #FFDC4D;
    font-size: 14px;
    font-weight: bold;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-shadow: 0 0 3px #000;
}

.actredeem-checkbox label {
    color: #ffc600;
    font-size: 14px;
    cursor: pointer;
    text-shadow: 1px 1px 0 #000;
}

/* ========================================================== */
/*                 PERM Codes CHECKBOX STYLES                     */
/* ========================================================== */
/* This no longer needs the margin-right: auto */
.permredeem-checkbox {
    display: flex;
    align-items: center; 
    /* The 'margin-right: auto' has been REMOVED from here */
}

/* --- The rest of your styles are perfect and remain unchanged --- */

.permredeem-checkbox input[type="checkbox"] {
    appearance: none;
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid #FF1FE2;
    border-radius: 3px;
    background: rgba(0, 0, 0, 0.3);
    position: relative;
    cursor: pointer;
    margin-right: 8px;
}

.permredeem-checkbox input[type="checkbox"]:checked::before {
    content: "‚úì";
    position: absolute;
    color: #FF78F1;
    font-size: 14px;
    font-weight: bold;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-shadow: 0 0 3px #000;
}

.permredeem-checkbox label {
    color: #ffc600;
    font-size: 14px;
    cursor: pointer;
    text-shadow: 1px 1px 0 #000;
}

  /*|||||||| check box color and shit  |||||||||||||*/      
        .redeem-checkbox {
            display: flex;
            align-items: center;
            margin: 0;
            order: 1;
        }
        
        .redeem-checkbox input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #878787;
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
            cursor: pointer;
            margin-right: 8px;
        }
        
        .redeem-checkbox input[type="checkbox"]:checked::before {
            content: "‚úì";
            position: absolute;
            color: #E5E5E5;
            font-size: 14px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 0 0 3px #000;
        }
        
        .redeem-checkbox label {
            color: #ffc600;
            font-size: 14px;
            cursor: pointer;
            text-shadow: 1px 1px 0 #000;
        }
        
        .redeemed {
            opacity: 0.7;
            position: relative;
        }
        
        .redeemed::after {
            content: "REDEEMED";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 24px;
            font-weight: bold;
            color: #7cff7c;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(124, 255, 124, 0.7);
            z-index: 10;
            pointer-events: none;

        }
        
        .redeemed .code-text {
            color: #7cff7c !important;
        }
        
        .permanent-redeemed {
            opacity: 0.7;
            position: relative;
        }
        
        .permanent-redeemed::after {
            content: "REDEEMED";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            font-size: 24px;
            font-weight: bold;
            color: #7cff7c;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(124, 255, 124, 0.7);
            z-index: 10;
            pointer-events: none;
        }
        
        .permanent-redeemed .permanent-code-text {
            color: #7cff7c !important;
        }

/* Brute-force style for testing */
.permanent-code-box.permanent-redeemed {
    border: 2px solid #44ff44 !important; /* A bright, ugly, unmissable green border */
}
/* ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
        .expired-text {
            color: #ff4444;
            font-weight: bold;
            margin-top: 8px;
            font-size: 13px;
            text-shadow: 1px 1px 0 #400000;
        }
        
        .info-content {
            background: linear-gradient(to bottom, #555, #333);
            color: white;
            padding: 15px;
            margin: 8px 0;
            border-radius: 4px;
            text-align: left;
            border: 1px solid #666;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .info-content p {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .info-content ul, .info-content ol {
            margin-left: 20px;
            margin-bottom: 10px;
        }
        
        .info-content li {
            margin-bottom: 5px;
        }
        
        .info-content a {
            color: #ffc600;
            text-decoration: underline;
            text-shadow: 1px 1px 0 #000;
        }
        
        .info-content a:hover {
            color: #ff7c00;
        }
        
        @media (max-width: 600px) {
            .social-links {
                gap: 10px;
            }
            
            .social-links a {
                font-size: 14px;
                padding: 6px 10px;
            }
        }
        .title-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 25px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            margin-bottom: 15px;
            border: 2px solid #ffc600;
        }

        .title-text {
            color: #ffc600;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000, 0 0 10px rgba(255, 198, 0, 0.7);
        }

        .icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ffc600;
        }
/* Normal blue preview button ||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||||||*/
        .preview-btn {
            background: linear-gradient(to bottom, #4a90e2, #2a70c2);
            border: 1px solid #6ba8ff;
            color: #fff;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .preview-btn:hover {
            background: linear-gradient(to bottom, #2a70c2, #4a90e2);
            transform: scale(1.05);
            box-shadow: 0 0 4px #6ba8ff;
        }

        /* perm active preview button ||||||||||||||||*/
        .prempreview-btn {
            background: linear-gradient(to bottom, #B634D7, #AA2EC9);
            border: 1px solid #DE57FF;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .prempreview-btn:hover {
            background: linear-gradient(to bottom, #AA2EC9, #B634D7);
            transform: scale(1.05);
            box-shadow: 0 0 4px #DE57FF;
        }

        /* active preview button ||||||||||||||||*/
        .activepreview-btn {
            background: linear-gradient(to bottom, #ff7c00, #e56a00);
            border: 1px solid #FFDE00;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .activepreview-btn:hover {
            background: linear-gradient(to bottom, #e56a00, #ff7c00);
            transform: scale(1.05);
            box-shadow: 0 0 4px #FFDE00;
        }

        /* expire preview button ||||||||||||||||*/
        .exppreview-btn {
            background: linear-gradient(to bottom, #EE2222, #DF2525);
            border: 1px solid #FF5757;
            color: #FFFFFF;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin: 0;
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .exppreview-btn:hover {
            background: linear-gradient(to bottom, #DF2525, #EE2222);
            transform: scale(1.05);
            box-shadow: 0 0 4px #FF5757;
        }
        /*||||||||||||||| ||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||||||*/
        .image-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }


/* --- END: Mobile Full-Screen Image Preview --- */

        .close-preview {
            position: absolute;
            top: -15px;
            right: -15px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 20px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Info content sections ||||||||||| ||||||||||||||||||||| |||||||||||||||||||||||||||||||*/
        #info-section .info-content {
            background: linear-gradient(to bottom, #555, #333);
            border: 2px solid #888;
            color: white;
        }

        #changelog-section .info-content {
            background: linear-gradient(to bottom, #6c757d, #495057);
            border: 2px solid #adb5bd;
            color: white;
        }

        #changelog-section .info-content a {
            color: #e9ecef;
            text-shadow: 0 0 5px #e9ecef;
        }

        #changelog-section .info-content a:hover {
            color: #ffffff;
        }

        #redeem-section .info-content {
            background: linear-gradient(to bottom, #00aa00, #0055aa);
            border: 2px solid #00ccff;
            color: white;
        }

        #redeem-section .info-content a {
            color: #00ffff;
            text-shadow: 0 0 5px #00ffff;
        }

        #redeem-section .info-content a:hover {
            color: #ffffff;
        }

    /* Style for the new "View Roadmap" button |||||||||||||| ||||||||||||||||||||| ||||||||||||||||||||||||||||*/
        .roadmap-button {
            background: linear-gradient(to bottom, #333, #111); /* Dark grey to black gradient */
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin: 1px auto 5px auto; /* Top margin, auto left/right, bottom margin */
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            border: 1px solid #555; /* Dark grey border */
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            font-family: 'Chakra Petch', sans-serif;
            display: block;
            width: fit-content;
            margin: 10px auto; /* Center horizontally, provide vertical spacing */
        }
        
        .roadmap-button:hover {
            background: linear-gradient(to bottom, #444, #222); /* Slightly lighter on hover */
            transform: scale(1.05);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.1); /* Subtle white glow */
        }

        /* =================================================== */
/*           PASTE THE NEW BUTTON STYLE HERE           */
/* =================================================== */
/*  This is where you can easily customize the colors  */
.events-button {
    background: linear-gradient(to bottom, #f01a11, #fe9f17); /* SeaGreen gradient */
    color: white;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    font-size: 14px;
    text-transform: uppercase;
    border: 1px solid #890608; /* MediumSeaGreen border */
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    font-family: 'Chakra Petch', sans-serif;
    display: block;
    width: fit-content;
    margin: 10px auto; 
}

.events-button:hover {
    background: linear-gradient(to bottom, #fe9f17, #f01a11); /* Lighter green on hover */
    transform: scale(1.05);
    box-shadow: 0 0 8px rgba(255, 204, 61, 0.6); /* Green glow */
}
/* =================================================== */

/* Style for the new extra button inside the Black Market Vendor box ||||||| ||||||||||||||||||||| |||||||||||||||||||||||||||||||||||*/
        .black-market-extra-btn {
            background: linear-gradient(to bottom, #777, #555); /* Gray gradient */
            border: 1px solid #999;
            color: #fff;
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px; /* Adds space from the "View Location" button */
            transition: all 0.3s;
            font-size: 12px;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .black-market-extra-btn:hover {
            background: linear-gradient(to bottom, #888, #666);
            transform: scale(1.05);
            box-shadow: 0 0 4px #aaa;
        }


                /* Container for the two small Black Market buttons */
        .black-market-buttons-group {
            display: flex;
            flex-wrap: wrap; /* Allow buttons to wrap if screen is too small */
            gap: 8px; /* Space between the two buttons */
            align-items: center;
        }

        /* Base style for small Black Market buttons  |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
        .bm-small-btn {
            padding: 4px 8px; /* Reduced padding */
            font-size: 10px; /* Reduced font size */
            font-weight: bold;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            font-family: 'Chakra Petch', sans-serif;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            flex-shrink: 0; /* Prevent them from shrinking too much */
            line-height: 1.2; /* Adjust line height for smaller text */
        }
        
        .bm-small-btn:hover {
            transform: scale(1.03);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }

        /* Specific style for the Static Image button  ||||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||*/
        .bm-static-image-btn {
            background: linear-gradient(to bottom, #FF7A7F, #C92B31); /* Gray gradient */
            border: 1px solid #DA0007;
            color: #fff;
        }

        .bm-static-image-btn:hover {
            background: linear-gradient(to bottom, #C92B31, #FF7A7F);
        }

        /* Specific style for the MapGenie button  ||||||||||||||||||||| ||||||||||||||||||||| |||||||||||||||||||||*/
        .bm-mapgenie-btn {
            background: linear-gradient(to bottom, #C92B31, #FF7A7F); /* Blue gradient */
            border: 1px solid #DA0007;
            color: #fff;
        }

        .bm-mapgenie-btn:hover {
            background: linear-gradient(to bottom, #FF7A7F, #C92B31);
        }

        /* Ensure .redeem-checkbox is properly ordered in the footer */
        .code-footer .redeem-checkbox {
            order: unset; /* Clears any explicit order */
            margin-left: auto; /* <--- ADD THIS to push the checkbox to the far right */
            margin-right: 0; /* Ensure no conflicting right margin */
        }

        /* New group for active code's action buttons (COPY and optional PREVIEW) ||||||||||| |||||||||||||||||||||||||||||||*/
        .active-code-buttons-group {
            display: flex;
            gap: 10px; /* Space between preview and copy buttons */
            align-items: center;
            margin-left: auto; /* Pushes this group to the far right within the footer */
        }
        
        /* Ensure default display for the overall code-footer */
        .code-footer {
            display: flex;
            justify-content: space-between; /* Pushes children to opposite ends */
            align-items: center;
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 198, 0, 0.3);
        }

        /* Make sure the redeem checkbox explicitly stays left  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
        /* This overrides any previous 'order' or 'margin-left: auto' */
        .code-footer .redeem-checkbox {
            order: unset; /* Remove any explicit order that might be set */
            margin-right: auto; /* Pushes itself to the left, allowing the button group to go right */
            margin-left: 0; /* Ensure no auto left margin interferes */
        }

        /* Ensure .small-copy-btn and .preview-btn revert to natural order/margins within their new group */
        .small-copy-btn, .preview-btn {
            order: unset; /* Remove any explicit order */
            margin: 0; /* Remove any external margins */
        }
        

/*  ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/

        /* Utility class to hide elements ||||||||||||| |||||||||||||||||||||||||||||*/
        .hidden {
            display: none !important;
        }

        /* Styling for the settings items (checkbox and label) */
        .setting-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .setting-item input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #ffc600;
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
            cursor: pointer;
            margin-right: 8px;
            flex-shrink: 0; /* Prevent shrinking */
        }

        .setting-item input[type="checkbox"]:checked::before {
            content: "‚úì";
            position: absolute;
            color: #ffc600;
            font-size: 14px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-shadow: 0 0 3px #000;
        }

        .setting-item label {
            color: #ffc600;
            font-size: 14px;
            cursor: pointer;
            text-shadow: 1px 1px 0 #000;
            line-height: 1.2;
        }

        /* New wrapper for the top-most horizontal buttons ||||||| |||||||||||||||||||||||||||||||||||*/
        .top-header-buttons {
            display: flex;
            justify-content: center; /* Center the buttons within the row */
            flex-wrap: wrap; /* Allow buttons to wrap to the next line on small screens */
            gap: 10px; /* Space between the buttons */
            margin-bottom: 20px; /* Space below the top row */
        }

        /* Style for the Black Market credit text |||||||||||||||||||||*/
        .black-market-credit {
            font-size: 11px;
            color: #bbb; /* Lighter text for credit */
            margin-top: 10px; /* Space above the footer/buttons */
            text-align: left;
            padding: 0 5px; /* Little padding to match content */
            font-weight: bold; /* <--- ADD THIS LINE */
        }

        .black-market-credit a {
            color: #428bca; /* Gold color for links */
            text-decoration: underline;
        }

/* Hide any label that follows a checked checkbox within redeem-checkbox  |||||| ||||||||||||||||||||||||||||||||||||*/
.redeem-checkbox input:checked + label,
.bmredeem-checkbox input:checked + label,
.permredeem-checkbox input:checked + label,
.actredeem-checkbox input:checked + label {
    display: none;
}

/* flash text pulse for drops and limited time shit  |||||| ||||||||||||||||||||||||||||||||||*/  
.drops-pulse {
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
    100% {
        opacity: 1;
    }
}


/* date added text for boxes |||||||| ||||||||||||||||||||||||||||||||||*/
/* Active Codes Date Added */
.code-box .date-added {
    font-size: 0.8em;
    color: #FFC247; /* Yellow/Orange */
    margin: -10px 0 8px 0; /* Positive margins only */
    font-style: italic;
}

/* Permanent/Drops Codes Date Added */
.permanent-code-box .date-added {
    font-size: 0.75em;
    color: #F011FF; /* Green */
    margin: 3px 0 6px 0; /* Positive margins only */
    font-style: normal;
    font-weight: bold;
}

/* Black Market Date Added */
.black-market-code-box .date-added {
    font-size: 0.7em;
    color: #FF6B47; /* Red/Orange */
    margin: 2px 0 5px 0; /* Positive margins only */
    font-style: italic;
    opacity: 0.9;
}

/* Expired Codes Date Added */
.expired-code-box .date-added {
    font-size: 0.7em;
    color: #888888; /* Gray */
    margin: -10px 0 5px 0; /* Positive margins only */
    font-style: italic;
    text-decoration: line-through;
    opacity: 0.8;
}


/* =================================================== */
/*           NEW: CODE DESCRIPTION STYLING             */
/* =================================================== */
.code-description {
    font-size: 14px;
    color: #ffcc88; /* A lighter, less prominent gold */
    line-height: 1.4;
    margin-bottom: 12px;
    padding-left: 5px;
    border-left: 2px solid rgba(255, 198, 0, 0.4); /* Subtle left border */
}

/* Specific color for descriptions in permanent boxes */
.permanent-description {
    color: #cce5ff; /* A light blue to match the theme */
    border-left-color: rgba(74, 144, 226, 0.4);
}

/* Specific color for descriptions in expired boxes */
.expired-description {
    color: #ffbaba; /* A light red */
    border-left-color: rgba(255, 68, 68, 0.4);
}

/* Styling for any links inside a description */
.code-description a {
    color: #F6E261; /* Re-using the bright link color */
    font-weight: bold;
}

/* Specific style for the new Loot/Info button for blacmarket box ||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||*/
.bm-loot-info-btn {
    background: linear-gradient(to bottom, #C92B31, #FF7A7F); 
    border: 1px solid #DA0007;
    color: #fff;
}

.bm-loot-info-btn:hover {
    background: linear-gradient(to bottom, #FF7A7F, #C92B31); /* Invert on hover */
}

/* =================================================== */
/*           SMALL KEY INFO BUTTONS                    */
/* =================================================== */
/* Container for the small key info buttons */
.key-info-buttons-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 12px; /* Adds space below the "Updated" date */
}

/* Styling for the individual small buttons */
.key-info-btn {
    background: linear-gradient(to bottom, #ff7c00, #e56a00);
    border: 1px solid #ffc600;
    color: #fff;
    padding: 4px 10px; /* Small padding for a small button */
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    font-size: 11px; /* This makes the text very small */
    text-transform: uppercase;
    font-family: 'Chakra Petch', sans-serif;
    text-shadow: 1px 1px 0 #000;
    transition: all 0.2s;
}

.key-info-btn:hover {
    background: linear-gradient(to bottom, #ff8c00, #ff6a00);
    transform: scale(1.05);
    box-shadow: 0 0 6px #ffc600;
}

/* =================================================== */
/*           FLOATING SHARE BUTTON & MENU (CORRECTED)  */
/* =================================================== */
.floating-share-container {
    position: relative;
    bottom: 115px; /* This tightens up the spacing */
    left: 20px;    /* Moved to the LEFT corner */
    z-index: 1003;
    display: flex;
    flex-direction: column;
    align-items: flex-start; /* Aligns items to the LEFT */
}

/* START: Solid Thin Line Share Button */
.share-fab {
    background: linear-gradient(to bottom, #1e8e3e, #166d2e); /* The new solid background */
    border: 1px solid #34a853;
    color: #fff;                  /* Text is now white for contrast */
    width: auto;
    height: auto;
    border-radius: 4px;
    padding: 6px 15px;
    font-size: 14px;
    font-weight: bold;
    font-family: 'Chakra Petch', sans-serif;
    text-shadow: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3); /* Subtle drop shadow */
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.share-fab:hover {
    background: linear-gradient(to bottom, #34a853, #1e8e3e); /* Brighter on hover */
    transform: translateY(-1px); /* Add a slight lift */
    box-shadow: 0 0 10px #5bb974;
}
/* END: Solid Thin Line Share Button */
/* END: Thin Line Share Button */

/* The pop-up menu container */
.share-menu {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 15px;
    opacity: 0;
    transform: translateY(10px) scale(0.9);
    pointer-events: none;
    transition: opacity 0.2s ease-out, transform 0.2s ease-out;
}

.share-menu.active {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
}

/* Individual share buttons inside the menu */
.share-menu-item {
    color: white;
    padding: 10px 20px;
    border-radius: 4px;
    font-weight: bold;
    text-decoration: none;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    transition: transform 0.2s;
    width: 180px;
}

.share-menu-item:hover {
    transform: scale(1.05);
}

.twitter-btn { background: linear-gradient(to bottom, #1DA1F2, #0c85d0); border: 2px solid #1DA1F2; }
.facebook-btn { background: linear-gradient(to bottom, #1877F2, #1056ad); border: 2px solid #1877F2; }

/* Mobile zoom back to normal css */
/* ADD THIS CSS to your main <style> tag */

/* --- START: Image Preview Modal Controls & Zoom --- */
.image-preview-content {
    max-width: 90%;
    max-height: 90%;
    position: relative;
    /* This allows scrolling inside the frame if the image is zoomed */
    overflow: auto; 
}

.image-preview-content img {
    /* Image should not be wider than its container */
    max-width: 100%; 
    /* Or taller than 90% of the screen height */
    max-height: 90vh; 
    /* The border and rounded corners for the PC view */
    border: 3px solid #ffc600;
    border-radius: 5px;
    /* Ensures the image scales down without stretching */
    object-fit: contain; 
}

/* This is the container for the new control buttons */
#image-preview-controls {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1001;
    background: rgba(10, 10, 10, 0.85);
    backdrop-filter: blur(5px);
    border-radius: 50px;
    padding: 8px;
    display: flex;
    gap: 10px;
    border: 1px solid #ffc600;
    box-shadow: 0 0 15px rgba(255, 198, 0, 0.5);
}

/* Styling for the individual buttons (Zoom In, Out, Reset, Close) */
.control-btn {
    background: linear-gradient(to bottom, #ff7c00, #e56a00);
    border: 1px solid #ffc600;
    color: #fff;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    font-weight: bold;
    font-size: 24px;
    text-shadow: 1px 1px 0 #000;
    transition: all 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    padding-bottom: 4px; /* Helps visually center some characters */
}

.control-btn:hover {
    background: linear-gradient(to bottom, #ff8c00, #ff6a00);
    transform: scale(1.1);
    box-shadow: 0 0 8px #ffc600;
}

/* Specific styling for the new close button */
#close-preview-btn {
    background: linear-gradient(to bottom, #EE2222, #DF2525);
    border-color: #FF5757;
}

#close-preview-btn:hover {
    box-shadow: 0 0 8px #FF5757;
}
/* --- END: Image Preview Modal Controls & Zoom --- */

/* ADD THIS SNIPPET AT THE END OF YOUR CSS */

/* --- START: Image Preview Modal Controls & Zoom --- */
.image-preview-content {
    overflow: auto;
}
#image-preview-controls {
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1001; /* Should be lower than the modal's z-index */
    background: rgba(10, 10, 10, 0.85);
    backdrop-filter: blur(5px);
    border-radius: 50px;
    padding: 8px;
    display: flex;
    gap: 10px;
    border: 1px solid #ffc600;
    box-shadow: 0 0 15px rgba(255, 198, 0, 0.5);
}
.control-btn {
    background: linear-gradient(to bottom, #ff7c00, #e56a00);
    border: 1px solid #ffc600;
    color: #fff;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    font-weight: bold;
    font-size: 24px;
    text-shadow: 1px 1px 0 #000;
    transition: all 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    padding-bottom: 4px;
        touch-action: manipulation; /* <-- ADD THIS LINE */
}
.control-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 8px #ffc600;
}
#close-preview-btn {
    background: linear-gradient(to bottom, #EE2222, #DF2525);
    border-color: #FF5757;
}
/* ADD THIS SNIPPET AT THE END OF YOUR CSS */

/* --- END: Corrected Image Preview Styles --- */

/* hide kofi when preview is open */

/* When the preview modal is open (body has class 'modal-open')... */
body.modal-open iframe[id^="kofi"], /* ...Find the Ko-fi widget iframe... */
body.modal-open .floating-share-container { /* ...and the Share button container... */
    /* ...and hide them completely. */
    display: none !important; 
}

/* START: SITE OPTIONS CONTAINER STYLES */

/* START: SITE OPTIONS CONTAINER STYLES (v4 - Polished Buttons) */

/* --- The Main Wrapper (Unchanged) --- */
/* --- Main Wrapper & Title --- */
.site-options-container {
    border: 2px solid #adb5bd; padding: 20px 15px; margin: 20px 0;
    background: rgba(17, 26, 34, 0.6); box-shadow: 0 0 15px rgba(173, 181, 189, 0.2);
    text-align: center; clip-path: polygon(0 0, 100% 0, 100% 95%, 95% 100%, 0 100%); border-radius: 0;
}
.site-options-container .site-options-title {
    color: #adb5bd; font-family: 'Chakra Petch', sans-serif; text-transform: uppercase;
    font-weight: 700; font-size: 18px; letter-spacing: 2px; text-shadow: 0 0 2px rgba(173, 181, 189, 0.8);
    margin: 0; cursor: pointer; user-select: none; line-height: 1.3;
}
.updated-subtitle {
    display: block; font-size: 0.7em; font-weight: normal; color: #00ffff; text-shadow: 0 0 5px #00ffff;
}

/* --- Slide-down Logic --- */
.site-options-container .slide-down-content {
    max-height: 0; overflow: hidden; margin-top: 0;
    transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out;
}
.site-options-container.is-open .slide-down-content {
    max-height: 80vh; margin-top: 20px;
}

/* --- The 2x2 Button Grid Structure --- */
.options-button-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.button-row {
    display: flex;
    flex-direction: row;
    gap: 10px;
}

/* --- Polished Button Style --- */
.option-btn {
    flex: 1; 
    min-width: 140px; padding: 12px 5px; font-family: 'Chakra Petch', sans-serif;
    font-size: 14px; font-weight: bold; color: #fff; text-shadow: 0px 1px 3px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(0, 0, 0, 0.7); border-top-color: rgba(255, 255, 255, 0.2);
    border-radius: 6px; cursor: pointer; transition: all 0.2s ease-in-out;
    box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.1), 0 2px 3px rgba(0, 0, 0, 0.4);
}
.option-btn:hover {
    transform: translateY(-1px);
    box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.2), 0 4px 8px rgba(0, 0, 0, 0.5);
}
.option-btn:active {
    transform: translateY(1px);
    box-shadow: inset 0 2px 3px rgba(0, 0, 0, 0.3);
}

/* --- Button Colors --- */
.option-btn-hide { background: linear-gradient(to bottom, #868e96, #495057); }
.option-btn-faq { background: linear-gradient(to bottom, #36c2ca, #1c7b80); }
.option-btn-log { background: linear-gradient(to bottom, #6979d5, #3e4a8b); }
.option-btn-redeem { background: linear-gradient(to bottom, #05f515, #049efb); }

/* --- Content Panel Container --- */
.options-content-panels {
    margin-top: 15px;
}

/* --- Scrollbar for Content --- */
#info-section .info-content,
#changelog-section .info-content,
#redeem-section .info-content,
#settings-section .info-content {
    max-height: 40vh; overflow-y: auto; padding-right: 10px;
}
/* END: SITE OPTIONS CONTAINER STYLES */

/* =================================================================== */
/*           ‚≠ê FINAL, UNIFIED & ENHANCED MOBILE STYLES ‚≠ê             */
/* =================================================================== */
@media (max-width: 768px) {

    /* --- 1. Global & Container Adjustments --- */
    body {
        padding: 10px;
        font-size: 16px; 
    }
    .container {
        padding: 15px;
    }
    .floating-info-panel {
        width: calc(100%);
    }
    /* --- 2. Typography for Smaller Screens --- */
    h1, h2, h3 {
        font-size: 12px;
    }
    .title-text {
        font-size: 14px;
    }

    /* --- 3. Fix for "Site Options" Buttons --- */
    .button-row {
        flex-direction: column;
    }
    .option-btn {
        width: 100%;
        min-width: 0;
        padding: 14px 10px;
        font-size: 16px;
    }

    /* --- 4. Main Page Buttons (Collapse, Roadmap, etc.) --- */
    .info-button,
    .collapse-btn,
    .collapse-btn-exp,
    .collapse-btn-Perm,
    .collapse-btn-BlackMarket,
    .roadmap-button {
        display: block;
        width: 100%;
        margin: 10px 0;
        padding: 14px;
        font-size: 15px;
    }
    .rewards-link {
        padding: 12px;
    }

    /* --- 5. Code Box Styles --- */
    .code-box::before,
    .expired-code-box::before,
    .black-market-code-box::before,
    .permanent-code-box::before {
        background-size: contain !important;
    }
    .code-footer,
    .permanent-code-footer {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
    }
    .active-code-buttons-group,
    .black-market-buttons-group {
        display: flex;
        flex-direction: column;
        width: 100%;
        gap: 8px;
        margin: 0;
    }
    .small-copy-btn,
    .permanent-copy-btn,
    .expired-copy-btn,
    .preview-btn,
    .prempreview-btn,
    .activepreview-btn,
    .exppreview-btn,
    .bm-small-btn {
        width: 100%;
        padding: 12px;
        font-size: 14px;
        margin: 0;
    }
    .redeem-checkbox,
    .permredeem-checkbox,
    .actredeem-checkbox,
    .bmredeem-checkbox {
        margin: 0;
        order: -1;
        padding-bottom: 5px;
    }
    .redeem-checkbox label,
    .permredeem-checkbox label,
    .actredeem-checkbox label,
    .bmredeem-checkbox label {
        font-size: 16px;
    }

    /* --- 6. Image Preview Modal --- */
    .image-preview-content,
    .image-preview-content img {
        max-width: 100%;
        max-height: 100%;
        border: none;
        border-radius: 0;
        object-fit: contain;
    }
}


/* START: NEW COMMUNITY CHALLENGE STYLES */
.challenge-button {
    background: linear-gradient(to bottom, #f8278a, #ca114f); /* Purple gradient */
    color: white;
    padding: 10px 20px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s;
    font-size: 14px;
    text-transform: uppercase;
    border: 1px solid #ff54a5; /* Light purple border */
    text-shadow: 1px 1px 0 #000;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    font-family: 'Chakra Petch', sans-serif;
    display: block;
    width: fit-content;
    margin: 10px auto; 
}
.challenge-button:hover {
    background: linear-gradient(to bottom, #ca114f, #f8278a);
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(138, 43, 226, 0.7); /* Purple glow */
}

/* Style for the dropdown panel's content */
#challenge-section .info-content {
    background: linear-gradient(to bottom, #be1a68, #940d3a);
    border: 2px solid #ff54a5;
}
/* END: NEW COMMUNITY CHALLENGE STYLES */
/* EVENTS STYLES |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
/* START: FINAL & CORRECTED EVENTS DROPDOWN STYLE - REPLACE OLD VERSION */

.events-content-unique {
    /* FIX: New, richer Orange/Red theme to better match the button */
    background: linear-gradient(to bottom, #611815, #5c3a0e) !important; 
    border: 2px solid #fe9f17 !important; /* Bright orange border */
    color: #f0f0f0 !important;

    /* Base layout styles */
    padding: 15px !important;
    margin-top: 8px !important;
    border-radius: 4px !important;
    box-shadow: 0 4px 8px rgba(0,0,0,0.5) !important;
}

/* Styles for the content inside */
.events-content-unique b {
    color: #ffffff;
    font-size: 1.1em;
}
.events-content-unique ul {
    list-style-type: '‚Ä¢ ';
    padding-left: 20px;
    color: #f0f0f0;
}
.events-content-unique img {
    border: 2px solid #fe9f17; /* Match the main border */
    border-radius: 4px;
}

/* END: FINAL & CORRECTED EVENTS DROPDOWN STYLE */


/* START: COMPLETE & FINAL ACTION BUTTONS CSS - DELETE ALL PREVIOUS VERSIONS */

/* Hides the default Ko-fi floating icon */
iframe#kofi-chat-widget { display: none !important; }

/* Main container for the buttons */
.action-buttons-container {
    display: flex; justify-content: center; align-items: center;
    flex-wrap: wrap; gap: 8px; margin: 15px 0;
}

/* Uniform style for all buttons in the row */
.action-btn {
    padding: 6px 14px !important; font-size: 13px !important;
    font-family: 'Chakra Petch', sans-serif !important; font-weight: bold !important;
    border-radius: 4px !important; cursor: pointer !important;
    transition: all 0.2s ease !important;
    text-shadow: 1px 1px 1px rgba(0,0,0,0.4) !important;
    line-height: 1.2 !important; border: 1px solid rgba(0,0,0,0.5) !important;
}
.action-btn:hover {
    transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

/* Removes old fixed positioning */
.action-buttons-container .floating-share-container,
.action-buttons-container .tally-button-wrapper,
.action-buttons-container .floating-poll-btn {
    position: static;
}

/* Specific button colors */
.action-buttons-container .share-fab { background: linear-gradient(to bottom, #EBEBEB, #B7B7B7) !important; color: #434747 !important; }
.action-buttons-container .floating-poll-btn { background-color: #8A2BE2 !important; color: white !important; border: 1px solid #DDA0DD !important; }
.action-buttons-container .floating-feedback-btn {
    background: linear-gradient(to bottom, #0056A8, #003B75) !important;
    color: #fff !important;
    border: 1px solid #007BFF !important;
}
.action-buttons-container .kofi-button { background: linear-gradient(to bottom, #EBEBEB, #B7B7B7) !important; color: #434747 !important; }

/* --- THE CRITICAL FIX FOR THE SHARE MENU --- */

/* The container for the share button and its dropdown menu */
.floating-share-container {
    position: relative; /* CRITICAL: This anchors the absolute menu below */
}

/* The dropdown menu itself */
.action-buttons-container .share-menu {
    display: none; /* Hide it completely by default */
    position: absolute;
    top: 100%; /* Position it right below its container */
    left: 50%;
    transform: translateX(-50%); /* Center the menu under the button */
    margin-top: 8px; /* Space from the button */
    z-index: 10000; /* CRITICAL: Ensures it appears on top of everything */
    background-color: #2a2a2a;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 5px;
    min-width: 180px; /* Set a minimum width */
}

/* The class that the JavaScript will add to show the menu */
.action-buttons-container .share-menu.active {
    display: block; /* This makes the menu visible */
}
/* END: COMPLETE & FINAL ACTION BUTTONS CSS */

/* START: FINAL, OVERRIDING SHARE BUTTON CSS - PASTE AT THE VERY END OF YOUR <style> TAG */

/* This uses a unique name to avoid conflicts */
.share-container-final {
    position: relative; /* This is essential for positioning the menu */
}

/* This uses a unique ID (#) which gives it HIGH priority */
#final-share-menu {
    display: none; /* Hidden by default */
    position: absolute;
    top: 110%; /* Position it just below the button */
    left: 50%;
    transform: translateX(-50%); /* Center it horizontally */
    z-index: 10000; /* CRITICAL: Ensures it appears on top of EVERYTHING */
    background-color: #2a2a2a;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 5px;
    min-width: 180px;
}

/* This class is added by JavaScript to show the menu */
#final-share-menu.active {
    display: block;
}

/* These styles are for the links inside the pop-up menu */
#final-share-menu .share-menu-item {
    color: white;
    padding: 10px 20px;
    border-radius: 4px;
    font-weight: bold;
    text-decoration: none;
    text-align: center;
    display: block; /* Makes the links stack vertically */
    margin: 5px;
    transition: transform 0.2s;
}
#final-share-menu .share-menu-item:hover {
    transform: scale(1.05);
}
#final-share-menu .twitter-btn { background: #1DA1F2; }
#final-share-menu .facebook-btn { background: #1877F2; }

/* END: FINAL, OVERRIDING SHARE BUTTON CSS */


/* START: Styles for the new Ko-fi Modal */
.modal-overlay {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 3000;
    justify-content: center;
    align-items: center;
}
.modal-content {
    position: relative;
    padding: 20px;
    background: #1f1f1f;
    border: 2px solid #ffc600;
    border-radius: 8px;
    max-width: 90%;
}
.close-modal {
    position: absolute;
    top: -15px;
    right: -15px;
    background: #ff4444;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 20px;
    cursor: pointer;
    font-weight: bold;
    line-height: 28px;
}
#kofi-iframe-container iframe {
    max-width: 80vw;
    max-height: 80vh;
}
/* END: Styles for the new Ko-fi Modal */

/* START: FINAL MOBILE BUTTON BAR FIX - PASTE AT END OF <style> TAG */

/* Style the new elements for all screen sizes */
.action-btn {
    display: flex;
    flex-direction: column; /* Allows text to stack vertically */
    align-items: center;
    justify-content: center;
    line-height: 1.3 !important;
}

.action-btn small {
    font-size: 0.8em;
    font-weight: normal;
    opacity: 0.8;
    margin-top: 3px;
    display: block; /* Ensures it takes its own line */
}

.kofi-icon {
    height: 16px;
    margin-bottom: 4px;
}

/* This media query only applies these styles to smaller screens */
@media (max-width: 768px) {
    .action-buttons-container {
        flex-wrap: nowrap; /* CRITICAL: Prevents buttons from wrapping to the next line */
        align-items: stretch; /* Makes all buttons the same height */
    }

    /* Target all buttons inside the container on mobile */
    .action-buttons-container > * {
        flex: 1; /* CRITICAL: Makes each button take up an equal amount of space */
        min-width: 0; /* Allows buttons to shrink smaller than their content */
    }

    /* Make the buttons and text smaller to fit */
    .action-btn {
        font-size: 11px !important; /* Smaller font */
        padding: 5px !important; /* Less padding */
    }
}
/* END: FINAL MOBILE BUTTON BAR FIX */

/* START: FINAL Style for the SQUARE Corner Report Button */

.report-btn-corner {
    /* Positioning */
    position: absolute;
    top: 8px;
    right: 8px;
    z-index: 5;

    /* APPEARANCE - Black, SQUARE button */
    background: rgba(0, 0, 0, 0.7);
    border: 1px solid #7a2a2a;
    width: 30px;
    height: 30px;
    border-radius: 4px; /* Makes it a rounded square */
    
    /* Centering the icon */
    display: flex;
    align-items: center;
    justify-content: center;
    
    /* FIX: This nudges the emoji up to be perfectly centered */
    padding-bottom: 2px; 
    
    /* Text and other styles */
    font-size: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.report-btn-corner:hover {
    background: rgba(0, 0, 0, 0.9);
    transform: scale(1.1);
    box-shadow: 0 0 8px #ff7a7a;
}

/* END: FINAL Style for the SQUARE Corner Report Button */

/* === START: MODERN REPORT MODAL STYLES === */
#report-modal .modal-content {
    background: linear-gradient(135deg, #1e1e1e, #2d2d2d);
    border: 2px solid #ff6b6b;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(255, 107, 107, 0.2);
}

#report-modal .modal-header {
    color: white;
    padding: 20px;
    border-radius: 10px 10px 0 0;
    text-align: center;
}

#report-modal .modal-header h3 {
    margin: 0;
    font-size: 1.4em;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

#report-modal .close-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 24px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
}

#report-modal .close-btn:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

#report-modal .form-group {
    margin: 20px 0;
}

#report-modal .form-group label {
    display: block;
    margin-bottom: 8px;
    color: #ff6b6b;
    font-weight: bold;
    font-size: 14px;
}

#report-modal .form-group input,
#report-modal .form-group textarea {
    width: 100%;
    padding: 12px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid #444;
    border-radius: 6px;
    color: white;
    font-family: 'Chakra Petch', sans-serif;
    transition: all 0.3s ease;
}

/* === FIX DROPDOWN STYLES === */
#report-modal .form-group select {
    width: 100%;
    padding: 12px;
    background: #1a1a1a !important;
    border: 1px solid #444;
    border-radius: 6px;
    color: white !important;
    font-family: 'Chakra Petch', sans-serif;
    transition: all 0.3s ease;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
    background-repeat: no-repeat !important;
    background-position: right 12px center !important;
    background-size: 16px !important;
}

#report-modal .form-group select option {
    background: #1a1a1a !important;
    color: white !important;
    padding: 12px !important;
}

#report-modal .form-group select:focus {
    outline: none;
    border-color: #ff6b6b;
    box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.2);
}

#report-modal .form-group input:focus,
#report-modal .form-group textarea:focus {
    outline: none;
    border-color: #ff6b6b;
    box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.2);
}

#report-modal .form-actions {
    display: flex;
    gap: 12px;
    margin-top: 25px;
}

#report-modal .btn-cancel {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    border: 1px solid #5a6268;
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    flex: 1;
}

#report-modal .btn-submit {
    background: linear-gradient(135deg, #ff6b6b, #ee5a52);
    border: 1px solid #ff8e8e;
    color: white;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease;
    flex: 1;
}

#report-modal .btn-cancel:hover {
    background: linear-gradient(135deg, #5a6268, #495057);
    transform: translateY(-2px);
}

#report-modal .btn-submit:hover {
    background: linear-gradient(135deg, #ff5252, #e53935);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
}

#report-modal .btn-submit:disabled {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
/* === END: MODERN REPORT MODAL STYLES === */

/* Add this new CSS for the reported button state */
.report-btn-corner.reported,
.report-btn-corner:disabled {
    background: rgba(42, 122, 59, 0.7) !important; /* Greenish background */
    border-color: #7aff8d !important;
    cursor: not-allowed;
}

.report-btn-corner.reported:hover,
.report-btn-corner:disabled:hover {
    transform: none; /* No zoom effect */
    box-shadow: none; /* No glow */
}

/* Styles for the new main button group */
.main-action-buttons {
    display: flex;
    flex-direction: column; /* Stacks the button rows vertically */
    align-items: center;   /* Centers them horizontally */
    gap: 10px;             /* Adds a nice space between the rows */
    margin-bottom: 20px;   /* Adds space below the whole group */
}

.submit-code-btn {
    margin-top: 8px; /* Adds a 15px space directly above ONLY this button */
}

/* Remove old margins to prevent double-spacing */
.main-action-buttons .submit-code-btn {
    margin-top: 25px; /* Adds a 15px space above the submit button */
}


/* START: Styles for Code Submission Feature */

/* The main button to open the modal */
.submit-code-btn {
    background: linear-gradient(to bottom, #ff7c00, #e56a00);
    border: 1px solid #ffc600;
    color: #fff;
    padding: 4px 10px; /* Small padding for a small button */
    border-radius: 3px;
    cursor: pointer;
    font-weight: bold;
    font-size: 11px; /* This makes the text very small */
    text-transform: uppercase;
    font-family: 'Chakra Petch', sans-serif;
    text-shadow: 1px 1px 0 #000;
    transition: all 0.2s;
}
.submit-code-btn:hover {
    background: linear-gradient(to bottom, #ff8c00, #ff6a00);
    transform: scale(1.05);
    box-shadow: 0 0 6px #ffc600;
}

/* The pop-up form styles */
.submit-modal-overlay {
    display: none; /* Hidden by default */
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 9999;
    justify-content: center;
    align-items: center;
}
.submit-modal-content {
    background: #1f1f1f;
    padding: 25px;
    border-radius: 8px;
    border: 2px solid #ffc600;
    width: 90%;
    max-width: 500px;
    position: relative;
    font-family: 'Chakra Petch', sans-serif;
}
.submit-modal-content h3 {
    color: #ffc600;
    margin-top: 0;
    margin-bottom: 10px;
}
.close-submit-modal {
    position: absolute; top: -15px; right: -15px;
    background: #ff4444; color: white; border: none;
    border-radius: 50%; width: 30px; height: 30px;
    font-size: 20px; cursor: pointer; font-weight: bold;
}

/* Style for required fields */
.form-group input:required {
    border-left: 3px solid #ff6b6b;
}

.form-group label[for]:after {
    content: " *";
    color: #ff6b6b;
}

/* Form element styles */
.form-group {
    margin: 15px 0;
    text-align: left;
}
.form-group label {
    display: block;
    margin-bottom: 5px;
    color: #ccc;
    font-size: 14px;
}
.form-group input {
    width: 100%;
    padding: 10px;
    background: #111;
    border: 1px solid #444;
    border-radius: 4px;
    color: #fff;
    font-family: 'Chakra Petch', sans-serif;
}
.submit-action-btn {
    background: #ff7c00; border: none; color: white;
    padding: 12px 20px; border-radius: 4px; font-size: 16px;
    font-weight: bold; cursor: pointer; width: 100%;
    text-transform: uppercase; margin-top: 10px;
}

/* Message styles */
#submit-message {
    padding: 10px;
    margin: 10px 0;
    border-radius: 4px;
    display: none; /* Hidden by default */
    font-weight: bold;
}
.submit-error {
    background: #5c1f1f; color: #ffaaaa; border: 1px solid #ff7a7a;
}
.submit-success {
    background: #166d2e; color: #a3ffb5; border: 1px solid #34a853;
}

/* Required field styling */
.form-group input:required,
.form-group select:required,
.form-group textarea:required {
    border-left: 3px solid #dc3545;
}

.form-group label[for]:after {
    content: " *";
    color: #dc3545;
}

.form-group label[for="reporter-name"]:after {
    content: ""; /* Name is optional */
}

/* Validation error styling */
.form-group input:invalid,
.form-group select:invalid,
.form-group textarea:invalid {
    border-color: #ffc600;
    background-color: #1f1f1f;
}

.error-message {
    color: #dc3545;
    font-size: 12px;
    margin-top: 5px;
    display: none;
}

/* END: Styles for Code Submission Feature */

/* Style for the purpose dropdown */
/* Style for the dropdowns */
#submit-modal-overlay select {
    width: 100%;
    padding: 12px;
    background: #1a1a1a !important;
    border: 1px solid #444;
    border-radius: 6px;
    color: white !important;
    font-family: 'Chakra Petch', sans-serif;
    transition: all 0.3s ease;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e") !important;
    background-repeat: no-repeat !important;
    background-position: right 12px center !important;
    background-size: 16px !important;
}

#submit-modal-overlay select option {
    background: #1a1a1a !important;
    color: white !important;
    padding: 12px !important;
}

#submit-modal-overlay select:focus {
    outline: none;
    border-color: #00ffff;
    box-shadow: 0 0 0 2px rgba(0, 255, 255, 0.2);
}

#submit-modal-overlay select:required {
    border-left: 3px solid #ffc600;
}

/* =================================================== */
/*         START: SLICK FEEDBACK MODAL STYLES          */
/* =================================================== */
.feedback-modal-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 10000;
    justify-content: center;
    align-items: center;
    font-family: 'Chakra Petch', sans-serif;
}
.feedback-modal-content {
    background: #1a1a1a;
    color: #f0f0f0;
    padding: 25px;
    border-radius: 8px;
    border: 2px solid #007BFF;
    box-shadow: 0 5px 25px rgba(0, 123, 255, 0.3);
    width: 90%;
    max-width: 550px;
    position: relative;
    text-align: left;
}
.feedback-close-btn {
    position: absolute; top: -15px; right: -15px;
    background: #ff4444; color: white; border: none;
    border-radius: 50%; width: 30px; height: 30px;
    font-size: 20px; font-weight: bold;
    cursor: pointer; line-height: 28px;
    text-align: center;
    transition: transform 0.2s;
}
.feedback-close-btn:hover {
    transform: scale(1.1);
}
.feedback-modal-header {
    text-align: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #0056A8;
}
.feedback-modal-header h3 {
    margin: 0; color: #fff;
}
.feedback-modal-header p {
    margin: 5px 0 0 0; color: #007BFF; font-weight: bold;
}

/* Page styles */
.feedback-page {
    display: none;
    animation: fadeIn 0.5s;
}
.feedback-page.active {
    display: block;
}
.page-title {
    font-weight: bold;
    color: #fff;
    margin-bottom: 15px;
    font-size: 1.1em;
}
.page-subtitle {
    font-size: 0.9em;
    color: #aaa;
    margin-top: -10px;
    margin-bottom: 20px;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Form group styles */
.form-group {
    margin-bottom: 20px;
}
.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #ccc;
}
.form-group input[type="text"],
.form-group textarea {
    width: 100%;
    padding: 10px;
    background: #111;
    border: 1px solid #444;
    border-radius: 4px;
    color: #fff;
    font-family: 'Chakra Petch', sans-serif;
    transition: border-color 0.3s;
}
.form-group input[type="text"]:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #007BFF;
}
.form-group input.invalid,
.form-group .radio-group.invalid {
    border: 1px solid #ff4444 !important;
}

/* Custom Radio Buttons */
.radio-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
    border: 1px solid transparent; /* For invalid state */
    padding: 5px;
    border-radius: 4px;
}
.radio-group.horizontal {
    flex-direction: row;
    justify-content: space-around;
}
.radio-group label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-weight: normal;
    color: #ddd;
}
.radio-group input[type="radio"] {
    display: none;
}
.radio-group input[type="radio"] + span {
    padding-left: 30px;
    position: relative;
}
.radio-group input[type="radio"] + span::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    border: 2px solid #007BFF;
    border-radius: 50%;
    background: #111;
}
.radio-group input[type="radio"]:checked + span::after {
    content: '';
    position: absolute;
    left: 5px;
    top: 50%;
    transform: translateY(-50%);
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #007BFF;
}

/* Navigation */
.feedback-navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 25px;
    padding-top: 15px;
    border-top: 1px solid #0056A8;
}
.feedback-nav-btn {
    background: linear-gradient(to bottom, #007BFF, #0056A8);
    color: white;
    border: none;
    padding: 10px 25px;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    font-family: 'Chakra Petch', sans-serif;
    transition: all 0.3s;
}
.feedback-nav-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
}
.feedback-nav-btn:disabled {
    background: #555;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
#feedback-prev-btn {
    background: #555;
}
#feedback-submit-btn {
     background: linear-gradient(to bottom, #28a745, #218838);
}

/* Thank You Page */
.thank-you-page {
    text-align: center;
}
.thank-you-page h3 {
    color: #28a745; font-size: 1.5em;
}
.thank-you-page p {
    color: #ccc; line-height: 1.6;
}
/* =================================================== */
/*          END: SLICK FEEDBACK MODAL STYLES           */
/* =================================================== */

/* =================================================== */
/*    START: CONSOLIDATED COLOR & LAYOUT MODE STYLES   */
/* =================================================== */

/* 1. Base Stealth/Color Mode Setup */
body {
    --stealth-brightness: 0.7; /* Default fallback value */
    transition: background-color 0.5s ease;
}
body.stealth-mode .container {
    filter: grayscale(1) brightness(var(--stealth-brightness)) !important; 
    box-shadow: 0 0 10px rgba(128, 128, 128, 0.4) !important;
    border-color: #808080 !important;
    transition: filter 0.2s ease-out, box-shadow 0.2s ease-out, border-color 0.2s ease-out;
}
body.stealth-mode .container:before {
    background: linear-gradient(90deg, #808080, #555555, #808080) !important;
    box-shadow: 0 0 8px #555555 !important;
}
body.stealth-mode {
    background-image: none !important;
    background-color: #0d0d0d !important;
}
/* Keep Floating Elements UN-Filtered (use the new merged selector names) */
.stealth-mode .combined-floating-panel,
.stealth-mode .modal-overlay,
.stealth-mode .poll-modal-overlay,
.stealth-mode .floating-share-container,
.stealth-mode .action-buttons-container {
    filter: none !important; 
    box-shadow: none !important;
}

/* 2. Combined Floating Panel Styles (Replaces old 'floating-stealth-panel') */
.combined-floating-panel {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 1003;
    padding: 0;
    margin: 0;
    background: transparent;
    border: none;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}
#combined-toggle-btn {
    background: #1a1a1a;
    color: white;
    border: 1px solid #444;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}
/* Controls Wrapper/Collapse Logic (Replaces old 'stealth-controls-wrapper') */
#combined-controls-wrapper {
    background: #1a1a1a;
    border: 1px solid #444;
    border-radius: 4px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
    gap: 8px;
    position: absolute;
    bottom: 100%;
    left: 0;
    margin-bottom: 10px;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transform: translateY(10px);
    pointer-events: none;
    transition: all 0.3s ease-in-out;
    min-width: 170px;
}
.combined-floating-panel.is-open #combined-controls-wrapper {
    max-height: 200px;
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    border: 1px solid #00ffff;
}
/* Control Styles */
#combined-controls-wrapper label, #combined-controls-wrapper button {
    font-size: 12px;
    font-family: 'Chakra Petch', sans-serif;
    color: #bbb;
    font-weight: bold;
    cursor: pointer;
    user-select: none;
    background: #333;
    border: 1px solid #555;
    padding: 8px 10px;
    border-radius: 4px;
    text-align: center;
    transition: background 0.2s;
}
#combined-controls-wrapper input[type="range"] { width: 100%; -webkit-appearance: none; background: transparent; }
/* (Slider track/thumb styles remain the same) */


/* 3. Expanded View Layout (The Layout Mode) */

/* CRITICAL FIX: Explicitly set default to vertical stack */
#active-codes-container,
#expired-codes-container,
#permanent-codes-container,
#black-market-codes-container {
    display: block; 
    padding: 0;
    margin: 0;
}

/* PC-Only Media Query */
@media (min-width: 900px) {
    
    /* Hide the floating button that the Expanded View Button Replaced (if it existed) */
    .floating-pc-btn {
        display: none !important;
    }
    
    /* VITAL FIX: FORCE TITLE BAR AND TOP BUTTONS TO BE UN-AFFECTED */
    body.expanded-view .container .title-bar,
    body.expanded-view .container .action-buttons-container {
        flex-basis: 100%;  
        flex-grow: 0;      
        flex-shrink: 0;    
        margin-left: 0;
        margin-right: 0;
    }

    /* APPLYING EXPANDED VIEW (Only applies when .expanded-view is ON) */
    body.expanded-view .container {
        max-width: 1400px;
        width: 95%;
        transition: max-width 0.5s ease-in-out;
        
        /* VITAL: This line enables the entire container to be a horizontal flow */
        display: flex;       
        flex-wrap: wrap;     
        justify-content: center; 
    }
    
    /* MINIMAL RULE TO ARRANGE ALL INDIVIDUAL BUTTONS */
    body.expanded-view .rewards-link,
    body.expanded-view .roadmap-button,
    body.expanded-view .events-button,
    body.expanded-view .challenge-button,
    body.expanded-view .collapse-btn-BlackMarket,
    body.expanded-view .collapse-btn-Perm,
    body.expanded-view .collapse-btn-exp {
        flex: 1 1 300px; 
        margin: 5px;     
    }
    
    /* Force headings and floating panels to take full width so they break the line */
    body.expanded-view .container h1,
    body.expanded-view .container h2,
    body.expanded-view .container h3,
    body.expanded-view .container .floating-info-panel,
    body.expanded-view .container .contact-me-section,
    body.expanded-view .container .site-options-container {
        flex-basis: 100%;
        margin-top: 15px; 
    }

    /* HORIZONTAL LAYOUT FOR TOP BUTTONS */
    body.expanded-view .main-action-buttons {
        flex-direction: row; 
        justify-content: space-evenly;
        flex-wrap: nowrap;
        flex-basis: 100%; 
    }
    body.expanded-view .main-action-buttons .button-row {
        flex-direction: row; 
        flex: 1; 
        justify-content: center;
    }
    body.expanded-view .options-button-grid {
        flex-direction: row; 
        justify-content: space-evenly;
    }

    /* HORIZONTAL LAYOUT FOR CODE BOXES (Multi-Column) */
    body.expanded-view #active-codes-container,
    body.expanded-view #expired-codes-container,
    body.expanded-view #permanent-codes-container,
    body.expanded-view #black-market-codes-container {
        flex-basis: 100%;
    }
    
    body.expanded-view #active-codes-container,
    body.expanded-view #expired-codes-container,
    body.expanded-view #permanent-codes-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    body.expanded-view #black-market-codes-container {
        display: flex; 
        flex-wrap: wrap;
        gap: 20px;
    }
    
    /* Final fixes for code boxes and footer alignment (unchanged) */
    body.expanded-view .code-box, body.expanded-view .expired-code-box, body.expanded-view .permanent-code-box, body.expanded-view .black-market-code-box {
        margin: 12px 0; 
    }
    body.expanded-view .black-market-code-box {
        flex: 1 1 300px;
        margin: 0;
    }
    body.expanded-view .code-footer, body.expanded-view .permanent-code-footer, body.expanded-view .black-market-code-box .code-footer {
        display: flex; flex-direction: row; justify-content: space-between; align-items: center; flex-wrap: nowrap;
    }
    body.expanded-view .active-code-buttons-group { flex-direction: row; margin-left: auto; }
    body.expanded-view .redeem-checkbox, body.expanded-view .permredeem-checkbox, body.expanded-view .actredeem-checkbox {
        order: unset !important; margin: 0 !important; padding: 0 !important;
    }
}

@media (max-width: 899px) {
    /* Hide the floating PC button */
    .floating-pc-btn {
        display: none !important;
    }
    
    /* Ensure non-expanded view (mobile) uses vertical stack */
    #active-codes-container, #expired-codes-container, #permanent-codes-container, #black-market-codes-container {
        display: block; 
    }
}
/* =================================================== */
/*    END: CONSOLIDATED COLOR & LAYOUT MODE STYLES     */
/* =================================================== */

/* START: Custom Sticky Notification Bar Styles */
#custom-notification-bar {
    position: sticky; /* Makes it stick just below the title bar on scroll */
    top: 0;
    width: 100%;
    margin-top: -20px; /* Pulls it up to sit just below the header */
    background: linear-gradient(90deg, #ff4444, #cc0000);
    color: white;
    padding: 10px 20px;
    font-size: 16px;
    font-weight: bold;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-family: 'Chakra Petch', sans-serif;
}
#custom-notification-bar p {
    margin: 0;
}
#custom-notification-bar a {
    color: #ffff00;
    text-decoration: underline;
    margin-left: 10px;
    cursor: pointer;
}
#custom-notification-bar button {
    background: none;
    border: none;
    color: white;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
}
/* END: Custom Sticky Notification Bar Styles */

    </style>
</head>

<!-- Report Dialog Modal -->
<div id="report-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üö® Report SHiFT Code Issue</h3>
            <button class="close-btn" onclick="closeReportModal()">&times;</button>
        </div>
        
        <div class="modal-body">
            <form id="report-form">
                <div class="form-group">
                    <label for="reporter-name">Your Name (Optional) | Reddit/Discord Username If Want Me To Contact You:</label>
                    <input type="text" id="reporter-name" placeholder="Enter your name or reddit/discord name if want me to contact you">
                </div>
                
                <div class="form-group">
                    <label for="issue-type">What's the issue? *</label>
                    <select id="issue-type" required>
                        <option value="">Select an issue...</option>
                        <option value="expired">Code is expired</option>
                        <option value="invalid">Code is invalid</option>
                        <option value="promo">Promo is done</option>
                        <option value="region-locked">Region locked</option>
                        <option value="platform-issue">Platform specific issue</option>
                        <option value="other">Other issue</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="issue-description">Description *</label>
                    <textarea 
                        id="issue-description" 
                        placeholder="Please describe the issue in detail. What happened when you tried to redeem the code?"
                        rows="3"
                        required
                    ></textarea>
                    <small>Please provide specific details about the problem</small>
                </div>
                
                <div class="form-group">
                    <label for="proof-link">Proof Link *</label>
                    <input 
                        type="url" 
                        id="proof-link" 
                        placeholder="https://example.com/screenshot.jpg"
                        required
                    >
                    <small>Required: Link to screenshot, video, or other proof showing the issue [use imgur,postimage, any image host]</small>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeReportModal()">Cancel</button>
                    <button type="submit" class="btn-submit">Submit Report</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- REPLACE the existing image-preview-modal div with this one -->
<div id="image-preview-modal" class="image-preview-modal">
    <div class="image-preview-content">
        <div id="preview-container" style="display: none;">
            <!-- Iframe or video will be injected here by JavaScript -->
        </div>
        <img id="preview-image" src="" alt="Preview" style="display: none;">
    </div>
    <!-- These are the new controls for zooming and closing -->
    <div id="image-preview-controls">
        <button class="control-btn" id="zoom-in-btn" title="Zoom In">+</button>
        <button class="control-btn" id="zoom-out-btn" title="Zoom Out">-</button>
        <button class="control-btn" id="reset-zoom-btn" title="Reset Zoom">‚ü≤</button>
        <button class="control-btn" id="close-preview-btn" title="Close">√ó</button>
    </div>
</div>
<!-- END of the replacement block -->



<body>




    <div class="noise"></div>
    <div class="scanlines"></div>
    
    <div class="container">
        <div class="title-bar">
            <img src="https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png" alt="Left Icon" class="icon">
            <div class="title-text">SHiFT Code Tracker  + More</div>
            <img src="https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png" alt="Right Icon" class="icon">
        </div>

<!-- DELETE your old action-buttons-container and REPLACE it with this one -->
<div class="action-buttons-container">

        <button class="action-btn kofi-button" onclick="openKofiModal()">
        <img src="https://storage.ko-fi.com/cdn/cup-border.png" alt="Ko-fi donations" class="kofi-icon"/>
        Support This via Dono
        <small>Means Alot If You Do</small>
    </button>

<button class="action-btn floating-feedback-btn">
    Feedback<br>Forum<br><small>Updated 10/14/2025</small>
</button>
    <!-- This container is the key -->
    <div class="share-container-final">
        <button class="action-btn share-fab" id="final-share-button">
            üîó Share It On Socials
            <small>Help It Get Seen :)</small>
        </button>
    <div class="share-menu-final" id="final-share-menu">
    <a href="https://twitter.com/intent/tweet?text=Vault%20Hunters%20This%20SHiFT%20Code%20tracker%20has%20it%20all%3A%20active%20codes%2C%20Black%20Market%20info%20%26%20weekly%20resets%20in%20one%20spot.%0A%0AThanks%20%40xsmashx88x%20for%20making%20this!%0A%0AEh%20%40Borderlands%20%40GearboxOfficial%2C%20show%20it%20some%20love!%20%3A)%0A%0A%23Borderlands%20%23ShiftCodes%20%23Borderlands4%20%23BL4&url=https://xsmashx88x.github.io/Shift-Codes/" class="share-menu-item twitter-btn" target="_blank">üê¶ Share on X</a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://xsmashx88x.github.io/Shift-Codes/&quote=Fellow%20Vault%20Hunters%2C%20check%20out%20this%20epic%20SHiFT%20Code%20tracker!%20It%20has%20it%20all%20in%20one%20place%3A%20active%20codes%2C%20Black%20Market%20locations%2C%20weekly%20reset%20info%2C%20and%20more.%20You%20won't%20need%20to%20hunt%20for%20codes%20again!" class="share-menu-item facebook-btn" target="_blank">üëç Share on FB</a>
    </div>
</div>


    <button class="action-btn floating-poll-btn" id="openPollBtn">EH! Poll Time</button>

</div>



<!-- END: FINAL CORRECTED Floating Poll Button and Modal -->    

    <!-- === START: FINAL FLOATING INFO PANEL === -->
    <div class="floating-info-panel">
        
        <!-- This part is always visible -->
        <div class="visible-reminder-text">
            ‚Ä¢ FAV & CHECK DAILY ‚Ä¢ REFRESH OFTEN ‚Ä¢ 
            
            <!-- This is the smaller, clickable link that triggers the dropdown -->
            <a class="thank-you-link" style="color: #ffffff;" onclick="toggleThankYouPanel(this)">
                ‚Ä¢ Supporters & Special Thanks ‚Ä¢ <br> <small style="font-size: 0.7em; color: #00ffff;">Click To Open/Close list</small>
            </a>
        </div>
        
        <!-- This is the content that is hidden by default -->
        <div class="thank-you-content">
            <h4>MSG TO YOU ALL</h4>
            <ul>
                <li><span style="color: gold; font-weight: bold;">Sticky</span>, For being a legend, Good Friend. Love Ya Man | ü´Çüëä</li>                
                <li>The amazing <span style="color: hotpink;">[/r/Borderlands]</span> Community! | ü´Çüëä</li>
                <li>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</li>
                <li><span style="font-weight: bold;">Peeps who donate a certain amount or above go below</span></li>
                <li><span style="color: gold; font-weight: bold;">Pip (‚ÄòVirtual Pip‚Äô Xbox, ‚ÄòPip Was Here‚Äô Steam)</span>, Holy shit eh THANK YOU | ü´Çüëä</li>
                <li>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</li>
                <li><span style="font-weight: bold;">I am thankful for all donos dont think i am not :)</span></li>
                <li><span style="color: #F228BC;">To Everyone Who Has Supported This, An Will. Thank You</span>üëä</li>
                <li><span style="color: #28EBF2;">Means Alot, Its hard to express just how much this helps me on a personal level</span></li>
                <li><span style="color: #F2C928;">Will Thank You On Kofi :) </span>üçµ</li>
                </ul>
        </div>

    </div>


<!-- START: Code Submission Modal -->
<div id="submit-modal-overlay" class="submit-modal-overlay">
    <div class="submit-modal-content">
        <button class="close-submit-modal" onclick="closeCodeSubmitModal()">&times;</button>
        <h3>Submit a SHiFT Code</h3>
        <p>Found a code we're missing? Let us know!</p>
        
        <div class="form-group">
            <label for="submit-description">What is the code for? (e.g., "1 Gold Key", "Vex Skin") *</label>
            <input type="text" id="submit-description" placeholder="Enter a brief description..." required>
        </div>

        <div class="form-group">
            <label for="submit-code">SHiFT Code *</label>
            <input type="text" id="submit-code" placeholder="XXXXX-XXXXX-XXXXX-XXXXX-XXXXX" required>
        </div>

        <div class="form-group">
            <label for="submit-purpose">Code is for *</label>
            <select id="submit-purpose" required>
                <option value="">Select an option...</option>
                <option value="public_use">Public Use (Post on site, Multiple Redeems)</option>
                <option value="smash_only">Smash (One time use)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="submit-platform">Code is useable on *</label>
            <select id="submit-platform" required>
                <option value="">Select an option...</option>
                <option value="multi_platform">Multi Platform</option>
                <option value="xbox_only">Xbox</option>
                <option value="playstation_only">PlayStation</option>
                <option value="steam_only">Steam</option>
            </select>
        </div>

        <div class="form-group">
            <label for="submit-username">Username (for credit) - Discord/Reddit Username *</label>
            <input type="text" id="submit-username" placeholder="Enter your Discord or Reddit username" required>
        </div>

        <!-- This div will show success or error messages -->
        <div id="submit-message"></div>

        <button class="submit-action-btn" onclick="submitCode()">Submit to Admins</button>
    </div>
</div>
<!-- END: 
/* FEEDBACK QUESTIONS  |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  */
/* =================================================== -->
<!--         START: SLICK FEEDBACK MODAL                 -->
<!-- =================================================== -->
<div id="feedback-modal-overlay" class="feedback-modal-overlay">
    <div class="feedback-modal-content">
        <button class="feedback-close-btn">&times;</button>
        <div class="feedback-modal-header">
            <h3>SHiFT Code Tracker - Feedback Forum</h3>
            <p id="feedback-step-indicator">Step 1 of 6</p>
        </div>

        <form id="feedback-form">
            <!-- Page 1: User Info -->
            <div class="feedback-page active">
                <div class="form-group">
                    <label for="username">What's Your Username/Name?</label>
                    <input type="text" id="username" name="Username" placeholder="Enter your name..." required>
                </div>
                <div class="form-group">
                    <label>Where did you hear about this?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="Source" value="Smash on Reddit" required><span>Smash on Reddit</span></label>
                        <label><input type="radio" name="Source" value="Others on Reddit"><span>Others on Reddit</span></label>
                        <label><input type="radio" name="Source" value="Discord"><span>Discord</span></label>
                        <label><input type="radio" name="Source" value="Twitter/X or Facebook"><span>Twitter/X or Facebook</span></label>
                        <label><input type="radio" name="Source" value="Google"><span>Google</span></label>
                    </div>
                </div>
            </div>

            <!-- Page 2: Ratings -->
            <div class="feedback-page">
                <p class="page-title">How would you rate the following from your view on PC/Mobile?</p>
                <div class="form-group">
                    <label>Overall Website View</label>
                    <div class="radio-group horizontal">
                        <label><input type="radio" name="Website View" value="Average" required><span>Average</span></label>
                        <label><input type="radio" name="Website View" value="Good"><span>Good</span></label>
                        <label><input type="radio" name="Website View" value="Great"><span>Great</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Overall Website Experience</label>
                    <div class="radio-group horizontal">
                        <label><input type="radio" name="Website Experience" value="Average" required><span>Average</span></label>
                        <label><input type="radio" name="Website Experience" value="Good"><span>Good</span></label>
                        <label><input type="radio" name="Website Experience" value="Great"><span>Great</span></label>
                    </div>
                </div>
                 <div class="form-group">
                    <label>View for Active keys, Perm + Drops, Black Market</label>
                    <div class="radio-group horizontal">
                        <label><input type="radio" name="Key Sections View" value="Average" required><span>Average</span></label>
                        <label><input type="radio" name="Key Sections View" value="Good"><span>Good</span></label>
                        <label><input type="radio" name="Key Sections View" value="Great"><span>Great</span></label>
                    </div>
                </div>
            </div>

            <!-- Page 3: Section Feedback -->
            <div class="feedback-page">
                <p class="page-title">Section Feedback/Usage: Do you use or like them?</p>
                <div class="form-group">
                    <label>Black Market</label>
                    <div class="radio-group horizontal">
                        <label><input type="radio" name="Black Market Usage" value="Yes" required><span>Yes</span></label>
                        <label><input type="radio" name="Black Market Usage" value="No"><span>No</span></label>
                        <label><input type="radio" name="Black Market Usage" value="Don't Use"><span>Don't Use</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Drops + Skins</label>
                    <div class="radio-group horizontal">
                        <label><input type="radio" name="Drops/Skins Usage" value="Yes" required><span>Yes</span></label>
                        <label><input type="radio" name="Drops/Skins Usage" value="No"><span>No</span></label>
                        <label><input type="radio" name="Drops/Skins Usage" value="Don't Use"><span>Don't Use</span></label>
                    </div>
                </div>
                 <div class="form-group">
                    <label>Roadmap/Events (when there is one)</label>
                    <div class="radio-group horizontal">
                        <label><input type="radio" name="Roadmap/Events Usage" value="Yes" required><span>Yes</span></label>
                        <label><input type="radio" name="Roadmap/Events Usage" value="No"><span>No</span></label>
                        <label><input type="radio" name="Roadmap/Events Usage" value="Don't Use"><span>Don't Use</span></label>
                    </div>
                </div>
            </div>

            <!-- Page 4: Suggestions -->
            <div class="feedback-page">
                <p class="page-title">Feedback On Site and Your Suggestions</p>
                 <div class="form-group">
                    <label for="overall-website">Overall Website?</label>
                    <textarea id="overall-website" name="Overall Website Feedback" rows="2" placeholder="Your thoughts..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="how-to-improve">How can we make this better for you?</label>
                    <textarea id="how-to-improve" name="Improvement Suggestions" rows="2" placeholder="Your suggestions...(asking for older bl game shift codes) wont happen... did a poll and users said no for this" required></textarea>
                </div>
                <div class="form-group">
                    <label for="anything-else">Anything else you would like to share/Suggestions?</label>
                    <textarea id="anything-else" name="Additional Suggestions" rows="2" placeholder="Any other ideas..." required></textarea>
                </div>
            </div>

             <!-- Page 5: Socials (Optional) -->
            <div class="feedback-page">
                <p class="page-title">Put Your Twitter/Discord/Reddit Username</p>
                <p class="page-subtitle">Only if you want me to contact you about the feedback/suggestions. You can skip this page if you want. (put N/A)</p>
                <div class="form-group">
                    <label for="twitter-user">Twitter</label>
                    <input type="text" id="twitter-user" name="Twitter" placeholder="@username (optional)">
                </div>
                <div class="form-group">
                    <label for="discord-user">Discord</label>
                    <input type="text" id="discord-user" name="Discord" placeholder="username (optional)">
                </div>
                <div class="form-group">
                    <label for="reddit-user">Reddit</label>
                    <input type="text" id="reddit-user" name="Reddit" placeholder="u/username (optional)">
                </div>
            </div>

            <!-- Page 6: Thank You -->
            <div class="feedback-page thank-you-page">
                <h3>Thank you!</h3>
                <p>Your feedback is helping me to improve and understand your feelings toward this, so I can offer you the best possible experience.</p>
                <p>If you want to suggest stuff or talk, you can open a Reddit DM, or message me on Discord or Twitter. All info is under the "Connect/Contact" button on the main site. I can't reply to the forum here, but I do see everything you all put. :)</p>
            </div>
        </form>

        <div class="feedback-navigation">
            <button id="feedback-prev-btn" class="feedback-nav-btn" style="display: none;">Previous</button>
            <button id="feedback-next-btn" class="feedback-nav-btn">Next</button>
            <button id="feedback-submit-btn" class="feedback-nav-btn" style="display: none;">Submit</button>
        </div>
    </div>
</div>
<!-- =================================================== -->
<!--          END: SLICK FEEDBACK MODAL                  -->
<!-- =================================================== -->

<body>


<!-- === START: High-Tech Contact Me Section === -->
<div class="contact-me-section">
    <h4 class="contact-me-title">Connect/Contact</h4>
    
    <!-- This new wrapper will handle the animation -->
    <div class="slide-down-content">

        <p class="info-text">
            Xbox/Shift : xsmashx88x
        </p>

        <div class="social-links">  
            <a href="https://x.com/xsmashx88x" target="_blank">üê¶ Twitter | Follow/Chat </a>
            <a href="https://discord.com/users/97484502628052992" target="_blank">üí¨ Discord | Chat</a>
            <a href="https://www.reddit.com/user/smashcanuckgamer/" target="_blank">üëæ Reddit | Chat</a>
        </div>

    </div>
</div>
<!-- === END: High-Tech Contact Me Section === -->



<!-- START: FINAL, CORRECTLY ORGANIZED SITE OPTIONS CONTAINER -->
<div class="site-options-container">
    <h4 class="site-options-title" onclick="toggleOptionsContainer(this)">
        SITE OPTIONS & INFO
        <small class="updated-subtitle">UPDATED 10/14/2025</small>
    </h4>
    
    <div class="slide-down-content">
        <!-- CONTAINER 1: THE BUTTON GRID (This now ONLY contains buttons) -->
        <div class="options-button-grid">
            <div class="button-row">
                <button class="option-btn option-btn-hide" onclick="toggleOptionPanel('settings-section')" id="hideem-toggle-btn">üôàHide Items<small> </small></button>
                <button class="option-btn option-btn-faq" onclick="toggleOptionPanel('info-section')" id="infofaq-toggle-btn">‚ùóINFO/FAQ‚ùì<br><small>Updated 10/10/2025</small></button>
            </div>
            <div class="button-row">
                <button class="option-btn option-btn-log" onclick="toggleOptionPanel('changelog-section')" id="changlog-toggle-btn">üìãCHANGE LOGüõ†Ô∏è<br><small>Updated 10/14/2025</small></button>
                <button class="option-btn option-btn-redeem" onclick="toggleOptionPanel('redeem-section')" id="redeem-toggle-btn">üñ•Ô∏è HOW TO REDEEM ON CONSOLE üéÆ</button>
            </div>
        </div>

        <!-- CONTAINER 2: THE CONTENT PANELS (Now properly separated from the buttons) -->
        <div class="options-content-panels">
            <div id="settings-section" class="info-section">
                <div class="info-content">
                    <h3>Visibility Settings</h3>
                    <p>Choose which elements to hide:</p>
                    <div class="setting-item">
                        <input type="checkbox" id="hide-redeem-toggle-btn" onchange="handleSettingChange('redeem-toggle-btn', this.checked)">
                        <label for="hide-redeem-toggle-btn">Hide "How To Redeem" button</label>
                    </div>
                    <div class="setting-item">
                        <input type="checkbox" id="hide-rewards-link" onchange="toggleRewardsLink(this.checked)">
                        <label for="hide-rewards-link">üÜï|Hide "Click Here | To Redeem Codes"</label>
                    </div>
                    <div class="setting-item">
                        <input type="checkbox" id="hide-roadmap-btn" onchange="handleSettingChange('roadmap-btn', this.checked)">
                        <label for="hide-roadmap-btn">Hide "View BL4 Roadmap" button</label>
                    </div>
                    <div class="setting-item">
                        <input type="checkbox" id="hide-maurices-toggle-btn" onchange="handleSettingChange('maurices-toggle-btn', this.checked)">
                        <label for="hide-maurices-toggle-btn">Hide "Mauric's Black Market" button</label>
                    </div>
                    <div class="setting-item">
                        <input type="checkbox" id="hide-permanent-toggle-btn" onchange="handleSettingChange('permanent-toggle-btn', this.checked)">
                        <label for="hide-permanent-toggle-btn">Hide "[View] Drops + Limited Time Codes + More" button</label>
                    </div>
                </div>
            </div>
            <div id="info-section" class="info-section">
                <div class="info-content">
                    <p style="color:#E10B0B;"><strong>üÜïWelcome, Vault Hunter!</strong></p>
                    <ul style="color:#FD8787;">
                        <li><i>üÜïI created this tracker for a simple reason: I saw how many of us were struggling to keep up with SHiFT codes, constantly wondering if they were still active or when they might expire. Since not everyone wants to live on Twitter/X, I wanted to build a single, reliable home for the community.<br><br>Due to some personal health matters, I have a lot of time on my hands, and I decided to put it to good use for a community I like. So many others just don't update fast enough or fix when a code should be expired but works or worse IGN they want you to sub to a service smfh<br><br>Now, about the donation button. Frankly, I didn't want to add one, but it was created by popular request from users who wanted to show their support. So let me be crystal clear:<br><br>This site will stay updated for as long as it's helpful to you, donations or not. That is my promise.<br><br>That said, for those who have chosen to contribute, your support is incredibly helpful on a personal level and genuinely appreciated more than you know.<br>Thank you for being an amazing community. Now, go get that loot</i></li>
                    </ul>
                    <p style="color:#7AFD42;"><strong>A Note to the Community</strong></p>
                    <ul style="color:#C7FFB0;">
                        <li><i>This project was created solely to help the community, not for personal gain like followers or fame. It's simply a tool built for fellow Vault Hunters.</i></li>
                        <li><i>The donation button was added by popular request from community members who wished to support the project. It is, and always will be, completely optional.</i></li>
                        <li><i>If you find this tracker valuable and wish to show your appreciation, your support is incredibly helpful. Thank you!</i></li>
                    </ul>
                    <p style="color:#FA70CE;"><strong>F.A.Q</strong></p>
                    <ul style="color:#FFC1EB;">
                        <li>üÜï<b>Will you ever do older BL Games?</b> <i>Sadly, Did a poll and community got to pick and nope, they don't want it. <a href="https://i.postimg.cc/HkhmW7qV/screenshot-35.png">Poll View Image</a></i></li>
                        <li><b>How quickly are codes updated?</b> <i>Codes are typically added within minutes of being released. The primary goal of this site is to serve as a reliable, long-term tracker for the entire community, especially for those who don't monitor social media 24/7. This saves you the frustration of finding and trying codes that have already expired.</i></li>
                        <li><b>What is the purpose of this site?</b> <i>This tracker was built to provide a clear, simple solution for two things: to know for certain if a SHiFT code is still active, and to make redeeming them effortless with a one-click copy button.</i></li>
                        <li><b>How are codes added to the tracker?</b> <i>Every code is found and added manually. I monitor official social media channels and community hubs for new releases. There are no automated bots, which ensures the information is as accurate as possible.</i></li>
                        <li><b>"Haters that say : I can find keys faster than they get posted here."</b> <i>Congratulations on winning the race against a free public service! While you're refreshing social media 24/7, this site is busy being a reliable archive for people who have jobs, hobbies, or just better things to do. We'll be here when you need to check if that code from Tuesday is still good.</i></li>
                    </ul>
                    <p style="color:#FFDE59;"><strong>PSA</strong></p>
                    <ul style="color:#FFF3C4;">
                        <li><b>Gold Keys On Multi Systems :</b><i>if linked multi systems can redeem on each :) from what I hear.</i></li>
                        <li><b>They Don't Show Even Tho Did Redeem Them :</b><i>If the redeem site shows 3 codes lets say the 3 you did, then close and restart your game they should show up.</i></li>
                    </ul>
                </div>
            </div>
            <div id="changelog-section" class="info-section">
                <div class="info-content">
                    <p><strong>Change Log | Info On Changes/Updates/ An More</strong></p>
                    <ul>
                        <li>üÜï<b>10|14|2025:</b> Lil Fixs/Added : Dark Mode/Wide Mode... Things might break in wide.. not fully tested.. Dark Mode has a slider for how dark as well :)</li>
                        <li>üÜï<b>10|13/14|2025:</b> Lil Fixs/Added : A report not working codes + submit codes button :  if its truly expired i will get an alert and will remove it as soon as i can</li>
                        <li><b>10/12/2025:</b> Lil Fixs/Added : Lil Tweaks, UI Changes (moved floating buttons based on feedback)<br>sorry you gamers didnt see the check cause of the floating donate button</li>
                        <li><b>10/8/2025:</b> Lil Fixs/Added : Lil Tweaks, UI Changes</li>
                        <li><b>10/5/2025:</b> Lil Fixs/Added : Lil Tweaks, Added A Remember Copy Hightlight</li>
                        <li><b>10/4/2025:</b> Fixed/Added : Lil Tweaks, Added Chest/View Keys Button (links to pics)</li>
                        <li><b>10/2/2025:</b> Fixed/Added : Lil Tweaks</li>
                        <li><b>9/29/2025:</b> Fixed/Added : New Codes, Some Lil Changes.</li>
                        <li><b>9/28/2025:</b> Fixed/Added : Fixed Few Things, Added Wildcard/Encore Boss Info</li>
                        <li><b>9/27/2025:</b> Fixed/Added : Just some small tweaks..</li>
                        <li><b>9/26/2025:</b> Fixed/Added : Few Things... Might or Might Not Notice :)</li>
                        <li><b>9/25/2025:</b> Fixed : Should Be More Mobile Friendly</li>
                        <li><b>9/25/2025:</b> Added : Hide Buttons Option (should stick on refresh)</li>
                        <li><b>9/25/2025:</b> Fixed : Mobile Button Issues For Black Market</li>
                        <li><b>9/25/2025:</b> Added : Maurices Black Market, Static View</li>
                        <li><b>9/25/2025:</b> Added : Maurices Black Market, With Map View</li>
                        <li><b>9/24/2025:</b> Fixed time issues</li>
                        <li><b>9/24/2025:</b> Fixed refresh issue on Android/some browsers</li>
                        <li><b>9/23/2025:</b> Added "Mark as redeemed" feature with local storage</li>
                        <li><b>9/22/2025:</b> Added preview button for image rewards</li>
                        <li><b>9/21/2025:</b> Improved countdown timer functionality</li>
                        <li><b>9/20/2025:</b> Added permanent/unknown expiration codes section</li>
                        <li><b>9/19/2025:</b> Initial website launch with basic functionality</li>
                    </ul>
                </div>
            </div>
            <div id="redeem-section" class="info-section">
                <div class="info-content">
                    <p><strong>In-Game</strong></p>
                    <ol>
                        <li>Open the Pause Menu while in-game Or On Main Menu</li>
                        <li>Click "SHiFT"</li>
                        <li>Click "Rewards"</li>
                        <li>Enter codes and redeem them</li>
                    </ol>
                    <p><strong>Online</strong></p>
                    <p>CLICK THAT BUTTON BELOW AND WILL OPEN THE SHIFT REDEEM SITE</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END: FINAL, CORRECTLY ORGANIZED SITE OPTIONS CONTAINER -->

<div id="rewards-container">
    <a href="https://shift.gearboxsoftware.com/rewards" target="_blank" class="rewards-link">
        üîó CLICK HERE | TO REDEEM CODES üåê <br>
        <small style="font-size: 0.9em; opacity: 0.6; color: black;">Opens Official SHIFT Rewards Site</small>
    </a>
</div>

        <button class="roadmap-button" onclick="openRoadmapImage()" id="roadmap-btn">üó∫Ô∏è VIEW BL4 ROADMAP üõ£Ô∏è</button>
                <button class="events-button hidden" onclick="toggleInfo('events-section')" id="events-btn"></button>
<div id="events-section" class="info-section events-content-unique">
    <a href="javascript:void(0);" onclick="openImagePreview(EVENTS_CONFIG.imageUrl)">
        <img id="events-image" src="" alt="Events Image" style="width: 100%; cursor: pointer;">
    </a>
    <p id="events-description" style="margin-top: 15px; line-height: 1.5; text-align: left;"></p>
</div>
                        <button class="challenge-button hidden" onclick="toggleInfo('challenge-section')" id="challenge-btn"></button>
        <div id="challenge-section" class="info-section">
            <div class="info-content">
                <!-- The clickable image -->
                <a href="javascript:void(0);" onclick="openImagePreview(COMMUNITY_CHALLENGE_CONFIG.imageUrl)">
                    <img id="challenge-image" src="" alt="Community Challenge Image" style="width: 100%; border-radius: 4px; border: 2px solid #BF40BF; cursor: pointer;">
                </a>
                <!-- The description text -->
                <p id="challenge-description" style="margin-top: 15px; color: #E6E6FA; line-height: 1.5;"></p>
            </div>
        </div>
        <!-- ADD THIS NEW DIV for the events dropdown -->

      <button class="collapse-btn-BlackMarket" onclick="toggleInfo('black-market-section')" id="maurices-toggle-btn">üíµ Maurices Black Market/Boss + WildCardü´∞<br> <small style="font-size: 0.7em; opacity: 0.9; ">After Reset, Give Me A Few To Update Images/Info Plz.</small><br><small style="font-size: 0.7em; color: #FF7979;" class="drops-pulse">!Updated 10/9/2025!</small> </button>
        
        <div id="black-market-section" class="info-section">
            <h2  style="font-size: 1.2em;">üíµ Maurices Black Market/Boss + Wild Card ü´∞</h2>
            <div id="black-market-codes-container">
                <!-- Black Market Vendor will be inserted here by JavaScript -->
            </div>
        </div>

<button class="collapse-btn-Perm" onclick="togglePermanent()" id="permanent-toggle-btn">
    üéÅ [View] Drops/Skins + Limited Time Codes + More ‚åõ
    <br>
    <small style="font-size: 0.9em; color: #be46ff;" class="drops-pulse">!Updated 10/14/2025!</small>
</button>
        
        <div id="permanent-section" class="permanent-section">
            <h2>üéÅ Drops/Skins + Limited Time Codes + More ‚åõ<br> <small style="font-size: 0.9em; opacity: 0.9; ">Anything Besides Gold Keys Will Go Here</small> </h2>                
            <div id="permanent-codes-container">
                <!-- Permanent codes will be inserted here by JavaScript -->
            </div>
        </div>

<h1>üëç Active BL4 SHiFT Codes (New At Top) üóùÔ∏è <br> <small style="font-size: 0.6em; opacity: 0.9; "> ‚¨á Gold Keys Only ‚¨á | ‚¨Ü Drops Button For Skins + Others ‚¨Ü</small> 
    <br>
    <small style="font-size: 0.7em; opacity: 0.8; color: #FFD114;" class="drops-pulse">!Updated 10/14/2025!</small>
    
    <!-- === NEW BUTTONS CONTAINER === -->
    <div class="key-info-buttons-container">
        <button class="key-info-btn" onclick="openImagePreview('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/seekeysyouhave.png')">
            Check Gold Keys
        </button>
        <button class="key-info-btn" onclick="openImagePreview('https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/%5BDate%20%202025-10-04%5D%20%2B%20%5BTime%20%2003-32-50AM%5D.png')">
            Find Gold Chest
        </button>
    </div>

    <button class="submit-code-btn" onclick="openCodeSubmitModal()">üìù Submit a Code</button>
</div>

</h1>
        <div id="active-codes-container">
            <!-- Active codes will be inserted here by JavaScript -->
        </div>

        <button class="collapse-btn-exp" onclick="toggleExpired()">
            ‚ùå Expired Ish üò≠
        </button>
        
        <div id="expired-section" class="expired-section">
            <h3>‚ùå Expired Ish : Damn Look At Them All üëé</h3>
            <div id="expired-codes-container">
                <!-- Expired codes will be inserted here by JavaScript -->
            </div>
        </div>
    </div>

<!-- START: COMBINED LAYOUT & COLOR MODE PANEL -->
<div class="combined-floating-panel" id="combined-panel">
    
    <!-- The main black circle button (the trigger) -->
    <button id="combined-toggle-btn" onclick="toggleCombinedPanel(event)">‚öôÔ∏è</button>

    <!-- The pop-out control wrapper (hidden by default) -->
    <div id="combined-controls-wrapper">
        
        <!-- 1. EXPANDED PC VIEW TOGGLE -->
        <button id="pc-view-toggle" onclick="toggleLayoutMode()">
            Layout Mode: OFF üñ•Ô∏è
        </button>
        
        <!-- 2. STEALTH MODE TOGGLE LABEL -->
        <label for="stealth-slider" id="stealth-mode-label" onclick="toggleColorMode()">Color Mode: OFF üåà</label>
        
        <!-- 3. BRIGHTNESS SLIDER -->
        <input 
            type="range" 
            id="stealth-slider" 
            min="0.4" 
            max="1.0" 
            step="0.05" 
            value="0.7" 
            oninput="updateStealthBrightness(this.value)"
        >
        
    </div>
</div>
<!-- END: COMBINED LAYOUT & COLOR MODE PANEL -->

<!-- START: CUSTOM STICKY NOTIFICATION BAR -->
<div id="custom-notification-bar" style="display: none;">
    <p>
        üö® New SHiFT Codes Dropped! Click to view!
        <a href="https://xsmashx88x.github.io/Shift-Codes/" target="_self" onclick="this.parentNode.style.display='none';">REFRESH NOW</a>
    </p>
    <button onclick="document.getElementById('custom-notification-bar').style.display='none';">X</button>
</div>
<!-- END: CUSTOM STICKY NOTIFICATION BAR -->

    <script>

/* =================================================== */
/*        START: FINAL WORKING NOTIFICATION LOGIC      */
/* =================================================== */

// --- VITAL CONSTANTS (Ensure these are defined) ---
const NOTIFICATION_STORAGE_KEY = 'shiftNotificationVersion';
const MAIN_URL = 'https://xsmashx88x.github.io/test.shift/';
const VERSION_FILE_URL = 'https://raw.githubusercontent.com/xsmashx88x/test.shift/main/code_version.txt';
const POLLING_INTERVAL_MS = 60000; 

// --- MISSING FUNCTION: THIS UPDATES THE BUTTON'S TEXT/STYLE ---
function updateButtonDisplay(permission) {
    const button = document.getElementById('notif-permission-btn');
    if (!button) return;

    if (permission === 'granted') {
        button.textContent = 'Notif Enabled ‚úÖ';
        button.classList.add('hidden'); // Hide if granted
    } else if (permission === 'denied') {
        button.textContent = 'Notif Blocked üö´';
        button.disabled = true;
    } else {
        button.textContent = 'Enable Notif üîî';
        button.classList.remove('hidden'); // Ensure visible if still default/prompting
    }
}
// --- END MISSING FUNCTION ---


function requestNotificationPermission() {
    if (!("Notification" in window)) {
        console.log("Browser doesn't support notifications.");
        return;
    }
    
    // Pass the permission result to the display update function
    Notification.requestPermission(function (permission) {
        updateButtonDisplay(permission);
    });
}

async function checkAndShowNotification() {
    try {
        // Fetch the latest version number from the external text file
        const response = await fetch(VERSION_FILE_URL + '?nocache=' + new Date().getTime());
        const latestVersionString = (await response.text()).trim();
        const LATEST_VERSION = parseInt(latestVersionString) || 0;
        
        const lastNotifiedVersion = parseInt(localStorage.getItem(NOTIFICATION_STORAGE_KEY)) || 0;
        
        if (LATEST_VERSION > lastNotifiedVersion) {
            
            if (Notification.permission === "granted") {
                
                const newCodeNotif = new Notification('üö® New SHiFT Codes Dropped! üóùÔ∏è', {
                    body: 'Vault Hunter! New codes are here! Click to view.',
                    icon: 'https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/gh-pages/bl%20key.png', 
                    requireInteraction: true 
                });
                
                newCodeNotif.onclick = function() {
                    window.open(MAIN_URL, '_self');
                    this.close();
                };
                
                localStorage.setItem(NOTIFICATION_STORAGE_KEY, LATEST_VERSION);
                
            } else {
                // If not granted, the button will remain visible to prompt the user
            }
        }
    } catch (error) {
        console.error("Error during version check:", error);
    }
}

// --- VITAL: START POLLING ---
document.addEventListener('DOMContentLoaded', () => {
    // 1. Initial button status check (This now works because updateButtonDisplay is defined)
    if ("Notification" in window && document.getElementById('notif-permission-btn')) {
        updateButtonDisplay(Notification.permission);
    }
    
    // 2. Run the check once immediately (with a short delay to load)
    setTimeout(checkAndShowNotification, 3000); 
    
    // 3. Start the continuous polling loop
    setInterval(checkAndShowNotification, POLLING_INTERVAL_MS);
});

/* =================================================== */
/*          END: FINAL WORKING NOTIFICATION LOGIC      */
/* =================================================== */ 

/* =================================================== */
/*    START: UNIFIED COLOR & LAYOUT MODE SCRIPT        */
/* =================================================== */

const BRIGHTNESS_STORAGE_KEY = 'stealthBrightness';
const COLOR_TOGGLE_KEY = 'colorModeEnabled';
const LAYOUT_TOGGLE_KEY = 'expandedViewEnabled';
const DEFAULT_BRIGHTNESS = '0.7';

// --- COLOR MODE (STEALTH) LOGIC ---
function updateStealthBrightness(value) {
    const body = document.body;
    body.style.setProperty('--stealth-brightness', value);
    try { localStorage.setItem(BRIGHTNESS_STORAGE_KEY, value); } catch (e) { console.error("Error saving brightness:", e); }
}

function toggleColorMode() {
    const body = document.body;
    const label = document.getElementById('stealth-mode-label');
    const isStealthMode = body.classList.toggle('stealth-mode');
    
    try { localStorage.setItem(COLOR_TOGGLE_KEY, isStealthMode); } catch (e) { console.error("Error saving color mode:", e); }

    if (isStealthMode) {
        label.innerHTML = 'Color Mode: ON üï∂Ô∏è';
        updateStealthBrightness(document.getElementById('stealth-slider').value);
    } else {
        label.innerHTML = 'Color Mode: OFF üåà';
        body.style.removeProperty('--stealth-brightness');
    }
}

// --- LAYOUT MODE (EXPANDED PC) LOGIC ---
function toggleLayoutMode() {
    const body = document.body;
    const button = document.getElementById('pc-view-toggle');
    const isExpanded = body.classList.toggle('expanded-view');
    
    try { localStorage.setItem(LAYOUT_TOGGLE_KEY, isExpanded); } catch (e) { console.error("Error saving layout mode:", e); }

    if (isExpanded) {
        button.textContent = 'Layout Mode: ON üíª';
        button.style.background = '#007bff';
        button.style.borderColor = '#0056b3';
    } else {
        button.textContent = 'Layout Mode: OFF üñ•Ô∏è';
        button.style.background = '#333';
        button.style.borderColor = '#555';
    }
}

// --- PANEL CONTROL LOGIC ---
function toggleCombinedPanel(event) {
    event.stopPropagation();
    const panel = document.getElementById('combined-panel'); // Note: Changed to combined-panel
    if (panel) {
        panel.classList.toggle('is-open');
    }
}

document.addEventListener('click', function(event) {
    const panel = document.getElementById('combined-panel');
    if (panel && !panel.contains(event.target)) {
        panel.classList.remove('is-open');
    }
});

// --- INITIALIZATION ---
function applySavedCombinedMode() {
    // 1. Get Elements
    const body = document.body;
    const slider = document.getElementById('stealth-slider');
    const colorLabel = document.getElementById('stealth-mode-label');
    const layoutButton = document.getElementById('pc-view-toggle');
    
    // Check if the unified panel elements exist before running logic
    if (!slider || !colorLabel || !layoutButton) return;

    // 2. Apply Color/Stealth Mode
    const isSavedColorMode = localStorage.getItem(COLOR_TOGGLE_KEY) === 'true';
    const savedBrightness = localStorage.getItem(BRIGHTNESS_STORAGE_KEY) || DEFAULT_BRIGHTNESS;

    slider.value = savedBrightness;
    
    if (isSavedColorMode) {
        body.classList.add('stealth-mode');
        colorLabel.innerHTML = 'Color Mode: ON üï∂Ô∏è';
        updateStealthBrightness(savedBrightness);
    }

    // 3. Apply Layout Mode (PC View)
    const isSavedLayoutMode = localStorage.getItem(LAYOUT_TOGGLE_KEY) === 'true';
    if (window.matchMedia("(min-width: 900px)").matches) {
        if (isSavedLayoutMode) {
            body.classList.add('expanded-view');
            layoutButton.textContent = 'Layout Mode: ON üíª';
            layoutButton.style.background = '#007bff';
            layoutButton.style.borderColor = '#0056b3';
        }
    } else {
        // Ensure the class is removed on mobile devices regardless of saved state
        body.classList.remove('expanded-view');
        layoutButton.textContent = 'Layout Mode: OFF üñ•Ô∏è';
    }
}

document.addEventListener('DOMContentLoaded', applySavedCombinedMode);

/* =================================================== */
/*     END: UNIFIED COLOR & LAYOUT MODE SCRIPT         */
/* =================================================== */

// Extract key from page content
function extractKeyFromPage() {
    const keyPattern = /[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}/;
    const match = document.body.textContent.match(keyPattern);
    return match ? match[0] : null;
}

// Local storage functions
function saveReportedStatus(code, isReported) {
    try {
        const reportedCodes = JSON.parse(localStorage.getItem('shiftReportedCodes')) || {};
        reportedCodes[code] = isReported;
        localStorage.setItem('shiftReportedCodes', JSON.stringify(reportedCodes));
    } catch (e) { 
        console.error("Error saving reported status:", e); 
    }
}

function getReportedStatus(code) {
    try {
        const reportedCodes = JSON.parse(localStorage.getItem('shiftReportedCodes')) || {};
        return reportedCodes[code] || false;
    } catch (e) { 
        console.error("Error reading reported status:", e); 
        return false; 
    }
}


// UI Functions
function showKeyAlreadyReported() {
    const reportBtn = document.querySelector('#report-button');
    if (reportBtn) {
        reportBtn.disabled = true;
        reportBtn.textContent = 'Already Reported';
        reportBtn.style.backgroundColor = '#6b7280';
    }
    
    const statusDiv = document.createElement('div');
    statusDiv.innerHTML = `
        <strong>‚úÖ This key has already been reported</strong>
        <br><small>Other users can see that this key is no longer valid</small>
    `;
    statusDiv.style.cssText = 'background: #dcfce7; color: #166534; padding: 10px; border-radius: 4px; margin: 10px 0; border: 1px solid #bbf7d0;';
    
    const keyElement = document.querySelector('.key-display') || document.querySelector('code') || document.querySelector('pre');
    if (keyElement) {
        keyElement.parentNode.insertBefore(statusDiv, keyElement.nextSibling);
    }
}

function enableReportingUI() {
    const reportBtn = document.querySelector('#report-button');
    if (reportBtn) {
        reportBtn.disabled = false;
        reportBtn.textContent = 'Report as Used/Broken';
        reportBtn.style.backgroundColor = '#ef4444';
        reportBtn.onclick = () => {
            const key = extractKeyFromPage();
            if (key) {
                reportCode(key, reportBtn);
            }
        };
    }
}

// Page initialization
async function initializePage() {
    const currentKey = extractKeyFromPage();
    
    if (currentKey && isKeyReported(currentKey)) {
        showKeyAlreadyReported();
    } else {
        enableReportingUI();
    }
}

// Event listeners and modal functions
function setupEventListeners() {
    const zoomInButton = document.getElementById('zoom-in-btn');
    const zoomOutButton = document.getElementById('zoom-out-btn');
    const resetZoomButton = document.getElementById('reset-zoom-btn');
    const closeButton = document.getElementById('close-preview-btn');

    if (zoomInButton) zoomInButton.addEventListener('click', zoomIn);
    if (zoomOutButton) zoomOutButton.addEventListener('click', zoomOut);
    if (resetZoomButton) resetZoomButton.addEventListener('click', resetZoom);

    const newCloseButton = document.getElementById('close-preview-btn');
    if (newCloseButton) newCloseButton.addEventListener('click', closeImagePreview);
    
    const modal = document.getElementById('image-preview-modal');
    if(modal) {
        modal.addEventListener('click', function(e) {
            if (e.target.id === 'image-preview-modal') {
                closeImagePreview();
            }
        });
    }
}

let currentReportCode = '';

// Open report modal
function openReportModal(code) {
    currentReportCode = code;
    const modal = document.getElementById('report-modal');
    modal.style.display = 'flex';
    
    // Reset form and clear errors
    document.getElementById('report-form').reset();
    clearValidationErrors();
    
    // Set focus to first field
    document.getElementById('issue-type').focus();
}

// Close report modal
function closeReportModal() {
    const modal = document.getElementById('report-modal');
    modal.style.display = 'none';
    currentReportCode = '';
    clearValidationErrors();
}

// Clear validation errors
function clearValidationErrors() {
    document.querySelectorAll('.error-message').forEach(error => {
        error.style.display = 'none';
    });
    document.querySelectorAll('.form-group input, .form-group select, .form-group textarea').forEach(field => {
        field.style.borderColor = '#ddd';
    });
}

// Show validation error
function showError(fieldId, message) {
    const field = document.getElementById(fieldId);
    const errorElement = field.parentNode.querySelector('.error-message') || createErrorElement(field.parentNode);
    
    field.style.borderColor = '#dc3545';
    errorElement.textContent = message;
    errorElement.style.display = 'block';
}

// Create error element if it doesn't exist
function createErrorElement(parent) {
    const errorElement = document.createElement('div');
    errorElement.className = 'error-message';
    parent.appendChild(errorElement);
    return errorElement;
}

// Hide error
function hideError(fieldId) {
    const field = document.getElementById(fieldId);
    const errorElement = field.parentNode.querySelector('.error-message');
    if (errorElement) {
        errorElement.style.display = 'none';
        field.style.borderColor = '#ddd';
    }
}

// Enhanced validation
function validateForm(formData) {
    let isValid = true;
    
    // Validate issue type
    if (!formData.issueType) {
        showError('issue-type', 'Please select an issue type');
        isValid = false;
    } else {
        hideError('issue-type');
    }
    
    // Validate description
    if (!formData.description || formData.description.trim().length < 10) {
        showError('issue-description', 'Please provide a detailed description (at least 10 characters)');
        isValid = false;
    } else {
        hideError('issue-description');
    }
    
    // Validate proof link
    if (!formData.proofLink) {
        showError('proof-link', 'Proof link is required');
        isValid = false;
    } else if (!isValidUrl(formData.proofLink)) {
        showError('proof-link', 'Please enter a valid URL (https://example.com)');
        isValid = false;
    } else {
        hideError('proof-link');
    }
    
    return isValid;
}

// URL validation
function isValidUrl(string) {
    try {
        new URL(string);
        return true;
    } catch (_) {
        return false;
    }
}

// Handle form submission
function handleReportSubmit(event) {
    event.preventDefault();
    
    const formData = {
        code: currentReportCode,
        reporterName: document.getElementById('reporter-name').value.trim(),
        issueType: document.getElementById('issue-type').value,
        description: document.getElementById('issue-description').value.trim(),
        proofLink: document.getElementById('proof-link').value.trim(),
        timestamp: new Date().toISOString()
    };
    
    // Enhanced validation - all these should still be required
    if (!validateForm(formData)) {
        // Scroll to first error
        const firstError = document.querySelector('.error-message[style*="display: block"]');
        if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
    }
    
    // Submit the report
    submitDetailedReport(formData);
}

function validateForm(formData) {
    let isValid = true;
    
    // Validate issue type
    if (!formData.issueType) {
        showError('issue-type', 'Please select an issue type');
        isValid = false;
    } else {
        hideError('issue-type');
    }
    
    // Validate description
    if (!formData.description || formData.description.trim().length < 10) {
        showError('issue-description', 'Please provide a detailed description (at least 10 characters)');
        isValid = false;
    } else {
        hideError('issue-description');
    }
    
    // Validate proof link
    if (!formData.proofLink) {
        showError('proof-link', 'Proof link is required');
        isValid = false;
    } else if (!isValidUrl(formData.proofLink)) {
        showError('proof-link', 'Please enter a valid URL (https://example.com)');
        isValid = false;
    } else {
        hideError('proof-link');
    }
    
    return isValid;
}

// Rest of your existing functions remain the same...
function updateButtonToReported(code) {
    const buttons = document.querySelectorAll('.report-btn-corner');
    buttons.forEach(btn => {
        if (btn.onclick && btn.onclick.toString().includes(code)) {
            btn.innerHTML = '‚úîÔ∏è';
            btn.title = 'Reported! Thank you.';
            btn.classList.add('reported');
            btn.disabled = true;
            btn.onclick = null;
        }
    });
    
    saveReportedStatus(code, true);
}

function showReportSuccess() {
    const modal = document.getElementById('report-success-modal');
    if (modal) {
        modal.classList.add('show');
        setTimeout(() => { modal.classList.remove('show'); }, 3000);
    }
}

// Code submission modal functions
function openCodeSubmitModal() {
    document.getElementById('submit-message').style.display = 'none';
    document.getElementById('submit-description').value = '';
    document.getElementById('submit-code').value = '';
    document.getElementById('submit-username').value = '';
    document.getElementById('submit-modal-overlay').style.display = 'flex';
}

function closeCodeSubmitModal() {
    document.getElementById('submit-modal-overlay').style.display = 'none';
}

function submitCode() {
    const description = document.getElementById('submit-description').value.trim();
    const code = document.getElementById('submit-code').value.trim();
    const purpose = document.getElementById('submit-purpose').value;
    const platform = document.getElementById('submit-platform').value;
    const username = document.getElementById('submit-username').value.trim();
    const messageDiv = document.getElementById('submit-message');

    // Validate all five fields are filled
    if (!description || !code || !purpose || !platform || !username) {
        messageDiv.textContent = 'Please fill out all required fields.';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        return;
    }

    // Validate SHiFT code format (basic validation)
    const shiftCodePattern = /^[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}$/i;
    const standardizedCode = code.toUpperCase();
    
    if (!shiftCodePattern.test(standardizedCode)) {
        messageDiv.textContent = 'Please enter a valid SHiFT code format: XXXXX-XXXXX-XXXXX-XXXXX-XXXXX';
        messageDiv.className = 'submit-error';
        messageDiv.style.display = 'block';
        return;
    }

    // Check for duplicates (only for public codes)
    if (purpose === 'public_use') {
        const allCodes = [...ALL_CODES_CONFIG, ...PERMANENT_CODES];
        const isDuplicate = allCodes.some(c => c.code.toUpperCase() === standardizedCode);

        if (isDuplicate) {
            messageDiv.textContent = 'This code is already on the list! Thanks for checking.';
            messageDiv.className = 'submit-error';
            messageDiv.style.display = 'block';
            return;
        }
    }

    const webhookUrl = "https://discord.com/api/webhooks/1427252615942770783/ODC4nIRGAlupTRTwtlYXGDUyeZlvUz5cnr-6ATlf6KDeCP5hJo_MSf3x9DyNUrMdY56P"; 

    // Purpose mapping for display
    const purposeMap = {
        'public_use': 'Public Use (Post on site, Multiple Redeems)',
        'smash_only': 'Smash (One time use)'
    };

    // Platform mapping for display
    const platformMap = {
        'multi_platform': 'Multi Platform',
        'xbox_only': 'Xbox',
        'playstation_only': 'PlayStation',
        'steam_only': 'Steam'
    };

    const embed = {
        title: "üì¨ New SHiFT Code Submission!",
        color: 5814783,
        fields: [
            {
                name: "Description",
                value: description
            },
            {
                name: "Submitted Code",
                value: `\`\`\`${standardizedCode}\`\`\``
            },
            {
                name: "Code Purpose",
                value: purposeMap[purpose] || purpose
            },
            {
                name: "Platform",
                value: platformMap[platform] || platform
            },
            {
                name: "Submitted Username",
                value: username
            }
        ],
        timestamp: new Date().toISOString()
    };

    fetch(webhookUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ embeds: [embed] })
    });

    messageDiv.textContent = 'Success! Code has been submitted for review. Thank you!';
    messageDiv.className = 'submit-success';
    messageDiv.style.display = 'block';

    setTimeout(closeCodeSubmitModal, 3000);
}

function openCodeSubmitModal() {
    // Clear any old messages and input values
    document.getElementById('submit-message').style.display = 'none';
    document.getElementById('submit-description').value = '';
    document.getElementById('submit-code').value = '';
    document.getElementById('submit-purpose').value = '';
    document.getElementById('submit-platform').value = '';
    document.getElementById('submit-username').value = '';
    
    // Show the modal
    document.getElementById('submit-modal-overlay').style.display = 'flex';
}

// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', async () => {
    console.log('üöÄ Starting initialization...');
    
    
    // Initialize page if version check passes
    if (!checkCodesVersion()) {
        initializePage();
    }
    
    setupEventListeners();
});

// ADD THESE THREE NEW FUNCTIONS to your main script tag     



function extractKeyFromPage() {
    // This depends on your page structure - adjust accordingly
    // Example: look for elements containing the key pattern
    const keyPattern = /[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}/;
    
    // Try different selectors where your key might be displayed
    const possibleElements = [
        document.body.textContent.match(keyPattern),
        document.querySelector('code')?.textContent,
        document.querySelector('pre')?.textContent
    ];
    
    for (let element of possibleElements) {
        if (element && keyPattern.test(element)) {
            const match = element.match(keyPattern);
            return match ? match[0] : null;
        }
    }
    
    return null;
}

async function submitDetailedReport(formData) {
    const submitBtn = document.querySelector('#report-form .btn-submit');
    const originalText = submitBtn.textContent;
    
    try {
        submitBtn.textContent = 'Submitting...';
        submitBtn.disabled = true;
        
        const discordWebhookUrl = "https://discord.com/api/webhooks/1427115711641161779/jciH7ebl1wFx4otjHnp69jT87dTPdK1kQH4B9QBXAghnEVXBqPPCa16_4w758GIzNjBc";

        const embed = {
            title: "üìã Detailed SHiFT Code Report",
            color: 0xff4444,
            fields: [
                {
                    name: "Reported Code",
                    value: `\`\`\`${formData.code}\`\`\``,
                    inline: false
                },
                {
                    name: "Issue Type",
                    value: formData.issueType || "Not specified",
                    inline: true
                },
                {
                    name: "Reporter",
                    value: formData.reporterName || "Anonymous",
                    inline: true
                },
                {
                    name: "Description",
                    value: formData.description || "No description provided",
                    inline: false
                },
                {
                    name: "Proof Link",
                    value: formData.proofLink || "No proof provided",
                    inline: false
                },
                {
                    name: "Timestamp",
                    value: new Date(formData.timestamp).toLocaleString() || new Date().toLocaleString(),
                    inline: true
                }
            ],
            timestamp: new Date().toISOString(),
            footer: {
                text: "SHiFT Code Tracker - Detailed Report"
            }
        };

        const response = await fetch(discordWebhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ embeds: [embed] })
        });

        if (response.ok) {
            console.log('‚úÖ Detailed report submitted to Discord:', formData);
            
            // Update UI
            updateButtonToReported(formData.code);
            
            // Close modal and show success
            closeReportModal();
            showReportSuccess();
            
        } else {
            throw new Error('Failed to submit to Discord');
        }
    } catch (error) {
        console.error('‚ùå Failed to submit detailed report:', error);
        alert('Failed to submit report. Please try again.');
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
}

// Add these functions to your main script tag
function openKofiModal() {
    const container = document.getElementById('kofi-iframe-container');
    // Add the iframe content ONLY when the modal is opened
    container.innerHTML = `<iframe id='kofiframe' src='https://ko-fi.com/xsmashx88x/?hidefeed=true&widget=true&embed=true&preview=true' style='border:none;width:100%;padding:4px;background:#f9f9f9;' height='712' title='xsmashx88x'></iframe>`;
    
    const modal = document.getElementById('kofi-modal-overlay');
    modal.style.display = 'flex';
}

function closeKofiModal() {
    const modal = document.getElementById('kofi-modal-overlay');
    modal.style.display = 'none';
    
    // Remove the iframe content to stop any potential background activity
    const container = document.getElementById('kofi-iframe-container');
    container.innerHTML = '';
}

// NEW, DEDICATED function to clear Black Market statuses
function clearBlackMarketStatusOnReset() {
    try {
        console.log("A weekly reset has been detected. Clearing Black Market redemption statuses...");
        const redeemedCodes = JSON.parse(localStorage.getItem('shiftRedeemedCodes')) || {};

        // Loop through the vendor config and remove each corresponding key
        BLACK_MARKET_VENDORS.forEach((vendorData, index) => {
            const uniqueId = vendorData.code.replace(/\s+/g, '-') + '-' + index;
            if (redeemedCodes.hasOwnProperty(uniqueId)) {
                delete redeemedCodes[uniqueId];
                console.log(`Removed status for: ${uniqueId}`);
            }
        });

        // Save the cleaned object back to localStorage
        localStorage.setItem('shiftRedeemedCodes', JSON.stringify(redeemedCodes));
    } catch (e) {
        console.error("Error during Black Market status cleanup:", e);
    }
}        

// Function to toggle the main container
function toggleOptionsContainer(titleElement) {
    const container = titleElement.closest('.site-options-container');
    if (container) {
        container.classList.toggle('is-open');
    }
}

// Function to manage the content panels, ensuring only one is open at a time
function toggleOptionPanel(sectionIdToShow) {
    const panelIds = ['settings-section', 'info-section', 'changelog-section', 'redeem-section'];
    const targetPanel = document.getElementById(sectionIdToShow);
    if (!targetPanel) return;
    const isAlreadyOpen = targetPanel.classList.contains('show');
    panelIds.forEach(id => {
        const panel = document.getElementById(id);
        if (panel) {
            panel.classList.remove('show');
            saveSectionState(id, false);
        }
    });
    if (!isAlreadyOpen) {
        targetPanel.classList.add('show');
        saveSectionState(sectionIdToShow, true);
    }
}

        // === START: NEW FUNCTION TO CLEAR HIGHLIGHT ===

function clearLastCopied() {
    try {
        // Remove the ID from browser memory
        localStorage.removeItem('lastCopiedCodeId');
        
        // Find whichever element currently has the highlight and remove the class
        const highlightedBox = document.querySelector('.last-copied');
        if (highlightedBox) {
            highlightedBox.classList.remove('last-copied');
        }
    } catch (e) {
        console.error("Error clearing last copied state:", e);
    }
}

// === END: NEW FUNCTION ===

// === START: NEW FUNCTIONS FOR LAST COPIED ===

function setLastCopied(codeId) {
    try {
        localStorage.setItem('lastCopiedCodeId', codeId);
        // First, remove the highlight from any element that might have it
        document.querySelectorAll('.last-copied').forEach(el => el.classList.remove('last-copied'));
        // Then, find the specific element we just copied and add the highlight
        const newLastCopiedBox = document.querySelector(`[data-code-id="${codeId}"]`);
        if (newLastCopiedBox) {
            newLastCopiedBox.classList.add('last-copied');
        }
    } catch (e) { console.error("Error in setLastCopied:", e); }
}

function applyLastCopiedState() {
    try {
        const lastCopiedId = localStorage.getItem('lastCopiedCodeId');
        if (lastCopiedId) {
            // This runs on page load to find and highlight the saved item
            const element = document.querySelector(`[data-code-id="${lastCopiedId}"]`);
            if (element) {
                element.classList.add('last-copied');
            }
        }
    } catch (e) { console.error("Error applying last copied state:", e); }
}

// === END: NEW FUNCTIONS ===        

// ADD THESE TWO NEW FUNCTIONS

// === START: NEW FUNCTIONS FOR SAVING STATE ===

/**
 * Saves the open/closed state of a specific section to localStorage.
 * @param {string} sectionId - The ID of the section (e.g., 'info-section').
 * @param {boolean} isOpen - True if the section is open, false if closed.
 */
function saveSectionState(sectionId, isOpen) {
    try {
        const sectionStates = JSON.parse(localStorage.getItem('sectionStates')) || {};
        sectionStates[sectionId] = isOpen;
        localStorage.setItem('sectionStates', JSON.stringify(sectionStates));
    } catch (e) {
        console.error("Error saving section state:", e);
    }
}

/**
 * Reads the saved states from localStorage and applies them when the page loads.
 */
function applySavedSectionStates() {
    try {
        const savedStates = JSON.parse(localStorage.getItem('sectionStates')) || {};
        for (const sectionId in savedStates) {
            const section = document.getElementById(sectionId);
            const isOpen = savedStates[sectionId];
            if (section && isOpen) {
                section.classList.add('show');
            }
        }
    } catch (e) {
        console.error("Error applying saved section states:", e);
    }
}
// === END: NEW FUNCTIONS ===     


// === START: POLL MODAL SCRIPT ===
document.addEventListener('DOMContentLoaded', () => {
    const pollModal = document.getElementById('pollModal');
    const openPollBtn = document.getElementById('openPollBtn');
    const closePollBtn = document.getElementById('closePollBtn');

    // Function to open the modal
    const openPoll = () => {
        if (pollModal) pollModal.style.display = 'flex';
    };

    // Function to close the modal
    const closePoll = () => {
        if (pollModal) pollModal.style.display = 'none';
    };

    // Event Listeners
    if (openPollBtn) openPollBtn.addEventListener('click', openPoll);
    if (closePollBtn) closePollBtn.addEventListener('click', closePoll);

    // Also close if the user clicks on the dark overlay
    if (pollModal) {
        pollModal.addEventListener('click', (event) => {
            if (event.target === pollModal) {
                closePoll();
            }
        });
    }

    // ==========================================================
    // === PASTE THE NEW CLICK LISTENER CODE BLOCK RIGHT HERE ===
    // ==========================================================
    document.addEventListener('click', function(event) {
        // Check if the thing that was clicked is INSIDE a code box of any type.
        const isInsideCodeBox = event.target.closest('.code-box, .permanent-code-box, .expired-code-box, .black-market-code-box');

        // If the click was NOT inside a code box, clear the highlight.
        if (!isInsideCodeBox) {
            clearLastCopied();
        }
    });
    // ==========================================================

}); // <-- This is the final closing bracket for DOMContentLoaded

// === END: POLL MODAL SCRIPT ===

/* mobile image zoom fix maybe */
// ADD THIS code block at the top of your <script> tag

// --- START: Image Preview Zoom ---
function zoomIn() {
    if (panzoomInstance) {
        panzoomInstance.zoomIn();
    }
}
// --- END: Image Preview Zoom ---

// --- SCRIPT FOR FLOATING SHARE BUTTON (CORRECTED) ---
// START: FINAL SHARE BUTTON JAVASCRIPT - DELETE ALL PREVIOUS VERSIONS
document.addEventListener('DOMContentLoaded', function() {
    const shareButton = document.getElementById('final-share-button');
    const shareMenu = document.getElementById('final-share-menu');

    if (shareButton && shareMenu) {
        // This runs ONLY when the share button is clicked
        shareButton.addEventListener('click', function(event) {
            event.stopPropagation(); // Stops the click from closing the menu instantly
            shareMenu.classList.toggle('active'); // Shows or hides the menu
        });

        // This runs when you click anywhere else on the page
        document.addEventListener('click', function() {
            if (shareMenu.classList.contains('active')) {
                shareMenu.classList.remove('active');
            }
        });
    }
});
// END: FINAL SHARE BUTTON JAVASCRIPT

// --- ADD THIS FUNCTION for the new floating panel refresh and thanks ---

        function toggleThankYouPanel(linkElement) {
            const panel = linkElement.closest('.floating-info-panel');
            if (panel) {
                panel.classList.toggle('is-open');
            }
        }

// ==================== 12-HOUR FORMAT HELPER ====================
// This function correctly handles 12-hour AM/PM and 1-indexed months (1=Jan, 12=Dec).
        function createDate(year, month, day, hour, minute, second, isPM) {
            let hour24 = hour;
            if (isPM && hour < 12) {
                hour24 = hour + 12;
            } else if (!isPM && hour === 12) {
                hour24 = 0;
            }
            return new Date(year, month - 1, day, hour24, minute, second);
        }

//** Hide Redeem shift button **///
        function toggleRewardsLink(isChecked) {
          const rewardsDiv = document.getElementById('rewards-container');
          if (isChecked) {
            rewardsDiv.style.display = 'none';
          } else {
            rewardsDiv.style.display = 'block';
          }
        }


// ==================== CONFIGURATION ====================
/* Active codes ||||||||||||||||||||||||||||||||||||||||||||||||||||||| */
const ALL_CODES_CONFIG = [
        {
        code: "T9RJB-BFKRR-3RBTW-B33TB-KCZB9",
        description: 'All Platforms<br>Perm Key, Good For A Long Time',
        title: '1 Gold Key',
        showReportButton: false,
        showCopyButton: true,
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/skulliconkey.png"
    },
                    {
        code: "WZK3B-SHTHF-JZ59K-SBT3B-TWHXT",
        description: 'All Platforms<br>PAX AU 2K Code : link your 2K account to redeem <br> User Sent This In (Cant give credit.. no name was given) <br> not sure if its a perm or not will remove if it expires <br> <i> its from a email i hear, sadly i didnt get this one hmm </i> ',
        dateAdded: "2025-10-13",
        title: '1 Gold Key',
        showReportButton: true,
        showReportButton: false,
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/skulliconkey.png"
    },
                {
        code: "No Code",
        expires: createDate(2025, 11, 14, 11, 59, 0, 1), // 
        description: 'Geforce Experince App<br> One Time Use <br><br>Head to the GeForce Experience App\Nvidia App <br> Click on the Redeem tab <br> You will find the Borderlands 4 promotion there. <br> Hover over it, and a Redeem button will appear. <br> Click on it and it will take you to the page with the SHiFT code.',
        title: '1 Gold Key',
        showReportButton: true,
        showCopyButton: false,
        showPreviewButton: true,
        imagePreview: "https://i.postimg.cc/25gNxrpN/screenshot-35.png",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/skulliconkey.png"
    },
            {
        code: "J9FB3-9XTW3-56JJK-TBBTJ-TF9X3",
        expires: createDate(2025, 10, 14, 0, 23, 0, 0), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1977228544901366119" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-12",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: false,
        showCopyButton: true
    },
        {
        code: "BZX3B-6RTWB-5FTBW-TBT3B-3XZCT",
        expires: createDate(2025, 10, 14, 0, 23, 0, 0), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1977228544901366119" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-12",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: false,
        showCopyButton: true
    },
        {
        code: "BHXBB-W6BCB-WXJ3W-B3BTT-FTW3Z",
        expires: createDate(2025, 10, 14, 0, 23, 0, 0), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1977228544901366119" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-12",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: false,
        showCopyButton: true
    },
            {
        code: "TZ6TT-FKBKB-W6T35-BTTB3-636SR",
        expires: createDate(2025, 10, 11, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1976415477862895671" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-9",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
            {
        code: "JH63B-S5TK3-KFJJC-BBB3T-5KR63",
        expires: createDate(2025, 10, 11, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1976415477862895671" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-9",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
            {
        code: "T963J-TRBKB-56JBW-3BJBJ-ZZ3JR",
        expires: createDate(2025, 10, 11, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1976415477862895671" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-9",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
            {
        code: "T9XTB-93BC3-56T35-TBBJT-KF5TW",
        expires: createDate(2025, 10, 5, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1974287733985325112" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-3",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "TZRBJ-3KTWT-KX3BC-TT3TB-B9ZSK",
    expires: createDate(2025, 10, 5, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1974287733985325112" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-3",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
        {
        code: "3HR33-KWBKT-KRJ3W-JBBTJ-FSTC3",
        expires: createDate(2025, 10, 5, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1974287733985325112" target="_blank">Via Twit</a>',
        dateAdded: "2025-10-3",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
                {
        code: "TZFT3-K9Z33-5FT3W-BJ33T-WZ5X5",
        expires: "UED", // 
        description: 'üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200166888104169" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showReportButton: true,
        showCopyButton: true
    },
            {
        code: "J9RT3-RBJ5T-WRTBK-JB3J3-5TB3R",
        expires: createDate(2025, 10, 3, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200166888104169" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
            {
        code: "TH6BJ-WJTC3-W6B3C-3TTBT-5HTTH",
        expires: createDate(2025, 10, 3, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200166888104169" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
            {
        code: "3HXTT-JBJCT-CR33W-JJTJJ-BCR5W",
        expires: createDate(2025, 10, 2, 9, 35, 0, 1), // 
                dateAdded: "2025-09-30",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200166888104169" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
           {
        code: "BH6TJ-Z993B-5RJBK-JT3B3-RXT3Z",
        expires: createDate(2025, 10, 3, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200020347428912" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "3S6TT-RSHJ3-WFJ3K-BBJB3-W5ZKS",
        expires: createDate(2025, 10, 3, 9, 35, 0, 1), // 
        description: '<b> Expired Now </b> <br> <s>üö®key should be expired <br> ‚ö†Ô∏è Some Reported as Expired <br> ‚úÖ Verified Working by Admin <br> ‚ùóTho SMASH Will Update This Soon <br> (He checks often, As it may now show expired when at testing time it didnt, this wont be up long if it truly shows expired on shift)</s>',
        dateAdded: "2025-10-1",
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1973200020347428912" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "JH6BB-6RST3-5FB35-JT3BB-R3WCB",
        expires: createDate(2025, 9, 29, 4, 45, 0, 1), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1972042073701528063" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-27",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "JZRTJ-SR9BB-W6T35-BJBTT-36FZR",
        expires: createDate(2025, 9, 29, 4, 45, 0, 1), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1972042073701528063" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-27",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
        {
        code: "BSFTB-TZ9BB-KRJBK-TTJB3-6S3KS",
        expires: createDate(2025, 9, 29, 4, 45, 0, 1), // 
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1972042073701528063" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-27",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
    {
        code: "BHRBJ-ZWHT3-W6JBK-BT3BB-CW3ZK",
        expires: createDate(2025, 9, 26, 4, 19, 0, 1), // 4:19 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1970946292131188745" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-24",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
    {
        code: "JSX3J-B6SBJ-CXTBC-B3T3B-BZZZT",
        expires: createDate(2025, 9, 26, 4, 19, 0, 1), // 4:19 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1970946292131188745" target="_blank">Via Twit</a>',
        dateAdded: "2025-09-24",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "BHFJ3-WXHBB-W63JK-B33B3-5HX95",
        expires: createDate(2025, 9, 26, 4, 19, 0, 1), // 4:19 PM
        title: '1 Gold Key- <a href="https://x.com/DuvalMagic/status/1970946292131188745" target="_blank">Via Twit</a> | 9/24/2025',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "J9XBB-KK9T3-CRTBW-BBT3T-KTBTW",
        expires: createDate(2025, 9, 24, 12, 28, 0, 1), // 12:28 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1970163226441547832" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif",
        showCopyButton: true
    },
    {
        code: "JHFTJ-R5HBT-KF3TK-TBJT3-JJTHH",
        expires: createDate(2025, 9, 24, 12, 28, 0, 1), // 12:28 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1970163226441547832" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "THRBT-WW6CB-56TB5-3B3BJ-XBW3X",
        expires: createDate(2025, 9, 30, 0, 0, 0, 1), // Fixed: September 30, 2025 (month is 0-indexed)
        title: '1 Gold Key',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "3H63J-Z3S3J-KR3BK-BTJ33-ZWKTK",
        expires: createDate(2025, 9, 22, 12, 36, 0, 1), // 12:36 PM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1969440522528792653" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "TSR3B-J5S3T-KRBJW-BTTBJ-JRCXX",
        expires: createDate(2025, 9, 22, 12, 36, 0, 1), // 12:36 PM
        title: '1 : Gold Key - <a href="https://x.com/DuvalMagic/status/1969440522528792653" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "3ZXJB-53STT-56T3W-B3TT3-HTS95",
        expires: createDate(2025, 9, 21, 11, 58, 1, 1), // 11:58 AM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1969068501215170641" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "BSRT3-FTZBJ-K6BTW-JB3T3-WXT99",
        expires: createDate(2025, 9, 21, 11, 58, 1, 1), // 11:58 AM
        title: '1 Gold Key - <a href="https://x.com/DuvalMagic/status/1969068501215170641" target="_blank">Via Twit</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "B9XT3-HX6TT-W6BBW-TTJT3-JTFKX",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM (no isPM specified, defaults to AM)
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },              
    {
        code: "39RTT-3ZR3T-5FJBK-3J3J3-C5CRT",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },          
    {
        code: "WHWJB-XH3SX-39CZW-H3BBB-BTF55",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },          
    {
        code: "3SR3J-CS63T-CFB3K-J3JTT-RZ5JR",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "3SRBB-X9RBJ-CRTBW-3BBB3-KJFW6",
        expires: createDate(2025, 9, 10, 12, 0, 0, 0), // September 10, 2025, 12:00 PM
        title: "1 Gold Key",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    },
    {
        code: "WEWJB-XH3SX-39CZW-H3BBB-BPF55",
        expires: createDate(2025, 9, 20, 12, 0, 0, 0), // September 20, 2025, 12:00 PM
        title: '1 Gold Key - Requires linked My2K Games account - <a href="https://shift.gearboxsoftware.com/associations" target="_blank">Associate Account</a>',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/skullkey.gif"
    }       
];

const PERMANENT_CODES = [
    {
        code: "BZ6JJ-CB6CT-WXJJW-3TT3B-56FZ5",
        title: 'Vex | Mass Market Appeal | Vault Hunter Skin',
        description: 'Community Challenge : run the Rippers out of 1.8M Ripper Drill Sites as Vex from Oct. 10-13<br><a href="https://x.com/Borderlands/status/1978151314447339664" target="_blank">Link To Tweet</a> ',
        dateAdded: "10/14/2025",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: true,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/death4all-vex-chal.jpeg",
        expires: createDate(2030, 12, 31, 0, 0, 0, 0) // 
    },
                {
        code: "JZ6BJ-SBR5J-WF3BK-BT3BB-TX9HB",
        title: 'Amon Cult Classic | Vault Hunter Skin',
        description: 'Community Challenge : Defeat 300,000 Vault Bosses from Oct 3-5 as Amon<br><a href="https://x.com/Borderlands/status/1974172598222352649" target="_blank">Link To Tweet</a> ',
        dateAdded: "10/6/2025",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: true,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/weeklyeventchal/oct3oct5chal.png",
        expires: createDate(2030, 12, 31, 0, 0, 0, 0) // 
    },
                {
        code: "TZXT3-XJXCB-CXBJW-BTTJT-9SK6B",
        title: 'Rafas Savings Savior | Vault Hunter Skin',
        description: 'Community Challenge : Get 20 million Second Winds from Sep. 26-28 as Rafa<br><a href="https://x.com/Borderlands/status/1971651935104098527" target="_blank">Link To Tweet</a> ',
        dateAdded: "9/27/2025",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: true,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/G1y2OQYXEAAqQVZ.jpeg",
        expires: createDate(2030, 12, 31, 0, 0, 0, 0) // September 29, 2025, midnight AM (explicitly set to avoid default issues)
    },
            {
        code: "JS63J-JSCWJ-CFTBW-3TJ3J-WJS5R",
        title: 'Break Free cosmetics pack and Legendary Ripper shield <br><br>‚Ä¢ [Break Free] Vault Hunter Skin (for Vex, Rafa, Amon, and Harlowe)<br>‚Ä¢ [Firebreak] Legendary Ripper Shield (with minimum level of 25)<br>‚Ä¢ [Break Free] ECHO-4 Drone Skin<br>‚Ä¢ [Kn0x] ECHO-4 Drone Skin',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: true,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/breakfree.png",
        expires: createDate(2031, 1, 1, 2, 45, 0, 1) // Fixed: December 31, 2030, midnight AM
    },
            {
        code: "No Code",
        title: 'Discord  |  Borderlands Bundles + Single Items',
        description:'Click On Shop, Look for the Borderlands 4 Image or Scroll down and will find it. <br>Items Range from $10.99CAD to $5.99CAD Being The Lowest<br><br>NO ETA ON WHEN IT GOES AWAY, COULD BE A WEEK OR MONTH OR MONTHS FROM NOW<br><br> [Click the preview button to see video of the effects]',        
        dateAdded: "9/26/2025",
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/discordiconorange.png",
        showCopyButton: false,
        showReportButton: true,
        showPreviewButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/smaller%20%20cbr%20%20%20%202025-09-26%2012-09-25_1.mp4",
    },
        {
        code: "No Code",
        title: 'Twitch Drops : Watch, Drop, and Roll ECHO-4 Drone Skin cosmetic',
        description:'<a href="https://borderlands.2k.com/twitch-drops/" target="_blank">Read About It Here Or Via Info Below</a><br><br>Sep  27, 2025 - Oct 25, 2025<br><br>‚Ä¢ Watch any livestream in the Borderlands 4 category on the official <a href="http://twitch.tv/Borderlands" target="_blank">Borderlands 4 Twitch channel</a> or <a href="https://www.twitch.tv/gearboxofficial" target="_blank">Gearbox Twitch channel</a> for 15 minutes and claim the reward',        
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/twitchorange.png",
        showCopyButton: false,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/BL4_Echobot_Drop_Wide_textless.png",
        expires: createDate(2025, 10, 25, 2, 59, 0, 1) // 
    },
    {
        code: "No Code",
        title: 'Twitch Drops 2 : Forsaken Chaos Legendary shotgun',
        description:'<a href="https://borderlands.2k.com/twitch-drops/" target="_blank">Read About It Here Or Via Info Below</a><br><br>September 11, 2025 - September 30, 2025<br><br>‚Ä¢ Watch any Borderlands 4 Twitch livestream in the <a href="https://www.twitch.tv/directory/category/borderlands-4" target="_blank">Borderlands 4 category</a> for 2 hours and claim the reward',        
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/twitchorange.png",
        showCopyButton: false,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/BL4_ForsakenChaos.png",
        expires: createDate(2025, 9, 30, 0, 0, 0, 0) // September 30, 2025, midnight AM
    },
    {
        code: "No Code",
        title: 'Twitch Drops 3 : Midnight Defiance Legendary sniper rifle',
        description:'<a href="https://borderlands.2k.com/twitch-drops/" target="_blank">Read About It Here Or Via Info Below</a><br><br>September 11, 2025 - September 30, 2025<br><br>‚Ä¢ Watch any Borderlands 4 Twitch livestream in the <a href="https://www.twitch.tv/directory/category/borderlands-4" target="_blank">Borderlands 4 category</a> hosted by a <a href="https://borderlands.2k.com/borderlands-4/partnered-creators/" target="_blank">partnered creator</a> for 2 hours and claim the reward',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/twitchorange.png",
        showCopyButton: false,
        showPreviewButton: true,
        showReportButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/BL4_MidnightDefiance.png",
        expires: createDate(2025, 9, 30, 0, 0, 0, 0) // September 30, 2025, midnight AM
    },
    {
        code: "NO CODE - SIGNED UP AN IS SENT",
        title: 'Butterfinger ECHO-4 Drone Skin',
        description:'This shift code is can be acquired in two ways<br>Enter the  <a href="https://www.gamewithbutterfinger.com/home?path=Echo4" target="_blank">Butterfinger x Borderlands 4 online sweepstakes. </a> Note that theres no guarantee this will be available after September 2025. (US Only) <br> By purchasing the <a href="https://www.gamestop.com/collectibles/collectors-boxes/products/borderlands-4-echo-4-bundle-gamestop-exclusive/426330.html" target="_blank">GameStop Madrinas Coffee Collectors Box (US Only).</a> <br><i>USE A VPN, then search and use a fake usa number/address gen, if live outside the usa, Its what I did and I  got emailed the key :)</i>" ',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/bl4icon%20(GitHub%20icon).png",
        showCopyButton: false,
        showPreviewButton: true,
        imagePreview: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bl4promoimages/butter%20fingers%20skin.png",
        expires: createDate(2025, 9, 22, 0, 0, 0, 0) // September 22, 2025, midnight AM
    }
];


// ==================== BLACK MARKET VENDOR SYSTEM ====================
const BLACK_MARKET_VENDORS = [
    {
        code: "Black Market Vendor",
        title: 'Maurices Black Market - Refreshes every Thursday at 12:00 PM EDT',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/MauricesBlackMarket.png",
        description:'<b>Static Image Button</b> : <i>Is where he is</i><br>The Groaning Core POI in Carcadia District<br><b>View Location (MAP)</b> : <i>It Shows few Spots He Can Be <br> <br> If Static Button Is Missing, Means Update Is Happening</i>',
        showCopyButton: false,
        showPreviewButton: true,
        mapGenieLocation: "https://mapgenie.io/borderlands-4/maps/kairos?embed=light&catIds=13472",
        staticImageLocation: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/bmvendorlocation/bmvendor-TheGroaningCorePOI-in-CarcadiaDistrict.png",
        staticImageCredit: 'Static Image Can Be From : <a href="https://mentalmars.com/borderlands-4/loot/black-market/" target="_blank">MentalMars (Check Them Out)</a>',
        type: 'weekly-vendor'
    },
    {
        code: "Weekly WildCard Mission",
        title: 'Null And Void : Weekly Wild Card - Refreshes every Thursday at 12:00 PM EDT',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/weeklymission.png",
        description:'<b>Drop</b> : <i>Phantom Flame (Jakobs Pistol)</i><br><br><b>Where To Go?</b> : <i>Start the mission via the conrner of the map via the button there, It will reload the map and can track an get to the mission.<br><br>PS : If any of the 3 buttons are missing, means still updating</i>', // <--- COMMA ADDED HERE
        showCopyButton: false,
        showPreviewButton: true,
        loot: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyweapons/Phantom%20Flame-Pistol.png",
        infoUrl: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyact/NullandVoidinfocard.png",
        staticImageLocation: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyact/NullandVoidmaplocation.png",
        staticImageCredit: 'Image Credit : Me,Others',
        type: 'weekly-vendor'
    },
    {
        code: "Weekly Big Encore Boss",
        title: 'Directive-0 : Big Encore Boss - Refreshes every Thursday at 12:00 PM EDT',
        icon: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/bm-images/BigEncoreBoss.png",
                customButtons: {
            "üí∞View All Loot (Gif)": "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyweapons/oct9-16th-encore-directive0-loot.gif",
            "üí∞Bonnie And Clyde": "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyweapons/Bonnie%20And%20Clyde.png", // Replace with actual URL
            "üí∞Rowan's Charge": "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyweapons/Rowans%20Charge.png",   // Replace with actual URL
            "üí∞Whiskey Foxtrot": "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyweapons/Whiskey%20Foxtrot.png" // Replace with actual URL
        },
        description:'<b>Drops</b> : <i>Bonnie And Clyde (AR), Rowans Charge (AR), Whiskyey Foxtrot (AR)</i> <br><br> <b>Location : </b><i>Ironwall Resolve Bunker (Terminus District Dominion)<br><br>PS : No Info For Drops/Location Its Being Updated</i>', // <--- COMMA ADDED HERE
        showCopyButton: false,
        showPreviewButton: true,
        staticImageLocation: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/bm-images/weeklyact/Directive-0---encore-location.png",
        staticImageCredit: '<b>TIP :</b> <i>If you dont see the skull with hat icon, just means you have not done anything around there... use image button an go to around that area :)</i> <br> <b>Image Credit : </b><i>Me,Others</i>',
        type: 'weekly-vendor'
    }
    // You can add more vendor objects here, separated by commas
];

const POLL_CONFIG = {
    isEnabled: false // Set to true (1) to show the poll button, false (0) to hide it
};

const ROADMAP_CONFIG = {
    imageUrl: "https://i.postimg.cc/PqwXK6rS/screenshot-35.png", // <--- CHANGE THIS TO YOUR ACTUAL ROADMAP IMAGE URL
};

// REPLACE your old EVENTS_CONFIG object with this one

const EVENTS_CONFIG = {
    isEnabled: false, // This makes the button visible
    buttonText: "üéâ IT'S VEXIN' TIME üìÖ<br><small>CURRENT EVENT CHALLENGE | OCT 10 - OCT 13</small>",
    imageUrl: "https://i.postimg.cc/hGCNCNB4/screenshot-35.png", // <-- I have found and added the correct image URL for you
    descriptionText: `
        <b>Vexin' Time Challenge:</b>
        <ul>
            <li>If you can run the Rippers out of 1.8M Ripper Drill Sites as Vex from Oct. 10-13</li>
            <li>Community Gets | Mass Market Appeal outfit</li>
            <li>xxxx-shift-code-coming-soon-xxxx | Will be posted under drops after this event buttons goes away</li>
        <li><a href="https://x.com/Borderlands/status/1976730923518587193" target="_blank">Link To Tweet</a></li>
        </ul>
    `
};

// --- ADD THIS NEW CONFIGURATION OBJECT ---
const COMMUNITY_CHALLENGE_CONFIG = {
    isEnabled: true, // Set to true to show the button, false to hide it
    buttonText: "üèÜ Horrors of Kairos üèÜ<br><small>Seasonal Mini-Event | Oct 23 - Nov 6</small>",
    imageUrl: "https://i.postimg.cc/0QdYjZvh/screenshot-35.png", // The image inside the dropdown
    descriptionText: `
        <b>Key Takeaways:</b>
        <ul>
            <li>The Horrors of Kairos Seasonal Mini-Event takes place from October 23 to November 6, 2025</li>
            <li>Blood rains down during World Boss Encounters (Rifts)</li>
            <li>World Boss Reward Chests can contain new Legendaries</li>
        </ul>
        <br>
        <b>Horrors of Kairos Loot:</b>
        <ul>
            <li>Murmur <i>Tediore Assault Rifle</i> | Executes weakened enemies with guaranteed crits on targets under 35% health.</li>
            <li>Skully <i>Order Grenade</i> | This death-dealing grenade fires out projectiles as it seeks out the nearest target.</li>
            <li>Gourd Your Loins <i>Pumpkin Head</i> | xxxx-shift-code-coming-soon-xxxx</li>
            <li>Hex Appeal <i>Weapon Skin</i> | xxxx-shift-code-coming-soon-xxxx</li>
        </ul>
    `
};

const BLACK_MARKET_EXTRA_CONFIG = {
    imageUrl: "https://raw.githubusercontent.com/xsmashx88x/Shift-Codes/refs/heads/gh-pages/BL4-Black-Market-Location-003-Grindstone-of-the-Worthysep25-oct2.jpg", // <--- !!! REPLACE THIS WITH THE ACTUAL IMAGE URL !!!
};

        // Helper function to format the date added
         // =======================================================
        //      FINAL: SMART & MANUAL DATE ADDED FUNCTION
        // =======================================================
        /**
         * A smart function that gets and formats the "Added On" date based on specific rules:
         * - If `dateAdded` is a valid date string, it's used.
         * - If `dateAdded` is an empty string (""), it auto-generates today's date.
         * - If the `dateAdded` property is completely missing, it does nothing.
         * @param {object} codeData - The entire code object from your config.
         * @returns {string} - The formatted date string (e.g., "Sep 27, 2025") or an empty string.
         */
function getFormattedDateAdded(codeData) {
            // Check if the dateAdded property exists and has a value.
            if (codeData.hasOwnProperty('dateAdded') && codeData.dateAdded.trim() !== '') {
                // If it exists, return the text exactly as you wrote it.
                return codeData.dateAdded;
            }
            
            // If the property is missing or the string is empty, return nothing.
            return '';
        }


// Helper for Black Market Vendor's weekly refresh
        function getNextVendorRefresh() {
            const now = new Date();
            const nextRefresh = new Date(now);
            
            // Set target day (Thursday = 4) and time (12:00 PM)
            const targetDay = 4; // Thursday (Sunday is 0, Monday is 1, ..., Saturday is 6)
            const targetHour = 12; // 12 PM in 24-hour format
            const targetMinute = 0;
            
            // Calculate days until next Thursday
            let daysUntilTarget = (targetDay + 7 - now.getDay()) % 7;
            
            // If it's the same day, check if the time has already passed
            if (daysUntilTarget === 0) {
                if (now.getHours() > targetHour || 
                    (now.getHours() === targetHour && now.getMinutes() >= targetMinute)) {
                    daysUntilTarget = 7; // If the time has passed, schedule for the next week
                }
            }
            
            // Set the next refresh date
            nextRefresh.setDate(now.getDate() + daysUntilTarget);
            nextRefresh.setHours(targetHour, targetMinute, 0, 0);
            
            return nextRefresh;
        }

// FINAL, BACKWARD-COMPATIBLE version of the function
// FINAL, COMPLETE, AND CORRECT version of the function
function createBlackMarketVendorBox(vendorData, index) {
    const nextRefresh = getNextVendorRefresh();
    const now = new Date();
    const timeLeft = nextRefresh.getTime() - now.getTime();
    
    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
    
    const iconHtml = createIconHtml(vendorData.icon, false, 'blackmarket');
    
    const uniqueId = vendorData.code.replace(/\s+/g, '-') + '-' + index;
    const isRedeemed = getRedemptionStatus(uniqueId);
    const redeemedClass = isRedeemed ? 'redeemed' : '';

    // --- Button Logic Starts Here ---
    let dynamicButtonsHtml = '';

    // 1. Checks for the NEW customButtons object (Priority)
    if (vendorData.customButtons) {
        for (const buttonText in vendorData.customButtons) {
            const url = vendorData.customButtons[buttonText];
            dynamicButtonsHtml += `<button class="bm-small-btn bm-loot-info-btn" onclick="openImagePreview('${url}')">  ${buttonText}</button>`;
        }
    } 
    // 2. Falls back to the OLD loot property if customButtons is not found
    else if (vendorData.loot && vendorData.loot.trim() !== '') {
        dynamicButtonsHtml = `<button class="bm-small-btn bm-loot-info-btn" onclick="openImagePreview('${vendorData.loot}')">üí∞ View Loot</button>`;
    }

    // --- THIS IS THE CORRECTED PART THAT WAS MISSING ---
    // It now correctly creates the other buttons without placeholder comments.
    let infoButtonHtml = '';
    if (vendorData.infoUrl && vendorData.infoUrl.trim() !== '') {
        infoButtonHtml = `<button class="bm-small-btn bm-loot-info-btn" onclick="openImagePreview('${vendorData.infoUrl}')">üì∞ View Info</button>`;
    }
    let staticImageButtonHtml = '';
    if (vendorData.staticImageLocation) {
        staticImageButtonHtml = `<button class="bm-small-btn bm-static-image-btn" onclick="openImagePreview('${vendorData.staticImageLocation}')">üìç View Location (STATIC)</button>`;
    }
    let mapGenieButtonHtml = '';
    if (vendorData.mapGenieLocation) {
        mapGenieButtonHtml = `<button class="bm-small-btn bm-mapgenie-btn" onclick="openImagePreview('${vendorData.mapGenieLocation}')">üó∫Ô∏è View Location (MAP)</button>`;
    }
    // --- END OF THE CORRECTION ---
    
    let descriptionHtml = vendorData.description ? `<div class="code-description">${vendorData.description}</div>` : '';

    return `
        <div class="black-market-code-box ${redeemedClass}" id="black-market-vendor-${index}">
            <div class="code-header">
                ${iconHtml}
                <div class="title-container">${vendorData.title}</div>
            </div>
            
            <div class="code-text">${vendorData.code}</div>
            
            ${descriptionHtml}
            
            <div class="expire-date">Next refresh: ${formatDate(nextRefresh)}</div>
            <div class="countdown" data-refreshtime="${nextRefresh.getTime()}">Refreshes in: ${days}d ${hours}h ${minutes}m ${seconds}s</div>
            ${vendorData.staticImageCredit ? `<div class="black-market-credit">${vendorData.staticImageCredit}</div>` : ''}
            <div class="code-footer">
                <div class="black-market-buttons-group">
                    ${dynamicButtonsHtml}
                    ${infoButtonHtml}
                    ${staticImageButtonHtml}
                    ${mapGenieButtonHtml}
                </div>
                <div class="bmredeem-checkbox">
                    <input type="checkbox" id="bm-redeemed-${index}" ${isRedeemed ? 'checked' : ''} 
                        onchange="handleRedemptionChange('${uniqueId}', this, document.getElementById('black-market-vendor-${index}'))">
                    <label for="bm-redeemed-${index}">üí∞</label>
                </div>
            </div>
        </div>
    `;
}

function updateVendorTimer() {
    // Find ALL vendor boxes on the page that have a countdown element
    const vendorBoxes = document.querySelectorAll('.black-market-code-box .countdown');
    
    vendorBoxes.forEach(countdownElement => {
        const vendorBox = countdownElement.closest('.black-market-code-box');
        if (!vendorBox) return;

        const nextRefresh = getNextVendorRefresh();
        const now = new Date();
        const timeLeft = nextRefresh.getTime() - now.getTime();

        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        
        const expireDateElement = vendorBox.querySelector('.expire-date');
        
        countdownElement.textContent = `Refreshes in: ${days}d ${hours}h ${minutes}m ${seconds}s`;
        
        if (expireDateElement) {
            expireDateElement.textContent = `Next refresh: ${formatDate(nextRefresh)}`;
        }
    });
}
        // Make sure to call updateVendorTimer regularly (e.g., every second)
        setInterval(updateVendorTimer, 1000);




        // --- START: Panzoom Integration with Buttons ---
        // This variable will hold our active Panzoom instance.
        let panzoomInstance = null;

        // NEW button functions that control the Panzoom library
        function zoomIn() {
            if (panzoomInstance) {
                panzoomInstance.zoomIn();
            }
        }

        function zoomOut() {
            if (panzoomInstance) {
                panzoomInstance.zoomOut();
            }
        }

        function resetZoom() {
            if (panzoomInstance) {
                panzoomInstance.reset();
            }
        }

function openImagePreview(url) {
            const modal = document.getElementById('image-preview-modal');
            const imageElement = document.getElementById('preview-image');
            const container = document.getElementById('preview-container');

            // Reset any previous instance
            if (panzoomInstance) panzoomInstance.reset();
            
            imageElement.style.display = 'none';
            container.style.display = 'none';

            // Body scroll lock
            scrollYPosition = window.scrollY;
            document.body.style.top = `-${scrollYPosition}px`;
            document.body.classList.add('modal-open');
            
            if (url.match(/\.(jpeg|jpg|gif|png|svg|webp|bmp)$/i)) {
                imageElement.src = url;
                imageElement.style.display = 'block';

                panzoomInstance = Panzoom(imageElement, {
                    maxScale: 4,
                    minScale: 0.5,
                    canvas: true,
                    disableDblclick: true, // <-- ADD THIS LINE
                });
                modal.addEventListener('wheel', panzoomInstance.zoomWithWheel);

            } else if (url.match(/\.(mp4|webm|ogg|mov|avi|mkv|flv|wmv|m4v|3gp)$/i)) {
                container.innerHTML = `<video controls autoplay style="width: 800px; height: auto; max-width: 90vw; max-height: 80vh; border: 2px solid #ffc600; border-radius: 5px;"><source src="${url}" type="video/mp4"></video>`;
                container.style.display = 'block';
            } else {
                container.innerHTML = `<iframe src="${url}" style="width: 800px; height: 600px; max-width: 90vw; max-height: 80vh; border: 2px solid #ffc600; border-radius: 5px;" onerror="showPreviewFallback('${url}')"></iframe>`;
                container.style.display = 'block';
            }
            
            modal.style.display = 'flex';
        }

        // --- NEW: Function to open the Roadmap image ---
function openRoadmapImage() {
    openImagePreview(ROADMAP_CONFIG.imageUrl);
}

function openEventsImage() {
    openImagePreview(EVENTS_CONFIG.imageUrl);
}


// REPLACE your entire setupOptionalButtons function with this one
function setupOptionalButtons() {
    // --- Logic for the Community Challenge Button ---
    const challengeButton = document.getElementById('challenge-btn'); 
    const challengeImage = document.getElementById('challenge-image');
    const challengeDescription = document.getElementById('challenge-description');
    if (COMMUNITY_CHALLENGE_CONFIG.isEnabled) {
        challengeButton.innerHTML = COMMUNITY_CHALLENGE_CONFIG.buttonText;
        if(challengeImage) challengeImage.src = COMMUNITY_CHALLENGE_CONFIG.imageUrl;
        if(challengeDescription) challengeDescription.innerHTML = COMMUNITY_CHALLENGE_CONFIG.descriptionText;
        challengeButton.classList.remove('hidden');
    }

    // --- New Logic for the Events Button ---
    const eventsButton = document.getElementById('events-btn');
    const eventsImage = document.getElementById('events-image');
    const eventsDescription = document.getElementById('events-description');
    if (EVENTS_CONFIG.isEnabled) {
        eventsButton.innerHTML = EVENTS_CONFIG.buttonText;
        if(eventsImage) eventsImage.src = EVENTS_CONFIG.imageUrl;
        if(eventsDescription) eventsDescription.innerHTML = EVENTS_CONFIG.descriptionText;
        eventsButton.classList.remove('hidden');
    }
}


        function showPreviewFallback(url) {
            const container = document.getElementById('preview-container');
            container.innerHTML = `
                <div style="color: white; text-align: center; padding: 40px;">
                    <h3>üåê Cannot Embed Website</h3>
                    <p>Click below to open in new tab:</p>
                    <button onclick="window.open('${url}', '_blank'); closeImagePreview();" 
                            style="background: #ffc600; color: black; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                        Open MapGenie
                    </button>
                </div>
            `;
        }

function closeImagePreview() {
            if (panzoomInstance) {
                panzoomInstance.destroy();
                panzoomInstance = null;
            }

            const modal = document.getElementById('image-preview-modal');
            modal.style.display = 'none';

            document.body.classList.remove('modal-open');
            document.body.style.top = '';
            window.scrollTo(0, scrollYPosition);
        }


        // Close when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.id === 'image-preview-modal') {
                closeImagePreview();
            }
        });

function toggleInfo(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
        section.classList.toggle('show');
        // This saves the new state (open or closed) so it remembers for next time
        saveSectionState(sectionId, section.classList.contains('show'));
    }
}

function toggleExpired() {
    const expiredSection = document.getElementById('expired-section');
    expiredSection.classList.toggle('show');
    // Save the new state
    saveSectionState('expired-section', expiredSection.classList.contains('show'));
}

function togglePermanent() {
    const permanentSection = document.getElementById('permanent-section');
    permanentSection.classList.toggle('show');
    // Save the new state
    saveSectionState('permanent-section', permanentSection.classList.contains('show'));
}

        function copyToClipboard(text, index, type) {
            navigator.clipboard.writeText(text).then(() => {
                const message = document.getElementById(`copied-${type}-${index}`);
                if (message) {
                    message.style.display = 'inline';
                    setTimeout(() => {
                        message.style.display = 'none';
                    }, 2000);
                }
            }).catch(err => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const message = document.getElementById(`copied-${type}-${index}`);
                if (message) {
                    message.style.display = 'inline';
                    setTimeout(() => {
                        message.style.display = 'none';
                    }, 2000);
                }
            });
    // ADD THIS LINE AT THE END
    setLastCopied(text);
}

        function saveRedemptionStatus(code, isRedeemed) {
            try {
                const redeemedCodes = JSON.parse(localStorage.getItem('shiftRedeemedCodes')) || {};
                redeemedCodes[code] = isRedeemed;
                localStorage.setItem('shiftRedeemedCodes', JSON.stringify(redeemedCodes));
            } catch (e) {
                console.error("Error saving to localStorage:", e);
            }
        }

        function getRedemptionStatus(code) {
            try {
                const redeemedCodes = JSON.parse(localStorage.getItem('shiftRedeemedCodes')) || {};
                return redeemedCodes[code] || false;
            } catch (e) {
                console.error("Error reading from localStorage:", e);
                return false;
            }
        }

        function handleRedemptionChange(code, checkbox, container) {
            const isRedeemed = checkbox.checked;
            saveRedemptionStatus(code, isRedeemed);
            
            if (isRedeemed) {
                container.classList.add('redeemed');
            } else {
                container.classList.remove('redeemed');
            }
        }

        function handlePermanentRedemptionChange(code, checkbox, container) {
            const isRedeemed = checkbox.checked;
            saveRedemptionStatus(code, isRedeemed);
            
            if (isRedeemed) {
                container.classList.add('permanent-redeemed');
            } else {
                container.classList.remove('permanent-redeemed');
            }
        }

        // New functions for Black Market Vendor redemption status
        function saveBlackMarketRedemptionStatus(isRedeemed) {
            try {
                localStorage.setItem('blackMarketRedeemed', JSON.stringify(isRedeemed));
            } catch (e) {
                console.error("Error saving Black Market redemption status to localStorage:", e);
            }
        }

        function getBlackMarketRedemptionStatus() {
            try {
                const status = localStorage.getItem('blackMarketRedeemed');
                return status ? JSON.parse(status) : false;
            } catch (e) {
                console.error("Error reading Black Market redemption status from localStorage:", e);
                return false;
            }
        }

        function isImageUrl(str) {
            return str.match(/\.(jpeg|jpg|gif|png|svg|webp)$/i) !== null;
        }

// REFINED createIconHtml function
function createIconHtml(icon, isPermanent = false, iconType = null) {
    let baseClassName;

    if (isPermanent) {
        // Permanent codes will use their specific classes
        baseClassName = isImageUrl(icon) ? 'permanent-custom-icon' : 'permanent-key-icon';
    } else if (iconType === 'active-code') {
        // Active codes will use the new active-codes-icon class
        baseClassName = 'active-codes-icon';
    } else if (iconType === 'blackmarket') {
        // Black market codes will use the new blackmarket-icon class
        baseClassName = 'blackmarket-icon';
    } else {
        // Fallback for any other context, using the original custom/key icons
        // This handles cases where you might call createIconHtml without a specific iconType
        baseClassName = isImageUrl(icon) ? 'custom-icon' : 'key-icon';
    }

    const finalClassName = baseClassName; // In this simple case, finalClassName is just baseClassName

    if (!icon) {
        // Default to a key icon if no icon data is provided
        return `<span class="${finalClassName}">üîë</span>`;
    } else if (isImageUrl(icon)) {
        return `<img src="${icon}" class="${finalClassName}" alt="Icon">`;
    } else {
        // It's text/emoji
        return `<span class="${finalClassName}">${icon}</span>`;
    }
}

        // --- MODIFIED organizeCodes function for robust date comparison and error handling ---
        // --- MODIFIED organizeCodes function for robust date comparison and error handling ---
       function organizeCodes() {
            const now = new Date();
            const nowTimestamp = now.getTime(); // Get timestamp once for consistent comparison
            const regularActiveCodes = [];
            const permanentActiveCodes = [];
            const expiredCodes = [];

            // Process ALL_CODES_CONFIG (regular codes)
            ALL_CODES_CONFIG.forEach(codeData => {
                
                // NEW: Handle Unknown Expire Date (UED)
                if (codeData.expires === "UED") {
                    regularActiveCodes.push(codeData);
                    return; // Classify as active and move to the next code
                }

                // --- FIX STARTS HERE ---
                // First, check if the 'expires' property even exists.
                // If it doesn't, we know it's a permanent active code.
                if (!codeData.expires) {
                    regularActiveCodes.push(codeData);
                    return; // Move to the next code in the loop
                }
                // --- FIX ENDS HERE ---

                // The rest of this logic will now only run for codes that DO have an 'expires' property.
                let expiresDate;
                try {
                    expiresDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                } catch (e) {
                    console.error(`Error parsing expires date for regular code "${codeData.code}":`, codeData.expires, e);
                    expiredCodes.push(codeData);
                    return;
                }

                if (isNaN(expiresDate.getTime())) {
                    console.error("Invalid expires date for regular code (isNaN check):", codeData.code, codeData.expires);
                    expiredCodes.push(codeData);
                    return;
                }

                if (expiresDate.getTime() > nowTimestamp) {
                    regularActiveCodes.push(codeData);
                } else {
                    expiredCodes.push(codeData);
                }
            });

            // Process PERMANENT_CODES (This part remains the same)
            PERMANENT_CODES.forEach(codeData => {
                // NEW: Handle Unknown Expire Date (UED) for permanent codes
                if (codeData.expires === "UED") {
                    permanentActiveCodes.push(codeData);
                    return;
                }

                let expiresDate = null;
                if (codeData.expires) {
                    try {
                        expiresDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                    } catch (e) {
                        console.error(`Error parsing expires date for permanent code "${codeData.code}":`, codeData.expires, e);
                        permanentActiveCodes.push(codeData);
                        return;
                    }

                    if (isNaN(expiresDate.getTime())) {
                        console.error("Invalid expires date for permanent code (isNaN check):", codeData.code, codeData.expires);
                        permanentActiveCodes.push(codeData);
                        return;
                    }
                }
                
                if (!expiresDate || expiresDate.getTime() > nowTimestamp) {
                    permanentActiveCodes.push(codeData);
                } else { 
                    expiredCodes.push({
                        ...codeData,
                        wasPermanent: true
                    });
                }
            });
            
            return { regularActiveCodes, permanentActiveCodes, expiredCodes };
        }

        function formatDate(date) {
            // Ensure the date object is valid before formatting
            if (!date || isNaN(date.getTime())) {
                return "Invalid Date";
            }
            // Convert to user's local time with clear timezone info
            const userLocalTime = date.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZoneName: 'short'
            });
            
            // Get the user's timezone
            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            return `${userLocalTime} (Your Timezone: ${userTimezone})`; 
        }

function createPermanentCodeBox(codeData, index) {
    const hasCopyButton = codeData.showCopyButton !== false;
    const hasPreviewButton = codeData.showPreviewButton;
    const isRedeemed = getRedemptionStatus(codeData.code);
    const redeemedClass = isRedeemed ? 'permanent-redeemed' : '';
    const iconHtml = createIconHtml(codeData.icon, true);
    
    const descriptionHtml = codeData.description ? `<div class="code-description permanent-description">${codeData.description}</div>` : '';

    const formattedDate = getFormattedDateAdded(codeData);
    const dateAddedHtml = formattedDate ? `<div class="date-added">Added Here On : ${formattedDate}</div>` : '';
    
    // --- START: ADDED THIS BLOCK TO HANDLE THE REPORT BUTTON ---
    let reportButtonHtml = '';
    // Only show the button if showReportButton is explicitly set to true
    if (codeData.showReportButton === true) {
        const codeToCheck = codeData.code.trim();
const isReportedLocally = getReportedStatus(codeToCheck);
if (isReportedLocally) {
            reportButtonHtml = `<button class="report-btn-corner reported" title="This Has Been Reported" disabled>‚úîÔ∏è</button>`;
        } else {
            const isReportedLocally = getReportedStatus(codeToCheck);
            if (isReportedLocally) {
                reportButtonHtml = `<button class="report-btn-corner reported" title="You have already reported this code. Thank you!" disabled>‚úîÔ∏è</button>`;
            } else {
                reportButtonHtml = `<button class="report-btn-corner" onclick="openReportModal('${codeToCheck}')" title="Reports As Not Working">‚ö†Ô∏è</button>`;
            }
        }
    }
    // --- END: ADDED BLOCK ---

    let expirationHtml = '';
    if (codeData.expires === "UED") {
        expirationHtml = `<div class="expire-date">Expires: Unknown</div>`;
    } else if (codeData.expires) {
        let expiresDate;
        try {
            expiresDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
            if (!isNaN(expiresDate.getTime())) {
                const timeLeft = expiresDate.getTime() - new Date().getTime();
                let countdownHtml = '';
                if (timeLeft > 0) {
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    countdownHtml = `<div class="countdown">Time left: ${days}d ${hours}h ${minutes}m</div>`;
                }
                expirationHtml = `<div class="expire-date">Expires: ${formatDate(expiresDate)}</div>${countdownHtml}`;
            }
        } catch (e) {
            console.error("Error parsing expires date:", e);
        }
    }
    
    let copyButtonHtml = ''; if (hasCopyButton) { copyButtonHtml = `<button class="permanent-copy-btn" onclick="copyToClipboard('${codeData.code}', ${index}, 'permanent')">COPY</button><span id="copied-permanent-${index}" class="permanent-copied-message">‚úì Copied!</span>`; }
    let previewButtonHtml = ''; if (hasPreviewButton && codeData.imagePreview) { previewButtonHtml = `<button class="prempreview-btn" onclick="openImagePreview('${codeData.imagePreview}')">üì∑ PREVIEW</button>`; }
    
    return `
        <div class="permanent-code-box clearfix ${redeemedClass}" id="permanent-${index}" data-code-id="${codeData.code}">
            ${reportButtonHtml} <!-- ADDED THIS LINE -->
            <div class="permanent-code-header">${iconHtml}<div class="permanent-code-text">${codeData.code}</div></div>
            ${dateAddedHtml}
            <div class="permanent-title-container">${codeData.title}</div>
            ${descriptionHtml}
            ${expirationHtml}
            <div class="permanent-code-footer">
                <div class="permredeem-checkbox"><input type="checkbox" id="permanent-redeemed-${index}" ${isRedeemed ? 'checked' : ''} onchange="handlePermanentRedemptionChange('${codeData.code}', this, document.getElementById('permanent-${index}'))"><label for="permanent-redeemed-${index}">üéÅ</label></div>
                ${copyButtonHtml}${previewButtonHtml}
            </div>
        </div>`;
}


// REPLACE your entire createActiveCodeBox function with this one

function createActiveCodeBox(codeData, index) {
    const hasCopyButton = codeData.showCopyButton !== false;
    const hasPreviewButton = codeData.showPreviewButton;
    const isRedeemed = getRedemptionStatus(codeData.code);
    const redeemedClass = isRedeemed ? 'redeemed' : '';
    const iconHtml = createIconHtml(codeData.icon, false, 'active-code');
    const descriptionHtml = codeData.description ? `<div class="code-description">${codeData.description}</div>` : '';
    const formattedDate = getFormattedDateAdded(codeData);
    const dateAddedHtml = formattedDate ? `<div class="date-added">Added Here On : ${formattedDate}</div>` : '';

    let expirationDetailsHtml = '';
    // ... (rest of expiration logic is unchanged, so I've shortened it for clarity) ...
    if (codeData.expires === "UED") { expirationDetailsHtml = `<div class="expire-date">Expires: Unknown</div>`; } else if (codeData.expires) { let expiresDate; try { expiresDate = new Date(codeData.expires); if (!isNaN(expiresDate.getTime())) { const timeLeft = expiresDate.getTime() - new Date().getTime(); if (timeLeft > 0) { const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24)); const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)); const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60)); expirationDetailsHtml = `<div class="expire-date">Expires: ${formatDate(expiresDate)}</div><div class="countdown">Time left: ${days}d ${hours}h ${minutes}m</div>`; } } } catch (e) { console.error("Error parsing expires date:", e); } } else { expirationDetailsHtml = `<div class="expire-date">Expires: Never (Permanent Code)</div>`; }
    
    // --- START: REPLACE THIS LOGIC BLOCK ---
    let reportButtonHtml = '';
    if (codeData.showReportButton !== false) {
        
        const codeToCheck = codeData.code.trim();
        
        // THIS IS THE FIX: It now reads directly from the global variable
        // which is guaranteed to be ready before this function runs.
const isReportedLocally = getReportedStatus(codeToCheck);
if (isReportedLocally) {
            reportButtonHtml = `<button class="report-btn-corner reported" title="This Has Been Reported" disabled>‚úîÔ∏è</button>`;
        } else {
            const isReportedLocally = getReportedStatus(codeToCheck);
            if (isReportedLocally) {
                reportButtonHtml = `<button class="report-btn-corner reported" title="You have already reported this code. Thank you!" disabled>‚úîÔ∏è</button>`;
            } else {
                reportButtonHtml = `<button class="report-btn-corner" onclick="openReportModal('${codeToCheck}')" title="Reports As Not Working">‚ö†Ô∏è</button>`;
            }
        }
    }
    // --- END: REPLACE THIS LOGIC BLOCK ---

    let copyButtonHtml = ''; if (hasCopyButton) { copyButtonHtml = `<button class="small-copy-btn" onclick="copyToClipboard('${codeData.code}', ${index}, 'active')">COPY</button>`; }
    let previewButtonHtml = ''; if (hasPreviewButton && codeData.imagePreview) { previewButtonHtml = `<button class="activepreview-btn" onclick="openImagePreview('${codeData.imagePreview}')">üì∑ PREVIEW</button>`; }
    
    return `
        <div class="code-box ${redeemedClass}" id="active-${index}" data-code-id="${codeData.code}">
            ${reportButtonHtml}
            <div class="code-header">${iconHtml}<div class="title-container">${codeData.title}</div></div>
            ${dateAddedHtml}
            ${descriptionHtml}
            <div class="code-text">${codeData.code}</div>
            ${expirationDetailsHtml}
            <div class="code-footer">
                <div class="actredeem-checkbox"><input type="checkbox" id="redeemed-${index}" ${isRedeemed ? 'checked' : ''} onchange="handleRedemptionChange('${codeData.code}', this, document.getElementById('active-${index}'))"><label for="redeemed-${index}">üëç</label></div>
                <div class="active-code-buttons-group">${previewButtonHtml}${copyButtonHtml}</div>
            </div>
        </div>`;
}


        function createExpiredCodeBox(codeData, index) {
            const hasPreviewButton = codeData.showPreviewButton;
            const isRedeemed = getRedemptionStatus(codeData.code);
            const redeemedClass = isRedeemed ? 'redeemed' : '';
            const iconHtml = createIconHtml(codeData.icon, false);
            
            const descriptionHtml = codeData.description ? 
                `<div class="code-description expired-description">${codeData.description}</div>` : '';
            
            const formattedDate = getFormattedDateAdded(codeData);
            const dateAddedHtml = formattedDate ? `<div class="date-added">Added Here On : ${formattedDate}</div>` : '';
            
            // --- NEW LOGIC STARTS HERE ---
            // Check for the showCopyButton property, defaulting to true if it's missing.
            const hasCopyButton = codeData.showCopyButton !== false;
            let copyButtonHtml = ''; // Create an empty placeholder

            // Only create the button HTML if hasCopyButton is true.
            if (hasCopyButton) {
                copyButtonHtml = `
                    <button class="expired-copy-btn" onclick="copyToClipboard('${codeData.code}', ${index}, 'expired')">
                        COPY
                    </button>
                    <span id="copied-expired-${index}" class="copied-message">‚úì Copied!</span>
                `;
            }
            // --- NEW LOGIC ENDS HERE ---
            
            let previewButtonHtml = '';
            if (hasPreviewButton && codeData.imagePreview) { 
                previewButtonHtml = `<button class="exppreview-btn" onclick="openImagePreview('${codeData.imagePreview}')">üì∑ PREVIEW</button>`;
            }
            
            let expiresDate;
            try {
                expiresDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                if (isNaN(expiresDate.getTime())) { expiresDate = new Date(); }
            } catch (e) {
                expiresDate = new Date();
            }

            return `
                <div class="expired-code-box ${redeemedClass}" id="expired-${index}" data-code-id="${codeData.code}">
                    <div class="code-header">
                        ${iconHtml}
                        <div class="title-container">${codeData.title}</div>
                    </div>
                    
                    ${dateAddedHtml}
                    ${descriptionHtml}
                    
                    <div class="code-text">${codeData.code}</div>
                    <div class="expire-date">Expired: ${formatDate(expiresDate)}</div>
                    <div class="code-footer">
                        <div class="redeem-checkbox">
                            <input type="checkbox" id="expired-redeemed-${index}" ${isRedeemed ? 'checked' : ''} 
                                onchange="handleRedemptionChange('${codeData.code}', this, document.getElementById('expired-${index}'))">
                            <label for="expired-redeemed-${index}">üëé</label>
                        </div>
                        <div class="active-code-buttons-group">
                            ${previewButtonHtml} 
                            
                            <!-- Use the new variable which is either the button or an empty string -->
                            ${copyButtonHtml}
                            
                        </div>
                    </div>
                    <div class="expired-text">‚ùå EXPIRED</div>
                </div>
            `;
        }

        function updateCountdowns() {
            const now = new Date();
            const nowTimestamp = now.getTime();
            
            // Update active codes
            const activeContainers = document.querySelectorAll('#active-codes-container .code-box');
            activeContainers.forEach((container) => {
                const countdownElement = container.querySelector('.countdown');
                const codeTextElement = container.querySelector('.code-text');
                
                if (!countdownElement || !codeTextElement) return;
                
                const codeText = codeTextElement.textContent;
                // Find the correct code data from ALL_CODES_CONFIG (excluding the vendor for this loop)
                const codeData = ALL_CODES_CONFIG.find(code => code.code === codeText);
                
                // NEW: Skip if no codeData, no expires property, or if expires is "UED"
                if (!codeData || !codeData.expires || codeData.expires === "UED") {
                    return;
                }
                
                let expireDate;
                try {
                    expireDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                    if (isNaN(expireDate.getTime())) {
                        console.error("Invalid expires date in updateCountdowns (active) for:", codeData.code, codeData.expires);
                        countdownElement.textContent = 'Invalid Date';
                        countdownElement.style.color = '#ff4444';
                        return;
                    }
                } catch (e) {
                    console.error("Error parsing expires date in updateCountdowns (active) for:", codeData.code, codeData.expires, e);
                    countdownElement.textContent = 'Error Date';
                    countdownElement.style.color = '#ff4444';
                    return;
                }

                const timeLeft = expireDate.getTime() - nowTimestamp;
                
                if (timeLeft <= 0) {
                    countdownElement.textContent = 'EXPIRED';
                    countdownElement.style.color = '#ff4444';
                    // Note: This only updates the text. To *move* the box, you'd need more complex DOM manipulation
                    // or re-initialize the page which happens on a full refresh.
                } else {
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                    
                    countdownElement.textContent = `Time left: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                    countdownElement.style.color = '#ff7c00';
                }
            });
            
            // Update permanent codes countdowns
            const permanentContainers = document.querySelectorAll('#permanent-codes-container .permanent-code-box');
            permanentContainers.forEach((container) => {
                const countdownElement = container.querySelector('.countdown');
                const codeTextElement = container.querySelector('.permanent-code-text');
                
                if (!countdownElement || !codeTextElement) return;
                
                const codeText = codeTextElement.textContent;
                const codeData = PERMANENT_CODES.find(code => code.code === codeText);
                
                // NEW: Skip if no codeData, no expires property, or if expires is "UED"
                if (!codeData || !codeData.expires || codeData.expires === "UED") {
                    if (countdownElement) countdownElement.textContent = ''; 
                    return;
                }
                
                let expireDate;
                try {
                    expireDate = (codeData.expires instanceof Date) ? codeData.expires : new Date(codeData.expires);
                    if (isNaN(expireDate.getTime())) {
                        console.error("Invalid expires date in updateCountdowns (permanent) for:", codeData.code, codeData.expires);
                        countdownElement.textContent = 'Invalid Date';
                        countdownElement.style.color = '#ff4444';
                        return;
                    }
                } catch (e) {
                    console.error("Error parsing expires date in updateCountdowns (permanent) for:", codeData.code, codeData.expires, e);
                    countdownElement.textContent = 'Error Date';
                    countdownElement.style.color = '#ff4444';
                    return;
                }

                const timeLeft = expireDate.getTime() - nowTimestamp;
                
                if (timeLeft <= 0) {
                    countdownElement.textContent = 'EXPIRED';
                    countdownElement.style.color = '#ff4444';
                } else {
                    const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                    
                    countdownElement.textContent = `Time left: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                    countdownElement.style.color = '#ff7c00';
                }
            });
        }

        // ==================== AUTO CACHE DETECTION ====================
function getCodesHash() {
    // Include all code configs and the Black Market vendor's next refresh time
    const allCodesData = [...ALL_CODES_CONFIG, ...PERMANENT_CODES]; 
    const hashString = allCodesData.map(code => 
code.code + (code.expires ? (new Date(code.expires).getTime() || '') : '') + (code.dateAdded || '')
    ).join('|');

    // Add the next vendor refresh time to the hash to ensure refresh on vendor change
    const nextVendorRefreshTimestamp = getNextVendorRefresh().getTime();
    return btoa(hashString + `|VendorRefresh:${nextVendorRefreshTimestamp}`).substring(0, 32); 
}

        function checkCodesVersion() {
            const currentHash = getCodesHash();
            const savedHash = localStorage.getItem('shiftCodesHash');
            
            if (savedHash !== currentHash) {
                // Codes have changed - update and refresh
                localStorage.setItem('shiftCodesHash', currentHash);
                console.log('Codes updated, refreshing page...');
                location.reload();
                return true; // Page will refresh
            }
            
            return false; // No changes, continue normally
        }

function initializePage() {
        // === ADD THIS BLOCK AT THE TOP OF THE FUNCTION ===
    const pollButton = document.getElementById('openPollBtn');
    if (pollButton && !POLL_CONFIG.isEnabled) {
        pollButton.classList.add('hidden');
    }
    // 
    const permanentContainer = document.getElementById('permanent-codes-container');
    const activeContainer = document.getElementById('active-codes-container');
    const expiredContainer = document.getElementById('expired-codes-container');
    const blackMarketContainer = document.getElementById('black-market-codes-container'); 
    
    // Clear all containers to prevent duplicates
    permanentContainer.innerHTML = '';
    activeContainer.innerHTML = '';
    expiredContainer.innerHTML = '';
    blackMarketContainer.innerHTML = '';

    const { regularActiveCodes, permanentActiveCodes, expiredCodes } = organizeCodes();
    
    // --- THIS IS THE CORRECTED LOGIC ---
    // It now loops through your BLACK_MARKET_VENDORS array
    if (BLACK_MARKET_VENDORS && BLACK_MARKET_VENDORS.length > 0) {
        BLACK_MARKET_VENDORS.forEach((vendorData, index) => {
            blackMarketContainer.innerHTML += createBlackMarketVendorBox(vendorData, index);
        });
    } else {
        blackMarketContainer.innerHTML = '<div class="no-codes">Black Market Vendor information is currently unavailable.</div>';
    }
    // --- END OF CORRECTION ---
    
    // Render active codes
    if (regularActiveCodes.length > 0) {
        regularActiveCodes.forEach((codeData, index) => {
            activeContainer.innerHTML += createActiveCodeBox(codeData, index);
        });
    } else {
        activeContainer.innerHTML += '<div class="no-codes">No active regular codes at the moment. Check back later, Vault Hunter!</div>';
    }
    
    // Render permanent codes
    if (permanentActiveCodes.length > 0) {
        permanentActiveCodes.forEach((codeData, index) => {
            permanentContainer.innerHTML += createPermanentCodeBox(codeData, index);
        });
    } else {
        permanentContainer.innerHTML += '<div class="no-codes">No permanent codes available at this time.</div>';
    }
    
    // Render expired codes
    if (expiredCodes.length > 0) {
        expiredCodes.forEach((codeData, index) => {
            expiredContainer.innerHTML += createExpiredCodeBox(codeData, index);
        });
    } else {
        expiredContainer.innerHTML += '<div class="no-codes">No expired codes to display.</div>';
    }

        setupOptionalButtons();
    
    updateCountdowns(); // Initial call
// ... (rest of the function) ...
    setInterval(updateCountdowns, 1000); 
    applyDisplayPreferences();
    applySavedSectionStates();
        applyLastCopiedState();
}

  let scrollYPosition = 0; // Defining this globally for the lock function

document.addEventListener('DOMContentLoaded', () => {
    // --- THIS IS THE NEW, ROBUST RESET LOGIC ---
    try {
        const nextRefreshTimestamp = getNextVendorRefresh().getTime();
        const lastKnownRefresh = localStorage.getItem('lastKnownRefresh');

        // If the upcoming refresh time is different from the last one we saved,
        // it means a weekly reset has happened since the last visit.
        if (lastKnownRefresh !== nextRefreshTimestamp.toString()) {
            clearBlackMarketStatusOnReset();
            // After cleaning up, save the new upcoming refresh time so we don't clean up again until the *next* reset.
            localStorage.setItem('lastKnownRefresh', nextRefreshTimestamp);
            console.log(`New refresh time set for: ${new Date(nextRefreshTimestamp)}`);
        }
    } catch (e) {
        console.error("Error in weekly reset detection logic:", e);
    }
    // --- END OF NEW LOGIC ---

    // The rest of the function remains the same
    if (!checkCodesVersion()) {
        initializePage();
    }

    // Connect the buttons to the NEW Panzoom control functions
            const zoomInButton = document.getElementById('zoom-in-btn');
            const zoomOutButton = document.getElementById('zoom-out-btn');
            const resetZoomButton = document.getElementById('reset-zoom-btn');
            const closeButton = document.getElementById('close-preview-btn');

            if (zoomInButton) zoomInButton.addEventListener('click', zoomIn);
            if (zoomOutButton) zoomOutButton.addEventListener('click', zoomOut);
            if (resetZoomButton) resetZoomButton.addEventListener('click', resetZoom);

            // This button's ID was different in my example, let's use the correct one from your HTML.
            // Assuming the close button in the control bar is the main one now.
            const newCloseButton = document.getElementById('close-preview-btn');
            if (newCloseButton) newCloseButton.addEventListener('click', closeImagePreview);
            
             // Close when clicking outside on the modal background
            const modal = document.getElementById('image-preview-modal');
            if(modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target.id === 'image-preview-modal') {
                        closeImagePreview();
                    }
                });
            }
        });

        // --- NEW: Functions for User Display Preferences ---
        function saveDisplayPreference(elementId, isHidden) {
            try {
                const preferences = JSON.parse(localStorage.getItem('userDisplayPreferences')) || {};
                preferences[elementId] = isHidden; // Store true if hidden, false if visible
                localStorage.setItem('userDisplayPreferences', JSON.stringify(preferences));
            } catch (e) {
                console.error("Error saving display preference to localStorage:", e);
            }
        }

        function getDisplayPreference(elementId) {
            try {
                const preferences = JSON.parse(localStorage.getItem('userDisplayPreferences')) || {};
                // Default to false (not hidden) if no preference is saved
                return preferences[elementId] || false; 
            } catch (e) {
                console.error("Error reading display preference from localStorage:", e);
                return false;
            }
        }

        function applyDisplayPreferences() {
            const controlledElements = ['settings-toggle-btn', 'redeem-toggle-btn', 'roadmap-btn', 'maurices-toggle-btn', 'permanent-toggle-btn'];

            controlledElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    const isHidden = getDisplayPreference(id);
                    element.classList.toggle('hidden', isHidden); // Add/remove 'hidden' class
                    
                    // Also update the state of the checkbox in the settings panel
                    const checkbox = document.getElementById(`hide-${id}`);
                    if (checkbox) {
                        checkbox.checked = isHidden;
                    }
                }
            });
        }

        function handleSettingChange(elementId, isHidden) {
            saveDisplayPreference(elementId, isHidden);
            applyDisplayPreferences(); // Re-apply all preferences immediately
        }
        // -- END NEW FUNCTIONS --

/* FEEDBACK QUESTIONS Webhook |||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||  */
/* =================================================== */
/*         START: SLICK FEEDBACK MODAL SCRIPT          */
/* =================================================== */
document.addEventListener('DOMContentLoaded', () => {

    // --- 1. CONFIGURATION ---
    //
    // üö® FIX: PASTE YOUR REAL DISCORD WEBHOOK URL HERE! üö®
    const discordWebhookUrl = "https://discord.com/api/webhooks/1427139309588189265/ep1T-rbIqqhpwfes6t_86sgu8RqNrFaw782DrJozkrbKEJbYDbzL17bWKdZDrPUMJs2O"; 
    //
    const openModalButton = document.querySelector('.floating-feedback-btn'); 

    // --- 2. GETTING ELEMENTS ---
    const modalOverlay = document.getElementById('feedback-modal-overlay');
    const closeButton = document.querySelector('.feedback-close-btn');
    const feedbackForm = document.getElementById('feedback-form');
    const pages = document.querySelectorAll('.feedback-page');
    const prevBtn = document.getElementById('feedback-prev-btn');
    const nextBtn = document.getElementById('feedback-next-btn');
    const submitBtn = document.getElementById('feedback-submit-btn');
    const stepIndicator = document.getElementById('feedback-step-indicator');
    
    let currentPage = 0;
    const totalFormPages = pages.length - 1;
    
    // --- 3. CORE FUNCTIONS ---
    
    function showPage(pageIndex) {
        pages.forEach((page, index) => {
            page.classList.toggle('active', index === pageIndex);
        });

        if (pageIndex < totalFormPages) {
            stepIndicator.textContent = `Step ${pageIndex + 1} of ${totalFormPages}`;
            stepIndicator.style.display = 'block';
        } else {
            stepIndicator.style.display = 'none';
        }
        
        prevBtn.style.display = pageIndex === 0 ? 'none' : 'inline-block';
        nextBtn.style.display = pageIndex < totalFormPages - 1 ? 'inline-block' : 'none';
        submitBtn.style.display = pageIndex === totalFormPages - 1 ? 'inline-block' : 'none';

        if (pageIndex === totalFormPages) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'none';
        }
    }

    function openModal() {
        if (!modalOverlay) return;
        currentPage = 0;
        feedbackForm.reset();
        showPage(currentPage);
        modalOverlay.style.display = 'flex';
    }

    function closeModal() {
        if (!modalOverlay) return;
        modalOverlay.style.display = 'none';
    }
    
    function validatePage(pageIndex) {
        if (pageIndex === 4) { // Skips validation for the optional socials page
            return true; 
        }
        const currentPageElement = pages[pageIndex];
        const requiredInputs = currentPageElement.querySelectorAll('[required]');
        let allValid = true;
        requiredInputs.forEach(input => {
            input.classList.remove('invalid');
            const radioGroup = input.closest('.radio-group');
            if(radioGroup) radioGroup.classList.remove('invalid');
            if (input.type === 'radio') {
                if (!feedbackForm.querySelector(`input[name="${input.name}"]:checked`)) {
                    allValid = false;
                    if(radioGroup) radioGroup.classList.add('invalid');
                }
            } else if (input.value.trim() === '') {
                allValid = false;
                input.classList.add('invalid');
            }
        });
        return allValid;
    }

async function submitFeedback() {
    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';

    const formData = new FormData(feedbackForm);
    let messageContent = "**üìù New Feedback Submission!**\n\n";
    formData.forEach((value, key) => {
        if (value.trim() !== '') {
            messageContent += `**${key}:**\n\`\`\`${value}\`\`\`\n`;
        }
    });
    
    // THIS IS THE CORRECTED PAYLOAD
    const payload = {
        username: "Feedback Bot",
        avatar_url: "https://cdn-icons-png.flaticon.com/512/3991/3991971.png",
        content: messageContent,
        thread_name: `Feedback from: ${formData.get('Username') || 'Anonymous'}` // Dynamic title!
    };

    try {
        const response = await fetch(discordWebhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
        });

        if (response.ok) {
            currentPage++;
            showPage(currentPage);
        } else {
            // This alert will now give you a more specific error from Discord
            const errorData = await response.json();
            alert(`Error from Discord: ${errorData.message}`);
        }
    } catch (error) {
        alert('A network error occurred. Please check your connection and try again.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit';
    }
}

    // --- 4. EVENT LISTENERS ---
    if (openModalButton) openModalButton.addEventListener('click', openModal);
    if (closeButton) closeButton.addEventListener('click', closeModal);
    if (modalOverlay) modalOverlay.addEventListener('click', e => { if (e.target === modalOverlay) closeModal(); });
    if (nextBtn) nextBtn.addEventListener('click', () => { if (validatePage(currentPage)) { currentPage++; showPage(currentPage); } });
    if (prevBtn) prevBtn.addEventListener('click', () => { currentPage--; showPage(currentPage); });
    if (submitBtn) submitBtn.addEventListener('click', submitFeedback);
});
/* =================================================== */
/*          END: SLICK FEEDBACK MODAL SCRIPT           */
/* =================================================== */

    </script>

        <div class="poll-modal-overlay" id="pollModal">
        <div class="poll-modal-content">
            <button class="close-poll-btn" id="closePollBtn">&times;</button>
            <div class="strawpoll-embed" id="strawpoll_kjn1Ddk30yQ">
                <iframe title="StrawPoll Embed" id="strawpoll_iframe_kjn1Ddk30yQ" src="https://strawpoll.com/embed/kjn1Ddk30yQ?theme=dark" frameborder="0" allowfullscreen allowtransparency></iframe>
                <script async src="https://cdn.strawpoll.com/dist/widgets.js" charset="utf-8"></script>
            </div>
        </div>
    </div>

<!-- START: New Ko-fi Modal -->
<div id="kofi-modal-overlay" class="modal-overlay">
    <div class="modal-content">
        <button class="close-modal" onclick="closeKofiModal()">&times;</button>
        <div id="kofi-iframe-container">
            <!-- The iframe will be inserted here by JavaScript -->
        </div>
    </div>
</div>
<!-- END: New Ko-fi Modal -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Find the report form by its ID
    const reportForm = document.getElementById('report-form');

    // If the form exists on the page...
    if (reportForm) {
        // ...listen for its 'submit' event and call the handleReportSubmit function when it happens.
        reportForm.addEventListener('submit', handleReportSubmit);
    }
});
</script>

</body>
</html>
